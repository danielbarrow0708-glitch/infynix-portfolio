(function(){"use strict";var Pi,J,yc,kc,In,wc,Cc,_c,Sc,Ro,Io,Oo,Tc,Ri={},xc=[],ym=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Ii=Array.isArray;function xt(t,e){for(var n in e)t[n]=e[n];return t}function Do(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function _e(t,e,n){var i,r,o,s={};for(o in e)o=="key"?i=e[o]:o=="ref"?r=e[o]:s[o]=e[o];if(arguments.length>2&&(s.children=arguments.length>3?Pi.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(o in t.defaultProps)s[o]===void 0&&(s[o]=t.defaultProps[o]);return Oi(t,s,i,r,null)}function Oi(t,e,n,i,r){var o={type:t,props:e,key:n,ref:i,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:r??++yc,__i:-1,__u:0};return r==null&&J.vnode!=null&&J.vnode(o),o}function Ec(){return{current:null}}function Te(t){return t.children}function ft(t,e){this.props=t,this.context=e}function Wn(t,e){if(e==null)return t.__?Wn(t.__,t.__i+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?Wn(t):null}function Pc(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return Pc(t)}}function Ao(t){(!t.__d&&(t.__d=!0)&&In.push(t)&&!ar.__r++||wc!=J.debounceRendering)&&((wc=J.debounceRendering)||Cc)(ar)}function ar(){for(var t,e,n,i,r,o,s,a=1;In.length;)In.length>a&&In.sort(_c),t=In.shift(),a=In.length,t.__d&&(n=void 0,r=(i=(e=t).__v).__e,o=[],s=[],e.__P&&((n=xt({},i)).__v=i.__v+1,J.vnode&&J.vnode(n),Mo(e.__P,n,i,e.__n,e.__P.namespaceURI,32&i.__u?[r]:null,o,r??Wn(i),!!(32&i.__u),s),n.__v=i.__v,n.__.__k[n.__i]=n,Ac(o,n,s),n.__e!=r&&Pc(n)));ar.__r=0}function Rc(t,e,n,i,r,o,s,a,c,l,d){var u,h,f,g,p,v,b,k=i&&i.__k||xc,C=e.length;for(c=km(n,e,k,c,C),u=0;u<C;u++)(f=n.__k[u])!=null&&(h=f.__i==-1?Ri:k[f.__i]||Ri,f.__i=u,v=Mo(t,f,h,r,o,s,a,c,l,d),g=f.__e,f.ref&&h.ref!=f.ref&&(h.ref&&Lo(h.ref,null,f),d.push(f.ref,f.__c||g,f)),p==null&&g!=null&&(p=g),(b=!!(4&f.__u))||h.__k===f.__k?c=Ic(f,c,t,b):typeof f.type=="function"&&v!==void 0?c=v:g&&(c=g.nextSibling),f.__u&=-7);return n.__e=p,c}function km(t,e,n,i,r){var o,s,a,c,l,d=n.length,u=d,h=0;for(t.__k=new Array(r),o=0;o<r;o++)(s=e[o])!=null&&typeof s!="boolean"&&typeof s!="function"?(c=o+h,(s=t.__k[o]=typeof s=="string"||typeof s=="number"||typeof s=="bigint"||s.constructor==String?Oi(null,s,null,null,null):Ii(s)?Oi(Te,{children:s},null,null,null):s.constructor==null&&s.__b>0?Oi(s.type,s.props,s.key,s.ref?s.ref:null,s.__v):s).__=t,s.__b=t.__b+1,a=null,(l=s.__i=wm(s,n,c,u))!=-1&&(u--,(a=n[l])&&(a.__u|=2)),a==null||a.__v==null?(l==-1&&(r>d?h--:r<d&&h++),typeof s.type!="function"&&(s.__u|=4)):l!=c&&(l==c-1?h--:l==c+1?h++:(l>c?h--:h++,s.__u|=4))):t.__k[o]=null;if(u)for(o=0;o<d;o++)(a=n[o])!=null&&(2&a.__u)==0&&(a.__e==i&&(i=Wn(a)),Nc(a,a));return i}function Ic(t,e,n,i){var r,o;if(typeof t.type=="function"){for(r=t.__k,o=0;r&&o<r.length;o++)r[o]&&(r[o].__=t,e=Ic(r[o],e,n,i));return e}t.__e!=e&&(i&&(e&&t.type&&!e.parentNode&&(e=Wn(t)),n.insertBefore(t.__e,e||null)),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function qt(t,e){return e=e||[],t==null||typeof t=="boolean"||(Ii(t)?t.some(function(n){qt(n,e)}):e.push(t)),e}function wm(t,e,n,i){var r,o,s,a=t.key,c=t.type,l=e[n],d=l!=null&&(2&l.__u)==0;if(l===null&&t.key==null||d&&a==l.key&&c==l.type)return n;if(i>(d?1:0)){for(r=n-1,o=n+1;r>=0||o<e.length;)if((l=e[s=r>=0?r--:o++])!=null&&(2&l.__u)==0&&a==l.key&&c==l.type)return s}return-1}function Oc(t,e,n){e[0]=="-"?t.setProperty(e,n??""):t[e]=n==null?"":typeof n!="number"||ym.test(e)?n:n+"px"}function cr(t,e,n,i,r){var o,s;e:if(e=="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof i=="string"&&(t.style.cssText=i=""),i)for(e in i)n&&e in n||Oc(t.style,e,"");if(n)for(e in n)i&&n[e]==i[e]||Oc(t.style,e,n[e])}else if(e[0]=="o"&&e[1]=="n")o=e!=(e=e.replace(Sc,"$1")),s=e.toLowerCase(),e=s in t||e=="onFocusOut"||e=="onFocusIn"?s.slice(2):e.slice(2),t.l||(t.l={}),t.l[e+o]=n,n?i?n.u=i.u:(n.u=Ro,t.addEventListener(e,o?Oo:Io,o)):t.removeEventListener(e,o?Oo:Io,o);else{if(r=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t)try{t[e]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&e[4]!="-"?t.removeAttribute(e):t.setAttribute(e,e=="popover"&&n==1?"":n))}}function Dc(t){return function(e){if(this.l){var n=this.l[e.type+t];if(e.t==null)e.t=Ro++;else if(e.t<n.u)return;return n(J.event?J.event(e):e)}}}function Mo(t,e,n,i,r,o,s,a,c,l){var d,u,h,f,g,p,v,b,k,C,y,_,S,E,x,P,D,M=e.type;if(e.constructor!=null)return null;128&n.__u&&(c=!!(32&n.__u),o=[a=e.__e=n.__e]),(d=J.__b)&&d(e);e:if(typeof M=="function")try{if(b=e.props,k="prototype"in M&&M.prototype.render,C=(d=M.contextType)&&i[d.__c],y=d?C?C.props.value:d.__:i,n.__c?v=(u=e.__c=n.__c).__=u.__E:(k?e.__c=u=new M(b,y):(e.__c=u=new ft(b,y),u.constructor=M,u.render=_m),C&&C.sub(u),u.props=b,u.state||(u.state={}),u.context=y,u.__n=i,h=u.__d=!0,u.__h=[],u._sb=[]),k&&u.__s==null&&(u.__s=u.state),k&&M.getDerivedStateFromProps!=null&&(u.__s==u.state&&(u.__s=xt({},u.__s)),xt(u.__s,M.getDerivedStateFromProps(b,u.__s))),f=u.props,g=u.state,u.__v=e,h)k&&M.getDerivedStateFromProps==null&&u.componentWillMount!=null&&u.componentWillMount(),k&&u.componentDidMount!=null&&u.__h.push(u.componentDidMount);else{if(k&&M.getDerivedStateFromProps==null&&b!==f&&u.componentWillReceiveProps!=null&&u.componentWillReceiveProps(b,y),!u.__e&&u.shouldComponentUpdate!=null&&u.shouldComponentUpdate(b,u.__s,y)===!1||e.__v==n.__v){for(e.__v!=n.__v&&(u.props=b,u.state=u.__s,u.__d=!1),e.__e=n.__e,e.__k=n.__k,e.__k.some(function(F){F&&(F.__=e)}),_=0;_<u._sb.length;_++)u.__h.push(u._sb[_]);u._sb=[],u.__h.length&&s.push(u);break e}u.componentWillUpdate!=null&&u.componentWillUpdate(b,u.__s,y),k&&u.componentDidUpdate!=null&&u.__h.push(function(){u.componentDidUpdate(f,g,p)})}if(u.context=y,u.props=b,u.__P=t,u.__e=!1,S=J.__r,E=0,k){for(u.state=u.__s,u.__d=!1,S&&S(e),d=u.render(u.props,u.state,u.context),x=0;x<u._sb.length;x++)u.__h.push(u._sb[x]);u._sb=[]}else do u.__d=!1,S&&S(e),d=u.render(u.props,u.state,u.context),u.state=u.__s;while(u.__d&&++E<25);u.state=u.__s,u.getChildContext!=null&&(i=xt(xt({},i),u.getChildContext())),k&&!h&&u.getSnapshotBeforeUpdate!=null&&(p=u.getSnapshotBeforeUpdate(f,g)),P=d,d!=null&&d.type===Te&&d.key==null&&(P=Mc(d.props.children)),a=Rc(t,Ii(P)?P:[P],e,n,i,r,o,s,a,c,l),u.base=e.__e,e.__u&=-161,u.__h.length&&s.push(u),v&&(u.__E=u.__=null)}catch(F){if(e.__v=null,c||o!=null)if(F.then){for(e.__u|=c?160:128;a&&a.nodeType==8&&a.nextSibling;)a=a.nextSibling;o[o.indexOf(a)]=null,e.__e=a}else{for(D=o.length;D--;)Do(o[D]);No(e)}else e.__e=n.__e,e.__k=n.__k,F.then||No(e);J.__e(F,e,n)}else o==null&&e.__v==n.__v?(e.__k=n.__k,e.__e=n.__e):a=e.__e=Cm(n.__e,e,n,i,r,o,s,c,l);return(d=J.diffed)&&d(e),128&e.__u?void 0:a}function No(t){t&&t.__c&&(t.__c.__e=!0),t&&t.__k&&t.__k.forEach(No)}function Ac(t,e,n){for(var i=0;i<n.length;i++)Lo(n[i],n[++i],n[++i]);J.__c&&J.__c(e,t),t.some(function(r){try{t=r.__h,r.__h=[],t.some(function(o){o.call(r)})}catch(o){J.__e(o,r.__v)}})}function Mc(t){return typeof t!="object"||t==null||t.__b&&t.__b>0?t:Ii(t)?t.map(Mc):xt({},t)}function Cm(t,e,n,i,r,o,s,a,c){var l,d,u,h,f,g,p,v=n.props,b=e.props,k=e.type;if(k=="svg"?r="http://www.w3.org/2000/svg":k=="math"?r="http://www.w3.org/1998/Math/MathML":r||(r="http://www.w3.org/1999/xhtml"),o!=null){for(l=0;l<o.length;l++)if((f=o[l])&&"setAttribute"in f==!!k&&(k?f.localName==k:f.nodeType==3)){t=f,o[l]=null;break}}if(t==null){if(k==null)return document.createTextNode(b);t=document.createElementNS(r,k,b.is&&b),a&&(J.__m&&J.__m(e,o),a=!1),o=null}if(k==null)v===b||a&&t.data==b||(t.data=b);else{if(o=o&&Pi.call(t.childNodes),v=n.props||Ri,!a&&o!=null)for(v={},l=0;l<t.attributes.length;l++)v[(f=t.attributes[l]).name]=f.value;for(l in v)if(f=v[l],l!="children"){if(l=="dangerouslySetInnerHTML")u=f;else if(!(l in b)){if(l=="value"&&"defaultValue"in b||l=="checked"&&"defaultChecked"in b)continue;cr(t,l,null,f,r)}}for(l in b)f=b[l],l=="children"?h=f:l=="dangerouslySetInnerHTML"?d=f:l=="value"?g=f:l=="checked"?p=f:a&&typeof f!="function"||v[l]===f||cr(t,l,f,v[l],r);if(d)a||u&&(d.__html==u.__html||d.__html==t.innerHTML)||(t.innerHTML=d.__html),e.__k=[];else if(u&&(t.innerHTML=""),Rc(e.type=="template"?t.content:t,Ii(h)?h:[h],e,n,i,k=="foreignObject"?"http://www.w3.org/1999/xhtml":r,o,s,o?o[0]:n.__k&&Wn(n,0),a,c),o!=null)for(l=o.length;l--;)Do(o[l]);a||(l="value",k=="progress"&&g==null?t.removeAttribute("value"):g!=null&&(g!==t[l]||k=="progress"&&!g||k=="option"&&g!=v[l])&&cr(t,l,g,v[l],r),l="checked",p!=null&&p!=t[l]&&cr(t,l,p,v[l],r))}return t}function Lo(t,e,n){try{if(typeof t=="function"){var i=typeof t.__u=="function";i&&t.__u(),i&&e==null||(t.__u=t(e))}else t.current=e}catch(r){J.__e(r,n)}}function Nc(t,e,n){var i,r;if(J.unmount&&J.unmount(t),(i=t.ref)&&(i.current&&i.current!=t.__e||Lo(i,null,e)),(i=t.__c)!=null){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(o){J.__e(o,e)}i.base=i.__P=null}if(i=t.__k)for(r=0;r<i.length;r++)i[r]&&Nc(i[r],e,n||typeof t.type!="function");n||Do(t.__e),t.__c=t.__=t.__e=void 0}function _m(t,e,n){return this.constructor(t,n)}function ln(t,e,n){var i,r,o,s;e==document&&(e=document.documentElement),J.__&&J.__(t,e),r=(i=typeof n=="function")?null:n&&n.__k||e.__k,o=[],s=[],Mo(e,t=(!i&&n||e).__k=_e(Te,null,[t]),r||Ri,Ri,e.namespaceURI,!i&&n?[n]:r?null:e.firstChild?Pi.call(e.childNodes):null,o,!i&&n?n:r?r.__e:e.firstChild,i,s),Ac(o,t,s)}function Uo(t,e){ln(t,e,Uo)}function Fo(t,e,n){var i,r,o,s,a=xt({},t.props);for(o in t.type&&t.type.defaultProps&&(s=t.type.defaultProps),e)o=="key"?i=e[o]:o=="ref"?r=e[o]:a[o]=e[o]===void 0&&s!=null?s[o]:e[o];return arguments.length>2&&(a.children=arguments.length>3?Pi.call(arguments,2):n),Oi(t.type,a,i||t.key,r||t.ref,null)}function Ne(t){function e(n){var i,r;return this.getChildContext||(i=new Set,(r={})[e.__c]=this,this.getChildContext=function(){return r},this.componentWillUnmount=function(){i=null},this.shouldComponentUpdate=function(o){this.props.value!=o.value&&i.forEach(function(s){s.__e=!0,Ao(s)})},this.sub=function(o){i.add(o);var s=o.componentWillUnmount;o.componentWillUnmount=function(){i&&i.delete(o),s&&s.call(o)}}),n.children}return e.__c="__cC"+Tc++,e.__=t,e.Provider=e.__l=(e.Consumer=function(n,i){return n.children(i)}).contextType=e,e}Pi=xc.slice,J={__e:function(t,e,n,i){for(var r,o,s;e=e.__;)if((r=e.__c)&&!r.__)try{if((o=r.constructor)&&o.getDerivedStateFromError!=null&&(r.setState(o.getDerivedStateFromError(t)),s=r.__d),r.componentDidCatch!=null&&(r.componentDidCatch(t,i||{}),s=r.__d),s)return r.__E=r}catch(a){t=a}throw t}},yc=0,kc=function(t){return t!=null&&t.constructor==null},ft.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=xt({},this.state),typeof t=="function"&&(t=t(xt({},n),this.props)),t&&xt(n,t),t!=null&&this.__v&&(e&&this._sb.push(e),Ao(this))},ft.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),Ao(this))},ft.prototype.render=Te,In=[],Cc=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,_c=function(t,e){return t.__v.__b-e.__v.__b},ar.__r=0,Sc=/(PointerCapture)$|Capture$/i,Ro=0,Io=Dc(!1),Oo=Dc(!0),Tc=0;function lr(){return lr=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},lr.apply(this,arguments)}var Sm=["context","children"];function Tm(t,e,n,i){function r(){var o=Reflect.construct(HTMLElement,[],r);return o._vdomComponent=t,o._root=i&&i.shadow?o.attachShadow({mode:i.mode||"open"}):o,o}return(r.prototype=Object.create(HTMLElement.prototype)).constructor=r,r.prototype.connectedCallback=Em,r.prototype.attributeChangedCallback=Pm,r.prototype.disconnectedCallback=Rm,n=n||t.observedAttributes||Object.keys(t.propTypes||{}),r.observedAttributes=n,n.forEach(function(o){Object.defineProperty(r.prototype,o,{get:function(){return this._vdom.props[o]},set:function(s){this._vdom?this.attributeChangedCallback(o,null,s):(this._props||(this._props={}),this._props[o]=s,this.connectedCallback());var a=typeof s;s!=null&&a!=="string"&&a!=="boolean"&&a!=="number"||this.setAttribute(o,s)}})}),customElements.define(e||t.tagName||t.displayName||t.name,r)}function xm(t){this.getChildContext=function(){return t.context};var e=t.children,n=(function(i,r){if(i==null)return{};var o,s,a={},c=Object.keys(i);for(s=0;s<c.length;s++)r.indexOf(o=c[s])>=0||(a[o]=i[o]);return a})(t,Sm);return Fo(e,n)}function Em(){var t=new CustomEvent("_preact",{detail:{},bubbles:!0,cancelable:!0});this.dispatchEvent(t),this._vdom=_e(xm,lr({},this._props,{context:t.detail.context}),Fc(this,this._vdomComponent)),(this.hasAttribute("hydrate")?Uo:ln)(this._vdom,this._root)}function Lc(t){return t.replace(/-(\w)/g,function(e,n){return n?n.toUpperCase():""})}function Pm(t,e,n){if(this._vdom){var i={};i[t]=n=n??void 0,i[Lc(t)]=n,this._vdom=Fo(this._vdom,i),ln(this._vdom,this._root)}}function Rm(){ln(this._vdom=null,this._root)}function Uc(t,e){var n=this;return _e("slot",lr({},t,{ref:function(i){i?(n.ref=i,n._listener||(n._listener=function(r){r.stopPropagation(),r.detail.context=e},i.addEventListener("_preact",n._listener))):n.ref.removeEventListener("_preact",n._listener)}}))}function Fc(t,e){if(t.nodeType===3)return t.data;if(t.nodeType!==1)return null;var n=[],i={},r=0,o=t.attributes,s=t.childNodes;for(r=o.length;r--;)o[r].name!=="slot"&&(i[o[r].name]=o[r].value,i[Lc(o[r].name)]=o[r].value);for(r=s.length;r--;){var a=Fc(s[r],null),c=s[r].slot;c?i[c]=_e(Uc,{name:c},a):n[r]=a}var l=e?_e(Uc,null,n):n;return _e(e||t.nodeName.toLowerCase(),i,l)}var Im=0;function m(t,e,n,i,r,o){e||(e={});var s,a,c=e;if("ref"in c)for(a in c={},e)a=="ref"?s=e[a]:c[a]=e[a];var l={type:t,props:c,key:n,ref:s,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--Im,__i:-1,__u:0,__source:r,__self:o};if(typeof t=="function"&&(s=t.defaultProps))for(a in s)c[a]===void 0&&(c[a]=s[a]);return J.vnode&&J.vnode(l),l}var zt,pe,Bo,Bc,Hn=0,jc=[],xe=J,Vc=xe.__b,qc=xe.__r,zc=xe.diffed,$c=xe.__c,Wc=xe.unmount,Hc=xe.__;function On(t,e){xe.__h&&xe.__h(pe,t,Hn||e),Hn=0;var n=pe.__H||(pe.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({}),n.__[t]}function K(t){return Hn=1,dr(Kc,t)}function dr(t,e,n){var i=On(zt++,2);if(i.t=t,!i.__c&&(i.__=[n?n(e):Kc(void 0,e),function(a){var c=i.__N?i.__N[0]:i.__[0],l=i.t(c,a);c!==l&&(i.__N=[l,i.__[1]],i.__c.setState({}))}],i.__c=pe,!pe.__f)){var r=function(a,c,l){if(!i.__c.__H)return!0;var d=i.__c.__H.__.filter(function(h){return!!h.__c});if(d.every(function(h){return!h.__N}))return!o||o.call(this,a,c,l);var u=i.__c.props!==a;return d.forEach(function(h){if(h.__N){var f=h.__[0];h.__=h.__N,h.__N=void 0,f!==h.__[0]&&(u=!0)}}),o&&o.call(this,a,c,l)||u};pe.__f=!0;var o=pe.shouldComponentUpdate,s=pe.componentWillUpdate;pe.componentWillUpdate=function(a,c,l){if(this.__e){var d=o;o=void 0,r(a,c,l),o=d}s&&s.call(this,a,c,l)},pe.shouldComponentUpdate=r}return i.__N||i.__}function X(t,e){var n=On(zt++,3);!xe.__s&&$o(n.__H,e)&&(n.__=t,n.u=e,pe.__H.__h.push(n))}function $t(t,e){var n=On(zt++,4);!xe.__s&&$o(n.__H,e)&&(n.__=t,n.u=e,pe.__h.push(n))}function $(t){return Hn=5,le(function(){return{current:t}},[])}function jo(t,e,n){Hn=6,$t(function(){if(typeof t=="function"){var i=t(e());return function(){t(null),i&&typeof i=="function"&&i()}}if(t)return t.current=e(),function(){return t.current=null}},n==null?n:n.concat(t))}function le(t,e){var n=On(zt++,7);return $o(n.__H,e)&&(n.__=t(),n.__H=e,n.__h=t),n.__}function H(t,e){return Hn=8,le(function(){return t},e)}function dn(t){var e=pe.context[t.__c],n=On(zt++,9);return n.c=t,e?(n.__==null&&(n.__=!0,e.sub(pe)),e.props.value):t.__}function Vo(t,e){xe.useDebugValue&&xe.useDebugValue(e?e(t):t)}function Om(t){var e=On(zt++,10),n=K();return e.__=t,pe.componentDidCatch||(pe.componentDidCatch=function(i,r){e.__&&e.__(i,r),n[1](i)}),[n[0],function(){n[1](void 0)}]}function qo(){var t=On(zt++,11);if(!t.__){for(var e=pe.__v;e!==null&&!e.__m&&e.__!==null;)e=e.__;var n=e.__m||(e.__m=[0,0]);t.__="P"+n[0]+"-"+n[1]++}return t.__}function Dm(){for(var t;t=jc.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(ur),t.__H.__h.forEach(zo),t.__H.__h=[]}catch(e){t.__H.__h=[],xe.__e(e,t.__v)}}xe.__b=function(t){pe=null,Vc&&Vc(t)},xe.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),Hc&&Hc(t,e)},xe.__r=function(t){qc&&qc(t),zt=0;var e=(pe=t.__c).__H;e&&(Bo===pe?(e.__h=[],pe.__h=[],e.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(e.__h.forEach(ur),e.__h.forEach(zo),e.__h=[],zt=0)),Bo=pe},xe.diffed=function(t){zc&&zc(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(jc.push(e)!==1&&Bc===xe.requestAnimationFrame||((Bc=xe.requestAnimationFrame)||Am)(Dm)),e.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),Bo=pe=null},xe.__c=function(t,e){e.some(function(n){try{n.__h.forEach(ur),n.__h=n.__h.filter(function(i){return!i.__||zo(i)})}catch(i){e.some(function(r){r.__h&&(r.__h=[])}),e=[],xe.__e(i,n.__v)}}),$c&&$c(t,e)},xe.unmount=function(t){Wc&&Wc(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(i){try{ur(i)}catch(r){e=r}}),n.__H=void 0,e&&xe.__e(e,n.__v))};var Gc=typeof requestAnimationFrame=="function";function Am(t){var e,n=function(){clearTimeout(i),Gc&&cancelAnimationFrame(e),setTimeout(t)},i=setTimeout(n,35);Gc&&(e=requestAnimationFrame(n))}function ur(t){var e=pe,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),pe=e}function zo(t){var e=pe;t.__c=t.__(),pe=e}function $o(t,e){return!t||t.length!==e.length||e.some(function(n,i){return n!==t[i]})}function Kc(t,e){return typeof e=="function"?e(t):e}function Jc(t,e){for(var n in e)t[n]=e[n];return t}function Wo(t,e){for(var n in t)if(n!=="__source"&&!(n in e))return!0;for(var i in e)if(i!=="__source"&&t[i]!==e[i])return!0;return!1}function Ho(t,e){var n=e(),i=K({t:{__:n,u:e}}),r=i[0].t,o=i[1];return $t(function(){r.__=n,r.u=e,Go(r)&&o({t:r})},[t,n,e]),X(function(){return Go(r)&&o({t:r}),t(function(){Go(r)&&o({t:r})})},[t]),n}function Go(t){var e,n,i=t.u,r=t.__;try{var o=i();return!((e=r)===(n=o)&&(e!==0||1/e==1/n)||e!=e&&n!=n)}catch{return!0}}function Ko(t){t()}function Jo(t){return t}function Yo(){return[!1,Ko]}var Xo=$t;function hr(t,e){this.props=t,this.context=e}function fr(t,e){function n(r){var o=this.props.ref,s=o==r.ref;return!s&&o&&(o.call?o(null):o.current=null),e?!e(this.props,r)||!s:Wo(this.props,r)}function i(r){return this.shouldComponentUpdate=n,_e(t,r)}return i.displayName="Memo("+(t.displayName||t.name)+")",i.prototype.isReactComponent=!0,i.__f=!0,i.type=t,i}(hr.prototype=new ft).isPureReactComponent=!0,hr.prototype.shouldComponentUpdate=function(t,e){return Wo(this.props,t)||Wo(this.state,e)};var Yc=J.__b;J.__b=function(t){t.type&&t.type.__f&&t.ref&&(t.props.ref=t.ref,t.ref=null),Yc&&Yc(t)};var Mm=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function ne(t){function e(n){var i=Jc({},n);return delete i.ref,t(i,n.ref||null)}return e.$$typeof=Mm,e.render=t,e.prototype.isReactComponent=e.__f=!0,e.displayName="ForwardRef("+(t.displayName||t.name)+")",e}var Xc=function(t,e){return t==null?null:qt(qt(t).map(e))},un={map:Xc,forEach:Xc,count:function(t){return t?qt(t).length:0},only:function(t){var e=qt(t);if(e.length!==1)throw"Children.only";return e[0]},toArray:qt},Nm=J.__e;J.__e=function(t,e,n,i){if(t.then){for(var r,o=e;o=o.__;)if((r=o.__c)&&r.__c)return e.__e==null&&(e.__e=n.__e,e.__k=n.__k),r.__c(t,e)}Nm(t,e,n,i)};var Qc=J.unmount;function Zc(t,e,n){return t&&(t.__c&&t.__c.__H&&(t.__c.__H.__.forEach(function(i){typeof i.__c=="function"&&i.__c()}),t.__c.__H=null),(t=Jc({},t)).__c!=null&&(t.__c.__P===n&&(t.__c.__P=e),t.__c.__e=!0,t.__c=null),t.__k=t.__k&&t.__k.map(function(i){return Zc(i,e,n)})),t}function el(t,e,n){return t&&n&&(t.__v=null,t.__k=t.__k&&t.__k.map(function(i){return el(i,e,n)}),t.__c&&t.__c.__P===e&&(t.__e&&n.appendChild(t.__e),t.__c.__e=!0,t.__c.__P=n)),t}function Di(){this.__u=0,this.o=null,this.__b=null}function tl(t){var e=t.__.__c;return e&&e.__a&&e.__a(t)}function nl(t){var e,n,i;function r(o){if(e||(e=t()).then(function(s){n=s.default||s},function(s){i=s}),i)throw i;if(!n)throw e;return _e(n,o)}return r.displayName="Lazy",r.__f=!0,r}function Gn(){this.i=null,this.l=null}J.unmount=function(t){var e=t.__c;e&&e.__R&&e.__R(),e&&32&t.__u&&(t.type=null),Qc&&Qc(t)},(Di.prototype=new ft).__c=function(t,e){var n=e.__c,i=this;i.o==null&&(i.o=[]),i.o.push(n);var r=tl(i.__v),o=!1,s=function(){o||(o=!0,n.__R=null,r?r(a):a())};n.__R=s;var a=function(){if(!--i.__u){if(i.state.__a){var c=i.state.__a;i.__v.__k[0]=el(c,c.__c.__P,c.__c.__O)}var l;for(i.setState({__a:i.__b=null});l=i.o.pop();)l.forceUpdate()}};i.__u++||32&e.__u||i.setState({__a:i.__b=i.__v.__k[0]}),t.then(s,s)},Di.prototype.componentWillUnmount=function(){this.o=[]},Di.prototype.render=function(t,e){if(this.__b){if(this.__v.__k){var n=document.createElement("div"),i=this.__v.__k[0].__c;this.__v.__k[0]=Zc(this.__b,n,i.__O=i.__P)}this.__b=null}var r=e.__a&&_e(Te,null,t.fallback);return r&&(r.__u&=-33),[_e(Te,null,e.__a?null:t.children),r]};var il=function(t,e,n){if(++n[1]===n[0]&&t.l.delete(e),t.props.revealOrder&&(t.props.revealOrder[0]!=="t"||!t.l.size))for(n=t.i;n;){for(;n.length>3;)n.pop()();if(n[1]<n[0])break;t.i=n=n[2]}};function Lm(t){return this.getChildContext=function(){return t.context},t.children}function Um(t){var e=this,n=t.h;if(e.componentWillUnmount=function(){ln(null,e.v),e.v=null,e.h=null},e.h&&e.h!==n&&e.componentWillUnmount(),!e.v){for(var i=e.__v;i!==null&&!i.__m&&i.__!==null;)i=i.__;e.h=n,e.v={nodeType:1,parentNode:n,childNodes:[],__k:{__m:i.__m},contains:function(){return!0},insertBefore:function(r,o){this.childNodes.push(r),e.h.insertBefore(r,o)},removeChild:function(r){this.childNodes.splice(this.childNodes.indexOf(r)>>>1,1),e.h.removeChild(r)}}}ln(_e(Lm,{context:e.context},t.__v),e.v)}function pr(t,e){var n=_e(Um,{__v:t,h:e});return n.containerInfo=e,n}(Gn.prototype=new ft).__a=function(t){var e=this,n=tl(e.__v),i=e.l.get(t);return i[0]++,function(r){var o=function(){e.props.revealOrder?(i.push(r),il(e,t,i)):r()};n?n(o):o()}},Gn.prototype.render=function(t){this.i=null,this.l=new Map;var e=qt(t.children);t.revealOrder&&t.revealOrder[0]==="b"&&e.reverse();for(var n=e.length;n--;)this.l.set(e[n],this.i=[1,0,this.i]);return t.children},Gn.prototype.componentDidUpdate=Gn.prototype.componentDidMount=function(){var t=this;this.l.forEach(function(e,n){il(t,n,e)})};var rl=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,Fm=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,Bm=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,jm=/[A-Z0-9]/g,Vm=typeof document<"u",qm=function(t){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(t)};function ol(t,e,n){return e.__k==null&&(e.textContent=""),ln(t,e),typeof n=="function"&&n(),t?t.__c:null}function sl(t,e,n){return Uo(t,e),typeof n=="function"&&n(),t?t.__c:null}ft.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(t){Object.defineProperty(ft.prototype,t,{configurable:!0,get:function(){return this["UNSAFE_"+t]},set:function(e){Object.defineProperty(this,t,{configurable:!0,writable:!0,value:e})}})});var al=J.event;function zm(){}function $m(){return this.cancelBubble}function Wm(){return this.defaultPrevented}J.event=function(t){return al&&(t=al(t)),t.persist=zm,t.isPropagationStopped=$m,t.isDefaultPrevented=Wm,t.nativeEvent=t};var Qo,Hm={enumerable:!1,configurable:!0,get:function(){return this.class}},cl=J.vnode;J.vnode=function(t){typeof t.type=="string"&&(function(e){var n=e.props,i=e.type,r={},o=i.indexOf("-")===-1;for(var s in n){var a=n[s];if(!(s==="value"&&"defaultValue"in n&&a==null||Vm&&s==="children"&&i==="noscript"||s==="class"||s==="className")){var c=s.toLowerCase();s==="defaultValue"&&"value"in n&&n.value==null?s="value":s==="download"&&a===!0?a="":c==="translate"&&a==="no"?a=!1:c[0]==="o"&&c[1]==="n"?c==="ondoubleclick"?s="ondblclick":c!=="onchange"||i!=="input"&&i!=="textarea"||qm(n.type)?c==="onfocus"?s="onfocusin":c==="onblur"?s="onfocusout":Bm.test(s)&&(s=c):c=s="oninput":o&&Fm.test(s)?s=s.replace(jm,"-$&").toLowerCase():a===null&&(a=void 0),c==="oninput"&&r[s=c]&&(s="oninputCapture"),r[s]=a}}i=="select"&&r.multiple&&Array.isArray(r.value)&&(r.value=qt(n.children).forEach(function(l){l.props.selected=r.value.indexOf(l.props.value)!=-1})),i=="select"&&r.defaultValue!=null&&(r.value=qt(n.children).forEach(function(l){l.props.selected=r.multiple?r.defaultValue.indexOf(l.props.value)!=-1:r.defaultValue==l.props.value})),n.class&&!n.className?(r.class=n.class,Object.defineProperty(r,"className",Hm)):(n.className&&!n.class||n.class&&n.className)&&(r.class=r.className=n.className),e.props=r})(t),t.$$typeof=rl,cl&&cl(t)};var ll=J.__r;J.__r=function(t){ll&&ll(t),Qo=t.__c};var dl=J.diffed;J.diffed=function(t){dl&&dl(t);var e=t.props,n=t.__e;n!=null&&t.type==="textarea"&&"value"in e&&e.value!==n.value&&(n.value=e.value==null?"":e.value),Qo=null};var ul={ReactCurrentDispatcher:{current:{readContext:function(t){return Qo.__n[t.__c].props.value},useCallback:H,useContext:dn,useDebugValue:Vo,useDeferredValue:Jo,useEffect:X,useId:qo,useImperativeHandle:jo,useInsertionEffect:Xo,useLayoutEffect:$t,useMemo:le,useReducer:dr,useRef:$,useState:K,useSyncExternalStore:Ho,useTransition:Yo}}},Gm="18.3.1";function hl(t){return _e.bind(null,t)}function Wt(t){return!!t&&t.$$typeof===rl}function fl(t){return Wt(t)&&t.type===Te}function pl(t){return!!t&&!!t.displayName&&(typeof t.displayName=="string"||t.displayName instanceof String)&&t.displayName.startsWith("Memo(")}function Ai(t){return Wt(t)?Fo.apply(null,arguments):t}function ml(t){return!!t.__k&&(ln(null,t),!0)}function gl(t){return t&&(t.base||t.nodeType===1&&t)||null}var vl=function(t,e){return t(e)},mr=function(t,e){return t(e)},bl=Te,yl=Wt,Ht={useState:K,useId:qo,useReducer:dr,useEffect:X,useLayoutEffect:$t,useInsertionEffect:Xo,useTransition:Yo,useDeferredValue:Jo,useSyncExternalStore:Ho,startTransition:Ko,useRef:$,useImperativeHandle:jo,useMemo:le,useCallback:H,useContext:dn,useDebugValue:Vo,version:"18.3.1",Children:un,render:ol,hydrate:sl,unmountComponentAtNode:ml,createPortal:pr,createElement:_e,createContext:Ne,createFactory:hl,cloneElement:Ai,createRef:Ec,Fragment:Te,isValidElement:Wt,isElement:yl,isFragment:fl,isMemo:pl,findDOMNode:gl,Component:ft,PureComponent:hr,memo:fr,forwardRef:ne,flushSync:mr,unstable_batchedUpdates:vl,StrictMode:bl,Suspense:Di,SuspenseList:Gn,lazy:nl,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:ul};const kl=Object.freeze(Object.defineProperty({__proto__:null,Children:un,Component:ft,Fragment:Te,PureComponent:hr,StrictMode:bl,Suspense:Di,SuspenseList:Gn,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:ul,cloneElement:Ai,createContext:Ne,createElement:_e,createFactory:hl,createPortal:pr,createRef:Ec,default:Ht,findDOMNode:gl,flushSync:mr,forwardRef:ne,hydrate:sl,isElement:yl,isFragment:fl,isMemo:pl,isValidElement:Wt,lazy:nl,memo:fr,render:ol,startTransition:Ko,unmountComponentAtNode:ml,unstable_batchedUpdates:vl,useCallback:H,useContext:dn,useDebugValue:Vo,useDeferredValue:Jo,useEffect:X,useErrorBoundary:Om,useId:qo,useImperativeHandle:jo,useInsertionEffect:Xo,useLayoutEffect:$t,useMemo:le,useReducer:dr,useRef:$,useState:K,useSyncExternalStore:Ho,useTransition:Yo,version:Gm},Symbol.toStringTag,{value:"Module"}));var Km=Symbol.for("preact-signals");function gr(){if(hn>1)hn--;else{for(var t,e=!1;Mi!==void 0;){var n=Mi;for(Mi=void 0,Zo++;n!==void 0;){var i=n.o;if(n.o=void 0,n.f&=-3,!(8&n.f)&&Sl(n))try{n.c()}catch(r){e||(t=r,e=!0)}n=i}}if(Zo=0,hn--,e)throw t}}function wl(t){if(hn>0)return t();hn++;try{return t()}finally{gr()}}var ce=void 0;function Cl(t){var e=ce;ce=void 0;try{return t()}finally{ce=e}}var Mi=void 0,hn=0,Zo=0,vr=0;function _l(t){if(ce!==void 0){var e=t.n;if(e===void 0||e.t!==ce)return e={i:0,S:t,p:ce.s,n:void 0,t:ce,e:void 0,x:void 0,r:e},ce.s!==void 0&&(ce.s.n=e),ce.s=e,t.n=e,32&ce.f&&t.S(e),e;if(e.i===-1)return e.i=0,e.n!==void 0&&(e.n.p=e.p,e.p!==void 0&&(e.p.n=e.n),e.p=ce.s,e.n=void 0,ce.s.n=e,ce.s=e),e}}function qe(t,e){this.v=t,this.i=0,this.n=void 0,this.t=void 0,this.W=e==null?void 0:e.watched,this.Z=e==null?void 0:e.unwatched,this.name=e==null?void 0:e.name}qe.prototype.brand=Km,qe.prototype.h=function(){return!0},qe.prototype.S=function(t){var e=this,n=this.t;n!==t&&t.e===void 0&&(t.x=n,this.t=t,n!==void 0?n.e=t:Cl(function(){var i;(i=e.W)==null||i.call(e)}))},qe.prototype.U=function(t){var e=this;if(this.t!==void 0){var n=t.e,i=t.x;n!==void 0&&(n.x=i,t.e=void 0),i!==void 0&&(i.e=n,t.x=void 0),t===this.t&&(this.t=i,i===void 0&&Cl(function(){var r;(r=e.Z)==null||r.call(e)}))}},qe.prototype.subscribe=function(t){var e=this;return Jn(function(){var n=e.value,i=ce;ce=void 0;try{t(n)}finally{ce=i}},{name:"sub"})},qe.prototype.valueOf=function(){return this.value},qe.prototype.toString=function(){return this.value+""},qe.prototype.toJSON=function(){return this.value},qe.prototype.peek=function(){var t=ce;ce=void 0;try{return this.value}finally{ce=t}},Object.defineProperty(qe.prototype,"value",{get:function(){var t=_l(this);return t!==void 0&&(t.i=this.i),this.v},set:function(t){if(t!==this.v){if(Zo>100)throw new Error("Cycle detected");this.v=t,this.i++,vr++,hn++;try{for(var e=this.t;e!==void 0;e=e.x)e.t.N()}finally{gr()}}}});function it(t,e){return new qe(t,e)}function Sl(t){for(var e=t.s;e!==void 0;e=e.n)if(e.S.i!==e.i||!e.S.h()||e.S.i!==e.i)return!0;return!1}function Tl(t){for(var e=t.s;e!==void 0;e=e.n){var n=e.S.n;if(n!==void 0&&(e.r=n),e.S.n=e,e.i=-1,e.n===void 0){t.s=e;break}}}function xl(t){for(var e=t.s,n=void 0;e!==void 0;){var i=e.p;e.i===-1?(e.S.U(e),i!==void 0&&(i.n=e.n),e.n!==void 0&&(e.n.p=i)):n=e,e.S.n=e.r,e.r!==void 0&&(e.r=void 0),e=i}t.s=n}function Dn(t,e){qe.call(this,void 0),this.x=t,this.s=void 0,this.g=vr-1,this.f=4,this.W=e==null?void 0:e.watched,this.Z=e==null?void 0:e.unwatched,this.name=e==null?void 0:e.name}Dn.prototype=new qe,Dn.prototype.h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===vr))return!0;if(this.g=vr,this.f|=1,this.i>0&&!Sl(this))return this.f&=-2,!0;var t=ce;try{Tl(this),ce=this;var e=this.x();(16&this.f||this.v!==e||this.i===0)&&(this.v=e,this.f&=-17,this.i++)}catch(n){this.v=n,this.f|=16,this.i++}return ce=t,xl(this),this.f&=-2,!0},Dn.prototype.S=function(t){if(this.t===void 0){this.f|=36;for(var e=this.s;e!==void 0;e=e.n)e.S.S(e)}qe.prototype.S.call(this,t)},Dn.prototype.U=function(t){if(this.t!==void 0&&(qe.prototype.U.call(this,t),this.t===void 0)){this.f&=-33;for(var e=this.s;e!==void 0;e=e.n)e.S.U(e)}},Dn.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var t=this.t;t!==void 0;t=t.x)t.t.N()}},Object.defineProperty(Dn.prototype,"value",{get:function(){if(1&this.f)throw new Error("Cycle detected");var t=_l(this);if(this.h(),t!==void 0&&(t.i=this.i),16&this.f)throw this.v;return this.v}});function rt(t,e){return new Dn(t,e)}function El(t){var e=t.u;if(t.u=void 0,typeof e=="function"){hn++;var n=ce;ce=void 0;try{e()}catch(i){throw t.f&=-2,t.f|=8,es(t),i}finally{ce=n,gr()}}}function es(t){for(var e=t.s;e!==void 0;e=e.n)e.S.U(e);t.x=void 0,t.s=void 0,El(t)}function Jm(t){if(ce!==this)throw new Error("Out-of-order effect");xl(this),ce=t,this.f&=-2,8&this.f&&es(this),gr()}function Kn(t,e){this.x=t,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32,this.name=e==null?void 0:e.name}Kn.prototype.c=function(){var t=this.S();try{if(8&this.f||this.x===void 0)return;var e=this.x();typeof e=="function"&&(this.u=e)}finally{t()}},Kn.prototype.S=function(){if(1&this.f)throw new Error("Cycle detected");this.f|=1,this.f&=-9,El(this),Tl(this),hn++;var t=ce;return ce=this,Jm.bind(this,t)},Kn.prototype.N=function(){2&this.f||(this.f|=2,this.o=Mi,Mi=this)},Kn.prototype.d=function(){this.f|=8,1&this.f||es(this)},Kn.prototype.dispose=function(){this.d()};function Jn(t,e){var n=new Kn(t,e);try{n.c()}catch(r){throw n.d(),r}var i=n.d.bind(n);return i[Symbol.dispose]=i,i}var ts,br,ns,Pl=[],Rl=[];Jn(function(){ts=this.N})();function Yn(t,e){J[t]=e.bind(null,J[t]||function(){})}function yr(t){ns&&ns(),ns=t&&t.S()}function Il(t){var e=this,n=t.data,i=Le(n);i.value=n;var r=le(function(){for(var a=e,c=e.__v;c=c.__;)if(c.__c){c.__c.__$f|=4;break}var l=rt(function(){var f=i.value.value;return f===0?0:f===!0?"":f||""}),d=rt(function(){return!Array.isArray(l.value)&&!kc(l.value)}),u=Jn(function(){if(this.N=Ol,d.value){var f=l.value;a.__v&&a.__v.__e&&a.__v.__e.nodeType===3&&(a.__v.__e.data=f)}}),h=e.__$u.d;return e.__$u.d=function(){u(),h.call(this)},[d,l]},[]),o=r[0],s=r[1];return o.value?s.peek():s.value}Il.displayName="ReactiveTextNode",Object.defineProperties(qe.prototype,{constructor:{configurable:!0,value:void 0},type:{configurable:!0,value:Il},props:{configurable:!0,get:function(){return{data:this}}},__b:{configurable:!0,value:1}}),Yn("__b",function(t,e){if(typeof e.type=="function"&&typeof window<"u"&&window.__PREACT_SIGNALS_DEVTOOLS__&&window.__PREACT_SIGNALS_DEVTOOLS__.exitComponent(),typeof e.type=="string"){var n,i=e.props;for(var r in i)if(r!=="children"){var o=i[r];o instanceof qe&&(n||(e.__np=n={}),n[r]=o,i[r]=o.peek())}}t(e)}),Yn("__r",function(t,e){if(typeof e.type=="function"&&typeof window<"u"&&window.__PREACT_SIGNALS_DEVTOOLS__&&window.__PREACT_SIGNALS_DEVTOOLS__.enterComponent(e.type.displayName||e.type.name||"Unknown"),e.type!==Te){yr();var n,i=e.__c;i&&(i.__$f&=-2,(n=i.__$u)===void 0&&(i.__$u=n=(function(r){var o;return Jn(function(){o=this}),o.c=function(){i.__$f|=1,i.setState({})},o})())),br=i,yr(n)}t(e)}),Yn("__e",function(t,e,n,i){typeof window<"u"&&window.__PREACT_SIGNALS_DEVTOOLS__&&window.__PREACT_SIGNALS_DEVTOOLS__.exitComponent(),yr(),br=void 0,t(e,n,i)}),Yn("diffed",function(t,e){typeof e.type=="function"&&typeof window<"u"&&window.__PREACT_SIGNALS_DEVTOOLS__&&window.__PREACT_SIGNALS_DEVTOOLS__.exitComponent(),yr(),br=void 0;var n;if(typeof e.type=="string"&&(n=e.__e)){var i=e.__np,r=e.props;if(i){var o=n.U;if(o)for(var s in o){var a=o[s];a!==void 0&&!(s in i)&&(a.d(),o[s]=void 0)}else o={},n.U=o;for(var c in i){var l=o[c],d=i[c];l===void 0?(l=Ym(n,c,d,r),o[c]=l):l.o(d,r)}}}t(e)});function Ym(t,e,n,i){var r=e in t&&t.ownerSVGElement===void 0,o=it(n);return{o:function(s,a){o.value=s,i=a},d:Jn(function(){this.N=Ol;var s=o.value.value;i[e]!==s&&(i[e]=s,r?t[e]=s:s?t.setAttribute(e,s):t.removeAttribute(e))})}}Yn("unmount",function(t,e){if(typeof e.type=="string"){var n=e.__e;if(n){var i=n.U;if(i){n.U=void 0;for(var r in i){var o=i[r];o&&o.d()}}}}else{var s=e.__c;if(s){var a=s.__$u;a&&(s.__$u=void 0,a.d())}}t(e)}),Yn("__h",function(t,e,n,i){(i<3||i===9)&&(e.__$f|=2),t(e,n,i)}),ft.prototype.shouldComponentUpdate=function(t,e){var n=this.__$u,i=n&&n.s!==void 0;for(var r in e)return!0;if(this.__f||typeof this.u=="boolean"&&this.u===!0){var o=2&this.__$f;if(!(i||o||4&this.__$f)||1&this.__$f)return!0}else if(!(i||4&this.__$f)||3&this.__$f)return!0;for(var s in t)if(s!=="__source"&&t[s]!==this.props[s])return!0;for(var a in this.props)if(!(a in t))return!0;return!1};function Le(t,e){return K(function(){return it(t,e)})[0]}function be(t,e){var n=$(t);return n.current=t,br.__$f|=4,le(function(){return rt(function(){return n.current()},e)},[])}var Xm=typeof requestAnimationFrame>"u"?setTimeout:function(t){var e=function(){clearTimeout(n),cancelAnimationFrame(i),t()},n=setTimeout(e,35),i=requestAnimationFrame(e)},Qm=function(t){queueMicrotask(function(){queueMicrotask(t)})};function Zm(){wl(function(){for(var t;t=Pl.shift();)ts.call(t)})}function eg(){Pl.push(this)===1&&(J.requestAnimationFrame||Xm)(Zm)}function tg(){wl(function(){for(var t;t=Rl.shift();)ts.call(t)})}function Ol(){Rl.push(this)===1&&(J.requestAnimationFrame||Qm)(tg)}function Et(t,e){var n=$(t);n.current=t,X(function(){return Jn(function(){return this.N=eg,n.current()},e)},[])}function ng(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in t)){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(t)}var ig=Object.defineProperty,rg=(t,e,n)=>e in t?ig(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Dl=(t,e,n)=>rg(t,typeof e!="symbol"?e+"":e,n);let Ke=class{constructor(){Dl(this,"_locking"),Dl(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const n=new Promise(r=>e=()=>{this._locks-=1,r()}),i=this._locking.then(()=>e);return this._locking=this._locking.then(()=>n),i}};function Ee(t,e){if(!t)throw new Error(e)}const og=34028234663852886e22,sg=-34028234663852886e22,ag=4294967295,cg=2147483647,lg=-2147483648;function kr(t){if(typeof t!="number")throw new Error("invalid int 32: "+typeof t);if(!Number.isInteger(t)||t>cg||t<lg)throw new Error("invalid int 32: "+t)}function is(t){if(typeof t!="number")throw new Error("invalid uint 32: "+typeof t);if(!Number.isInteger(t)||t>ag||t<0)throw new Error("invalid uint 32: "+t)}function Al(t){if(typeof t!="number")throw new Error("invalid float 32: "+typeof t);if(Number.isFinite(t)&&(t>og||t<sg))throw new Error("invalid float 32: "+t)}const Ml=Symbol("@bufbuild/protobuf/enum-type");function dg(t){const e=t[Ml];return Ee(e,"missing enum type on enum object"),e}function Nl(t,e,n,i){t[Ml]=Ll(e,n.map(r=>({no:r.no,name:r.name,localName:t[r.no]})))}function Ll(t,e,n){const i=Object.create(null),r=Object.create(null),o=[];for(const s of e){const a=Ul(s);o.push(a),i[s.name]=a,r[s.no]=a}return{typeName:t,values:o,findName(s){return i[s]},findNumber(s){return r[s]}}}function ug(t,e,n){const i={};for(const r of e){const o=Ul(r);i[o.localName]=o.no,i[o.no]=o.localName}return Nl(i,t,e),i}function Ul(t){return"localName"in t?t:Object.assign(Object.assign({},t),{localName:t.name})}class rs{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,n){const i=this.getType(),r=i.runtime.bin,o=r.makeReadOptions(n);return r.readMessage(this,o.readerFactory(e),e.byteLength,o),this}fromJson(e,n){const i=this.getType(),r=i.runtime.json,o=r.makeReadOptions(n);return r.readMessage(i,e,o,this),this}fromJsonString(e,n){let i;try{i=JSON.parse(e)}catch(r){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(r instanceof Error?r.message:String(r)))}return this.fromJson(i,n)}toBinary(e){const n=this.getType(),i=n.runtime.bin,r=i.makeWriteOptions(e),o=r.writerFactory();return i.writeMessage(this,o,r),o.finish()}toJson(e){const n=this.getType(),i=n.runtime.json,r=i.makeWriteOptions(e);return i.writeMessage(this,r)}toJsonString(e){var n;const i=this.toJson(e);return JSON.stringify(i,null,(n=e==null?void 0:e.prettySpaces)!==null&&n!==void 0?n:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function hg(t,e,n,i){var r;const o=(r=i==null?void 0:i.localName)!==null&&r!==void 0?r:e.substring(e.lastIndexOf(".")+1),s={[o]:function(a){t.util.initFields(this),t.util.initPartial(a,this)}}[o];return Object.setPrototypeOf(s.prototype,new rs),Object.assign(s,{runtime:t,typeName:e,fields:t.util.newFieldList(n),fromBinary(a,c){return new s().fromBinary(a,c)},fromJson(a,c){return new s().fromJson(a,c)},fromJsonString(a,c){return new s().fromJsonString(a,c)},equals(a,c){return t.util.equals(s,a,c)}}),s}function fg(){let t=0,e=0;for(let i=0;i<28;i+=7){let r=this.buf[this.pos++];if(t|=(r&127)<<i,(r&128)==0)return this.assertBounds(),[t,e]}let n=this.buf[this.pos++];if(t|=(n&15)<<28,e=(n&112)>>4,(n&128)==0)return this.assertBounds(),[t,e];for(let i=3;i<=31;i+=7){let r=this.buf[this.pos++];if(e|=(r&127)<<i,(r&128)==0)return this.assertBounds(),[t,e]}throw new Error("invalid varint")}function os(t,e,n){for(let o=0;o<28;o=o+7){const s=t>>>o,a=!(!(s>>>7)&&e==0),c=(a?s|128:s)&255;if(n.push(c),!a)return}const i=t>>>28&15|(e&7)<<4,r=e>>3!=0;if(n.push((r?i|128:i)&255),!!r){for(let o=3;o<31;o=o+7){const s=e>>>o,a=!!(s>>>7),c=(a?s|128:s)&255;if(n.push(c),!a)return}n.push(e>>>31&1)}}const wr=4294967296;function Fl(t){const e=t[0]==="-";e&&(t=t.slice(1));const n=1e6;let i=0,r=0;function o(s,a){const c=Number(t.slice(s,a));r*=n,i=i*n+c,i>=wr&&(r=r+(i/wr|0),i=i%wr)}return o(-24,-18),o(-18,-12),o(-12,-6),o(-6),e?jl(i,r):ss(i,r)}function pg(t,e){let n=ss(t,e);const i=n.hi&2147483648;i&&(n=jl(n.lo,n.hi));const r=Bl(n.lo,n.hi);return i?"-"+r:r}function Bl(t,e){if({lo:t,hi:e}=mg(t,e),e<=2097151)return String(wr*e+t);const n=t&16777215,i=(t>>>24|e<<8)&16777215,r=e>>16&65535;let o=n+i*6777216+r*6710656,s=i+r*8147497,a=r*2;const c=1e7;return o>=c&&(s+=Math.floor(o/c),o%=c),s>=c&&(a+=Math.floor(s/c),s%=c),a.toString()+Vl(s)+Vl(o)}function mg(t,e){return{lo:t>>>0,hi:e>>>0}}function ss(t,e){return{lo:t|0,hi:e|0}}function jl(t,e){return e=~e,t?t=~t+1:e+=1,ss(t,e)}const Vl=t=>{const e=String(t);return"0000000".slice(e.length)+e};function ql(t,e){if(t>=0){for(;t>127;)e.push(t&127|128),t=t>>>7;e.push(t)}else{for(let n=0;n<9;n++)e.push(t&127|128),t=t>>7;e.push(1)}}function gg(){let t=this.buf[this.pos++],e=t&127;if((t&128)==0)return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<7,(t&128)==0)return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<14,(t&128)==0)return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<21,(t&128)==0)return this.assertBounds(),e;t=this.buf[this.pos++],e|=(t&15)<<28;for(let n=5;(t&128)!==0&&n<10;n++)t=this.buf[this.pos++];if((t&128)!=0)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function vg(){const t=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof t.getBigInt64=="function"&&typeof t.getBigUint64=="function"&&typeof t.setBigInt64=="function"&&typeof t.setBigUint64=="function"&&(typeof process!="object"||typeof process.env!="object"||process.env.BUF_BIGINT_DISABLE!=="1")){const r=BigInt("-9223372036854775808"),o=BigInt("9223372036854775807"),s=BigInt("0"),a=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(c){const l=typeof c=="bigint"?c:BigInt(c);if(l>o||l<r)throw new Error("int64 invalid: ".concat(c));return l},uParse(c){const l=typeof c=="bigint"?c:BigInt(c);if(l>a||l<s)throw new Error("uint64 invalid: ".concat(c));return l},enc(c){return t.setBigInt64(0,this.parse(c),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},uEnc(c){return t.setBigInt64(0,this.uParse(c),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},dec(c,l){return t.setInt32(0,c,!0),t.setInt32(4,l,!0),t.getBigInt64(0,!0)},uDec(c,l){return t.setInt32(0,c,!0),t.setInt32(4,l,!0),t.getBigUint64(0,!0)}}}const n=r=>Ee(/^-?[0-9]+$/.test(r),"int64 invalid: ".concat(r)),i=r=>Ee(/^[0-9]+$/.test(r),"uint64 invalid: ".concat(r));return{zero:"0",supported:!1,parse(r){return typeof r!="string"&&(r=r.toString()),n(r),r},uParse(r){return typeof r!="string"&&(r=r.toString()),i(r),r},enc(r){return typeof r!="string"&&(r=r.toString()),n(r),Fl(r)},uEnc(r){return typeof r!="string"&&(r=r.toString()),i(r),Fl(r)},dec(r,o){return pg(r,o)},uDec(r,o){return Bl(r,o)}}}const Se=vg();var I;(function(t){t[t.DOUBLE=1]="DOUBLE",t[t.FLOAT=2]="FLOAT",t[t.INT64=3]="INT64",t[t.UINT64=4]="UINT64",t[t.INT32=5]="INT32",t[t.FIXED64=6]="FIXED64",t[t.FIXED32=7]="FIXED32",t[t.BOOL=8]="BOOL",t[t.STRING=9]="STRING",t[t.BYTES=12]="BYTES",t[t.UINT32=13]="UINT32",t[t.SFIXED32=15]="SFIXED32",t[t.SFIXED64=16]="SFIXED64",t[t.SINT32=17]="SINT32",t[t.SINT64=18]="SINT64"})(I||(I={}));var fn;(function(t){t[t.BIGINT=0]="BIGINT",t[t.STRING=1]="STRING"})(fn||(fn={}));function pn(t,e,n){if(e===n)return!0;if(t==I.BYTES){if(!(e instanceof Uint8Array)||!(n instanceof Uint8Array)||e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==n[i])return!1;return!0}switch(t){case I.UINT64:case I.FIXED64:case I.INT64:case I.SFIXED64:case I.SINT64:return e==n}return!1}function Xn(t,e){switch(t){case I.BOOL:return!1;case I.UINT64:case I.FIXED64:case I.INT64:case I.SFIXED64:case I.SINT64:return e==0?Se.zero:"0";case I.DOUBLE:case I.FLOAT:return 0;case I.BYTES:return new Uint8Array(0);case I.STRING:return"";default:return 0}}function zl(t,e){switch(t){case I.BOOL:return e===!1;case I.STRING:return e==="";case I.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var Ie;(function(t){t[t.Varint=0]="Varint",t[t.Bit64=1]="Bit64",t[t.LengthDelimited=2]="LengthDelimited",t[t.StartGroup=3]="StartGroup",t[t.EndGroup=4]="EndGroup",t[t.Bit32=5]="Bit32"})(Ie||(Ie={}));class bg{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let r=0;r<this.chunks.length;r++)e+=this.chunks[r].length;let n=new Uint8Array(e),i=0;for(let r=0;r<this.chunks.length;r++)n.set(this.chunks[r],i),i+=this.chunks[r].length;return this.chunks=[],n}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),n=this.stack.pop();if(!n)throw new Error("invalid state, fork stack empty");return this.chunks=n.chunks,this.buf=n.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,n){return this.uint32((e<<3|n)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(is(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return kr(e),ql(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let n=this.textEncoder.encode(e);return this.uint32(n.byteLength),this.raw(n)}float(e){Al(e);let n=new Uint8Array(4);return new DataView(n.buffer).setFloat32(0,e,!0),this.raw(n)}double(e){let n=new Uint8Array(8);return new DataView(n.buffer).setFloat64(0,e,!0),this.raw(n)}fixed32(e){is(e);let n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,e,!0),this.raw(n)}sfixed32(e){kr(e);let n=new Uint8Array(4);return new DataView(n.buffer).setInt32(0,e,!0),this.raw(n)}sint32(e){return kr(e),e=(e<<1^e>>31)>>>0,ql(e,this.buf),this}sfixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=Se.enc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}fixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=Se.uEnc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}int64(e){let n=Se.enc(e);return os(n.lo,n.hi,this.buf),this}sint64(e){let n=Se.enc(e),i=n.hi>>31,r=n.lo<<1^i,o=(n.hi<<1|n.lo>>>31)^i;return os(r,o,this.buf),this}uint64(e){let n=Se.uEnc(e);return os(n.lo,n.hi,this.buf),this}}class yg{constructor(e,n){this.varint64=fg,this.uint32=gg,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=n??new TextDecoder}tag(){let e=this.uint32(),n=e>>>3,i=e&7;if(n<=0||i<0||i>5)throw new Error("illegal tag: field no "+n+" wire type "+i);return[n,i]}skip(e,n){let i=this.pos;switch(e){case Ie.Varint:for(;this.buf[this.pos++]&128;);break;case Ie.Bit64:this.pos+=4;case Ie.Bit32:this.pos+=4;break;case Ie.LengthDelimited:let r=this.uint32();this.pos+=r;break;case Ie.StartGroup:for(;;){const[o,s]=this.tag();if(s===Ie.EndGroup){if(n!==void 0&&o!==n)throw new Error("invalid end group tag");break}this.skip(s,o)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(i,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return Se.dec(...this.varint64())}uint64(){return Se.uDec(...this.varint64())}sint64(){let[e,n]=this.varint64(),i=-(e&1);return e=(e>>>1|(n&1)<<31)^i,n=n>>>1^i,Se.dec(e,n)}bool(){let[e,n]=this.varint64();return e!==0||n!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return Se.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return Se.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),n=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(n,n+e)}string(){return this.textDecoder.decode(this.bytes())}}function kg(t,e,n,i){let r;return{typeName:e,extendee:n,get field(){if(!r){const o=typeof i=="function"?i():i;o.name=e.split(".").pop(),o.jsonName="[".concat(e,"]"),r=t.util.newFieldList([o]).list()[0]}return r},runtime:t}}function $l(t){const e=t.field.localName,n=Object.create(null);return n[e]=wg(t),[n,()=>n[e]]}function wg(t){const e=t.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return Xn(e.T,e.L);case"message":const n=e.T,i=new n;return n.fieldWrapper?n.fieldWrapper.unwrapField(i):i;case"map":throw"map fields are not allowed to be extensions"}}function Cg(t,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let n=t.length-1;n>=0;--n)if(t[n].no==e.no)return[t[n]];return[]}return t.filter(n=>n.no===e.no)}let Gt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),Cr=[];for(let t=0;t<Gt.length;t++)Cr[Gt[t].charCodeAt(0)]=t;Cr[45]=Gt.indexOf("+"),Cr[95]=Gt.indexOf("/");const Wl={dec(t){let e=t.length*3/4;t[t.length-2]=="="?e-=2:t[t.length-1]=="="&&(e-=1);let n=new Uint8Array(e),i=0,r=0,o,s=0;for(let a=0;a<t.length;a++){if(o=Cr[t.charCodeAt(a)],o===void 0)switch(t[a]){case"=":r=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(r){case 0:s=o,r=1;break;case 1:n[i++]=s<<2|(o&48)>>4,s=o,r=2;break;case 2:n[i++]=(s&15)<<4|(o&60)>>2,s=o,r=3;break;case 3:n[i++]=(s&3)<<6|o,r=0;break}}if(r==1)throw Error("invalid base64 string.");return n.subarray(0,i)},enc(t){let e="",n=0,i,r=0;for(let o=0;o<t.length;o++)switch(i=t[o],n){case 0:e+=Gt[i>>2],r=(i&3)<<4,n=1;break;case 1:e+=Gt[r|i>>4],r=(i&15)<<2,n=2;break;case 2:e+=Gt[r|i>>6],e+=Gt[i&63],n=0;break}return n&&(e+=Gt[r],e+="=",n==1&&(e+="=")),e}};function _g(t,e,n){Gl(e,t);const i=e.runtime.bin.makeReadOptions(n),r=Cg(t.getType().runtime.bin.listUnknownFields(t),e.field),[o,s]=$l(e);for(const a of r)e.runtime.bin.readField(o,i.readerFactory(a.data),e.field,a.wireType,i);return s()}function Sg(t,e,n,i){Gl(e,t);const r=e.runtime.bin.makeReadOptions(i),o=e.runtime.bin.makeWriteOptions(i);if(Hl(t,e)){const l=t.getType().runtime.bin.listUnknownFields(t).filter(d=>d.no!=e.field.no);t.getType().runtime.bin.discardUnknownFields(t);for(const d of l)t.getType().runtime.bin.onUnknownField(t,d.no,d.wireType,d.data)}const s=o.writerFactory();let a=e.field;!a.opt&&!a.repeated&&(a.kind=="enum"||a.kind=="scalar")&&(a=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(a,n,s,o);const c=r.readerFactory(s.finish());for(;c.pos<c.len;){const[l,d]=c.tag(),u=c.skip(d,l);t.getType().runtime.bin.onUnknownField(t,l,d,u)}}function Hl(t,e){const n=t.getType();return e.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(t).find(i=>i.no==e.field.no)}function Gl(t,e){Ee(t.extendee.typeName==e.getType().typeName,"extension ".concat(t.typeName," can only be applied to message ").concat(t.extendee.typeName))}function Kl(t,e){const n=t.localName;if(t.repeated)return e[n].length>0;if(t.oneof)return e[t.oneof.localName].case===n;switch(t.kind){case"enum":case"scalar":return t.opt||t.req?e[n]!==void 0:t.kind=="enum"?e[n]!==t.T.values[0].no:!zl(t.T,e[n]);case"message":return e[n]!==void 0;case"map":return Object.keys(e[n]).length>0}}function Jl(t,e){const n=t.localName,i=!t.opt&&!t.req;if(t.repeated)e[n]=[];else if(t.oneof)e[t.oneof.localName]={case:void 0};else switch(t.kind){case"map":e[n]={};break;case"enum":e[n]=i?t.T.values[0].no:void 0;break;case"scalar":e[n]=i?Xn(t.T,t.L):void 0;break;case"message":e[n]=void 0;break}}function Kt(t,e){if(t===null||typeof t!="object"||!Object.getOwnPropertyNames(rs.prototype).every(i=>i in t&&typeof t[i]=="function"))return!1;const n=t.getType();return n===null||typeof n!="function"||!("typeName"in n)||typeof n.typeName!="string"?!1:e===void 0?!0:n.typeName==e.typeName}function Yl(t,e){return Kt(e)||!t.fieldWrapper?e:t.fieldWrapper.wrapField(e)}I.DOUBLE,I.FLOAT,I.INT64,I.UINT64,I.INT32,I.UINT32,I.BOOL,I.STRING,I.BYTES;const Xl={ignoreUnknownFields:!1},Ql={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function Tg(t){return t?Object.assign(Object.assign({},Xl),t):Xl}function xg(t){return t?Object.assign(Object.assign({},Ql),t):Ql}const _r=Symbol(),Sr=Symbol();function Eg(){return{makeReadOptions:Tg,makeWriteOptions:xg,readMessage(t,e,n,i){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error("cannot decode message ".concat(t.typeName," from JSON: ").concat(Pt(e)));i=i??new t;const r=new Map,o=n.typeRegistry;for(const[s,a]of Object.entries(e)){const c=t.fields.findJsonName(s);if(c){if(c.oneof){if(a===null&&c.kind=="scalar")continue;const l=r.get(c.oneof);if(l!==void 0)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: multiple keys for oneof "').concat(c.oneof.name,'" present: "').concat(l,'", "').concat(s,'"'));r.set(c.oneof,s)}Zl(i,a,c,n,t)}else{let l=!1;if(o!=null&&o.findExtension&&s.startsWith("[")&&s.endsWith("]")){const d=o.findExtension(s.substring(1,s.length-1));if(d&&d.extendee.typeName==t.typeName){l=!0;const[u,h]=$l(d);Zl(u,a,d.field,n,d),Sg(i,d,h(),n)}}if(!l&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: key "').concat(s,'" is unknown'))}}return i},writeMessage(t,e){const n=t.getType(),i={};let r;try{for(r of n.fields.byNumber()){if(!Kl(r,t)){if(r.req)throw"required field not set";if(!e.emitDefaultValues||!Rg(r))continue}const s=r.oneof?t[r.oneof.localName].value:t[r.localName],a=ed(r,s,e);a!==void 0&&(i[e.useProtoFieldName?r.name:r.jsonName]=a)}const o=e.typeRegistry;if(o!=null&&o.findExtensionFor)for(const s of n.runtime.bin.listUnknownFields(t)){const a=o.findExtensionFor(n.typeName,s.no);if(a&&Hl(t,a)){const c=_g(t,a,e),l=ed(a.field,c,e);l!==void 0&&(i[a.field.jsonName]=l)}}}catch(o){const s=r?"cannot encode field ".concat(n.typeName,".").concat(r.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),a=o instanceof Error?o.message:String(o);throw new Error(s+(a.length>0?": ".concat(a):""))}return i},readScalar(t,e,n){return Ni(t,e,n??fn.BIGINT,!0)},writeScalar(t,e,n){if(e!==void 0&&(n||zl(t,e)))return Tr(t,e)},debug:Pt}}function Pt(t){if(t===null)return"null";switch(typeof t){case"object":return Array.isArray(t)?"array":"object";case"string":return t.length>100?"string":'"'.concat(t.split('"').join('\\"'),'"');default:return String(t)}}function Zl(t,e,n,i,r){let o=n.localName;if(n.repeated){if(Ee(n.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Pt(e)));const s=t[o];for(const a of e){if(a===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Pt(a)));switch(n.kind){case"message":s.push(n.T.fromJson(a,i));break;case"enum":const c=as(n.T,a,i.ignoreUnknownFields,!0);c!==Sr&&s.push(c);break;case"scalar":try{s.push(Ni(n.T,a,n.L,!0))}catch(l){let d="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Pt(a));throw l instanceof Error&&l.message.length>0&&(d+=": ".concat(l.message)),new Error(d)}break}}}else if(n.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Pt(e)));const s=t[o];for(const[a,c]of Object.entries(e)){if(c===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: map value null"));let l;try{l=Pg(n.K,a)}catch(d){let u="cannot decode map key for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Pt(e));throw d instanceof Error&&d.message.length>0&&(u+=": ".concat(d.message)),new Error(u)}switch(n.V.kind){case"message":s[l]=n.V.T.fromJson(c,i);break;case"enum":const d=as(n.V.T,c,i.ignoreUnknownFields,!0);d!==Sr&&(s[l]=d);break;case"scalar":try{s[l]=Ni(n.V.T,c,fn.BIGINT,!0)}catch(u){let h="cannot decode map value for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Pt(e));throw u instanceof Error&&u.message.length>0&&(h+=": ".concat(u.message)),new Error(h)}break}}}else switch(n.oneof&&(t=t[n.oneof.localName]={case:o},o="value"),n.kind){case"message":const s=n.T;if(e===null&&s.typeName!="google.protobuf.Value")return;let a=t[o];Kt(a)?a.fromJson(e,i):(t[o]=a=s.fromJson(e,i),s.fieldWrapper&&!n.oneof&&(t[o]=s.fieldWrapper.unwrapField(a)));break;case"enum":const c=as(n.T,e,i.ignoreUnknownFields,!1);switch(c){case _r:Jl(n,t);break;case Sr:break;default:t[o]=c;break}break;case"scalar":try{const l=Ni(n.T,e,n.L,!1);switch(l){case _r:Jl(n,t);break;default:t[o]=l;break}}catch(l){let d="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Pt(e));throw l instanceof Error&&l.message.length>0&&(d+=": ".concat(l.message)),new Error(d)}break}}function Pg(t,e){if(t===I.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return Ni(t,e,fn.BIGINT,!0).toString()}function Ni(t,e,n,i){if(e===null)return i?Xn(t,n):_r;switch(t){case I.DOUBLE:case I.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const r=Number(e);if(Number.isNaN(r)||!Number.isFinite(r))break;return t==I.FLOAT&&Al(r),r;case I.INT32:case I.FIXED32:case I.SFIXED32:case I.SINT32:case I.UINT32:let o;if(typeof e=="number"?o=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(o=Number(e)),o===void 0)break;return t==I.UINT32||t==I.FIXED32?is(o):kr(o),o;case I.INT64:case I.SFIXED64:case I.SINT64:if(typeof e!="number"&&typeof e!="string")break;const s=Se.parse(e);return n?s.toString():s;case I.FIXED64:case I.UINT64:if(typeof e!="number"&&typeof e!="string")break;const a=Se.uParse(e);return n?a.toString():a;case I.BOOL:if(typeof e!="boolean")break;return e;case I.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case I.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return Wl.dec(e)}throw new Error}function as(t,e,n,i){if(e===null)return t.typeName=="google.protobuf.NullValue"?0:i?t.values[0].no:_r;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const r=t.findName(e);if(r!==void 0)return r.no;if(n)return Sr;break}throw new Error("cannot decode enum ".concat(t.typeName," from JSON: ").concat(Pt(e)))}function Rg(t){return t.repeated||t.kind=="map"?!0:!(t.oneof||t.kind=="message"||t.opt||t.req)}function ed(t,e,n){if(t.kind=="map"){Ee(typeof e=="object"&&e!=null);const i={},r=Object.entries(e);switch(t.V.kind){case"scalar":for(const[s,a]of r)i[s.toString()]=Tr(t.V.T,a);break;case"message":for(const[s,a]of r)i[s.toString()]=a.toJson(n);break;case"enum":const o=t.V.T;for(const[s,a]of r)i[s.toString()]=cs(o,a,n.enumAsInteger);break}return n.emitDefaultValues||r.length>0?i:void 0}if(t.repeated){Ee(Array.isArray(e));const i=[];switch(t.kind){case"scalar":for(let r=0;r<e.length;r++)i.push(Tr(t.T,e[r]));break;case"enum":for(let r=0;r<e.length;r++)i.push(cs(t.T,e[r],n.enumAsInteger));break;case"message":for(let r=0;r<e.length;r++)i.push(e[r].toJson(n));break}return n.emitDefaultValues||i.length>0?i:void 0}switch(t.kind){case"scalar":return Tr(t.T,e);case"enum":return cs(t.T,e,n.enumAsInteger);case"message":return Yl(t.T,e).toJson(n)}}function cs(t,e,n){var i;if(Ee(typeof e=="number"),t.typeName=="google.protobuf.NullValue")return null;if(n)return e;const r=t.findNumber(e);return(i=r==null?void 0:r.name)!==null&&i!==void 0?i:e}function Tr(t,e){switch(t){case I.INT32:case I.SFIXED32:case I.SINT32:case I.FIXED32:case I.UINT32:return Ee(typeof e=="number"),e;case I.FLOAT:case I.DOUBLE:return Ee(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case I.STRING:return Ee(typeof e=="string"),e;case I.BOOL:return Ee(typeof e=="boolean"),e;case I.UINT64:case I.FIXED64:case I.INT64:case I.SFIXED64:case I.SINT64:return Ee(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case I.BYTES:return Ee(e instanceof Uint8Array),Wl.enc(e)}}const Qn=Symbol("@bufbuild/protobuf/unknown-fields"),td={readUnknownFields:!0,readerFactory:t=>new yg(t)},nd={writeUnknownFields:!0,writerFactory:()=>new bg};function Ig(t){return t?Object.assign(Object.assign({},td),t):td}function Og(t){return t?Object.assign(Object.assign({},nd),t):nd}function Dg(){return{makeReadOptions:Ig,makeWriteOptions:Og,listUnknownFields(t){var e;return(e=t[Qn])!==null&&e!==void 0?e:[]},discardUnknownFields(t){delete t[Qn]},writeUnknownFields(t,e){const i=t[Qn];if(i)for(const r of i)e.tag(r.no,r.wireType).raw(r.data)},onUnknownField(t,e,n,i){const r=t;Array.isArray(r[Qn])||(r[Qn]=[]),r[Qn].push({no:e,wireType:n,data:i})},readMessage(t,e,n,i,r){const o=t.getType(),s=r?e.len:e.pos+n;let a,c;for(;e.pos<s&&([a,c]=e.tag(),!(r===!0&&c==Ie.EndGroup));){const l=o.fields.find(a);if(!l){const d=e.skip(c,a);i.readUnknownFields&&this.onUnknownField(t,a,c,d);continue}id(t,e,l,c,i)}if(r&&(c!=Ie.EndGroup||a!==n))throw new Error("invalid end group tag")},readField:id,writeMessage(t,e,n){const i=t.getType();for(const r of i.fields.byNumber()){if(!Kl(r,t)){if(r.req)throw new Error("cannot encode field ".concat(i.typeName,".").concat(r.name," to binary: required field not set"));continue}const o=r.oneof?t[r.oneof.localName].value:t[r.localName];rd(r,o,e,n)}return n.writeUnknownFields&&this.writeUnknownFields(t,e),e},writeField(t,e,n,i){e!==void 0&&rd(t,e,n,i)}}}function id(t,e,n,i,r){let{repeated:o,localName:s}=n;switch(n.oneof&&(t=t[n.oneof.localName],t.case!=s&&delete t.value,t.case=s,s="value"),n.kind){case"scalar":case"enum":const a=n.kind=="enum"?I.INT32:n.T;let c=Er;if(n.kind=="scalar"&&n.L>0&&(c=Mg),o){let h=t[s];if(i==Ie.LengthDelimited&&a!=I.STRING&&a!=I.BYTES){let g=e.uint32()+e.pos;for(;e.pos<g;)h.push(c(e,a))}else h.push(c(e,a))}else t[s]=c(e,a);break;case"message":const l=n.T;o?t[s].push(xr(e,new l,r,n)):Kt(t[s])?xr(e,t[s],r,n):(t[s]=xr(e,new l,r,n),l.fieldWrapper&&!n.oneof&&!n.repeated&&(t[s]=l.fieldWrapper.unwrapField(t[s])));break;case"map":let[d,u]=Ag(n,e,r);t[s][d]=u;break}}function xr(t,e,n,i){const r=e.getType().runtime.bin,o=i==null?void 0:i.delimited;return r.readMessage(e,t,o?i.no:t.uint32(),n,o),e}function Ag(t,e,n){const i=e.uint32(),r=e.pos+i;let o,s;for(;e.pos<r;){const[a]=e.tag();switch(a){case 1:o=Er(e,t.K);break;case 2:switch(t.V.kind){case"scalar":s=Er(e,t.V.T);break;case"enum":s=e.int32();break;case"message":s=xr(e,new t.V.T,n,void 0);break}break}}if(o===void 0&&(o=Xn(t.K,fn.BIGINT)),typeof o!="string"&&typeof o!="number"&&(o=o.toString()),s===void 0)switch(t.V.kind){case"scalar":s=Xn(t.V.T,fn.BIGINT);break;case"enum":s=t.V.T.values[0].no;break;case"message":s=new t.V.T;break}return[o,s]}function Mg(t,e){const n=Er(t,e);return typeof n=="bigint"?n.toString():n}function Er(t,e){switch(e){case I.STRING:return t.string();case I.BOOL:return t.bool();case I.DOUBLE:return t.double();case I.FLOAT:return t.float();case I.INT32:return t.int32();case I.INT64:return t.int64();case I.UINT64:return t.uint64();case I.FIXED64:return t.fixed64();case I.BYTES:return t.bytes();case I.FIXED32:return t.fixed32();case I.SFIXED32:return t.sfixed32();case I.SFIXED64:return t.sfixed64();case I.SINT64:return t.sint64();case I.UINT32:return t.uint32();case I.SINT32:return t.sint32()}}function rd(t,e,n,i){Ee(e!==void 0);const r=t.repeated;switch(t.kind){case"scalar":case"enum":let o=t.kind=="enum"?I.INT32:t.T;if(r)if(Ee(Array.isArray(e)),t.packed)Lg(n,o,t.no,e);else for(const s of e)Li(n,o,t.no,s);else Li(n,o,t.no,e);break;case"message":if(r){Ee(Array.isArray(e));for(const s of e)od(n,i,t,s)}else od(n,i,t,e);break;case"map":Ee(typeof e=="object"&&e!=null);for(const[s,a]of Object.entries(e))Ng(n,i,t,s,a);break}}function Ng(t,e,n,i,r){t.tag(n.no,Ie.LengthDelimited),t.fork();let o=i;switch(n.K){case I.INT32:case I.FIXED32:case I.UINT32:case I.SFIXED32:case I.SINT32:o=Number.parseInt(i);break;case I.BOOL:Ee(i=="true"||i=="false"),o=i=="true";break}switch(Li(t,n.K,1,o),n.V.kind){case"scalar":Li(t,n.V.T,2,r);break;case"enum":Li(t,I.INT32,2,r);break;case"message":Ee(r!==void 0),t.tag(2,Ie.LengthDelimited).bytes(r.toBinary(e));break}t.join()}function od(t,e,n,i){const r=Yl(n.T,i);n.delimited?t.tag(n.no,Ie.StartGroup).raw(r.toBinary(e)).tag(n.no,Ie.EndGroup):t.tag(n.no,Ie.LengthDelimited).bytes(r.toBinary(e))}function Li(t,e,n,i){Ee(i!==void 0);let[r,o]=sd(e);t.tag(n,r)[o](i)}function Lg(t,e,n,i){if(!i.length)return;t.tag(n,Ie.LengthDelimited).fork();let[,r]=sd(e);for(let o=0;o<i.length;o++)t[r](i[o]);t.join()}function sd(t){let e=Ie.Varint;switch(t){case I.BYTES:case I.STRING:e=Ie.LengthDelimited;break;case I.DOUBLE:case I.FIXED64:case I.SFIXED64:e=Ie.Bit64;break;case I.FIXED32:case I.SFIXED32:case I.FLOAT:e=Ie.Bit32;break}const n=I[t].toLowerCase();return[e,n]}function Ug(){return{setEnumType:Nl,initPartial(t,e){if(t===void 0)return;const n=e.getType();for(const i of n.fields.byMember()){const r=i.localName,o=e,s=t;if(s[r]!=null)switch(i.kind){case"oneof":const a=s[r].case;if(a===void 0)continue;const c=i.findField(a);let l=s[r].value;c&&c.kind=="message"&&!Kt(l,c.T)?l=new c.T(l):c&&c.kind==="scalar"&&c.T===I.BYTES&&(l=Ui(l)),o[r]={case:a,value:l};break;case"scalar":case"enum":let d=s[r];i.T===I.BYTES&&(d=i.repeated?d.map(Ui):Ui(d)),o[r]=d;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===I.BYTES)for(const[f,g]of Object.entries(s[r]))o[r][f]=Ui(g);else Object.assign(o[r],s[r]);break;case"message":const h=i.V.T;for(const f of Object.keys(s[r])){let g=s[r][f];h.fieldWrapper||(g=new h(g)),o[r][f]=g}break}break;case"message":const u=i.T;if(i.repeated)o[r]=s[r].map(h=>Kt(h,u)?h:new u(h));else{const h=s[r];u.fieldWrapper?u.typeName==="google.protobuf.BytesValue"?o[r]=Ui(h):o[r]=h:o[r]=Kt(h,u)?h:new u(h)}break}}},equals(t,e,n){return e===n?!0:!e||!n?!1:t.fields.byMember().every(i=>{const r=e[i.localName],o=n[i.localName];if(i.repeated){if(r.length!==o.length)return!1;switch(i.kind){case"message":return r.every((s,a)=>i.T.equals(s,o[a]));case"scalar":return r.every((s,a)=>pn(i.T,s,o[a]));case"enum":return r.every((s,a)=>pn(I.INT32,s,o[a]))}throw new Error("repeated cannot contain ".concat(i.kind))}switch(i.kind){case"message":let s=r,a=o;return i.T.fieldWrapper&&(s!==void 0&&!Kt(s)&&(s=i.T.fieldWrapper.wrapField(s)),a!==void 0&&!Kt(a)&&(a=i.T.fieldWrapper.wrapField(a))),i.T.equals(s,a);case"enum":return pn(I.INT32,r,o);case"scalar":return pn(i.T,r,o);case"oneof":if(r.case!==o.case)return!1;const c=i.findField(r.case);if(c===void 0)return!0;switch(c.kind){case"message":return c.T.equals(r.value,o.value);case"enum":return pn(I.INT32,r.value,o.value);case"scalar":return pn(c.T,r.value,o.value)}throw new Error("oneof cannot contain ".concat(c.kind));case"map":const l=Object.keys(r).concat(Object.keys(o));switch(i.V.kind){case"message":const d=i.V.T;return l.every(h=>d.equals(r[h],o[h]));case"enum":return l.every(h=>pn(I.INT32,r[h],o[h]));case"scalar":const u=i.V.T;return l.every(h=>pn(u,r[h],o[h]))}break}})},clone(t){const e=t.getType(),n=new e,i=n;for(const r of e.fields.byMember()){const o=t[r.localName];let s;if(r.repeated)s=o.map(Pr);else if(r.kind=="map"){s=i[r.localName];for(const[a,c]of Object.entries(o))s[a]=Pr(c)}else r.kind=="oneof"?s=r.findField(o.case)?{case:o.case,value:Pr(o.value)}:{case:void 0}:s=Pr(o);i[r.localName]=s}for(const r of e.runtime.bin.listUnknownFields(t))e.runtime.bin.onUnknownField(i,r.no,r.wireType,r.data);return n}}}function Pr(t){if(t===void 0)return t;if(Kt(t))return t.clone();if(t instanceof Uint8Array){const e=new Uint8Array(t.byteLength);return e.set(t),e}return t}function Ui(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function Fg(t,e,n){return{syntax:t,json:Eg(),bin:Dg(),util:Object.assign(Object.assign({},Ug()),{newFieldList:e,initFields:n}),makeMessageType(i,r,o){return hg(this,i,r,o)},makeEnum:ug,makeEnumType:Ll,getEnumType:dg,makeExtension(i,r,o){return kg(this,i,r,o)}}}class Bg{constructor(e,n){this._fields=e,this._normalizer=n}findJsonName(e){if(!this.jsonNames){const n={};for(const i of this.list())n[i.jsonName]=n[i.name]=i;this.jsonNames=n}return this.jsonNames[e]}find(e){if(!this.numbers){const n={};for(const i of this.list())n[i.no]=i;this.numbers=n}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,n)=>e.no-n.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let n;for(const i of this.list())i.oneof?i.oneof!==n&&(n=i.oneof,e.push(n)):e.push(i)}return this.members}}function ad(t,e){const n=cd(t);return e?n:Wg($g(n))}function jg(t){return ad(t,!1)}const Vg=cd;function cd(t){let e=!1;const n=[];for(let i=0;i<t.length;i++){let r=t.charAt(i);switch(r){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(r),e=!1;break;default:e&&(e=!1,r=r.toUpperCase()),n.push(r);break}}return n.join("")}const qg=new Set(["constructor","toString","toJSON","valueOf"]),zg=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),ld=t=>"".concat(t,"$"),$g=t=>zg.has(t)?ld(t):t,Wg=t=>qg.has(t)?ld(t):t;class Hg{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=jg(e)}addField(e){Ee(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let n=0;n<this.fields.length;n++)this._lookup[this.fields[n].localName]=this.fields[n]}return this._lookup[e]}}function Gg(t,e){var n,i,r,o,s,a;const c=[];let l;for(const d of typeof t=="function"?t():t){const u=d;if(u.localName=ad(d.name,d.oneof!==void 0),u.jsonName=(n=d.jsonName)!==null&&n!==void 0?n:Vg(d.name),u.repeated=(i=d.repeated)!==null&&i!==void 0?i:!1,d.kind=="scalar"&&(u.L=(r=d.L)!==null&&r!==void 0?r:fn.BIGINT),u.delimited=(o=d.delimited)!==null&&o!==void 0?o:!1,u.req=(s=d.req)!==null&&s!==void 0?s:!1,u.opt=(a=d.opt)!==null&&a!==void 0?a:!1,d.packed===void 0&&(u.packed=d.kind=="enum"||d.kind=="scalar"&&d.T!=I.BYTES&&d.T!=I.STRING),d.oneof!==void 0){const h=typeof d.oneof=="string"?d.oneof:d.oneof.name;(!l||l.name!=h)&&(l=new Hg(h)),u.oneof=l,l.addField(u)}c.push(u)}return c}const T=Fg("proto3",t=>new Bg(t,e=>Gg(e)),t=>{for(const e of t.getType().fields.byMember()){if(e.opt)continue;const n=e.localName,i=t;if(e.repeated){i[n]=[];continue}switch(e.kind){case"oneof":i[n]={case:void 0};break;case"enum":i[n]=0;break;case"map":i[n]={};break;case"scalar":i[n]=Xn(e.T,e.L);break}}});class Je extends rs{constructor(e){super(),this.seconds=Se.zero,this.nanos=0,T.util.initPartial(e,this)}fromJson(e,n){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(T.json.debug(e)));const i=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!i)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const r=Date.parse(i[1]+"-"+i[2]+"-"+i[3]+"T"+i[4]+":"+i[5]+":"+i[6]+(i[8]?i[8]:"Z"));if(Number.isNaN(r))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(r<Date.parse("0001-01-01T00:00:00Z")||r>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=Se.parse(r/1e3),this.nanos=0,i[7]&&(this.nanos=parseInt("1"+i[7]+"0".repeat(9-i[7].length))-1e9),this}toJson(e){const n=Number(this.seconds)*1e3;if(n<Date.parse("0001-01-01T00:00:00Z")||n>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let i="Z";if(this.nanos>0){const r=(this.nanos+1e9).toString().substring(1);r.substring(3)==="000000"?i="."+r.substring(0,3)+"Z":r.substring(6)==="000"?i="."+r.substring(0,6)+"Z":i="."+r+"Z"}return new Date(n).toISOString().replace(".000Z",i)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return Je.fromDate(new Date)}static fromDate(e){const n=e.getTime();return new Je({seconds:Se.parse(Math.floor(n/1e3)),nanos:n%1e3*1e6})}static fromBinary(e,n){return new Je().fromBinary(e,n)}static fromJson(e,n){return new Je().fromJson(e,n)}static fromJsonString(e,n){return new Je().fromJsonString(e,n)}static equals(e,n){return T.util.equals(Je,e,n)}}Je.runtime=T,Je.typeName="google.protobuf.Timestamp",Je.fields=T.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const Kg=T.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Je},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:Jg,repeated:!0},{no:5,name:"events",kind:"message",T:Xg,repeated:!0}]),Jg=T.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:Yg,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),Yg=T.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Je},{no:3,name:"value",kind:"scalar",T:2}]),Xg=T.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:Je},{no:7,name:"normalized_end_timestamp",kind:"message",T:Je,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),dd=T.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),pt=T.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),De=T.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),ls=T.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),Fi=T.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),Bi=T.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),mt=T.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),Zn=T.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),Qg=T.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),je=T.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),Rr=T.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:Ir,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:Sd}]),Ir=T.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),Zg=T.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:T.getEnumType(De),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),An=T.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:T.getEnumType(ei)},{no:4,name:"tracks",kind:"message",T:ti,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:Zg},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:T.getEnumType(ji)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:T.getEnumType(mt)},{no:18,name:"kind_details",kind:"enum",T:T.getEnumType(ev),repeated:!0}]),ei=T.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),ji=T.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"}]),ev=T.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),ot=T.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),tv=T.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:Mn,repeated:!0}]),ti=T.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:T.getEnumType(pt)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:T.getEnumType(De)},{no:10,name:"layers",kind:"message",T:Mn,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:tv,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:T.getEnumType(ot)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:Sd},{no:19,name:"audio_features",kind:"enum",T:T.getEnumType(je),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:T.getEnumType(dd)}]),Mn=T.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:T.getEnumType(ls)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9}]),Ye=T.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:T.getEnumType(Q)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:hd,oneof:"value"},{no:3,name:"speaker",kind:"message",T:nv,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:fd,oneof:"value"},{no:7,name:"transcription",kind:"message",T:iv,oneof:"value"},{no:8,name:"metrics",kind:"message",T:Kg,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:ds,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:pd,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:md,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:gd,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:hs,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:fs,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:ps,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),Q=T.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),nv=T.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:ud,repeated:!0}]),ud=T.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),hd=T.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),fd=T.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),iv=T.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:rv,repeated:!0}]),rv=T.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),ds=T.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),pd=T.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),md=T.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),gd=T.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:vd,oneof:"value"}]),vd=T.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),bd=T.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),yd=T.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:T.getEnumType(kd)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),kd=T.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),ov=T.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:T.getEnumType(wd)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),wd=T.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),Cd=T.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:_d},{no:2,name:"screen",kind:"message",T:_d},{no:3,name:"resume_connection",kind:"enum",T:T.getEnumType(Bi)},{no:4,name:"disabled_codecs",kind:"message",T:sv},{no:5,name:"force_relay",kind:"enum",T:T.getEnumType(Bi)}]),_d=T.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:T.getEnumType(Bi)}]),sv=T.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:Ir,repeated:!0},{no:2,name:"publish",kind:"message",T:Ir,repeated:!0}]),Sd=T.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),us=T.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),Td=T.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:T.getEnumType(us)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),xd=T.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),hs=T.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:T.getEnumType(ot)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:Td,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:xd,oneof:"content_header"}],{localName:"DataStream_Header"}),fs=T.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),ps=T.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),gt=T.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),ms=T.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),av=T.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),cv=T.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:Nn,oneof:"message"},{no:2,name:"answer",kind:"message",T:Nn,oneof:"message"},{no:3,name:"trickle",kind:"message",T:bs,oneof:"message"},{no:4,name:"add_track",kind:"message",T:vs,oneof:"message"},{no:5,name:"mute",kind:"message",T:ys,oneof:"message"},{no:6,name:"subscription",kind:"message",T:Or,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:Pd,oneof:"message"},{no:8,name:"leave",kind:"message",T:Dr,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:Id,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:Md,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:Nd,oneof:"message"},{no:13,name:"simulate",kind:"message",T:Rt,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:Od,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:Fd,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:Rd,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:fv,oneof:"message"}]),Ed=T.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:lv,oneof:"message"},{no:2,name:"answer",kind:"message",T:Nn,oneof:"message"},{no:3,name:"offer",kind:"message",T:Nn,oneof:"message"},{no:4,name:"trickle",kind:"message",T:bs,oneof:"message"},{no:5,name:"update",kind:"message",T:hv,oneof:"message"},{no:6,name:"track_published",kind:"message",T:ks,oneof:"message"},{no:8,name:"leave",kind:"message",T:Dr,oneof:"message"},{no:9,name:"mute",kind:"message",T:ys,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:pv,oneof:"message"},{no:11,name:"room_update",kind:"message",T:mv,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:vv,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:yv,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:wv,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:Cv,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:uv,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:dv,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:Sv,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:Ev,oneof:"message"},{no:22,name:"request_response",kind:"message",T:Pv,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:Rv,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:_v,oneof:"message"}]),gs=T.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9}]),vs=T.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:T.getEnumType(pt)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:T.getEnumType(De)},{no:9,name:"layers",kind:"message",T:Mn,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:gs,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:T.getEnumType(ot)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:T.getEnumType(dd)},{no:17,name:"audio_features",kind:"enum",T:T.getEnumType(je),repeated:!0}]),bs=T.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:T.getEnumType(gt)},{no:3,name:"final",kind:"scalar",T:8}]),ys=T.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),lv=T.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:Rr},{no:2,name:"participant",kind:"message",T:An},{no:3,name:"other_participants",kind:"message",T:An,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:Dd,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:Cd},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:yd},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:Ir,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),dv=T.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:Dd,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:Cd},{no:3,name:"server_info",kind:"message",T:yd},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),ks=T.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:ti}]),uv=T.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),Nn=T.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13}]),hv=T.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:An,repeated:!0}]),Or=T.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:bd,repeated:!0}]),Pd=T.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:T.getEnumType(ls)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),Rd=T.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:T.getEnumType(je),repeated:!0}]),fv=T.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),Dr=T.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:T.getEnumType(mt)},{no:3,name:"action",kind:"enum",T:T.getEnumType(ni)},{no:4,name:"regions",kind:"message",T:Tv}]),ni=T.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),Id=T.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:Mn,repeated:!0}]),Od=T.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),Dd=T.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),pv=T.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:ud,repeated:!0}]),mv=T.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:Rr}]),gv=T.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:T.getEnumType(Fi)},{no:3,name:"score",kind:"scalar",T:2}]),vv=T.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:gv,repeated:!0}]),bv=T.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:T.getEnumType(ms)}]),yv=T.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:bv,repeated:!0}]),ws=T.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:T.getEnumType(ls)},{no:2,name:"enabled",kind:"scalar",T:8}]),kv=T.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:ws,repeated:!0}]),wv=T.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:ws,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:kv,repeated:!0}]),Ad=T.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),Md=T.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:Ad,repeated:!0}]),Cv=T.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),_v=T.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:Rr},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:An},{no:4,name:"other_participants",kind:"message",T:An,repeated:!0}]),Nd=T.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:Nn},{no:2,name:"subscription",kind:"message",T:Or},{no:3,name:"publish_tracks",kind:"message",T:ks,repeated:!0},{no:4,name:"data_channels",kind:"message",T:Ud,repeated:!0},{no:5,name:"offer",kind:"message",T:Nn},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:Ld,repeated:!0}]),Ld=T.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),Ud=T.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:T.getEnumType(gt)}]),Rt=T.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:T.getEnumType(av),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),Fd=T.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),Sv=T.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),Tv=T.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:xv,repeated:!0}]),xv=T.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),Ev=T.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:T.getEnumType(Qg)}]),Pv=T.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:T.getEnumType(Cs)},{no:3,name:"message",kind:"scalar",T:9}]),Cs=T.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"}]),Rv=T.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]);function Iv(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Ar={exports:{}},Ov=Ar.exports,Bd;function Dv(){return Bd||(Bd=1,(function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(Ov,function(){var e=function(){},n="undefined",i=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],o={},s=null;function a(p,v){var b=p[v];if(typeof b.bind=="function")return b.bind(p);try{return Function.prototype.bind.call(b,p)}catch{return function(){return Function.prototype.apply.apply(b,[p,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(p){return p==="debug"&&(p="log"),typeof console===n?!1:p==="trace"&&i?c:console[p]!==void 0?a(console,p):console.log!==void 0?a(console,"log"):e}function d(){for(var p=this.getLevel(),v=0;v<r.length;v++){var b=r[v];this[b]=v<p?e:this.methodFactory(b,p,this.name)}if(this.log=this.debug,typeof console===n&&p<this.levels.SILENT)return"No console available for logging"}function u(p){return function(){typeof console!==n&&(d.call(this),this[p].apply(this,arguments))}}function h(p,v,b){return l(p)||u.apply(this,arguments)}function f(p,v){var b=this,k,C,y,_="loglevel";typeof p=="string"?_+=":"+p:typeof p=="symbol"&&(_=void 0);function S(M){var F=(r[M]||"silent").toUpperCase();if(!(typeof window===n||!_)){try{window.localStorage[_]=F;return}catch{}try{window.document.cookie=encodeURIComponent(_)+"="+F+";"}catch{}}}function E(){var M;if(!(typeof window===n||!_)){try{M=window.localStorage[_]}catch{}if(typeof M===n)try{var F=window.document.cookie,z=encodeURIComponent(_),W=F.indexOf(z+"=");W!==-1&&(M=/^([^;]+)/.exec(F.slice(W+z.length+1))[1])}catch{}return b.levels[M]===void 0&&(M=void 0),M}}function x(){if(!(typeof window===n||!_)){try{window.localStorage.removeItem(_)}catch{}try{window.document.cookie=encodeURIComponent(_)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function P(M){var F=M;if(typeof F=="string"&&b.levels[F.toUpperCase()]!==void 0&&(F=b.levels[F.toUpperCase()]),typeof F=="number"&&F>=0&&F<=b.levels.SILENT)return F;throw new TypeError("log.setLevel() called with invalid level: "+M)}b.name=p,b.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},b.methodFactory=v||h,b.getLevel=function(){return y??C??k},b.setLevel=function(M,F){return y=P(M),F!==!1&&S(y),d.call(b)},b.setDefaultLevel=function(M){C=P(M),E()||b.setLevel(M,!1)},b.resetLevel=function(){y=null,x(),d.call(b)},b.enableAll=function(M){b.setLevel(b.levels.TRACE,M)},b.disableAll=function(M){b.setLevel(b.levels.SILENT,M)},b.rebuild=function(){if(s!==b&&(k=P(s.getLevel())),d.call(b),s===b)for(var M in o)o[M].rebuild()},k=P(s?s.getLevel():"WARN");var D=E();D!=null&&(y=P(D)),d.call(b)}s=new f,s.getLogger=function(v){if(typeof v!="symbol"&&typeof v!="string"||v==="")throw new TypeError("You must supply a name when creating a logger.");var b=o[v];return b||(b=o[v]=new f(v,s.methodFactory)),b};var g=typeof window!==n?window.log:void 0;return s.noConflict=function(){return typeof window!==n&&window.log===s&&(window.log=g),s},s.getLoggers=function(){return o},s.default=s,s})})(Ar)),Ar.exports}var Mr=Dv(),_s;(function(t){t[t.trace=0]="trace",t[t.debug=1]="debug",t[t.info=2]="info",t[t.warn=3]="warn",t[t.error=4]="error",t[t.silent=5]="silent"})(_s||(_s={}));var vt;(function(t){t.Default="livekit",t.Room="livekit-room",t.Participant="livekit-participant",t.Track="livekit-track",t.Publication="livekit-track-publication",t.Engine="livekit-engine",t.Signal="livekit-signal",t.PCManager="livekit-pc-manager",t.PCTransport="livekit-pc-transport",t.E2EE="lk-e2ee"})(vt||(vt={}));let ie=Mr.getLogger("livekit");Object.values(vt).map(t=>Mr.getLogger(t)),ie.setDefaultLevel(_s.info);function Jt(t){const e=Mr.getLogger(t);return e.setDefaultLevel(ie.getLevel()),e}const Av=Mr.getLogger("lk-e2ee"),Vi=7e3,Mv=[0,300,4*300,9*300,16*300,Vi,Vi,Vi,Vi,Vi];class Nv{constructor(e){this._retryDelays=e!==void 0?[...e]:Mv}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const n=this._retryDelays[e.retryCount];return e.retryCount<=1?n:n+Math.random()*1e3}}function Lv(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n}function w(t,e,n,i){function r(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function a(d){try{l(i.next(d))}catch(u){s(u)}}function c(d){try{l(i.throw(d))}catch(u){s(u)}}function l(d){d.done?o(d.value):r(d.value).then(a,c)}l((i=i.apply(t,e||[])).next())})}function jd(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Yt(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof jd=="function"?jd(t):t[Symbol.iterator](),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(o){n[o]=t[o]&&function(s){return new Promise(function(a,c){s=t[o](s),r(a,c,s.done,s.value)})}}function r(o,s,a,c){Promise.resolve(c).then(function(l){o({value:l,done:a})},s)}}typeof SuppressedError=="function"&&SuppressedError;var Nr={exports:{}},Vd;function Uv(){if(Vd)return Nr.exports;Vd=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(_,S,E){return Function.prototype.apply.call(_,S,E)},n;t&&typeof t.ownKeys=="function"?n=t.ownKeys:Object.getOwnPropertySymbols?n=function(_){return Object.getOwnPropertyNames(_).concat(Object.getOwnPropertySymbols(_))}:n=function(_){return Object.getOwnPropertyNames(_)};function i(y){console&&console.warn&&console.warn(y)}var r=Number.isNaN||function(_){return _!==_};function o(){o.init.call(this)}Nr.exports=o,Nr.exports.once=b,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var s=10;function a(y){if(typeof y!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof y)}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(y){if(typeof y!="number"||y<0||r(y))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+y+".");s=y}}),o.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(_){if(typeof _!="number"||_<0||r(_))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+_+".");return this._maxListeners=_,this};function c(y){return y._maxListeners===void 0?o.defaultMaxListeners:y._maxListeners}o.prototype.getMaxListeners=function(){return c(this)},o.prototype.emit=function(_){for(var S=[],E=1;E<arguments.length;E++)S.push(arguments[E]);var x=_==="error",P=this._events;if(P!==void 0)x=x&&P.error===void 0;else if(!x)return!1;if(x){var D;if(S.length>0&&(D=S[0]),D instanceof Error)throw D;var M=new Error("Unhandled error."+(D?" ("+D.message+")":""));throw M.context=D,M}var F=P[_];if(F===void 0)return!1;if(typeof F=="function")e(F,this,S);else for(var z=F.length,W=g(F,z),E=0;E<z;++E)e(W[E],this,S);return!0};function l(y,_,S,E){var x,P,D;if(a(S),P=y._events,P===void 0?(P=y._events=Object.create(null),y._eventsCount=0):(P.newListener!==void 0&&(y.emit("newListener",_,S.listener?S.listener:S),P=y._events),D=P[_]),D===void 0)D=P[_]=S,++y._eventsCount;else if(typeof D=="function"?D=P[_]=E?[S,D]:[D,S]:E?D.unshift(S):D.push(S),x=c(y),x>0&&D.length>x&&!D.warned){D.warned=!0;var M=new Error("Possible EventEmitter memory leak detected. "+D.length+" "+String(_)+" listeners added. Use emitter.setMaxListeners() to increase limit");M.name="MaxListenersExceededWarning",M.emitter=y,M.type=_,M.count=D.length,i(M)}return y}o.prototype.addListener=function(_,S){return l(this,_,S,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(_,S){return l(this,_,S,!0)};function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(y,_,S){var E={fired:!1,wrapFn:void 0,target:y,type:_,listener:S},x=d.bind(E);return x.listener=S,E.wrapFn=x,x}o.prototype.once=function(_,S){return a(S),this.on(_,u(this,_,S)),this},o.prototype.prependOnceListener=function(_,S){return a(S),this.prependListener(_,u(this,_,S)),this},o.prototype.removeListener=function(_,S){var E,x,P,D,M;if(a(S),x=this._events,x===void 0)return this;if(E=x[_],E===void 0)return this;if(E===S||E.listener===S)--this._eventsCount===0?this._events=Object.create(null):(delete x[_],x.removeListener&&this.emit("removeListener",_,E.listener||S));else if(typeof E!="function"){for(P=-1,D=E.length-1;D>=0;D--)if(E[D]===S||E[D].listener===S){M=E[D].listener,P=D;break}if(P<0)return this;P===0?E.shift():p(E,P),E.length===1&&(x[_]=E[0]),x.removeListener!==void 0&&this.emit("removeListener",_,M||S)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(_){var S,E,x;if(E=this._events,E===void 0)return this;if(E.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):E[_]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete E[_]),this;if(arguments.length===0){var P=Object.keys(E),D;for(x=0;x<P.length;++x)D=P[x],D!=="removeListener"&&this.removeAllListeners(D);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(S=E[_],typeof S=="function")this.removeListener(_,S);else if(S!==void 0)for(x=S.length-1;x>=0;x--)this.removeListener(_,S[x]);return this};function h(y,_,S){var E=y._events;if(E===void 0)return[];var x=E[_];return x===void 0?[]:typeof x=="function"?S?[x.listener||x]:[x]:S?v(x):g(x,x.length)}o.prototype.listeners=function(_){return h(this,_,!0)},o.prototype.rawListeners=function(_){return h(this,_,!1)},o.listenerCount=function(y,_){return typeof y.listenerCount=="function"?y.listenerCount(_):f.call(y,_)},o.prototype.listenerCount=f;function f(y){var _=this._events;if(_!==void 0){var S=_[y];if(typeof S=="function")return 1;if(S!==void 0)return S.length}return 0}o.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function g(y,_){for(var S=new Array(_),E=0;E<_;++E)S[E]=y[E];return S}function p(y,_){for(;_+1<y.length;_++)y[_]=y[_+1];y.pop()}function v(y){for(var _=new Array(y.length),S=0;S<_.length;++S)_[S]=y[S].listener||y[S];return _}function b(y,_){return new Promise(function(S,E){function x(D){y.removeListener(_,P),E(D)}function P(){typeof y.removeListener=="function"&&y.removeListener("error",x),S([].slice.call(arguments))}C(y,_,P,{once:!0}),_!=="error"&&k(y,x,{once:!0})})}function k(y,_,S){typeof y.on=="function"&&C(y,"error",_,S)}function C(y,_,S,E){if(typeof y.on=="function")E.once?y.once(_,S):y.on(_,S);else if(typeof y.addEventListener=="function")y.addEventListener(_,function x(P){E.once&&y.removeEventListener(_,x),S(P)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof y)}return Nr.exports}var It=Uv();let qd=!0,zd=!0;function qi(t,e,n){const i=t.match(e);return i&&i.length>=n&&parseFloat(i[n],10)}function Ln(t,e,n){if(!t.RTCPeerConnection)return;const i=t.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(s,a){if(s!==e)return r.apply(this,arguments);const c=l=>{const d=n(l);d&&(a.handleEvent?a.handleEvent(d):a(d))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,c),r.apply(this,[s,c])};const o=i.removeEventListener;i.removeEventListener=function(s,a){if(s!==e||!this._eventMap||!this._eventMap[e])return o.apply(this,arguments);if(!this._eventMap[e].has(a))return o.apply(this,arguments);const c=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,o.apply(this,[s,c])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(s){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),s&&this.addEventListener(e,this["_on"+e]=s)},enumerable:!0,configurable:!0})}function Fv(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(qd=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function Bv(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(zd=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function $d(){if(typeof window=="object"){if(qd)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Ss(t,e){zd&&console.warn(t+" is deprecated, please use "+e+" instead.")}function jv(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const i=n.userAgentData.brands.find(r=>r.brand==="Chromium");if(i)return{browser:"chrome",version:parseInt(i.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=parseInt(qi(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(qi(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(qi(n.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,e._safariVersion=qi(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function Wd(t){return Object.prototype.toString.call(t)==="[object Object]"}function Hd(t){return Wd(t)?Object.keys(t).reduce(function(e,n){const i=Wd(t[n]),r=i?Hd(t[n]):t[n],o=i&&!Object.keys(r).length;return r===void 0||o?e:Object.assign(e,{[n]:r})},{}):t}function Ts(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?Ts(t,t.get(e[i]),n):i.endsWith("Ids")&&e[i].forEach(r=>{Ts(t,t.get(r),n)})}))}function Gd(t,e,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(e===null)return r;const o=[];return t.forEach(s=>{s.type==="track"&&s.trackIdentifier===e.id&&o.push(s)}),o.forEach(s=>{t.forEach(a=>{a.type===i&&a.trackId===s.id&&Ts(t,a,r)})}),r}const Kd=$d;function Jd(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const i=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const c={};return Object.keys(a).forEach(l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;const d=typeof a[l]=="object"?a[l]:{ideal:a[l]};d.exact!==void 0&&typeof d.exact=="number"&&(d.min=d.max=d.exact);const u=function(h,f){return h?h+f.charAt(0).toUpperCase()+f.slice(1):f==="deviceId"?"sourceId":f};if(d.ideal!==void 0){c.optional=c.optional||[];let h={};typeof d.ideal=="number"?(h[u("min",l)]=d.ideal,c.optional.push(h),h={},h[u("max",l)]=d.ideal,c.optional.push(h)):(h[u("",l)]=d.ideal,c.optional.push(h))}d.exact!==void 0&&typeof d.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[u("",l)]=d.exact):["min","max"].forEach(h=>{d[h]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[u(h,l)]=d[h])})}),a.advanced&&(c.optional=(c.optional||[]).concat(a.advanced)),c},r=function(a,c){if(e.version>=61)return c(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const l=function(d,u,h){u in d&&!(h in d)&&(d[h]=d[u],delete d[u])};a=JSON.parse(JSON.stringify(a)),l(a.audio,"autoGainControl","googAutoGainControl"),l(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=i(a.audio)}if(a&&typeof a.video=="object"){let l=a.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});const d=e.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!d)){delete a.video.facingMode;let u;if(l.exact==="environment"||l.ideal==="environment"?u=["back","rear"]:(l.exact==="user"||l.ideal==="user")&&(u=["front"]),u)return n.mediaDevices.enumerateDevices().then(h=>{h=h.filter(g=>g.kind==="videoinput");let f=h.find(g=>u.some(p=>g.label.toLowerCase().includes(p)));return!f&&h.length&&u.includes("back")&&(f=h[h.length-1]),f&&(a.video.deviceId=l.exact?{exact:f.deviceId}:{ideal:f.deviceId}),a.video=i(a.video),Kd("chrome: "+JSON.stringify(a)),c(a)})}a.video=i(a.video)}return Kd("chrome: "+JSON.stringify(a)),c(a)},o=function(a){return e.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},s=function(a,c,l){r(a,d=>{n.webkitGetUserMedia(d,c,u=>{l&&l(o(u))})})};if(n.getUserMedia=s.bind(n),n.mediaDevices.getUserMedia){const a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return r(c,l=>a(l).then(d=>{if(l.audio&&!d.getAudioTracks().length||l.video&&!d.getVideoTracks().length)throw d.getTracks().forEach(u=>{u.stop()}),new DOMException("","NotFoundError");return d},d=>Promise.reject(o(d))))}}}function Yd(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function Xd(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",r=>{let o;t.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(a=>a.track&&a.track.id===r.track.id):o={track:r.track};const s=new Event("track");s.track=r.track,s.receiver=o,s.transceiver={receiver:o},s.streams=[i.stream],this.dispatchEvent(s)}),i.stream.getTracks().forEach(r=>{let o;t.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(a=>a.track&&a.track.id===r.id):o={track:r};const s=new Event("track");s.track=r,s.receiver=o,s.transceiver={receiver:o},s.streams=[i.stream],this.dispatchEvent(s)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Ln(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function Qd(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(r,o){return{track:o,get dtmf(){return this._dtmf===void 0&&(o.kind==="audio"?this._dtmf=r.createDTMFSender(o):this._dtmf=null),this._dtmf},_pc:r}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,c){let l=r.apply(this,arguments);return l||(l=e(this,a),this._senders.push(l)),l};const o=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){o.apply(this,arguments);const c=this._senders.indexOf(a);c!==-1&&this._senders.splice(c,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._senders=this._senders||[],n.apply(this,[o]),o.getTracks().forEach(s=>{this._senders.push(e(this,s))})};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){this._senders=this._senders||[],i.apply(this,[o]),o.getTracks().forEach(s=>{const a=this._senders.find(c=>c.track===s);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Zd(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const o=n.apply(this,[]);return o.forEach(s=>s._pc=this),o});const i=t.RTCPeerConnection.prototype.addTrack;i&&(t.RTCPeerConnection.prototype.addTrack=function(){const o=i.apply(this,arguments);return o._pc=this,o}),t.RTCRtpSender.prototype.getStats=function(){const o=this;return this._pc.getStats().then(s=>Gd(s,o.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=n.apply(this,[]);return r.forEach(o=>o._pc=this),r}),Ln(t,"track",i=>(i.receiver._pc=i.srcElement,i)),t.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(o=>Gd(o,r.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const i=arguments[0];let r,o,s;return this.getSenders().forEach(a=>{a.track===i&&(r?s=!0:r=a)}),this.getReceivers().forEach(a=>(a.track===i&&(o?s=!0:o=a),a.track===i)),s||r&&o?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():o?o.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function eu(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(s=>this._shimmedLocalStreams[s][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(s,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(c)===-1&&this._shimmedLocalStreams[a.id].push(c):this._shimmedLocalStreams[a.id]=[a,c],c};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(s){this._shimmedLocalStreams=this._shimmedLocalStreams||{},s.getTracks().forEach(l=>{if(this.getSenders().find(u=>u.track===l))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();n.apply(this,arguments);const c=this.getSenders().filter(l=>a.indexOf(l)===-1);this._shimmedLocalStreams[s.id]=[s].concat(c)};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[s.id],i.apply(this,arguments)};const r=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},s&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const c=this._shimmedLocalStreams[a].indexOf(s);c!==-1&&this._shimmedLocalStreams[a].splice(c,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),r.apply(this,arguments)}}function tu(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return eu(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const d=n.apply(this);return this._reverseStreams=this._reverseStreams||{},d.map(u=>this._reverseStreams[u.id])};const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(d){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},d.getTracks().forEach(u=>{if(this.getSenders().find(f=>f.track===u))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[d.id]){const u=new t.MediaStream(d.getTracks());this._streams[d.id]=u,this._reverseStreams[u.id]=d,d=u}i.apply(this,[d])};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(d){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[d.id]||d]),delete this._reverseStreams[this._streams[d.id]?this._streams[d.id].id:d.id],delete this._streams[d.id]},t.RTCPeerConnection.prototype.addTrack=function(d,u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const h=[].slice.call(arguments,1);if(h.length!==1||!h[0].getTracks().find(p=>p===d))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(p=>p.track===d))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const g=this._streams[u.id];if(g)g.addTrack(d),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const p=new t.MediaStream([d]);this._streams[u.id]=p,this._reverseStreams[p.id]=u,this.addStream(p)}return this.getSenders().find(p=>p.track===d)};function o(l,d){let u=d.sdp;return Object.keys(l._reverseStreams||[]).forEach(h=>{const f=l._reverseStreams[h],g=l._streams[f.id];u=u.replace(new RegExp(g.id,"g"),f.id)}),new RTCSessionDescription({type:d.type,sdp:u})}function s(l,d){let u=d.sdp;return Object.keys(l._reverseStreams||[]).forEach(h=>{const f=l._reverseStreams[h],g=l._streams[f.id];u=u.replace(new RegExp(f.id,"g"),g.id)}),new RTCSessionDescription({type:d.type,sdp:u})}["createOffer","createAnswer"].forEach(function(l){const d=t.RTCPeerConnection.prototype[l],u={[l](){const h=arguments;return arguments.length&&typeof arguments[0]=="function"?d.apply(this,[g=>{const p=o(this,g);h[0].apply(null,[p])},g=>{h[1]&&h[1].apply(null,g)},arguments[2]]):d.apply(this,arguments).then(g=>o(this,g))}};t.RTCPeerConnection.prototype[l]=u[l]});const a=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=s(this,arguments[0]),a.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const l=c.get.apply(this);return l.type===""?l:o(this,l)}}),t.RTCPeerConnection.prototype.removeTrack=function(d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!d._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(d._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let h;Object.keys(this._streams).forEach(f=>{this._streams[f].getTracks().find(p=>d.track===p)&&(h=this._streams[f])}),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(d.track),this.dispatchEvent(new Event("negotiationneeded")))}}function xs(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=t.RTCPeerConnection.prototype[n],r={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=r[n]})}function nu(t,e){Ln(t,"negotiationneeded",n=>{const i=n.target;if(!((e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")&&i.signalingState!=="stable"))return n})}var iu=Object.freeze({__proto__:null,fixNegotiationNeeded:nu,shimAddTrackRemoveTrack:tu,shimAddTrackRemoveTrackWithNative:eu,shimGetSendersWithDtmf:Qd,shimGetUserMedia:Jd,shimMediaStream:Yd,shimOnTrack:Xd,shimPeerConnection:xs,shimSenderReceiverGetStats:Zd});function ru(t,e){const n=t&&t.navigator,i=t&&t.MediaStreamTrack;if(n.getUserMedia=function(r,o,s){Ss("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(r).then(o,s)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const r=function(s,a,c){a in s&&!(c in s)&&(s[c]=s[a],delete s[a])},o=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(s){return typeof s=="object"&&typeof s.audio=="object"&&(s=JSON.parse(JSON.stringify(s)),r(s.audio,"autoGainControl","mozAutoGainControl"),r(s.audio,"noiseSuppression","mozNoiseSuppression")),o(s)},i&&i.prototype.getSettings){const s=i.prototype.getSettings;i.prototype.getSettings=function(){const a=s.apply(this,arguments);return r(a,"mozAutoGainControl","autoGainControl"),r(a,"mozNoiseSuppression","noiseSuppression"),a}}if(i&&i.prototype.applyConstraints){const s=i.prototype.applyConstraints;i.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),r(a,"autoGainControl","mozAutoGainControl"),r(a,"noiseSuppression","mozNoiseSuppression")),s.apply(this,[a])}}}}function Vv(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return i.video===!0?i.video={mediaSource:e}:i.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(i)})}function ou(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Es(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const o=t.RTCPeerConnection.prototype[r],s={[r](){return arguments[0]=new(r==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};t.RTCPeerConnection.prototype[r]=s[r]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[o,s,a]=arguments;return i.apply(this,[o||null]).then(c=>{if(e.version<53&&!s)try{c.forEach(l=>{l.type=n[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;c.forEach((d,u)=>{c.set(u,Object.assign({},d,{type:n[d.type]||d.type}))})}return c}).then(s,a)}}function su(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(o=>o._pc=this),r});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const r=n.apply(this,arguments);return r._pc=this,r}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function au(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i}),Ln(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function cu(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){Ss("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&n.getTracks().includes(i.track)&&this.removeTrack(i)})})}function lu(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function du(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const r=i.length>0;r&&i.forEach(s=>{if("rid"in s&&!/^[a-z0-9]{0,16}$/i.test(s.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in s&&!(parseFloat(s.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in s&&!(parseFloat(s.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const o=e.apply(this,arguments);if(r){const{sender:s}=o,a=s.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=i,s.sendEncodings=i,this.setParametersPromises.push(s.setParameters(a).then(()=>{delete s.sendEncodings}).catch(()=>{delete s.sendEncodings})))}return o})}function uu(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const i=e.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function hu(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function fu(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var pu=Object.freeze({__proto__:null,shimAddTransceiver:du,shimCreateAnswer:fu,shimCreateOffer:hu,shimGetDisplayMedia:Vv,shimGetParameters:uu,shimGetUserMedia:ru,shimOnTrack:ou,shimPeerConnection:Es,shimRTCDataChannel:lu,shimReceiverGetStats:au,shimRemoveStream:cu,shimSenderGetStats:su});function mu(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(r=>e.call(this,r,i)),i.getVideoTracks().forEach(r=>e.call(this,r,i))},t.RTCPeerConnection.prototype.addTrack=function(i){for(var r=arguments.length,o=new Array(r>1?r-1:0),s=1;s<r;s++)o[s-1]=arguments[s];return o&&o.forEach(a=>{this._localStreams?this._localStreams.includes(a)||this._localStreams.push(a):this._localStreams=[a]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(n);if(i===-1)return;this._localStreams.splice(i,1);const r=n.getTracks();this.getSenders().forEach(o=>{r.includes(o.track)&&this.removeTrack(o)})})}}function gu(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(r=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(r))return;this._remoteStreams.push(r);const o=new Event("addstream");o.stream=r,this.dispatchEvent(o)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(o=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(o)>=0)return;i._remoteStreams.push(o);const s=new Event("addstream");s.stream=o,i.dispatchEvent(s)})}),e.apply(i,arguments)}}}function vu(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,i=e.createAnswer,r=e.setLocalDescription,o=e.setRemoteDescription,s=e.addIceCandidate;e.createOffer=function(l,d){const u=arguments.length>=2?arguments[2]:arguments[0],h=n.apply(this,[u]);return d?(h.then(l,d),Promise.resolve()):h},e.createAnswer=function(l,d){const u=arguments.length>=2?arguments[2]:arguments[0],h=i.apply(this,[u]);return d?(h.then(l,d),Promise.resolve()):h};let a=function(c,l,d){const u=r.apply(this,[c]);return d?(u.then(l,d),Promise.resolve()):u};e.setLocalDescription=a,a=function(c,l,d){const u=o.apply(this,[c]);return d?(u.then(l,d),Promise.resolve()):u},e.setRemoteDescription=a,a=function(c,l,d){const u=s.apply(this,[c]);return d?(u.then(l,d),Promise.resolve()):u},e.addIceCandidate=a}function bu(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,i=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=r=>i(yu(r))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(i,r,o){e.mediaDevices.getUserMedia(i).then(r,o)}).bind(e))}function yu(t){return t&&t.video!==void 0?Object.assign({},t,{video:Hd(t.video)}):t}function ku(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(i,r){if(i&&i.iceServers){const o=[];for(let s=0;s<i.iceServers.length;s++){let a=i.iceServers[s];a.urls===void 0&&a.url?(Ss("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,o.push(a)):o.push(i.iceServers[s])}i.iceServers=o}return new e(i,r)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function wu(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Cu(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const r=this.getTransceivers().find(s=>s.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveAudio===!0&&!r&&this.addTransceiver("audio",{direction:"recvonly"}),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const o=this.getTransceivers().find(s=>s.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):i.offerToReceiveVideo===!0&&!o&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function _u(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var Su=Object.freeze({__proto__:null,shimAudioContext:_u,shimCallbacksAPI:vu,shimConstraints:yu,shimCreateOfferLegacy:Cu,shimGetUserMedia:bu,shimLocalStreamsAPI:mu,shimRTCIceServerUrls:ku,shimRemoteStreamsAPI:gu,shimTrackEventTransceiver:wu}),Ps={exports:{}},Tu;function qv(){return Tu||(Tu=1,(function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},e.splitSections=function(n){return n.split(`
m=`).map((r,o)=>(o>0?"m="+r:r).trim()+`\r
`)},e.getDescription=function(n){const i=e.splitSections(n);return i&&i[0]},e.getMediaSections=function(n){const i=e.splitSections(n);return i.shift(),i},e.matchPrefix=function(n,i){return e.splitLines(n).filter(r=>r.indexOf(i)===0)},e.parseCandidate=function(n){let i;n.indexOf("a=candidate:")===0?i=n.substring(12).split(" "):i=n.substring(10).split(" ");const r={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let o=8;o<i.length;o+=2)switch(i[o]){case"raddr":r.relatedAddress=i[o+1];break;case"rport":r.relatedPort=parseInt(i[o+1],10);break;case"tcptype":r.tcpType=i[o+1];break;case"ufrag":r.ufrag=i[o+1],r.usernameFragment=i[o+1];break;default:r[i[o]]===void 0&&(r[i[o]]=i[o+1]);break}return r},e.writeCandidate=function(n){const i=[];i.push(n.foundation);const r=n.component;r==="rtp"?i.push(1):r==="rtcp"?i.push(2):i.push(r),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const o=n.type;return i.push("typ"),i.push(o),o!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let i=n.substring(9).split(" ");const r={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),r.name=i[0],r.clockRate=parseInt(i[1],10),r.channels=i.length===3?parseInt(i[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const r=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(r!==1?"/"+r:"")+`\r
`},e.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const i={};let r;const o=n.substring(n.indexOf(" ")+1).split(";");for(let s=0;s<o.length;s++)r=o[s].trim().split("="),i[r[0].trim()]=r[1];return i},e.writeFmtp=function(n){let i="",r=n.payloadType;if(n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const o=[];Object.keys(n.parameters).forEach(s=>{n.parameters[s]!==void 0?o.push(s+"="+n.parameters[s]):o.push(s)}),i+="a=fmtp:"+r+" "+o.join(";")+`\r
`}return i},e.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(n){let i="",r=n.payloadType;return n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(o=>{i+="a=rtcp-fb:"+r+" "+o.type+(o.parameter&&o.parameter.length?" "+o.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(n){const i=n.indexOf(" "),r={ssrc:parseInt(n.substring(7,i),10)},o=n.indexOf(":",i);return o>-1?(r.attribute=n.substring(i+1,o),r.value=n.substring(o+1)):r.attribute=n.substring(i+1),r},e.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(r=>parseInt(r,10))}},e.getMid=function(n){const i=e.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},e.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},e.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:e.matchPrefix(n+i,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,i){let r="a=setup:"+i+`\r
`;return n.fingerprints.forEach(o=>{r+="a=fingerprint:"+o.algorithm+" "+o.value+`\r
`}),r},e.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,i){return e.matchPrefix(n+i,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,i){const r=e.matchPrefix(n+i,"a=ice-ufrag:")[0],o=e.matchPrefix(n+i,"a=ice-pwd:")[0];return r&&o?{usernameFragment:r.substring(12),password:o.substring(10)}:null},e.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},e.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},o=e.splitLines(n)[0].split(" ");i.profile=o[2];for(let a=3;a<o.length;a++){const c=o[a],l=e.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(l){const d=e.parseRtpMap(l),u=e.matchPrefix(n,"a=fmtp:"+c+" ");switch(d.parameters=u.length?e.parseFmtp(u[0]):{},d.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),i.codecs.push(d),d.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(d.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(a=>{i.headerExtensions.push(e.parseExtmap(a))});const s=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return i.codecs.forEach(a=>{s.forEach(c=>{a.rtcpFeedback.find(d=>d.type===c.type&&d.parameter===c.parameter)||a.rtcpFeedback.push(c)})}),i},e.writeRtpDescription=function(n,i){let r="";r+="m="+n+" ",r+=i.codecs.length>0?"9":"0",r+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=i.codecs.map(s=>s.preferredPayloadType!==void 0?s.preferredPayloadType:s.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(s=>{r+=e.writeRtpMap(s),r+=e.writeFmtp(s),r+=e.writeRtcpFb(s)});let o=0;return i.codecs.forEach(s=>{s.maxptime>o&&(o=s.maxptime)}),o>0&&(r+="a=maxptime:"+o+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(s=>{r+=e.writeExtmap(s)}),r},e.parseRtpEncodingParameters=function(n){const i=[],r=e.parseRtpParameters(n),o=r.fecMechanisms.indexOf("RED")!==-1,s=r.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(n,"a=ssrc:").map(h=>e.parseSsrcMedia(h)).filter(h=>h.attribute==="cname"),c=a.length>0&&a[0].ssrc;let l;const d=e.matchPrefix(n,"a=ssrc-group:FID").map(h=>h.substring(17).split(" ").map(g=>parseInt(g,10)));d.length>0&&d[0].length>1&&d[0][0]===c&&(l=d[0][1]),r.codecs.forEach(h=>{if(h.name.toUpperCase()==="RTX"&&h.parameters.apt){let f={ssrc:c,codecPayloadType:parseInt(h.parameters.apt,10)};c&&l&&(f.rtx={ssrc:l}),i.push(f),o&&(f=JSON.parse(JSON.stringify(f)),f.fec={ssrc:c,mechanism:s?"red+ulpfec":"red"},i.push(f))}}),i.length===0&&c&&i.push({ssrc:c});let u=e.matchPrefix(n,"b=");return u.length&&(u[0].indexOf("b=TIAS:")===0?u=parseInt(u[0].substring(7),10):u[0].indexOf("b=AS:")===0?u=parseInt(u[0].substring(5),10)*1e3*.95-2e3*8:u=void 0,i.forEach(h=>{h.maxBitrate=u})),i},e.parseRtcpParameters=function(n){const i={},r=e.matchPrefix(n,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];r&&(i.cname=r.value,i.ssrc=r.ssrc);const o=e.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=o.length>0,i.compound=o.length===0;const s=e.matchPrefix(n,"a=rtcp-mux");return i.mux=s.length>0,i},e.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},e.parseMsid=function(n){let i;const r=e.matchPrefix(n,"a=msid:");if(r.length===1)return i=r[0].substring(7).split(" "),{stream:i[0],track:i[1]};const o=e.matchPrefix(n,"a=ssrc:").map(s=>e.parseSsrcMedia(s)).filter(s=>s.attribute==="msid");if(o.length>0)return i=o[0].value.split(" "),{stream:i[0],track:i[1]}},e.parseSctpDescription=function(n){const i=e.parseMLine(n),r=e.matchPrefix(n,"a=max-message-size:");let o;r.length>0&&(o=parseInt(r[0].substring(19),10)),isNaN(o)&&(o=65536);const s=e.matchPrefix(n,"a=sctp-port:");if(s.length>0)return{port:parseInt(s[0].substring(12),10),protocol:i.fmt,maxMessageSize:o};const a=e.matchPrefix(n,"a=sctpmap:");if(a.length>0){const c=a[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:o}}},e.writeSctpDescription=function(n,i){let r=[];return n.protocol!=="DTLS/SCTP"?r=["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:r=["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&r.push("a=max-message-size:"+i.maxMessageSize+`\r
`),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,i,r){let o;const s=i!==void 0?i:2;return n?o=n:o=e.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+o+" "+s+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,i){const r=e.splitLines(n);for(let o=0;o<r.length;o++)switch(r[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[o].substring(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const r=e.splitLines(n)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},e.parseOLine=function(n){const r=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=e.splitLines(n);for(let r=0;r<i.length;r++)if(i[r].length<2||i[r].charAt(1)!=="=")return!1;return!0},t.exports=e})(Ps)),Ps.exports}var xu=qv(),ii=Iv(xu),zv=ng({__proto__:null,default:ii},[xu]);function Lr(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substring(2)),i.candidate&&i.candidate.length){const r=new e(i),o=ii.parseCandidate(i.candidate);for(const s in o)s in r||Object.defineProperty(r,s,{value:o[s]});return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new e(i)},t.RTCIceCandidate.prototype=e.prototype,Ln(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function Rs(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||Ln(t,"icecandidate",e=>{if(e.candidate){const n=ii.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function Ur(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(a){if(!a||!a.sdp)return!1;const c=ii.splitSections(a.sdp);return c.shift(),c.some(l=>{const d=ii.parseMLine(l);return d&&d.kind==="application"&&d.protocol.indexOf("SCTP")!==-1})},i=function(a){const c=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const l=parseInt(c[1],10);return l!==l?-1:l},r=function(a){let c=65536;return e.browser==="firefox"&&(e.version<57?a===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},o=function(a,c){let l=65536;e.browser==="firefox"&&e.version===57&&(l=65535);const d=ii.matchPrefix(a.sdp,"a=max-message-size:");return d.length>0?l=parseInt(d[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(l=2147483637),l},s=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const c=i(arguments[0]),l=r(c),d=o(arguments[0],c);let u;l===0&&d===0?u=Number.POSITIVE_INFINITY:l===0||d===0?u=Math.max(l,d):u=Math.min(l,d);const h={};Object.defineProperty(h,"maxMessageSize",{get(){return u}}),this._sctp=h}return s.apply(this,arguments)}}function Fr(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(i,r){const o=i.send;i.send=function(){const a=arguments[0],c=a.length||a.size||a.byteLength;if(i.readyState==="open"&&r.sctp&&c>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return o.apply(i,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const r=n.apply(this,arguments);return e(r,this),r},Ln(t,"datachannel",i=>(e(i.channel,i.target),i))}function Is(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const o=r.target;if(o._lastConnectionState!==o.connectionState){o._lastConnectionState=o.connectionState;const s=new Event("connectionstatechange",r);o.dispatchEvent(s)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function Os(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const o=r.sdp.split(`
`).filter(s=>s.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&r instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:r.type,sdp:o}):r.sdp=o}return n.apply(this,arguments)}}function Br(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function jr(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return n.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer";break}return r.sdp||r.type!=="offer"&&r.type!=="answer"?n.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(s=>n.apply(this,[s]))})}var $v=Object.freeze({__proto__:null,removeExtmapAllowMixed:Os,shimAddIceCandidateNullOrEmpty:Br,shimConnectionState:Is,shimMaxMessageSize:Ur,shimParameterlessSetLocalDescription:jr,shimRTCIceCandidate:Lr,shimRTCIceCandidateRelayProtocol:Rs,shimSendThrowTypeError:Fr});function Wv(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=$d,i=jv(t),r={browserDetails:i,commonShim:$v,extractVersion:qi,disableLog:Fv,disableWarnings:Bv,sdp:zv};switch(i.browser){case"chrome":if(!iu||!xs||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=iu,Br(t,i),jr(t),Jd(t,i),Yd(t),xs(t,i),Xd(t),tu(t,i),Qd(t),Zd(t),nu(t,i),Lr(t),Rs(t),Is(t),Ur(t,i),Fr(t),Os(t,i);break;case"firefox":if(!pu||!Es||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=pu,Br(t,i),jr(t),ru(t,i),Es(t,i),ou(t),cu(t),su(t),au(t),lu(t),du(t),uu(t),hu(t),fu(t),Lr(t),Is(t),Ur(t,i),Fr(t);break;case"safari":if(!Su||!e.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=Su,Br(t,i),jr(t),ku(t),Cu(t),vu(t),mu(t),gu(t),wu(t),bu(t),_u(t),Lr(t),Rs(t),Ur(t,i),Fr(t),Os(t,i);break;default:n("Unsupported browser!");break}return r}Wv({window:typeof window>"u"?void 0:window});const Hv=10,zi="lk_e2ee",Gv={sharedKey:!1,ratchetSalt:"LKFrameEncryptionKey",ratchetWindowSize:8,failureTolerance:Hv,keyringSize:16};var mn;(function(t){t.SetKey="setKey",t.RatchetRequest="ratchetRequest",t.KeyRatcheted="keyRatcheted"})(mn||(mn={}));var Eu;(function(t){t.KeyRatcheted="keyRatcheted"})(Eu||(Eu={}));var gn;(function(t){t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError"})(gn||(gn={}));var Pu;(function(t){t.Error="cryptorError"})(Pu||(Pu={}));function Kv(){return Jv()||Ds()}function Ds(){return typeof window.RTCRtpScriptTransform<"u"}function Jv(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}class YS extends It.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(n,i,r)=>{ie.debug("key ratcheted event received",{ratchetResult:n,participantId:i,keyIndex:r})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},Gv),e),this.on(mn.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,n,i){const r={key:e,participantIdentity:n,keyIndex:i};if(!this.options.sharedKey&&!n)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(n??"shared","-").concat(i??0),r),this.emit(mn.SetKey,r)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,n){this.emit(mn.RatchetRequest,e,n)}}class Xt extends Error{constructor(e,n){super(n||"an error has occured"),this.name="LiveKitError",this.code=e}}var oe;(function(t){t[t.NotAllowed=0]="NotAllowed",t[t.ServerUnreachable=1]="ServerUnreachable",t[t.InternalError=2]="InternalError",t[t.Cancelled=3]="Cancelled",t[t.LeaveRequest=4]="LeaveRequest",t[t.Timeout=5]="Timeout"})(oe||(oe={}));class me extends Xt{constructor(e,n,i,r){super(1,e),this.name="ConnectionError",this.status=i,this.reason=n,this.context=r,this.reasonName=oe[n]}}class As extends Xt{constructor(e){super(21,e??"device is unsupported"),this.name="DeviceUnsupportedError"}}class Qt extends Xt{constructor(e){super(20,e??"track is invalid"),this.name="TrackInvalidError"}}class Yv extends Xt{constructor(e){super(10,e??"unsupported server"),this.name="UnsupportedServer"}}class Ue extends Xt{constructor(e){super(12,e??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class Ms extends Xt{constructor(e){super(13,e??"unable to negotiate"),this.name="NegotiationError"}}class Ru extends Xt{constructor(e,n){super(15,e),this.name="PublishTrackError",this.status=n}}class Iu extends Xt{constructor(e,n){super(15,e),this.reason=n,this.reasonName=typeof n=="string"?n:Cs[n]}}var bt;(function(t){t[t.AlreadyOpened=0]="AlreadyOpened",t[t.AbnormalEnd=1]="AbnormalEnd",t[t.DecodeFailed=2]="DecodeFailed",t[t.LengthExceeded=3]="LengthExceeded",t[t.Incomplete=4]="Incomplete",t[t.HandlerAlreadyRegistered=7]="HandlerAlreadyRegistered"})(bt||(bt={}));class vn extends Xt{constructor(e,n){super(16,e),this.name="DataStreamError",this.reason=n,this.reasonName=bt[n]}}var Vr;(function(t){t.PermissionDenied="PermissionDenied",t.NotFound="NotFound",t.DeviceInUse="DeviceInUse",t.Other="Other"})(Vr||(Vr={})),(function(t){function e(n){if(n&&"name"in n)return n.name==="NotFoundError"||n.name==="DevicesNotFoundError"?t.NotFound:n.name==="NotAllowedError"||n.name==="PermissionDeniedError"?t.PermissionDenied:n.name==="NotReadableError"||n.name==="TrackStartError"?t.DeviceInUse:t.Other}t.getFailure=e})(Vr||(Vr={}));var Ou;(function(t){t[t.InvalidKey=0]="InvalidKey",t[t.MissingKey=1]="MissingKey",t[t.InternalError=2]="InternalError"})(Ou||(Ou={}));var O;(function(t){t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting",t.Reconnected="reconnected",t.Disconnected="disconnected",t.ConnectionStateChanged="connectionStateChanged",t.Moved="moved",t.MediaDevicesChanged="mediaDevicesChanged",t.ParticipantConnected="participantConnected",t.ParticipantDisconnected="participantDisconnected",t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalAudioSilenceDetected="localAudioSilenceDetected",t.ActiveSpeakersChanged="activeSpeakersChanged",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.ParticipantAttributesChanged="participantAttributesChanged",t.ParticipantActive="participantActive",t.RoomMetadataChanged="roomMetadataChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.AudioPlaybackStatusChanged="audioPlaybackChanged",t.VideoPlaybackStatusChanged="videoPlaybackChanged",t.MediaDevicesError="mediaDevicesError",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.SignalConnected="signalConnected",t.RecordingStatusChanged="recordingStatusChanged",t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ActiveDeviceChanged="activeDeviceChanged",t.ChatMessage="chatMessage",t.LocalTrackSubscribed="localTrackSubscribed",t.MetricsReceived="metricsReceived"})(O||(O={}));var U;(function(t){t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackCpuConstrained="localTrackCpuConstrained",t.LocalSenderCreated="localSenderCreated",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.IsSpeakingChanged="isSpeakingChanged",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.TrackCpuConstrained="trackCpuConstrained",t.MediaDevicesError="mediaDevicesError",t.AudioStreamAcquired="audioStreamAcquired",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.PCTrackAdded="pcTrackAdded",t.AttributesChanged="attributesChanged",t.LocalTrackSubscribed="localTrackSubscribed",t.ChatMessage="chatMessage",t.Active="active"})(U||(U={}));var L;(function(t){t.TransportsCreated="transportsCreated",t.Connected="connected",t.Disconnected="disconnected",t.Resuming="resuming",t.Resumed="resumed",t.Restarting="restarting",t.Restarted="restarted",t.SignalResumed="signalResumed",t.SignalRestarted="signalRestarted",t.Closing="closing",t.MediaTrackAdded="mediaTrackAdded",t.ActiveSpeakersUpdate="activeSpeakersUpdate",t.DataPacketReceived="dataPacketReceived",t.RTPVideoMapUpdate="rtpVideoMapUpdate",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ParticipantUpdate="participantUpdate",t.RoomUpdate="roomUpdate",t.SpeakersChanged="speakersChanged",t.StreamStateChanged="streamStateChanged",t.ConnectionQualityUpdate="connectionQualityUpdate",t.SubscriptionError="subscriptionError",t.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",t.RemoteMute="remoteMute",t.SubscribedQualityUpdate="subscribedQualityUpdate",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackSubscribed="localTrackSubscribed",t.Offline="offline",t.SignalRequestResponse="signalRequestResponse",t.SignalConnected="signalConnected",t.RoomMoved="roomMoved"})(L||(L={}));var N;(function(t){t.Message="message",t.Muted="muted",t.Unmuted="unmuted",t.Restarted="restarted",t.Ended="ended",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",t.CpuConstrained="cpuConstrained",t.UpdateSettings="updateSettings",t.UpdateSubscription="updateSubscription",t.AudioPlaybackStarted="audioPlaybackStarted",t.AudioPlaybackFailed="audioPlaybackFailed",t.AudioSilenceDetected="audioSilenceDetected",t.VisibilityChanged="visibilityChanged",t.VideoDimensionsChanged="videoDimensionsChanged",t.VideoPlaybackStarted="videoPlaybackStarted",t.VideoPlaybackFailed="videoPlaybackFailed",t.ElementAttached="elementAttached",t.ElementDetached="elementDetached",t.UpstreamPaused="upstreamPaused",t.UpstreamResumed="upstreamResumed",t.SubscriptionPermissionChanged="subscriptionPermissionChanged",t.SubscriptionStatusChanged="subscriptionStatusChanged",t.SubscriptionFailed="subscriptionFailed",t.TrackProcessorUpdate="trackProcessorUpdate",t.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",t.TranscriptionReceived="transcriptionReceived",t.TimeSyncUpdate="timeSyncUpdate",t.PreConnectBufferFlushed="preConnectBufferFlushed"})(N||(N={}));function Xv(t){return typeof t>"u"?t:typeof structuredClone=="function"?typeof t=="object"&&t!==null?structuredClone(Object.assign({},t)):structuredClone(t):JSON.parse(JSON.stringify(t))}const Qv=/version\/(\d+(\.?_?\d+)+)/i;let Ns;function st(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const n=navigator.userAgent.toLowerCase();if(Ns===void 0||e){const i=Zv.find(r=>{let{test:o}=r;return o.test(n)});Ns=i==null?void 0:i.describe(n)}return Ns}const Zv=[{test:/firefox|iceweasel|fxios/i,describe(t){return{name:"Firefox",version:qr(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:Ls(t)}}},{test:/chrom|crios|crmo/i,describe(t){return{name:"Chrome",version:qr(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("crios")?"iOS":void 0,osVersion:Ls(t)}}},{test:/safari|applewebkit/i,describe(t){return{name:"Safari",version:qr(Qv,t),os:t.includes("mobile/")?"iOS":"macOS",osVersion:Ls(t)}}}];function qr(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=e.match(t);return i&&i.length>=n&&i[n]||""}function Ls(t){return t.includes("mac os")?qr(/\(.+?(\d+_\d+(:?_\d+)?)/,t,1).replace(/_/g,"."):void 0}var eb="2.15.5";const tb=eb,nb=16;class ze{}ze.setTimeout=function(){return setTimeout(...arguments)},ze.setInterval=function(){return setInterval(...arguments)},ze.clearTimeout=function(){return clearTimeout(...arguments)},ze.clearInterval=function(){return clearInterval(...arguments)};const ib=5e3,$i=[];var at;(function(t){t[t.LOW=0]="LOW",t[t.MEDIUM=1]="MEDIUM",t[t.HIGH=2]="HIGH"})(at||(at={}));class R extends It.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var r;super(),this.attachedElements=[],this.isMuted=!1,this.streamState=R.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=ie,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),ib):this.handleAppVisibilityChanged()},this.log=Jt((r=i.loggerName)!==null&&r!==void 0?r:vt.Track),this.loggerContextCb=i.loggerContextCb,this.setMaxListeners(100),this.kind=n,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=R.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),te(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let n="audio";this.kind===R.Kind.Video&&(n="video"),this.attachedElements.length===0&&this.kind===R.Kind.Video&&this.addAppVisibilityListener(),e||(n==="audio"&&($i.forEach(o=>{o.parentElement===null&&!e&&(e=o)}),e&&$i.splice($i.indexOf(e),1)),e||(e=document.createElement(n))),this.attachedElements.includes(e)||this.attachedElements.push(e),ri(this.mediaStreamTrack,e);const i=e.srcObject.getTracks(),r=i.some(o=>o.kind==="audio");return e.play().then(()=>{this.emit(r?N.AudioPlaybackStarted:N.VideoPlaybackStarted)}).catch(o=>{o.name==="NotAllowedError"?this.emit(r?N.AudioPlaybackFailed:N.VideoPlaybackFailed,o):o.name==="AbortError"?ie.debug("".concat(r?"audio":"video"," playback aborted, likely due to new play request")):ie.warn("could not playback ".concat(r?"audio":"video"),o),r&&e&&i.some(s=>s.kind==="video")&&o.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(N.ElementAttached,e),e}detach(e){try{if(e){oi(this.mediaStreamTrack,e);const i=this.attachedElements.indexOf(e);return i>=0&&(this.attachedElements.splice(i,1),this.recycleElement(e),this.emit(N.ElementDetached,e)),e}const n=[];return this.attachedElements.forEach(i=>{oi(this.mediaStreamTrack,i),n.push(i),this.recycleElement(i),this.emit(N.ElementDetached,i)}),this.attachedElements=[],n}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=Jt(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let n=!0;e.pause(),$i.forEach(i=>{i.parentElement||(n=!1)}),n&&$i.push(e)}}handleAppVisibilityChanged(){return w(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===R.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){Qe()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){Qe()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function ri(t,e){let n;e.srcObject instanceof MediaStream?n=e.srcObject:n=new MediaStream;let i;t.kind==="audio"?i=n.getAudioTracks():i=n.getVideoTracks(),i.includes(t)||(i.forEach(r=>{n.removeTrack(r)}),n.addTrack(t)),(!Un()||!(e instanceof HTMLVideoElement))&&(e.autoplay=!0),e.muted=n.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==n&&(e.srcObject=n,(Un()||si())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=n,e.play().catch(()=>{})},0))}function oi(t,e){if(e.srcObject instanceof MediaStream){const n=e.srcObject;n.removeTrack(t),n.getTracks().length>0?e.srcObject=n:e.srcObject=null}}(function(t){let e;(function(l){l.Audio="audio",l.Video="video",l.Unknown="unknown"})(e=t.Kind||(t.Kind={}));let n;(function(l){l.Camera="camera",l.Microphone="microphone",l.ScreenShare="screen_share",l.ScreenShareAudio="screen_share_audio",l.Unknown="unknown"})(n=t.Source||(t.Source={}));let i;(function(l){l.Active="active",l.Paused="paused",l.Unknown="unknown"})(i=t.StreamState||(t.StreamState={}));function r(l){switch(l){case e.Audio:return pt.AUDIO;case e.Video:return pt.VIDEO;default:return pt.DATA}}t.kindToProto=r;function o(l){switch(l){case pt.AUDIO:return e.Audio;case pt.VIDEO:return e.Video;default:return e.Unknown}}t.kindFromProto=o;function s(l){switch(l){case n.Camera:return De.CAMERA;case n.Microphone:return De.MICROPHONE;case n.ScreenShare:return De.SCREEN_SHARE;case n.ScreenShareAudio:return De.SCREEN_SHARE_AUDIO;default:return De.UNKNOWN}}t.sourceToProto=s;function a(l){switch(l){case De.CAMERA:return n.Camera;case De.MICROPHONE:return n.Microphone;case De.SCREEN_SHARE:return n.ScreenShare;case De.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}}t.sourceFromProto=a;function c(l){switch(l){case ms.ACTIVE:return i.Active;case ms.PAUSED:return i.Paused;default:return i.Unknown}}t.streamStateFromProto=c})(R||(R={}));class ue{constructor(e,n,i,r,o){if(typeof e=="object")this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else if(n!==void 0&&i!==void 0)this.width=e,this.height=n,this.aspectRatio=e/n,this.encoding={maxBitrate:i,maxFramerate:r,priority:o};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const rb=["vp8","h264"],ob=["vp8","h264","vp9","av1","h265"];function sb(t){return!!rb.find(e=>e===t)}var Du;(function(t){t[t.PREFER_REGRESSION=0]="PREFER_REGRESSION",t[t.SIMULCAST=1]="SIMULCAST",t[t.REGRESSION=2]="REGRESSION"})(Du||(Du={}));var Us;(function(t){t.telephone={maxBitrate:12e3},t.speech={maxBitrate:24e3},t.music={maxBitrate:48e3},t.musicStereo={maxBitrate:64e3},t.musicHighQuality={maxBitrate:96e3},t.musicHighQualityStereo={maxBitrate:128e3}})(Us||(Us={}));const Wi={h90:new ue(160,90,9e4,20),h180:new ue(320,180,16e4,20),h216:new ue(384,216,18e4,20),h360:new ue(640,360,45e4,20),h540:new ue(960,540,8e5,25),h720:new ue(1280,720,17e5,30),h1080:new ue(1920,1080,3e6,30),h1440:new ue(2560,1440,5e6,30),h2160:new ue(3840,2160,8e6,30)},Fs={h120:new ue(160,120,7e4,20),h180:new ue(240,180,125e3,20),h240:new ue(320,240,14e4,20),h360:new ue(480,360,33e4,20),h480:new ue(640,480,5e5,20),h540:new ue(720,540,6e5,25),h720:new ue(960,720,13e5,30),h1080:new ue(1440,1080,23e5,30),h1440:new ue(1920,1440,38e5,30)},Bs={h360fps3:new ue(640,360,2e5,3,"medium"),h360fps15:new ue(640,360,4e5,15,"medium"),h720fps5:new ue(1280,720,8e5,5,"medium"),h720fps15:new ue(1280,720,15e5,15,"medium"),h720fps30:new ue(1280,720,2e6,30,"medium"),h1080fps15:new ue(1920,1080,25e5,15,"medium"),h1080fps30:new ue(1920,1080,5e6,30,"medium"),original:new ue(0,0,7e6,30,"medium")},ab="|",Au="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function cb(t){const e=t.split(ab);return e.length>1?[e[0],t.substr(e[0].length+1)]:[t,""]}function Xe(t){return w(this,void 0,void 0,function*(){return new Promise(e=>ze.setTimeout(e,t))})}function js(){return"addTransceiver"in RTCPeerConnection.prototype}function Vs(){return"addTrack"in RTCPeerConnection.prototype}function lb(){if(!("getCapabilities"in RTCRtpSender)||Un())return!1;const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType==="video/AV1"){e=!0;break}}return e}function db(){if(!("getCapabilities"in RTCRtpSender)||si())return!1;if(Un()){const n=st();if(n!=null&&n.version&&At(n.version,"16")<0||(n==null?void 0:n.os)==="iOS"&&(n!=null&&n.osVersion)&&At(n.osVersion,"16")<0)return!1}const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType==="video/VP9"){e=!0;break}}return e}function Ot(t){return t==="av1"||t==="vp9"}function qs(t){return!document||zr()?!1:(t||(t=document.createElement("audio")),"setSinkId"in t)}function ub(){return typeof RTCPeerConnection>"u"?!1:js()||Vs()}function si(){var t;return((t=st())===null||t===void 0?void 0:t.name)==="Firefox"}function Un(){var t;return((t=st())===null||t===void 0?void 0:t.name)==="Safari"}function zr(){const t=st();return(t==null?void 0:t.name)==="Safari"||(t==null?void 0:t.os)==="iOS"}function hb(){const t=st();return(t==null?void 0:t.name)==="Safari"&&t.version.startsWith("17.")||(t==null?void 0:t.os)==="iOS"&&!!(t!=null&&t.osVersion)&&At(t.osVersion,"17")>=0}function fb(t){return t||(t=st()),(t==null?void 0:t.name)==="Safari"&&At(t.version,"18.3")>0||(t==null?void 0:t.os)==="iOS"&&!!(t!=null&&t.osVersion)&&At(t.osVersion,"18.3")>0}function Mu(){var t,e;return Qe()?(e=(t=navigator.userAgentData)===null||t===void 0?void 0:t.mobile)!==null&&e!==void 0?e:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function pb(){const t=st(),e="17.2";if(t)return t.name!=="Safari"&&t.os!=="iOS"||t.os==="iOS"&&t.osVersion&&At(e,t.osVersion)>=0?!0:t.name==="Safari"&&At(e,t.version)>=0}function Qe(){return typeof document<"u"}function Dt(){return navigator.product=="ReactNative"}function zs(t){return t.hostname.endsWith(".livekit.cloud")||t.hostname.endsWith(".livekit.run")}function Nu(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function Lu(){if(!Dt())return;let t=Nu();if(t)return t.platform}function Uu(){if(Qe())return window.devicePixelRatio;if(Dt()){let t=Nu();if(t)return t.devicePixelRatio}return 1}function At(t,e){const n=t.split("."),i=e.split("."),r=Math.min(n.length,i.length);for(let o=0;o<r;++o){const s=parseInt(n[o],10),a=parseInt(i[o],10);if(s>a)return 1;if(s<a)return-1;if(o===r-1&&s===a)return 0}return t===""&&e!==""?-1:e===""?1:n.length==i.length?0:n.length<i.length?-1:1}function mb(t){for(const e of t)e.target.handleResize(e)}function gb(t){for(const e of t)e.target.handleVisibilityChanged(e)}let $s=null;const Fu=()=>($s||($s=new ResizeObserver(mb)),$s);let Ws=null;const Bu=()=>(Ws||(Ws=new IntersectionObserver(gb,{root:null,rootMargin:"0px"})),Ws);function vb(){var t;const e=new ov({sdk:wd.JS,protocol:nb,version:tb});return Dt()&&(e.os=(t=Lu())!==null&&t!==void 0?t:""),e}function ju(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const r=document.createElement("canvas");r.width=t,r.height=e;const o=r.getContext("2d");o==null||o.fillRect(0,0,r.width,r.height),i&&o&&(o.beginPath(),o.arc(t/2,e/2,50,0,Math.PI*2,!0),o.closePath(),o.fillStyle="grey",o.fill());const s=r.captureStream(),[a]=s.getTracks();if(!a)throw Error("Could not get empty media stream video track");return a.enabled=n,a}let Hi;function Hs(){if(!Hi){const t=new AudioContext,e=t.createOscillator(),n=t.createGain();n.gain.setValueAtTime(0,0);const i=t.createMediaStreamDestination();if(e.connect(n),n.connect(i),e.start(),[Hi]=i.stream.getAudioTracks(),!Hi)throw Error("Could not get empty media stream audio track");Hi.enabled=!1}return Hi.clone()}class Mt{get isResolved(){return this._isResolved}constructor(e,n){this._isResolved=!1,this.onFinally=n,this.promise=new Promise((i,r)=>w(this,void 0,void 0,function*(){this.resolve=i,this.reject=r,e&&(yield e(i,r))})).finally(()=>{var i;this._isResolved=!0,(i=this.onFinally)===null||i===void 0||i.call(this)})}}function bb(t){return ob.includes(t)}function bn(t){if(typeof t=="string"||typeof t=="number")return t;if(Array.isArray(t))return t[0];if(t.exact!==void 0)return Array.isArray(t.exact)?t.exact[0]:t.exact;if(t.ideal!==void 0)return Array.isArray(t.ideal)?t.ideal[0]:t.ideal;throw Error("could not unwrap constraint")}function yb(t){return t.startsWith("http")?t.replace(/^(http)/,"ws"):t}function Gs(t){return t.startsWith("ws")?t.replace(/^(ws)/,"http"):t}function kb(t,e){return t.segments.map(n=>{let{id:i,text:r,language:o,startTime:s,endTime:a,final:c}=n;var l;const d=(l=e.get(i))!==null&&l!==void 0?l:Date.now(),u=Date.now();return c?e.delete(i):e.set(i,d),{id:i,text:r,startTime:Number.parseInt(s.toString()),endTime:Number.parseInt(a.toString()),final:c,language:o,firstReceivedTime:d,lastReceivedTime:u}})}function wb(t){const{id:e,timestamp:n,message:i,editTimestamp:r}=t;return{id:e,timestamp:Number.parseInt(n.toString()),editTimestamp:r?Number.parseInt(r.toString()):void 0,message:i}}function Vu(t){switch(t.reason){case oe.LeaveRequest:return t.context;case oe.Cancelled:return mt.CLIENT_INITIATED;case oe.NotAllowed:return mt.USER_REJECTED;case oe.ServerUnreachable:return mt.JOIN_FAILURE;default:return mt.UNKNOWN_REASON}}function $r(t){return t!==void 0?Number(t):void 0}function Fn(t){return t!==void 0?BigInt(t):void 0}function ai(t){return!!t&&!(t instanceof MediaStreamTrack)&&t.isLocal}function Nt(t){return!!t&&t.kind==R.Kind.Audio}function Bn(t){return!!t&&t.kind==R.Kind.Video}function yn(t){return ai(t)&&Bn(t)}function Zt(t){return ai(t)&&Nt(t)}function Ks(t){return!!t&&!t.isLocal}function Cb(t){return!!t&&!t.isLocal}function Js(t){return Ks(t)&&Bn(t)}function _b(t){return t.isLocal}function Sb(t,e){const n=[];let i=new TextEncoder().encode(t);for(;i.length>e;){let r=e;for(;r>0;){const o=i[r];if(o!==void 0&&(o&192)!==128)break;r--}n.push(i.slice(0,r)),i=i.slice(r)}return i.length>0&&n.push(i),n}function qu(t,e,n){var i,r,o,s;const{optionsWithoutProcessor:a,audioProcessor:c,videoProcessor:l}=Wu(t??{}),d=e==null?void 0:e.processor,u=n==null?void 0:n.processor,h=a??{};return h.audio===!0&&(h.audio={}),h.video===!0&&(h.video={}),h.audio&&(Ys(h.audio,e),(i=(o=h.audio).deviceId)!==null&&i!==void 0||(o.deviceId={ideal:"default"}),(c||d)&&(h.audio.processor=c??d)),h.video&&(Ys(h.video,n),(r=(s=h.video).deviceId)!==null&&r!==void 0||(s.deviceId={ideal:"default"}),(l||u)&&(h.video.processor=l??u)),h}function Ys(t,e){return Object.keys(e).forEach(n=>{t[n]===void 0&&(t[n]=e[n])}),t}function Xs(t){var e,n,i,r;const o={};if(t.video)if(typeof t.video=="object"){const s={},a=s,c=t.video;Object.keys(c).forEach(l=>{switch(l){case"resolution":Ys(a,c.resolution);break;default:a[l]=c[l]}}),o.video=s,(e=(i=o.video).deviceId)!==null&&e!==void 0||(i.deviceId={ideal:"default"})}else o.video=t.video?{deviceId:{ideal:"default"}}:!1;else o.video=!1;return t.audio?typeof t.audio=="object"?(o.audio=t.audio,(n=(r=o.audio).deviceId)!==null&&n!==void 0||(r.deviceId={ideal:"default"})):o.audio={deviceId:{ideal:"default"}}:o.audio=!1,o}function zu(t){return w(this,arguments,void 0,function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return(function*(){const i=$u();if(i){const r=i.createAnalyser();r.fftSize=2048;const o=r.frequencyBinCount,s=new Uint8Array(o);i.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(r),yield Xe(n),r.getByteTimeDomainData(s);const c=s.some(l=>l!==128&&l!==0);return i.close(),!c}return!1})()})}function $u(){var t;const e=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(e){const n=new e({latencyHint:"interactive"});if(n.state==="suspended"&&typeof window<"u"&&(!((t=window.document)===null||t===void 0)&&t.body)){const i=()=>w(this,void 0,void 0,function*(){var r;try{n.state==="suspended"&&(yield n.resume())}catch(o){console.warn("Error trying to auto-resume audio context",o)}(r=window.document.body)===null||r===void 0||r.removeEventListener("click",i)});window.document.body.addEventListener("click",i)}return n}}function Tb(t){return t==="audioinput"?R.Source.Microphone:t==="videoinput"?R.Source.Camera:R.Source.Unknown}function Qs(t){return t===R.Source.Microphone?"audioinput":t===R.Source.Camera?"videoinput":void 0}function xb(t){var e,n;let i=(e=t.video)!==null&&e!==void 0?e:!0;return t.resolution&&t.resolution.width>0&&t.resolution.height>0&&(i=typeof i=="boolean"?{}:i,Un()?i=Object.assign(Object.assign({},i),{width:{max:t.resolution.width},height:{max:t.resolution.height},frameRate:t.resolution.frameRate}):i=Object.assign(Object.assign({},i),{width:{ideal:t.resolution.width},height:{ideal:t.resolution.height},frameRate:t.resolution.frameRate})),{audio:(n=t.audio)!==null&&n!==void 0?n:!1,video:i,controller:t.controller,selfBrowserSurface:t.selfBrowserSurface,surfaceSwitching:t.surfaceSwitching,systemAudio:t.systemAudio,preferCurrentTab:t.preferCurrentTab}}function Wr(t){return t.split("/")[1].toLowerCase()}function Eb(t){const e=[];return t.forEach(n=>{n.track!==void 0&&e.push(new ks({cid:n.track.mediaStreamID,track:n.trackInfo}))}),e}function te(t){return"mediaStreamTrack"in t?{trackID:t.sid,source:t.source,muted:t.isMuted,enabled:t.mediaStreamTrack.enabled,kind:t.kind,streamID:t.mediaStreamID,streamTrackID:t.mediaStreamTrack.id}:{trackID:t.trackSid,enabled:t.isEnabled,muted:t.isMuted,trackInfo:Object.assign({mimeType:t.mimeType,name:t.trackName,encrypted:t.isEncrypted,kind:t.kind,source:t.source},t.track?te(t.track):{})}}function Pb(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function Rb(t,e){var n;t===void 0&&(t={}),e===void 0&&(e={});const i=[...Object.keys(e),...Object.keys(t)],r={};for(const o of i)t[o]!==e[o]&&(r[o]=(n=e[o])!==null&&n!==void 0?n:"");return r}function Wu(t){const e=Object.assign({},t);let n,i;return typeof e.audio=="object"&&e.audio.processor&&(n=e.audio.processor,e.audio=Object.assign(Object.assign({},e.audio),{processor:void 0})),typeof e.video=="object"&&e.video.processor&&(i=e.video.processor,e.video=Object.assign(Object.assign({},e.video),{processor:void 0})),{audioProcessor:n,videoProcessor:i,optionsWithoutProcessor:Xv(e)}}function Ib(t){switch(t){case De.CAMERA:return R.Source.Camera;case De.MICROPHONE:return R.Source.Microphone;case De.SCREEN_SHARE:return R.Source.ScreenShare;case De.SCREEN_SHARE_AUDIO:return R.Source.ScreenShareAudio;default:return R.Source.Unknown}}function Hu(t,e){return t.width*t.height<e.width*e.height}function Ob(t,e){var n;return(n=t.layers)===null||n===void 0?void 0:n.find(i=>i.quality===e)}class Db extends It.EventEmitter{constructor(e){super(),this.onWorkerMessage=n=>{var i,r;const{kind:o,data:s}=n.data;switch(o){case"error":ie.error(s.error.message),this.emit(gn.EncryptionError,s.error);break;case"initAck":s.enabled&&this.keyProvider.getKeys().forEach(a=>{this.postKey(a)});break;case"enable":if(s.enabled&&this.keyProvider.getKeys().forEach(a=>{this.postKey(a)}),this.encryptionEnabled!==s.enabled&&s.participantIdentity===((i=this.room)===null||i===void 0?void 0:i.localParticipant.identity))this.emit(gn.ParticipantEncryptionStatusChanged,s.enabled,this.room.localParticipant),this.encryptionEnabled=s.enabled;else if(s.participantIdentity){const a=(r=this.room)===null||r===void 0?void 0:r.getParticipantByIdentity(s.participantIdentity);if(!a)throw TypeError("couldn't set encryption status, participant not found".concat(s.participantIdentity));this.emit(gn.ParticipantEncryptionStatusChanged,s.enabled,a)}break;case"ratchetKey":this.keyProvider.emit(mn.KeyRatcheted,s.ratchetResult,s.participantIdentity,s.keyIndex);break}},this.onWorkerError=n=>{ie.error("e2ee worker encountered an error:",{error:n.error}),this.emit(gn.EncryptionError,n.error)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1}setup(e){if(!Kv())throw new As("tried to setup end-to-end encryption on an unsupported browser");if(ie.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const n={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:Av.getLevel()}};this.worker&&(ie.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(n))}}setParticipantCryptorEnabled(e,n){ie.debug("set e2ee to ".concat(e," for participant ").concat(n)),this.postEnable(e,n)}setSifTrailer(e){!e||e.length===0?ie.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on(L.RTPVideoMapUpdate,n=>{this.postRTPMap(n)})}setupEventListeners(e,n){e.on(O.TrackPublished,(i,r)=>this.setParticipantCryptorEnabled(i.trackInfo.encryption!==ot.NONE,r.identity)),e.on(O.ConnectionStateChanged,i=>{i===ae.Connected&&e.remoteParticipants.forEach(r=>{r.trackPublications.forEach(o=>{this.setParticipantCryptorEnabled(o.trackInfo.encryption!==ot.NONE,r.identity)})})}).on(O.TrackUnsubscribed,(i,r,o)=>{var s;const a={kind:"removeTransform",data:{participantIdentity:o.identity,trackId:i.mediaStreamID}};(s=this.worker)===null||s===void 0||s.postMessage(a)}).on(O.TrackSubscribed,(i,r,o)=>{this.setupE2EEReceiver(i,o.identity,r.trackInfo)}).on(O.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");n.getKeys().forEach(i=>{this.postKey(i)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(U.LocalSenderCreated,(i,r)=>w(this,void 0,void 0,function*(){this.setupE2EESender(r,i)})),n.on(mn.SetKey,i=>this.postKey(i)).on(mn.RatchetRequest,(i,r)=>this.postRatchetRequest(i,r))}postRatchetRequest(e,n){if(!this.worker)throw Error("could not ratchet key, worker is missing");const i={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:n}};this.worker.postMessage(i)}postKey(e){let{key:n,participantIdentity:i,keyIndex:r}=e;var o;if(!this.worker)throw Error("could not set key, worker is missing");const s={kind:"setKey",data:{participantIdentity:i,isPublisher:i===((o=this.room)===null||o===void 0?void 0:o.localParticipant.identity),key:n,keyIndex:r}};this.worker.postMessage(s)}postEnable(e,n){if(this.worker){const i={kind:"enable",data:{enabled:e,participantIdentity:n}};this.worker.postMessage(i)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var n;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((n=this.room)===null||n===void 0)&&n.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const i={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(i)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const n={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(n)}setupE2EEReceiver(e,n,i){if(e.receiver){if(!(i!=null&&i.mimeType)||i.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,n,e.kind==="video"?Wr(i.mimeType):void 0)}}setupE2EESender(e,n){if(!ai(e)||!n){n||ie.warn("early return because sender is not ready");return}this.handleSender(n,e.mediaStreamID,void 0)}handleReceiver(e,n,i,r){return w(this,void 0,void 0,function*(){if(this.worker){if(Ds()){const o={kind:"decode",participantIdentity:i,trackId:n,codec:r};e.transform=new RTCRtpScriptTransform(this.worker,o)}else{if(zi in e&&r){const c={kind:"updateCodec",data:{trackId:n,codec:r,participantIdentity:i}};this.worker.postMessage(c);return}let o=e.writableStream,s=e.readableStream;if(!o||!s){const c=e.createEncodedStreams();e.writableStream=c.writable,o=c.writable,e.readableStream=c.readable,s=c.readable}const a={kind:"decode",data:{readableStream:s,writableStream:o,trackId:n,codec:r,participantIdentity:i,isReuse:zi in e}};this.worker.postMessage(a,[s,o])}e[zi]=!0}})}handleSender(e,n,i){var r;if(!(zi in e||!this.worker)){if(!(!((r=this.room)===null||r===void 0)&&r.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(Ds()){ie.info("initialize script transform");const o={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:n,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,o)}else{ie.info("initialize encoded streams");const o=e.createEncodedStreams(),s={kind:"encode",data:{readableStream:o.readable,writableStream:o.writable,codec:i,trackId:n,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(s,[o.readable,o.writable])}e[zi]=!0}}}const Zs="default";class Ve{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new Ve),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return w(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var o;if(((o=Ve.userMediaPromiseMap)===null||o===void 0?void 0:o.size)>0){ie.debug("awaiting getUserMedia promise");try{n?yield Ve.userMediaPromiseMap.get(n):yield Promise.all(Ve.userMediaPromiseMap.values())}catch{ie.warn("error waiting for media permissons")}}let s=yield navigator.mediaDevices.enumerateDevices();if(r&&!(Un()&&i.hasDeviceInUse(n))&&(s.filter(c=>c.kind===n).length===0||s.some(c=>{const l=c.label==="",d=n?c.kind===n:!0;return l&&d}))){const c={video:n!=="audioinput"&&n!=="audiooutput",audio:n!=="videoinput"&&{deviceId:{ideal:"default"}}},l=yield navigator.mediaDevices.getUserMedia(c);s=yield navigator.mediaDevices.enumerateDevices(),l.getTracks().forEach(d=>{d.stop()})}return i._previousDevices=s,n&&(s=s.filter(a=>a.kind===n)),s})()})}normalizeDeviceId(e,n,i){return w(this,void 0,void 0,function*(){if(n!==Zs)return n;const r=yield this.getDevices(e),o=r.find(a=>a.deviceId===Zs);if(!o){ie.warn("could not reliably determine default device");return}const s=r.find(a=>a.deviceId!==Zs&&a.groupId===(i??o.groupId));if(!s){ie.warn("could not reliably determine default device");return}return s==null?void 0:s.deviceId})}hasDeviceInUse(e){return e?Ve.userMediaPromiseMap.has(e):Ve.userMediaPromiseMap.size>0}}Ve.mediaDeviceKinds=["audioinput","audiooutput","videoinput"],Ve.userMediaPromiseMap=new Map;var Gi;(function(t){t[t.WAITING=0]="WAITING",t[t.RUNNING=1]="RUNNING",t[t.COMPLETED=2]="COMPLETED"})(Gi||(Gi={}));class Ab{constructor(){this.pendingTasks=new Map,this.taskMutex=new Ke,this.nextTaskIndex=0}run(e){return w(this,void 0,void 0,function*(){const n={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:Gi.WAITING};this.pendingTasks.set(n.id,n);const i=yield this.taskMutex.lock();try{return n.executedAt=Date.now(),n.status=Gi.RUNNING,yield e()}finally{n.status=Gi.COMPLETED,this.pendingTasks.delete(n.id),i()}})}flush(){return w(this,void 0,void 0,function*(){return this.run(()=>w(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}function Mb(t,e){const n=new URL(yb(t));return e.forEach((i,r)=>{n.searchParams.set(r,i)}),Gu(n,"rtc")}function Nb(t){const e=new URL(Gs(t));return Gu(e,"validate")}function Lb(t){return t.endsWith("/")?t:"".concat(t,"/")}function Gu(t,e){return t.pathname="".concat(Lb(t.pathname)).concat(e),t.toString()}const Ub=["syncState","trickle","offer","answer","simulate","leave"];function Fb(t){const e=Ub.indexOf(t.case)>=0;return ie.trace("request allowed to bypass queue:",{canPass:e,req:t}),e}var ke;(function(t){t[t.CONNECTING=0]="CONNECTING",t[t.CONNECTED=1]="CONNECTED",t[t.RECONNECTING=2]="RECONNECTING",t[t.DISCONNECTING=3]="DISCONNECTING",t[t.DISCONNECTED=4]="DISCONNECTED"})(ke||(ke={}));class ea{get currentState(){return this.state}get isDisconnected(){return this.state===ke.DISCONNECTING||this.state===ke.DISCONNECTED}get isEstablishingConnection(){return this.state===ke.CONNECTING||this.state===ke.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;this.rtt=0,this.state=ke.DISCONNECTED,this.log=ie,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0},this.log=Jt((i=n.loggerName)!==null&&i!==void 0?i:vt.Signal),this.loggerContextCb=n.loggerContextCb,this.useJSON=e,this.requestQueue=new Ab,this.queuedRequests=[],this.closingLock=new Ke,this.connectionLock=new Ke,this.state=ke.DISCONNECTED}get logContext(){var e,n;return(n=(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this))!==null&&n!==void 0?n:{}}join(e,n,i,r){return w(this,void 0,void 0,function*(){return this.state=ke.CONNECTING,this.options=i,yield this.connect(e,n,i,r)})}reconnect(e,n,i,r){return w(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=ke.RECONNECTING,this.clearPingInterval(),yield this.connect(e,n,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:i,reconnectReason:r}))})}connect(e,n,i,r){this.connectOptions=i;const o=vb(),s=Bb(n,o,i),a=Mb(e,s),c=Nb(a);return new Promise((l,d)=>w(this,void 0,void 0,function*(){const u=yield this.connectionLock.lock();try{const h=()=>w(this,void 0,void 0,function*(){this.close(),clearTimeout(f),d(new me("room connection has been cancelled (signal)",oe.Cancelled))}),f=setTimeout(()=>{this.close(),d(new me("room connection has timed out (signal)",oe.ServerUnreachable))},i.websocketTimeout);r!=null&&r.aborted&&h(),r==null||r.addEventListener("abort",h);const g=new URL(a);g.searchParams.has("access_token")&&g.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(g),Object.assign({reconnect:i.reconnect,reconnectReason:i.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new WebSocket(a),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{clearTimeout(f)},this.ws.onerror=p=>w(this,void 0,void 0,function*(){if(this.state!==ke.CONNECTED){this.state=ke.DISCONNECTED,clearTimeout(f);try{const v=yield fetch(c);if(v.status.toFixed(0).startsWith("4")){const b=yield v.text();d(new me(b,oe.NotAllowed,v.status))}else d(new me("Encountered unknown websocket error during connection: ".concat(p.toString()),oe.InternalError,v.status))}catch(v){d(new me(v instanceof Error?v.message:"server was not reachable",oe.ServerUnreachable))}return}this.handleWSError(p)}),this.ws.onmessage=p=>w(this,void 0,void 0,function*(){var v,b,k;let C;if(typeof p.data=="string"){const y=JSON.parse(p.data);C=Ed.fromJson(y,{ignoreUnknownFields:!0})}else if(p.data instanceof ArrayBuffer)C=Ed.fromBinary(new Uint8Array(p.data));else{this.log.error("could not decode websocket message: ".concat(typeof p.data),this.logContext);return}if(this.state!==ke.CONNECTED){let y=!1;if(((v=C.message)===null||v===void 0?void 0:v.case)==="join"?(this.state=ke.CONNECTED,r==null||r.removeEventListener("abort",h),this.pingTimeoutDuration=C.message.value.pingTimeout,this.pingIntervalDuration=C.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&(this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})),this.startPingInterval()),l(C.message.value)):this.state===ke.RECONNECTING&&C.message.case!=="leave"?(this.state=ke.CONNECTED,r==null||r.removeEventListener("abort",h),this.startPingInterval(),((b=C.message)===null||b===void 0?void 0:b.case)==="reconnect"?l(C.message.value):(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),l(void 0),y=!0)):this.isEstablishingConnection&&C.message.case==="leave"?d(new me("Received leave request while trying to (re)connect",oe.LeaveRequest,void 0,C.message.value.reason)):i.reconnect||d(new me("did not receive join response, got ".concat((k=C.message)===null||k===void 0?void 0:k.case," instead"),oe.InternalError)),!y)return}this.signalLatency&&(yield Xe(this.signalLatency)),this.handleSignalResponse(C)}),this.ws.onclose=p=>{this.isEstablishingConnection&&d(new me("Websocket got closed during a (re)connection attempt",oe.InternalError)),this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:p.reason,code:p.code,wasClean:p.wasClean,state:this.state})),this.handleOnClose(p.reason)}}finally{u()}}))}close(){return w(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){const i=yield e.closingLock.lock();try{if(e.clearPingInterval(),n&&(e.state=ke.DISCONNECTING),e.ws){e.ws.onmessage=null,e.ws.onopen=null,e.ws.onclose=null;const r=new Promise(o=>{e.ws?e.ws.onclose=()=>{o()}:o()});e.ws.readyState<e.ws.CLOSING&&(e.ws.close(),yield Promise.race([r,Xe(250)])),e.ws=void 0}}finally{n&&(e.state=ke.DISCONNECTED),i()}})()})}sendOffer(e,n){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:Hr(e,n)})}sendAnswer(e,n){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:Hr(e,n)})}sendIceCandidate(e,n){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new bs({candidateInit:JSON.stringify(e),target:n})})}sendMuteTrack(e,n){return this.sendRequest({case:"mute",value:new ys({sid:e,muted:n})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,n){return w(this,arguments,void 0,function(i,r){var o=this;let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return(function*(){const a=o.getNextRequestId();return yield o.sendRequest({case:"updateMetadata",value:new Od({requestId:a,metadata:i,name:r,attributes:s})}),a})()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,n){return this.sendRequest({case:"updateLayers",value:new Id({trackSid:e,layers:n})})}sendUpdateSubscriptionPermissions(e,n){return this.sendRequest({case:"subscriptionPermission",value:new Md({allParticipants:e,trackPermissions:n})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:Se.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new Fd({timestamp:Se.parse(Date.now()),rtt:Se.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,n){return this.sendRequest({case:"updateAudioTrack",value:new Rd({trackSid:e,features:n})})}sendLeave(){return this.sendRequest({case:"leave",value:new Dr({reason:mt.CLIENT_INITIATED,action:ni.DISCONNECT})})}sendRequest(e){return w(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return(function*(){if(!r&&!Fb(n)&&i.state===ke.RECONNECTING){i.queuedRequests.push(()=>w(i,void 0,void 0,function*(){yield this.sendRequest(n,!0)}));return}if(r||(yield i.requestQueue.flush()),i.signalLatency&&(yield Xe(i.signalLatency)),i.isDisconnected){i.log.debug("skipping signal request (type: ".concat(n.case,") - SignalClient disconnected"));return}if(!i.ws||i.ws.readyState!==i.ws.OPEN){i.log.error("cannot send signal request before connected, type: ".concat(n==null?void 0:n.case),i.logContext);return}const s=new cv({message:n});try{i.useJSON?i.ws.send(s.toJsonString()):i.ws.send(s.toBinary())}catch(a){i.log.error("error sending signal message",Object.assign(Object.assign({},i.logContext),{error:a}))}})()})}handleSignalResponse(e){var n,i;const r=e.message;if(r==null){this.log.debug("received unsupported message",this.logContext);return}let o=!1;if(r.case==="answer"){const s=Ku(r.value);this.onAnswer&&this.onAnswer(s,r.value.id)}else if(r.case==="offer"){const s=Ku(r.value);this.onOffer&&this.onOffer(s,r.value.id)}else if(r.case==="trickle"){const s=JSON.parse(r.value.candidateInit);this.onTrickle&&this.onTrickle(s,r.value.target)}else r.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((n=r.value.participants)!==null&&n!==void 0?n:[]):r.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(r.value):r.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((i=r.value.speakers)!==null&&i!==void 0?i:[]):r.case==="leave"?this.onLeave&&this.onLeave(r.value):r.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(r.value.sid,r.value.muted):r.case==="roomUpdate"?this.onRoomUpdate&&r.value.room&&this.onRoomUpdate(r.value.room):r.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(r.value):r.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(r.value):r.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(r.value):r.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(r.value):r.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(r.value):r.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(r.value):r.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(r.value):r.case==="pong"||(r.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(r.value.lastPingTimestamp.toString()),this.resetPingTimeout(),o=!0):r.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(r.value):r.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(r.value.trackSid):r.case==="roomMoved"?(this.onTokenRefresh&&this.onTokenRefresh(r.value.token),this.onRoomMoved&&this.onRoomMoved(r.value)):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:r.case})));o||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return w(this,void 0,void 0,function*(){if(this.state===ke.DISCONNECTED)return;const n=this.onClose;yield this.close(),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),n&&n(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=ze.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&ze.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=ze.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&ze.clearInterval(this.pingInterval)}}function Ku(t){const e={type:"offer",sdp:t.sdp};switch(t.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=t.type;break}return e}function Hr(t,e){return new Nn({sdp:t.sdp,type:t.type,id:e})}function Bb(t,e,n){var i;const r=new URLSearchParams;return r.set("access_token",t),n.reconnect&&(r.set("reconnect","1"),n.sid&&r.set("sid",n.sid)),r.set("auto_subscribe",n.autoSubscribe?"1":"0"),r.set("sdk",Dt()?"reactnative":"js"),r.set("version",e.version),r.set("protocol",e.protocol.toString()),e.deviceModel&&r.set("device_model",e.deviceModel),e.os&&r.set("os",e.os),e.osVersion&&r.set("os_version",e.osVersion),e.browser&&r.set("browser",e.browser),e.browserVersion&&r.set("browser_version",e.browserVersion),n.adaptiveStream&&r.set("adaptive_stream","1"),n.reconnectReason&&r.set("reconnect_reason",n.reconnectReason.toString()),!((i=navigator.connection)===null||i===void 0)&&i.type&&r.set("network",navigator.connection.type),r}class Ju{constructor(){this.buffer=[],this._totalSize=0}push(e){this.buffer.push(e),this._totalSize+=e.data.byteLength}pop(){const e=this.buffer.shift();return e&&(this._totalSize-=e.data.byteLength),e}getAll(){return this.buffer.slice()}popToSequence(e){for(;this.buffer.length>0&&this.buffer[0].sequence<=e;)this.pop()}alignBufferedAmount(e){for(;this.buffer.length>0;){const n=this.buffer[0];if(this._totalSize-n.data.byteLength<=e)break;this.pop()}}get length(){return this.buffer.length}}class jb{constructor(e){this._map=new Map,this._lastCleanup=0,this.ttl=e}set(e,n){const i=Date.now();i-this._lastCleanup>this.ttl/2&&this.cleanup();const r=i+this.ttl;return this._map.set(e,{value:n,expiresAt:r}),this}get(e){const n=this._map.get(e);if(n){if(n.expiresAt<Date.now()){this._map.delete(e);return}return n.value}}has(e){const n=this._map.get(e);return n?n.expiresAt<Date.now()?(this._map.delete(e),!1):!0:!1}delete(e){return this._map.delete(e)}clear(){this._map.clear()}cleanup(){const e=Date.now();for(const[n,i]of this._map.entries())i.expiresAt<e&&this._map.delete(n);this._lastCleanup=e}get size(){return this.cleanup(),this._map.size}forEach(e){this.cleanup();for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e(i.value,n,this.asValueMap())}map(e){this.cleanup();const n=[],i=this.asValueMap();for(const[r,o]of i.entries())n.push(e(o,r,i));return n}asValueMap(){const e=new Map;for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e.set(n,i.value);return e}}var yt={},ta={},na={exports:{}},Yu;function ia(){if(Yu)return na.exports;Yu=1;var t=na.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var n="candidate:%s %d %s %d %s %d typ %s";return n+=e.raddr!=null?" raddr %s rport %d":"%v%v",n+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(n+=" generation %d"),n+=e["network-id"]!=null?" network-id %d":"%v",n+=e["network-cost"]!=null?" network-cost %d":"%v",n}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var n="ssrc:%d";return e.attribute!=null&&(n+=" %s",e.value!=null&&(n+=":%s")),n}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var n="mediaclk:";return n+=e.id!=null?"id=%s %s":"%v%s",n+=e.mediaClockValue!=null?"=%s":"",n+=e.rateNumerator!=null?" rate=%s":"",n+=e.rateDenominator!=null?"/%s":"",n}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(t).forEach(function(e){var n=t[e];n.forEach(function(i){i.reg||(i.reg=/(.*)/),i.format||(i.format="%s")})}),na.exports}var Xu;function Vb(){return Xu||(Xu=1,(function(t){var e=function(a){return String(Number(a))===a?Number(a):a},n=function(a,c,l,d){if(d&&!l)c[d]=e(a[1]);else for(var u=0;u<l.length;u+=1)a[u+1]!=null&&(c[l[u]]=e(a[u+1]))},i=function(a,c,l){var d=a.name&&a.names;a.push&&!c[a.push]?c[a.push]=[]:d&&!c[a.name]&&(c[a.name]={});var u=a.push?{}:d?c[a.name]:c;n(l.match(a.reg),u,a.names,a.name),a.push&&c[a.push].push(u)},r=ia(),o=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(a){var c={},l=[],d=c;return a.split(/(\r\n|\r|\n)/).filter(o).forEach(function(u){var h=u[0],f=u.slice(2);h==="m"&&(l.push({rtp:[],fmtp:[]}),d=l[l.length-1]);for(var g=0;g<(r[h]||[]).length;g+=1){var p=r[h][g];if(p.reg.test(f))return i(p,d,f)}}),c.media=l,c};var s=function(a,c){var l=c.split(/=(.+)/,2);return l.length===2?a[l[0]]=e(l[1]):l.length===1&&c.length>1&&(a[l[0]]=void 0),a};t.parseParams=function(a){return a.split(/;\s?/).reduce(s,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(a){return a.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(a){for(var c=[],l=a.split(" ").map(e),d=0;d<l.length;d+=3)c.push({component:l[d],ip:l[d+1],port:l[d+2]});return c},t.parseImageAttributes=function(a){return a.split(" ").map(function(c){return c.substring(1,c.length-1).split(",").reduce(s,{})})},t.parseSimulcastStreamList=function(a){return a.split(";").map(function(c){return c.split(",").map(function(l){var d,u=!1;return l[0]!=="~"?d=e(l):(d=e(l.substring(1,l.length)),u=!0),{scid:d,paused:u}})})}})(ta)),ta}var ra,Qu;function qb(){if(Qu)return ra;Qu=1;var t=ia(),e=/%[sdv%]/g,n=function(s){var a=1,c=arguments,l=c.length;return s.replace(e,function(d){if(a>=l)return d;var u=c[a];switch(a+=1,d){case"%%":return"%";case"%s":return String(u);case"%d":return Number(u);case"%v":return""}})},i=function(s,a,c){var l=a.format instanceof Function?a.format(a.push?c:c[a.name]):a.format,d=[s+"="+l];if(a.names)for(var u=0;u<a.names.length;u+=1){var h=a.names[u];a.name?d.push(c[a.name][h]):d.push(c[a.names[u]])}else d.push(c[a.name]);return n.apply(null,d)},r=["v","o","s","i","u","e","p","c","b","t","r","z","a"],o=["i","c","b","a"];return ra=function(s,a){a=a||{},s.version==null&&(s.version=0),s.name==null&&(s.name=" "),s.media.forEach(function(u){u.payloads==null&&(u.payloads="")});var c=a.outerOrder||r,l=a.innerOrder||o,d=[];return c.forEach(function(u){t[u].forEach(function(h){h.name in s&&s[h.name]!=null?d.push(i(u,h,s)):h.push in s&&s[h.push]!=null&&s[h.push].forEach(function(f){d.push(i(u,h,f))})})}),s.media.forEach(function(u){d.push(i("m",t.m[0],u)),l.forEach(function(h){t[h].forEach(function(f){f.name in u&&u[f.name]!=null?d.push(i(h,f,u)):f.push in u&&u[f.push]!=null&&u[f.push].forEach(function(g){d.push(i(h,f,g))})})})}),d.join(`\r
`)+`\r
`},ra}var Zu;function zb(){if(Zu)return yt;Zu=1;var t=Vb(),e=qb(),n=ia();return yt.grammar=n,yt.write=e,yt.parse=t.parse,yt.parseParams=t.parseParams,yt.parseFmtpConfig=t.parseFmtpConfig,yt.parsePayloads=t.parsePayloads,yt.parseRemoteCandidates=t.parseRemoteCandidates,yt.parseImageAttributes=t.parseImageAttributes,yt.parseSimulcastStreamList=t.parseSimulcastStreamList,yt}var kn=zb();function oa(t,e,n){var i,r,o;e===void 0&&(e=50),n===void 0&&(n={});var s=(i=n.isImmediate)!=null&&i,a=(r=n.callback)!=null&&r,c=n.maxWait,l=Date.now(),d=[];function u(){if(c!==void 0){var f=Date.now()-l;if(f+e>=c)return c-f}return e}var h=function(){var f=[].slice.call(arguments),g=this;return new Promise(function(p,v){var b=s&&o===void 0;if(o!==void 0&&clearTimeout(o),o=setTimeout(function(){if(o=void 0,l=Date.now(),!s){var C=t.apply(g,f);a&&a(C),d.forEach(function(y){return(0,y.resolve)(C)}),d=[]}},u()),b){var k=t.apply(g,f);return a&&a(k),p(k)}d.push({resolve:p,reject:v})})};return h.cancel=function(f){o!==void 0&&clearTimeout(o),d.forEach(function(g){return(0,g.reject)(f)}),d=[]},h}const $b=.7,Wb=20,ci={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class eh extends It.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;super(),this.log=ie,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=oa(r=>w(this,void 0,void 0,function*(){this.emit(ci.NegotiationStarted);try{yield this.createAndSendOffer()}catch(o){if(r)r(o);else throw o}}),Wb),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=Jt((i=n.loggerName)!==null&&i!==void 0?i:vt.PCTransport),this.loggerOptions=n,this.config=e,this._pc=this.createPC(),this.offerLock=new Ke}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=n=>{var i;n.candidate&&((i=this.onIceCandidate)===null||i===void 0||i.call(this,n.candidate))},e.onicecandidateerror=n=>{var i;(i=this.onIceCandidateError)===null||i===void 0||i.call(this,n)},e.oniceconnectionstatechange=()=>{var n;(n=this.onIceConnectionStateChange)===null||n===void 0||n.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var n;(n=this.onSignalingStatechange)===null||n===void 0||n.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var n;(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,e.connectionState)},e.ondatachannel=n=>{var i;(i=this.onDataChannel)===null||i===void 0||i.call(this,n)},e.ontrack=n=>{var i;(i=this.onTrack)===null||i===void 0||i.call(this,n)},e}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return w(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e,n){return w(this,void 0,void 0,function*(){var i;if(e.type==="answer"&&this.latestOfferId>0&&n>0&&n!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:n,latestOfferId:this.latestOfferId})),!1;let r;if(e.type==="offer"){let{stereoMids:o,nackMids:s}=Hb(e);this.remoteStereoMids=o,this.remoteNackMids=s}else if(e.type==="answer"){const o=kn.parse((i=e.sdp)!==null&&i!==void 0?i:"");o.media.forEach(s=>{s.type==="audio"&&this.trackBitrates.some(a=>{if(!a.transceiver||s.mid!=a.transceiver.mid)return!1;let c=0;if(s.rtp.some(d=>d.codec.toUpperCase()===a.codec.toUpperCase()?(c=d.payload,!0):!1),c===0)return!0;let l=!1;for(const d of s.fmtp)if(d.payload===c){d.config=d.config.split(";").filter(u=>!u.includes("maxaveragebitrate")).join(";"),a.maxbr>0&&(d.config+=";maxaveragebitrate=".concat(a.maxbr*1e3)),l=!0;break}return l||a.maxbr>0&&s.fmtp.push({payload:c,config:"maxaveragebitrate=".concat(a.maxbr*1e3)}),!0})}),r=kn.write(o)}return yield this.setMungedSDP(e,r,!0),this.pendingCandidates.forEach(o=>{this.pc.addIceCandidate(o)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):e.type==="answer"&&(this.emit(ci.NegotiationComplete),e.sdp&&kn.parse(e.sdp).media.forEach(s=>{s.type==="video"&&this.emit(ci.RTPVideoPayloadTypes,s.rtp)})),!0})}createAndSendOffer(e){return w(this,void 0,void 0,function*(){var n;const i=yield this.offerLock.lock();try{if(this.onOffer===void 0)return;if(e!=null&&e.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const a=this._pc.remoteDescription;if(e!=null&&e.iceRestart&&a)yield this._pc.setRemoteDescription(a);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const r=this.latestOfferId+1;this.latestOfferId=r;const o=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:o.sdp},this.logContext));const s=kn.parse((n=o.sdp)!==null&&n!==void 0?n:"");if(s.media.forEach(a=>{nh(a),a.type==="audio"?th(a,[],[]):a.type==="video"&&this.trackBitrates.some(c=>{if(!a.msid||!c.cid||!a.msid.includes(c.cid))return!1;let l=0;if(a.rtp.some(u=>u.codec.toUpperCase()===c.codec.toUpperCase()?(l=u.payload,!0):!1),l===0||(Ot(c.codec)&&!Un()&&this.ensureVideoDDExtensionForSVC(a,s),c.codec!=="av1"))return!0;const d=Math.round(c.maxbr*$b);for(const u of a.fmtp)if(u.payload===l){u.config.includes("x-google-start-bitrate")||(u.config+=";x-google-start-bitrate=".concat(d));break}return!0})}),this.latestOfferId>r){this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:r}));return}yield this.setMungedSDP(o,kn.write(s)),this.onOffer(o,this.latestOfferId)}finally{i()}})}createAndSetAnswer(){return w(this,void 0,void 0,function*(){var e;const n=yield this.pc.createAnswer(),i=kn.parse((e=n.sdp)!==null&&e!==void 0?e:"");return i.media.forEach(r=>{nh(r),r.type==="audio"&&th(r,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(n,kn.write(i)),n})}createDataChannel(e,n){return this.pc.createDataChannel(e,n)}addTransceiver(e,n){return this.pc.addTransceiver(e,n)}addTrack(e){if(!this._pc)throw new Ue("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var n;if(!this._pc)throw new Ue("PC closed, cannot configure");return(n=this._pc)===null||n===void 0?void 0:n.setConfiguration(e)}canRemoveTrack(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}removeTrack(e){var n;return(n=this._pc)===null||n===void 0?void 0:n.removeTrack(e)}getConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&n!==void 0?n:"closed"}getICEConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&n!==void 0?n:"closed"}getSignallingState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&n!==void 0?n:"closed"}getTransceivers(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&n!==void 0?n:[]}getSenders(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&n!==void 0?n:[]}getLocalDescription(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}getRemoteDescription(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return w(this,void 0,void 0,function*(){var e;if(!this._pc)return;let n="";const i=new Map,r=new Map;if((yield this._pc.getStats()).forEach(a=>{switch(a.type){case"transport":n=a.selectedCandidatePairId;break;case"candidate-pair":n===""&&a.selected&&(n=a.id),i.set(a.id,a);break;case"remote-candidate":r.set(a.id,"".concat(a.address,":").concat(a.port));break}}),n==="")return;const s=(e=i.get(n))===null||e===void 0?void 0:e.remoteCandidateId;if(s!==void 0)return r.get(s)})}setMungedSDP(e,n,i){return w(this,void 0,void 0,function*(){if(n){const r=e.sdp;e.sdp=n;try{this.log.debug("setting munged ".concat(i?"remote":"local"," description"),this.logContext),i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(o){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:o,sdp:n})),e.sdp=r}}try{i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(r){let o="unknown error";r instanceof Error?o=r.message:typeof r=="string"&&(o=r);const s={error:o,sdp:e.sdp};throw!i&&this.pc.remoteDescription&&(s.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:s})),new Ms(o)}})}ensureVideoDDExtensionForSVC(e,n){var i,r;if(!((i=e.ext)===null||i===void 0?void 0:i.some(s=>s.uri===Au))){if(this.ddExtID===0){let s=0;n.media.forEach(a=>{var c;a.type==="video"&&((c=a.ext)===null||c===void 0||c.forEach(l=>{l.value>s&&(s=l.value)}))}),this.ddExtID=s+1}(r=e.ext)===null||r===void 0||r.push({value:this.ddExtID,uri:Au})}}}function th(t,e,n){let i=0;t.rtp.some(r=>r.codec==="opus"?(i=r.payload,!0):!1),i>0&&(t.rtcpFb||(t.rtcpFb=[]),n.includes(t.mid)&&!t.rtcpFb.some(r=>r.payload===i&&r.type==="nack")&&t.rtcpFb.push({payload:i,type:"nack"}),e.includes(t.mid)&&t.fmtp.some(r=>r.payload===i?(r.config.includes("stereo=1")||(r.config+=";stereo=1"),!0):!1))}function Hb(t){var e;const n=[],i=[],r=kn.parse((e=t.sdp)!==null&&e!==void 0?e:"");let o=0;return r.media.forEach(s=>{var a;s.type==="audio"&&(s.rtp.some(c=>c.codec==="opus"?(o=c.payload,!0):!1),!((a=s.rtcpFb)===null||a===void 0)&&a.some(c=>c.payload===o&&c.type==="nack")&&i.push(s.mid),s.fmtp.some(c=>c.payload===o?(c.config.includes("sprop-stereo=1")&&n.push(s.mid),!0):!1))}),{stereoMids:n,nackMids:i}}function nh(t){if(t.connection){const e=t.connection.ip.indexOf(":")>=0;(t.connection.version===4&&e||t.connection.version===6&&!e)&&(t.connection.ip="0.0.0.0",t.connection.version=4)}}const sa="vp8",Gb={audioPreset:Us.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:Bs.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:sa,backupCodec:!0,preConnectBuffer:!1},ih={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},rh={deviceId:{ideal:"default"},resolution:Wi.h720.resolution},Kb={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new Nv,disconnectOnPageLeave:!0,webAudioMix:!1},aa={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var Pe;(function(t){t[t.NEW=0]="NEW",t[t.CONNECTING=1]="CONNECTING",t[t.CONNECTED=2]="CONNECTED",t[t.FAILED=3]="FAILED",t[t.CLOSING=4]="CLOSING",t[t.CLOSED=5]="CLOSED"})(Pe||(Pe={}));class Jb{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,n,i){var r;this.peerConnectionTimeout=aa.peerConnectionTimeout,this.log=ie,this.updateState=()=>{var o;const s=this.state,a=this.requiredTransports.map(c=>c.getConnectionState());a.every(c=>c==="connected")?this.state=Pe.CONNECTED:a.some(c=>c==="failed")?this.state=Pe.FAILED:a.some(c=>c==="connecting")?this.state=Pe.CONNECTING:a.every(c=>c==="closed")?this.state=Pe.CLOSED:a.some(c=>c==="closed")?this.state=Pe.CLOSING:a.every(c=>c==="new")&&(this.state=Pe.NEW),s!==this.state&&(this.log.debug("pc state change: from ".concat(Pe[s]," to ").concat(Pe[this.state]),this.logContext),(o=this.onStateChange)===null||o===void 0||o.call(this,this.state,this.publisher.getConnectionState(),this.subscriber.getConnectionState()))},this.log=Jt((r=i.loggerName)!==null&&r!==void 0?r:vt.PCManager),this.loggerOptions=i,this.isPublisherConnectionRequired=!n,this.isSubscriberConnectionRequired=n,this.publisher=new eh(e,i),this.subscriber=new eh(e,i),this.publisher.onConnectionStateChange=this.updateState,this.subscriber.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=o=>{var s;(s=this.onIceCandidate)===null||s===void 0||s.call(this,o,gt.PUBLISHER)},this.subscriber.onIceCandidate=o=>{var s;(s=this.onIceCandidate)===null||s===void 0||s.call(this,o,gt.SUBSCRIBER)},this.subscriber.onDataChannel=o=>{var s;(s=this.onDataChannel)===null||s===void 0||s.call(this,o)},this.subscriber.onTrack=o=>{var s;(s=this.onTrack)===null||s===void 0||s.call(this,o)},this.publisher.onOffer=(o,s)=>{var a;(a=this.onPublisherOffer)===null||a===void 0||a.call(this,o,s)},this.state=Pe.NEW,this.connectionLock=new Ke,this.remoteOfferLock=new Ke}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}requirePublisher(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=e,this.updateState()}requireSubscriber(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isSubscriberConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e,n){return this.publisher.setRemoteDescription(e,n)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return w(this,void 0,void 0,function*(){if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const e=this.publisher;for(const n of e.getSenders())try{e.canRemoveTrack()&&e.removeTrack(n)}catch(i){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:i}))}}yield Promise.all([this.publisher.close(),this.subscriber.close()]),this.updateState()})}triggerIceRestart(){return w(this,void 0,void 0,function*(){this.subscriber.restartingIce=!0,this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,n){return w(this,void 0,void 0,function*(){n===gt.PUBLISHER?yield this.publisher.addIceCandidate(e):yield this.subscriber.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e,n){return w(this,void 0,void 0,function*(){this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:this.subscriber.getSignallingState().toString()}));const i=yield this.remoteOfferLock.lock();try{return(yield this.subscriber.setRemoteDescription(e,n))?yield this.subscriber.createAndSetAnswer():void 0}finally{i()}})}updateConfiguration(e,n){this.publisher.setConfiguration(e),this.subscriber.setConfiguration(e),n&&this.triggerIceRestart()}ensurePCTransportConnection(e,n){return w(this,void 0,void 0,function*(){var i;const r=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((i=this.requiredTransports)===null||i===void 0?void 0:i.map(o=>this.ensureTransportConnected(o,e,n)))}finally{r()}})}negotiate(e){return w(this,void 0,void 0,function*(){return new Promise((n,i)=>w(this,void 0,void 0,function*(){const r=setTimeout(()=>{i("negotiation timed out")},this.peerConnectionTimeout),o=()=>{clearTimeout(r),i("negotiation aborted")};e.signal.addEventListener("abort",o),this.publisher.once(ci.NegotiationStarted,()=>{e.signal.aborted||this.publisher.once(ci.NegotiationComplete,()=>{clearTimeout(r),n()})}),yield this.publisher.negotiate(s=>{clearTimeout(r),i(s)})}))})}addPublisherTransceiver(e,n){return this.publisher.addTransceiver(e,n)}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,n){return this.publisher.createDataChannel(e,n)}getConnectedAddress(e){return e===gt.PUBLISHER?this.publisher.getConnectedAddress():e===gt.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&e.push(this.subscriber),e}ensureTransportConnected(e,n){return w(this,arguments,void 0,function(i,r){var o=this;let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return(function*(){if(i.getConnectionState()!=="connected")return new Promise((c,l)=>w(o,void 0,void 0,function*(){const d=()=>{this.log.warn("abort transport connection",this.logContext),ze.clearTimeout(u),l(new me("room connection has been cancelled",oe.Cancelled))};r!=null&&r.signal.aborted&&d(),r==null||r.signal.addEventListener("abort",d);const u=ze.setTimeout(()=>{r==null||r.signal.removeEventListener("abort",d),l(new me("could not establish pc connection",oe.InternalError))},s);for(;this.state!==Pe.CONNECTED;)if(yield Xe(50),r!=null&&r.signal.aborted){l(new me("room connection has been cancelled",oe.Cancelled));return}ze.clearTimeout(u),r==null||r.signal.removeEventListener("abort",d),c()}))})()})}}class Re extends Error{constructor(e,n,i){super(n),this.code=e,this.message=sh(n,Re.MAX_MESSAGE_BYTES),this.data=i?sh(i,Re.MAX_DATA_BYTES):void 0}static fromProto(e){return new Re(e.code,e.message,e.data)}toProto(){return new vd({code:this.code,message:this.message,data:this.data})}static builtIn(e,n){return new Re(Re.ErrorCode[e],Re.ErrorMessage[e],n)}}Re.MAX_MESSAGE_BYTES=256,Re.MAX_DATA_BYTES=15360,Re.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404},Re.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const oh=15360;function ca(t){return new TextEncoder().encode(t).length}function sh(t,e){if(ca(t)<=e)return t;let n=0,i=t.length;const r=new TextEncoder;for(;n<i;){const o=Math.floor((n+i+1)/2);r.encode(t.slice(0,o)).length<=e?n=o:i=o-1}return t.slice(0,n)}const la=2e3;function Gr(t,e){if(!e)return 0;let n,i;return"bytesReceived"in t?(n=t.bytesReceived,i=e.bytesReceived):"bytesSent"in t&&(n=t.bytesSent,i=e.bytesSent),n===void 0||i===void 0||t.timestamp===void 0||e.timestamp===void 0?0:(n-i)*8*1e3/(t.timestamp-e.timestamp)}const da=typeof MediaRecorder<"u";class Yb{constructor(){throw new Error("MediaRecorder is not available in this environment")}}const Xb=da?MediaRecorder:Yb;class Qb extends Xb{constructor(e,n){if(!da)throw new Error("MediaRecorder is not available in this environment");super(new MediaStream([e.mediaStreamTrack]),n);let i,r;const o=()=>r===void 0,s=()=>{this.removeEventListener("dataavailable",i),this.removeEventListener("stop",s),this.removeEventListener("error",a),r==null||r.close(),r=void 0},a=c=>{r==null||r.error(c),this.removeEventListener("dataavailable",i),this.removeEventListener("stop",s),this.removeEventListener("error",a),r=void 0};this.byteStream=new ReadableStream({start:c=>{r=c,i=l=>w(this,void 0,void 0,function*(){let d;if(l.data.arrayBuffer){const u=yield l.data.arrayBuffer();d=new Uint8Array(u)}else if(l.data.byteArray)d=l.data.byteArray;else throw new Error("no data available!");o()||c.enqueue(d)}),this.addEventListener("dataavailable",i)},cancel:()=>{s()}}),this.addEventListener("stop",s),this.addEventListener("error",a)}}function Zb(){return da}const e0=1e3,t0=1e4;class ah extends R{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(e,n,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o=arguments.length>4?arguments[4]:void 0;super(e,n,o),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=oa(()=>w(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>w(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(N.Ended,this)},this.reacquireTrack=!1,this.providedByUser=r,this.muteLock=new Ke,this.pauseUpstreamLock=new Ke,this.trackChangeLock=new Ke,this.trackChangeLock.lock().then(s=>w(this,void 0,void 0,function*(){try{yield this.setMediaStreamTrack(e,!0)}finally{s()}})),this._constraints=e.getConstraints(),i&&(this._constraints=i)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==R.Kind.Video)return;const{width:e,height:n}=this._mediaStreamTrack.getSettings();if(e&&n)return{width:e,height:n}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,n;return(n=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&n!==void 0?n:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,n){return w(this,void 0,void 0,function*(){var i;if(e===this._mediaStreamTrack&&!n)return;this._mediaStreamTrack&&(this.attachedElements.forEach(o=>{oi(this._mediaStreamTrack,o)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let r;if(this.processor&&e){if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(ri(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),r=this.processor.processedTrack}this.sender&&((i=this.sender.transport)===null||i===void 0?void 0:i.state)!=="closed"&&(yield this.sender.replaceTrack(r??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(o=>{ri(r??e,o)}))})}waitForDimensions(){return w(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e0;return(function*(){var i;if(e.kind===R.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((i=st())===null||i===void 0?void 0:i.os)==="iOS"&&(yield Xe(10));const r=Date.now();for(;Date.now()-r<n;){const o=e.dimensions;if(o)return o;yield Xe(50)}throw new Qt("unable to get track dimensions after timeout")})()})}setDeviceId(e){return w(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===bn(e)||(this._constraints.deviceId=e,this.isMuted)?!0:(yield this.restartTrack(),bn(e)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return w(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){if(e.source===R.Source.ScreenShare)return;const{deviceId:i,groupId:r}=e._mediaStreamTrack.getSettings(),o=e.kind===R.Kind.Audio?"audioinput":"videoinput";return n?Ve.getInstance().normalizeDeviceId(o,i,r):i})()})}mute(){return w(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return w(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,n){return w(this,void 0,void 0,function*(){const i=yield this.trackChangeLock.lock();try{if(!this.sender)throw new Qt("unable to replace an unpublished track");let r,o;return typeof n=="boolean"?r=n:n!==void 0&&(r=n.userProvidedTrack,o=n.stopProcessor),this.providedByUser=r??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),o&&this.processor&&(yield this.internalStopProcessor()),this}finally{i()}})}restart(e){return w(this,void 0,void 0,function*(){this.manuallyStopped=!1;const n=yield this.trackChangeLock.lock();try{e||(e=this._constraints);const{deviceId:i,facingMode:r}=e,o=Lv(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const s={audio:!1,video:!1};this.kind===R.Kind.Video?s.video=i||r?{deviceId:i,facingMode:r}:!0:s.audio=i?{deviceId:i}:!0,this.attachedElements.forEach(l=>{oi(this.mediaStreamTrack,l)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const c=(yield navigator.mediaDevices.getUserMedia(s)).getTracks()[0];return yield c.applyConstraints(o),c.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(c),this._constraints=e,this.emit(N.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{n()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?N.Muted:N.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return w(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),Mu()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return w(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(N.UpstreamPaused,this);const i=st();if((i==null?void 0:i.name)==="Safari"&&At(i.version,"12.0")<0)throw new As("pauseUpstream is not supported on Safari < 12.");((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{n()}})}resumeUpstream(){return w(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(N.UpstreamResumed,this),((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{n()}})}getRTCStatsReport(){return w(this,void 0,void 0,function*(){var e;return!((e=this.sender)===null||e===void 0)&&e.getStats?yield this.sender.getStats():void 0})}setProcessor(e){return w(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var o;const s=yield i.trackChangeLock.lock();try{i.log.debug("setting up processor",i.logContext);const a=document.createElement(i.kind),c={kind:i.kind,track:i._mediaStreamTrack,element:a,audioContext:i.audioContext};if(yield n.init(c),i.log.debug("processor initialized",i.logContext),i.processor&&(yield i.internalStopProcessor()),i.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(ri(i._mediaStreamTrack,a),a.muted=!0,a.play().catch(l=>{l instanceof DOMException&&l.name==="AbortError"?(i.log.warn("failed to play processor element, retrying",Object.assign(Object.assign({},i.logContext),{error:l})),setTimeout(()=>{a.play().catch(d=>{i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{err:d}))})},100)):i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{error:l}))}),i.processor=n,i.processorElement=a,i.processor.processedTrack){for(const l of i.attachedElements)l!==i.processorElement&&r&&(oi(i._mediaStreamTrack,l),ri(i.processor.processedTrack,l));yield(o=i.sender)===null||o===void 0?void 0:o.replaceTrack(i.processor.processedTrack)}i.emit(N.TrackProcessorUpdate,i.processor)}finally{s()}})()})}getProcessor(){return this.processor}stopProcessor(){return w(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){const i=yield e.trackChangeLock.lock();try{yield e.internalStopProcessor(n)}finally{i()}})()})}internalStopProcessor(){return w(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var i,r;e.processor&&(e.log.debug("stopping processor",e.logContext),(i=e.processor.processedTrack)===null||i===void 0||i.stop(),yield e.processor.destroy(),e.processor=void 0,n||((r=e.processorElement)===null||r===void 0||r.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(N.TrackProcessorUpdate))})()})}startPreConnectBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;if(!Zb()){this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext);return}if(this.localTrackRecorder){this.log.warn("preconnect buffer already started");return}else{let n="audio/webm;codecs=opus";MediaRecorder.isTypeSupported(n)||(n="video/mp4"),this.localTrackRecorder=new Qb(this,{mimeType:n})}this.localTrackRecorder.start(e),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},t0)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.byteStream}getPreConnectBufferMimeType(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.mimeType}}class Kr extends ah{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;super(e,R.Kind.Audio,n,i,o),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>w(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let s;try{s=yield this.getSenderStats()}catch(a){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:a}));return}s&&this.prevStats&&(this._currentBitrate=Gr(s,this.prevStats)),this.prevStats=s}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(N.AudioTrackFeatureUpdate,this,je.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(N.AudioTrackFeatureUpdate,this,je.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=r,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return w(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===R.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return w(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const i=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==bn(this._constraints.deviceId);return this.source===R.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||i)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{n()}})}restartTrack(e){return w(this,void 0,void 0,function*(){let n;if(e){const i=Xs({audio:e});typeof i.audio!="boolean"&&(n=i.audio)}yield this.restart(n)})}restart(e){const n=Object.create(null,{restart:{get:()=>super.restart}});return w(this,void 0,void 0,function*(){const i=yield n.restart.call(this,e);return this.checkForSilence(),i})}startMonitor(){Qe()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},la)))}setProcessor(e){return w(this,void 0,void 0,function*(){var n;const i=yield this.trackChangeLock.lock();try{if(!Dt()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.internalStopProcessor());const r={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(r),this.processor=e,this.processor.processedTrack&&(yield(n=this.sender)===null||n===void 0?void 0:n.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(N.TrackProcessorUpdate,this.processor)}finally{i()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return w(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const n=yield this.sender.getStats();let i;return n.forEach(r=>{r.type==="outbound-rtp"&&(i={type:"audio",streamId:r.id,packetsSent:r.packetsSent,packetsLost:r.packetsLost,bytesSent:r.bytesSent,timestamp:r.timestamp,roundTripTime:r.roundTripTime,jitter:r.jitter})}),i})}checkForSilence(){return w(this,void 0,void 0,function*(){const e=yield zu(this);return e&&(this.isMuted||this.log.warn("silence detected on local audio track",this.logContext),this.emit(N.AudioSilenceDetected)),e})}}function n0(t,e,n){switch(t.kind){case"audio":return new Kr(t,e,!1,void 0,n);case"video":return new Jr(t,e,!1,n);default:throw new Qt("unsupported track type: ".concat(t.kind))}}const i0=Object.values(Wi),r0=Object.values(Fs),o0=Object.values(Bs),s0=[Wi.h180,Wi.h360],a0=[Fs.h180,Fs.h360],c0=t=>[{scaleResolutionDownBy:2,fps:t.encoding.maxFramerate}].map(n=>{var i,r;return new ue(Math.floor(t.width/n.scaleResolutionDownBy),Math.floor(t.height/n.scaleResolutionDownBy),Math.max(15e4,Math.floor(t.encoding.maxBitrate/(Math.pow(n.scaleResolutionDownBy,2)*(((i=t.encoding.maxFramerate)!==null&&i!==void 0?i:30)/((r=n.fps)!==null&&r!==void 0?r:30))))),n.fps,t.encoding.priority)}),ua=["q","h","f"];function ha(t,e,n,i){var r,o;let s=i==null?void 0:i.videoEncoding;t&&(s=i==null?void 0:i.screenShareEncoding);const a=i==null?void 0:i.simulcast,c=i==null?void 0:i.scalabilityMode,l=i==null?void 0:i.videoCodec;if(!s&&!a&&!c||!e||!n)return[{}];s||(s=d0(t,e,n,l),ie.debug("using video encoding",s));const d=s.maxFramerate,u=new ue(e,n,s.maxBitrate,s.maxFramerate,s.priority);if(c&&Ot(l)){const g=new dh(c),p=[];if(g.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(c));const v=st();if(zr()||Dt()||(v==null?void 0:v.name)==="Chrome"&&At(v==null?void 0:v.version,"113")<0){const b=g.suffix=="h"?2:3,k=fb(v);for(let C=0;C<g.spatial;C+=1)p.push({rid:ua[2-C],maxBitrate:s.maxBitrate/Math.pow(b,C),maxFramerate:u.encoding.maxFramerate,scaleResolutionDownBy:k?Math.pow(2,C):void 0});p[0].scalabilityMode=c}else p.push({maxBitrate:s.maxBitrate,maxFramerate:u.encoding.maxFramerate,scalabilityMode:c});return u.encoding.priority&&(p[0].priority=u.encoding.priority,p[0].networkPriority=u.encoding.priority),ie.debug("using svc encoding",{encodings:p}),p}if(!a)return[s];let h=[];t?h=(r=lh(i==null?void 0:i.screenShareSimulcastLayers))!==null&&r!==void 0?r:ch(t,u):h=(o=lh(i==null?void 0:i.videoSimulcastLayers))!==null&&o!==void 0?o:ch(t,u);let f;if(h.length>0){const g=h[0];h.length>1&&([,f]=h);const p=Math.max(e,n);if(p>=960&&f)return fa(e,n,[g,f,u],d);if(p>=480)return fa(e,n,[g,u],d)}return fa(e,n,[u])}function l0(t,e,n){var i,r,o,s;if(!n.backupCodec||n.backupCodec===!0||n.backupCodec.codec===n.videoCodec)return;e!==n.backupCodec.codec&&ie.warn("requested a different codec than specified as backup",{serverRequested:e,backup:n.backupCodec.codec}),n.videoCodec=e,n.videoEncoding=n.backupCodec.encoding;const a=t.mediaStreamTrack.getSettings(),c=(i=a.width)!==null&&i!==void 0?i:(r=t.dimensions)===null||r===void 0?void 0:r.width,l=(o=a.height)!==null&&o!==void 0?o:(s=t.dimensions)===null||s===void 0?void 0:s.height;return t.source===R.Source.ScreenShare&&n.simulcast&&(n.simulcast=!1),ha(t.source===R.Source.ScreenShare,c,l,n)}function d0(t,e,n,i){const r=u0(t,e,n);let{encoding:o}=r[0];const s=Math.max(e,n);for(let a=0;a<r.length;a+=1){const c=r[a];if(o=c.encoding,c.width>=s)break}if(i)switch(i){case"av1":case"h265":o=Object.assign({},o),o.maxBitrate=o.maxBitrate*.7;break;case"vp9":o=Object.assign({},o),o.maxBitrate=o.maxBitrate*.85;break}return o}function u0(t,e,n){if(t)return o0;const i=e>n?e/n:n/e;return Math.abs(i-16/9)<Math.abs(i-4/3)?i0:r0}function ch(t,e){if(t)return c0(e);const{width:n,height:i}=e,r=n>i?n/i:i/n;return Math.abs(r-16/9)<Math.abs(r-4/3)?s0:a0}function fa(t,e,n,i){const r=[];if(n.forEach((o,s)=>{if(s>=ua.length)return;const a=Math.min(t,e),l={rid:ua[s],scaleResolutionDownBy:Math.max(1,a/Math.min(o.width,o.height)),maxBitrate:o.encoding.maxBitrate},d=i&&o.encoding.maxFramerate?Math.min(i,o.encoding.maxFramerate):o.encoding.maxFramerate;d&&(l.maxFramerate=d);const u=si()||s===0;o.encoding.priority&&u&&(l.priority=o.encoding.priority,l.networkPriority=o.encoding.priority),r.push(l)}),Dt()&&Lu()==="ios"){let o;r.forEach(a=>{o?a.maxFramerate&&a.maxFramerate>o&&(o=a.maxFramerate):o=a.maxFramerate});let s=!0;r.forEach(a=>{var c;a.maxFramerate!=o&&(s&&(s=!1,ie.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),ie.info('Setting framerate of encoding "'.concat((c=a.rid)!==null&&c!==void 0?c:"",'" to ').concat(o)),a.maxFramerate=o)})}return r}function lh(t){if(t)return t.sort((e,n)=>{const{encoding:i}=e,{encoding:r}=n;return i.maxBitrate>r.maxBitrate?1:i.maxBitrate<r.maxBitrate?-1:i.maxBitrate===r.maxBitrate&&i.maxFramerate&&r.maxFramerate?i.maxFramerate>r.maxFramerate?1:-1:0})}class dh{constructor(e){const n=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!n)throw new Error("invalid scalability mode");if(this.spatial=parseInt(n[1]),this.temporal=parseInt(n[2]),n.length>3)switch(n[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=n[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}function h0(t){return t.source===R.Source.ScreenShare||t.constraints.height&&bn(t.constraints.height)>=1080?"maintain-resolution":"balanced"}const f0=5e3;class Jr extends ah{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0;super(e,R.Kind.Video,n,i,r),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>w(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let o;try{o=yield this.getSenderStats()}catch(c){this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:c}));return}const s=new Map(o.map(c=>[c.rid,c])),a=o.some(c=>c.qualityLimitationReason==="cpu");if(a!==this.isCpuConstrained&&(this.isCpuConstrained=a,this.isCpuConstrained&&this.emit(N.CpuConstrained)),this.prevStats){let c=0;s.forEach((l,d)=>{var u;const h=(u=this.prevStats)===null||u===void 0?void 0:u.get(d);c+=Gr(l,h)}),this._currentBitrate=c}this.prevStats=s}),this.senderLock=new Ke}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var n;if(this.signalClient=e,!Qe())return;const i=(n=this.sender)===null||n===void 0?void 0:n.getParameters();i&&(this.encodings=i.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},la))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return w(this,void 0,void 0,function*(){var n,i,r,o,s;yield e.pauseUpstream.call(this);try{for(var a=!0,c=Yt(this.simulcastCodecs.values()),l;l=yield c.next(),n=l.done,!n;a=!0)o=l.value,a=!1,yield(s=o.sender)===null||s===void 0?void 0:s.replaceTrack(null)}catch(d){i={error:d}}finally{try{!a&&!n&&(r=c.return)&&(yield r.call(c))}finally{if(i)throw i.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return w(this,void 0,void 0,function*(){var n,i,r,o,s;yield e.resumeUpstream.call(this);try{for(var a=!0,c=Yt(this.simulcastCodecs.values()),l;l=yield c.next(),n=l.done,!n;a=!0){o=l.value,a=!1;const d=o;yield(s=d.sender)===null||s===void 0?void 0:s.replaceTrack(d.mediaStreamTrack)}}catch(d){i={error:d}}finally{try{!a&&!n&&(r=c.return)&&(yield r.call(c))}finally{if(i)throw i.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return w(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===R.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return w(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.source===R.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{n()}})}setTrackMuted(e){super.setTrackMuted(e);for(const n of this.simulcastCodecs.values())n.mediaStreamTrack.enabled=!e}getSenderStats(){return w(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const n=[],i=yield this.sender.getStats();return i.forEach(r=>{var o;if(r.type==="outbound-rtp"){const s={type:"video",streamId:r.id,frameHeight:r.frameHeight,frameWidth:r.frameWidth,framesPerSecond:r.framesPerSecond,framesSent:r.framesSent,firCount:r.firCount,pliCount:r.pliCount,nackCount:r.nackCount,packetsSent:r.packetsSent,bytesSent:r.bytesSent,qualityLimitationReason:r.qualityLimitationReason,qualityLimitationDurations:r.qualityLimitationDurations,qualityLimitationResolutionChanges:r.qualityLimitationResolutionChanges,rid:(o=r.rid)!==null&&o!==void 0?o:r.id,retransmittedPacketsSent:r.retransmittedPacketsSent,targetBitrate:r.targetBitrate,timestamp:r.timestamp},a=i.get(r.remoteId);a&&(s.jitter=a.jitter,s.packetsLost=a.packetsLost,s.roundTripTime=a.roundTripTime),n.push(s)}}),n.sort((r,o)=>{var s,a;return((s=o.frameWidth)!==null&&s!==void 0?s:0)-((a=r.frameWidth)!==null&&a!==void 0?a:0)}),n})}setPublishingQuality(e){const n=[];for(let i=at.LOW;i<=at.HIGH;i+=1)n.push(new ws({quality:i,enabled:i<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(Ot(this.codec),n)}restartTrack(e){return w(this,void 0,void 0,function*(){var n,i,r,o,s;let a;if(e){const u=Xs({video:e});typeof u.video!="boolean"&&(a=u.video)}yield this.restart(a),this.isCpuConstrained=!1;try{for(var c=!0,l=Yt(this.simulcastCodecs.values()),d;d=yield l.next(),n=d.done,!n;c=!0){o=d.value,c=!1;const u=o;u.sender&&((s=u.sender.transport)===null||s===void 0?void 0:s.state)!=="closed"&&(u.mediaStreamTrack=this.mediaStreamTrack.clone(),yield u.sender.replaceTrack(u.mediaStreamTrack))}}catch(u){i={error:u}}finally{try{!c&&!n&&(r=l.return)&&(yield r.call(l))}finally{if(i)throw i.error}}})}setProcessor(e){const n=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return w(this,arguments,void 0,function(i){var r=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var s,a,c,l,d,u;if(yield n.setProcessor.call(r,i,o),!((d=r.processor)===null||d===void 0)&&d.processedTrack)try{for(var h=!0,f=Yt(r.simulcastCodecs.values()),g;g=yield f.next(),s=g.done,!s;h=!0)l=g.value,h=!1,yield(u=l.sender)===null||u===void 0?void 0:u.replaceTrack(r.processor.processedTrack)}catch(p){a={error:p}}finally{try{!h&&!s&&(c=f.return)&&(yield c.call(f))}finally{if(a)throw a.error}}})()})}setDegradationPreference(e){return w(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const n=this.sender.getParameters();n.degradationPreference=e,this.sender.setParameters(n)}catch(n){this.log.warn("failed to set degradationPreference",Object.assign({error:n},this.logContext))}})}addSimulcastTrack(e,n){if(this.simulcastCodecs.has(e)){this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);return}const i={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:n};return this.simulcastCodecs.set(e,i),i}setSimulcastTrackSender(e,n){const i=this.simulcastCodecs.get(e);i&&(i.sender=n,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},f0))}setPublishingCodecs(e){return w(this,void 0,void 0,function*(){var n,i,r,o,s,a,c;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(Ot(e[0].codec),e[0].qualities),[];this.subscribedCodecs=e;const l=[];try{for(n=!0,i=Yt(e);r=yield i.next(),o=r.done,!o;n=!0){c=r.value,n=!1;const d=c;if(!this.codec||this.codec===d.codec)yield this.setPublishingLayers(Ot(d.codec),d.qualities);else{const u=this.simulcastCodecs.get(d.codec);if(this.log.debug("try setPublishingCodec for ".concat(d.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:u})),!u||!u.sender){for(const h of d.qualities)if(h.enabled){l.push(d.codec);break}}else u.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(d.codec),this.logContext),yield uh(u.sender,u.encodings,d.qualities,this.senderLock,Ot(d.codec),this.log,this.logContext))}}}catch(d){s={error:d}}finally{try{!n&&!o&&(a=i.return)&&(yield a.call(i))}finally{if(s)throw s.error}}return l})}setPublishingLayers(e,n){return w(this,void 0,void 0,function*(){if(this.optimizeForPerformance){this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:n}));return}this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:n})),!(!this.sender||!this.encodings)&&(yield uh(this.sender,this.encodings,n,this.senderLock,e,this.log,this.logContext))})}prioritizePerformance(){return w(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const e=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const n=this.sender.getParameters();n.encodings=n.encodings.map((i,r)=>{var o;return Object.assign(Object.assign({},i),{active:r===0,scaleResolutionDownBy:Math.max(1,Math.ceil(((o=this.mediaStreamTrack.getSettings().height)!==null&&o!==void 0?o:360)/360)),scalabilityMode:r===0&&Ot(this.codec)?"L1T3":void 0,maxFramerate:r===0?15:0,maxBitrate:r===0?i.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:n.encodings})),this.encodings=n.encodings,yield this.sender.setParameters(n)}catch(n){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:n})),this.optimizeForPerformance=!1}finally{e()}})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return w(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),Mu()&&this.isInBackground&&this.source===R.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function uh(t,e,n,i,r,o,s){return w(this,void 0,void 0,function*(){const a=yield i.lock();o.debug("setPublishingLayersForSender",Object.assign(Object.assign({},s),{sender:t,qualities:n,senderEncodings:e}));try{const c=t.getParameters(),{encodings:l}=c;if(!l)return;if(l.length!==e.length){o.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},s),{encodings:l,senderEncodings:e}));return}let d=!1;!1&&l[0].scalabilityMode||(r&&n.some(f=>f.enabled)&&n.forEach(f=>f.enabled=!0),l.forEach((h,f)=>{var g;let p=(g=h.rid)!==null&&g!==void 0?g:"";p===""&&(p="q");const v=hh(p),b=n.find(k=>k.quality===v);b&&h.active!==b.enabled&&(d=!0,h.active=b.enabled,o.debug("setting layer ".concat(b.quality," to ").concat(h.active?"enabled":"disabled"),s),si()&&(b.enabled?(h.scaleResolutionDownBy=e[f].scaleResolutionDownBy,h.maxBitrate=e[f].maxBitrate,h.maxFrameRate=e[f].maxFrameRate):(h.scaleResolutionDownBy=4,h.maxBitrate=10,h.maxFrameRate=2)))})),d&&(c.encodings=l,o.debug("setting encodings",Object.assign(Object.assign({},s),{encodings:c.encodings})),yield t.setParameters(c))}finally{a()}})}function hh(t){switch(t){case"f":return at.HIGH;case"h":return at.MEDIUM;case"q":return at.LOW;default:return at.HIGH}}function fh(t,e,n,i){if(!n)return[new Mn({quality:at.HIGH,width:t,height:e,bitrate:0,ssrc:0})];if(i){const r=n[0].scalabilityMode,o=new dh(r),s=[],a=o.suffix=="h"?1.5:2,c=o.suffix=="h"?2:3;for(let l=0;l<o.spatial;l+=1)s.push(new Mn({quality:Math.min(at.HIGH,o.spatial-1)-l,width:Math.ceil(t/Math.pow(a,l)),height:Math.ceil(e/Math.pow(a,l)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(c,l)):0,ssrc:0}));return s}return n.map(r=>{var o,s,a;const c=(o=r.scaleResolutionDownBy)!==null&&o!==void 0?o:1;let l=hh((s=r.rid)!==null&&s!==void 0?s:"");return new Mn({quality:l,width:Math.ceil(t/c),height:Math.ceil(e/c),bitrate:(a=r.maxBitrate)!==null&&a!==void 0?a:0,ssrc:0})})}const ph="_lossy",mh="_reliable",p0=2*1e3,pa="leave-reconnect",m0=3e4;var kt;(function(t){t[t.New=0]="New",t[t.Connected=1]="Connected",t[t.Disconnected=2]="Disconnected",t[t.Reconnecting=3]="Reconnecting",t[t.Closed=4]="Closed"})(kt||(kt={}));class g0 extends It.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var n;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=aa.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=kt.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=ie,this.reliableDataSequence=1,this.reliableMessageBuffer=new Ju,this.reliableReceivedState=new jb(m0),this.handleDataChannel=i=>w(this,[i],void 0,function(r){var o=this;let{channel:s}=r;return(function*(){if(s){if(s.label===mh)o.reliableDCSub=s;else if(s.label===ph)o.lossyDCSub=s;else return;o.log.debug("on data channel ".concat(s.id,", ").concat(s.label),o.logContext),s.onmessage=o.handleDataMessage}})()}),this.handleDataMessage=i=>w(this,void 0,void 0,function*(){var r,o;const s=yield this.dataProcessLock.lock();try{let a;if(i.data instanceof ArrayBuffer)a=i.data;else if(i.data instanceof Blob)a=yield i.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:i.data}));return}const c=Ye.fromBinary(new Uint8Array(a));if(c.sequence>0&&c.participantSid!==""){const l=this.reliableReceivedState.get(c.participantSid);if(l&&c.sequence<=l)return;this.reliableReceivedState.set(c.participantSid,c.sequence)}((r=c.value)===null||r===void 0?void 0:r.case)==="speaker"?this.emit(L.ActiveSpeakersUpdate,c.value.value.speakers):(((o=c.value)===null||o===void 0?void 0:o.case)==="user"&&b0(c,c.value.value),this.emit(L.DataPacketReceived,c))}finally{s()}}),this.handleDataError=i=>{const o=i.currentTarget.maxRetransmits===0?"lossy":"reliable";if(i instanceof ErrorEvent&&i.error){const{error:s}=i.error;this.log.error("DataChannel error on ".concat(o,": ").concat(i.message),Object.assign(Object.assign({},this.logContext),{error:s}))}else this.log.error("Unknown DataChannel error on ".concat(o),Object.assign(Object.assign({},this.logContext),{event:i}))},this.handleBufferedAmountLow=i=>{const o=i.currentTarget.maxRetransmits===0?Q.LOSSY:Q.RELIABLE;this.updateAndEmitDCBufferStatus(o)},this.handleDisconnect=(i,r)=>{if(this._isClosed)return;this.log.warn("".concat(i," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const o=c=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(c,"ms. giving up"),this.logContext),this.emit(L.Disconnected),this.close()},s=Date.now()-this.reconnectStart;let a=this.getNextRetryDelay({elapsedMs:s,retryCount:this.reconnectAttempts});if(a===null){o(s);return}i===pa&&(a=0),this.log.debug("reconnecting in ".concat(a,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=ze.setTimeout(()=>this.attemptReconnect(r).finally(()=>this.reconnectTimeout=void 0),a)},this.waitForRestarted=()=>new Promise((i,r)=>{this.pcState===kt.Connected&&i();const o=()=>{this.off(L.Disconnected,s),i()},s=()=>{this.off(L.Restarted,o),r()};this.once(L.Restarted,o),this.once(L.Disconnected,s)}),this.updateAndEmitDCBufferStatus=i=>{const r=this.isBufferStatusLow(i);typeof r<"u"&&r!==this.dcBufferStatus.get(i)&&(this.dcBufferStatus.set(i,r),this.emit(L.DCBufferStatusChanged,r,i))},this.isBufferStatusLow=i=>{const r=this.dataChannelForKind(i);if(r)return i===Q.RELIABLE&&this.reliableMessageBuffer.alignBufferedAmount(r.bufferedAmount),r.bufferedAmount<=r.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>{this.client.currentState===ke.RECONNECTING&&(this.clearReconnectTimeout(),this.attemptReconnect(Zn.RR_SIGNAL_DISCONNECTED))},this.log=Jt((n=e.loggerName)!==null&&n!==void 0?n:vt.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new ea(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.registerOnLineListener(),this.closingLock=new Ke,this.dataProcessLock=new Ke,this.dcBufferStatus=new Map([[Q.LOSSY,!0],[Q.RELIABLE,!0]]),this.client.onParticipantUpdate=i=>this.emit(L.ParticipantUpdate,i),this.client.onConnectionQuality=i=>this.emit(L.ConnectionQualityUpdate,i),this.client.onRoomUpdate=i=>this.emit(L.RoomUpdate,i),this.client.onSubscriptionError=i=>this.emit(L.SubscriptionError,i),this.client.onSubscriptionPermissionUpdate=i=>this.emit(L.SubscriptionPermissionUpdate,i),this.client.onSpeakersChanged=i=>this.emit(L.SpeakersChanged,i),this.client.onStreamStateUpdate=i=>this.emit(L.StreamStateChanged,i),this.client.onRequestResponse=i=>this.emit(L.SignalRequestResponse,i)}get logContext(){var e,n,i,r,o,s;return{room:(n=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||n===void 0?void 0:n.name,roomID:(r=(i=this.latestJoinResponse)===null||i===void 0?void 0:i.room)===null||r===void 0?void 0:r.sid,participant:(s=(o=this.latestJoinResponse)===null||o===void 0?void 0:o.participant)===null||s===void 0?void 0:s.identity,pID:this.participantSid}}join(e,n,i,r){return w(this,void 0,void 0,function*(){this.url=e,this.token=n,this.signalOpts=i,this.maxJoinAttempts=i.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const o=yield this.client.join(e,n,i,r);return this._isClosed=!1,this.latestJoinResponse=o,this.subscriberPrimary=o.subscriberPrimary,this.pcManager||(yield this.configure(o)),(!this.subscriberPrimary||o.fastPublish)&&this.negotiate(),this.clientConfiguration=o.clientConfiguration,this.emit(L.SignalConnected,o),o}catch(o){if(o instanceof me&&o.reason===oe.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,n,i,r);throw o}})}close(){return w(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(L.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return w(this,void 0,void 0,function*(){var e;yield(e=this.pcManager)===null||e===void 0?void 0:e.close(),this.pcManager=void 0;const n=i=>{i&&(i.close(),i.onbufferedamountlow=null,i.onclose=null,i.onclosing=null,i.onerror=null,i.onmessage=null,i.onopen=null)};n(this.lossyDC),n(this.lossyDCSub),n(this.reliableDC),n(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new Ju,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupClient(){return w(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new Qt("a track with the same ID has already been published");return new Promise((n,i)=>{const r=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],i(new me("publication of local track timed out, no response from server",oe.Timeout))},1e4);this.pendingTrackResolvers[e.cid]={resolve:o=>{clearTimeout(r),n(o)},reject:()=>{clearTimeout(r),i(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:n}=this.pendingTrackResolvers[e.track.id];n&&n(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(n){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:n}))}return!1}updateMuteStatus(e,n){this.client.sendMuteTrack(e,n)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){return w(this,void 0,void 0,function*(){var e;return(e=this.pcManager)===null||e===void 0?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){return w(this,void 0,void 0,function*(){var n,i;if(this.pcManager&&this.pcManager.currentState!==Pe.NEW)return;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid;const r=this.makeRTCConfiguration(e);this.pcManager=new Jb(r,e.subscriberPrimary,this.loggerOptions),this.emit(L.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(o,s)=>{this.client.sendIceCandidate(o,s)},this.pcManager.onPublisherOffer=(o,s)=>{this.client.sendOffer(o,s)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(o,s,a)=>w(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(o),this.logContext),["closed","disconnected","failed"].includes(s)&&(this.publisherConnectionPromise=void 0),o===Pe.CONNECTED){const d=this.pcState===kt.New;this.pcState=kt.Connected,d&&this.emit(L.Connected,e)}else o===Pe.FAILED&&this.pcState===kt.Connected&&(this.pcState=kt.Disconnected,this.handleDisconnect("peerconnection failed",a==="failed"?Zn.RR_SUBSCRIBER_FAILED:Zn.RR_PUBLISHER_FAILED));const c=this.client.isDisconnected||this.client.currentState===ke.RECONNECTING,l=[Pe.FAILED,Pe.CLOSING,Pe.CLOSED].includes(o);c&&l&&!this._isClosed&&this.emit(L.Offline)}),this.pcManager.onTrack=o=>{this.emit(L.MediaTrackAdded,o.track,o.streams[0],o.receiver)},v0((i=e.serverInfo)===null||i===void 0?void 0:i.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(e,n)=>w(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type})),yield this.pcManager.setPublisherAnswer(e,n))}),this.client.onTrickle=(e,n)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:n})),this.pcManager.addIceCandidate(e,n))},this.client.onOffer=(e,n)=>w(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=n,!this.pcManager)return;const i=yield this.pcManager.createSubscriberAnswerFromOffer(e,n);i&&this.client.sendAnswer(i,n)}),this.client.onLocalTrackPublished=e=>{var n;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:(n=e.track)===null||n===void 0?void 0:n.sid})),!this.pendingTrackResolvers[e.cid]){this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));return}const{resolve:i}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],i(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(L.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(L.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{this.token=e},this.client.onRemoteMuteChanged=(e,n)=>{this.emit(L.RemoteMute,e,n)},this.client.onSubscribedQualityUpdate=e=>{this.emit(L.SubscribedQualityUpdate,e)},this.client.onRoomMoved=e=>{var n;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=e.room),this.emit(L.RoomMoved,e)},this.client.onClose=()=>{this.handleDisconnect("signal",Zn.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:e==null?void 0:e.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions(e.regions)),e.action){case ni.DISCONNECT:this.emit(L.Disconnected,e==null?void 0:e.reason),this.close();break;case ni.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(pa);break;case ni.RESUME:this.handleDisconnect(pa)}}}makeRTCConfiguration(e){var n;const i=Object.assign({},this.rtcConfig);if(!((n=this.signalOpts)===null||n===void 0)&&n.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),i.encodedInsertableStreams=!0),e.iceServers&&!i.iceServers){const r=[];e.iceServers.forEach(o=>{const s={urls:o.urls};o.username&&(s.username=o.username),o.credential&&(s.credential=o.credential),r.push(s)}),i.iceServers=r}return e.clientConfiguration&&e.clientConfiguration.forceRelay===Bi.ENABLED&&(i.iceTransportPolicy="relay"),i.sdpSemantics="unified-plan",i.continualGatheringPolicy="gather_continually",i}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(ph,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(mh,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}createSender(e,n,i){return w(this,void 0,void 0,function*(){if(js())return yield this.createTransceiverRTCRtpSender(e,n,i);if(Vs())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new Ue("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,n,i,r){return w(this,void 0,void 0,function*(){if(js())return this.createSimulcastTransceiverSender(e,n,i,r);if(Vs())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new Ue("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,n,i){return w(this,void 0,void 0,function*(){if(!this.pcManager)throw new Ue("publisher is closed");const r=[];e.mediaStream&&r.push(e.mediaStream),Bn(e)&&(e.codec=n.videoCodec);const o={direction:"sendonly",streams:r};return i&&(o.sendEncodings=i),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,o)).sender})}createSimulcastTransceiverSender(e,n,i,r){return w(this,void 0,void 0,function*(){if(!this.pcManager)throw new Ue("publisher is closed");const o={direction:"sendonly"};r&&(o.sendEncodings=r);const s=yield this.pcManager.addPublisherTransceiver(n.mediaStreamTrack,o);if(i.videoCodec)return e.setSimulcastTrackSender(i.videoCodec,s.sender),s.sender})}createRTCRtpSender(e){return w(this,void 0,void 0,function*(){if(!this.pcManager)throw new Ue("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return w(this,void 0,void 0,function*(){var n,i,r;if(!this._isClosed){if(this.attemptingReconnect){ie.warn("already attempting reconnect, returning early",this.logContext);return}(((n=this.clientConfiguration)===null||n===void 0?void 0:n.resumeConnection)===Bi.DISABLED||((r=(i=this.pcManager)===null||i===void 0?void 0:i.currentState)!==null&&r!==void 0?r:Pe.NEW)===Pe.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(o){this.reconnectAttempts+=1;let s=!0;o instanceof Ue?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:o})),s=!1):o instanceof li||(this.fullReconnectOnNext=!0),s?this.handleDisconnect("reconnect",Zn.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(L.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(n){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:n}))}return null}restartConnection(e){return w(this,void 0,void 0,function*(){var n,i,r;try{if(!this.url||!this.token)throw new Ue("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(L.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let o;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new li;o=yield this.join(e??this.url,this.token,this.signalOpts)}catch(s){throw s instanceof me&&s.reason===oe.NotAllowed?new Ue("could not reconnect, token might be expired"):new li}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(L.SignalRestarted,o),yield this.waitForPCReconnected(),this.client.currentState!==ke.CONNECTED)throw new li("Signal connection got severed during reconnect");(n=this.regionUrlProvider)===null||n===void 0||n.resetAttempts(),this.emit(L.Restarted)}catch(o){const s=yield(i=this.regionUrlProvider)===null||i===void 0?void 0:i.getNextBestRegionUrl();if(s){yield this.restartConnection(s);return}else throw(r=this.regionUrlProvider)===null||r===void 0||r.resetAttempts(),o}})}resumeConnection(e){return w(this,void 0,void 0,function*(){var n;if(!this.url||!this.token)throw new Ue("could not reconnect, url or token not saved");if(!this.pcManager)throw new Ue("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(L.Resuming);let i;try{this.setupSignalClientCallbacks(),i=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(r){let o="";throw r instanceof Error&&(o=r.message,this.log.error(r.message,Object.assign(Object.assign({},this.logContext),{error:r}))),r instanceof me&&r.reason===oe.NotAllowed?new Ue("could not reconnect, token might be expired"):r instanceof me&&r.reason===oe.LeaveRequest?r:new li(o)}if(this.emit(L.SignalResumed),i){const r=this.makeRTCConfiguration(i);this.pcManager.updateConfiguration(r),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=i.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==ke.CONNECTED)throw new li("Signal connection got severed during reconnect");this.client.setReconnected(),((n=this.reliableDC)===null||n===void 0?void 0:n.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),i!=null&&i.lastMessageSeq&&this.resendReliableMessagesForResume(i.lastMessageSeq),this.emit(L.Resumed)})}waitForPCInitialConnection(e,n){return w(this,void 0,void 0,function*(){if(!this.pcManager)throw new Ue("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(n,e)})}waitForPCReconnected(){return w(this,void 0,void 0,function*(){this.pcState=kt.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield Xe(p0),!this.pcManager)throw new Ue("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=kt.Connected}catch(e){throw this.pcState=kt.Disconnected,new me("could not establish PC connection, ".concat(e.message),oe.InternalError)}})}publishRpcResponse(e,n,i,r){return w(this,void 0,void 0,function*(){const o=new Ye({destinationIdentities:[e],kind:Q.RELIABLE,value:{case:"rpcResponse",value:new gd({requestId:n,value:r?{case:"error",value:r.toProto()}:{case:"payload",value:i??""}})}});yield this.sendDataPacket(o,Q.RELIABLE)})}publishRpcAck(e,n){return w(this,void 0,void 0,function*(){const i=new Ye({destinationIdentities:[e],kind:Q.RELIABLE,value:{case:"rpcAck",value:new md({requestId:n})}});yield this.sendDataPacket(i,Q.RELIABLE)})}sendDataPacket(e,n){return w(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(n),n===Q.RELIABLE&&(e.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const i=e.toBinary(),r=this.dataChannelForKind(n);if(r){if(n===Q.RELIABLE&&this.reliableMessageBuffer.push({data:i,sequence:e.sequence}),this.attemptingReconnect)return;r.send(i)}this.updateAndEmitDCBufferStatus(n)})}resendReliableMessagesForResume(e){return w(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(Q.RELIABLE);const n=this.dataChannelForKind(Q.RELIABLE);n&&(this.reliableMessageBuffer.popToSequence(e),this.reliableMessageBuffer.getAll().forEach(i=>{n.send(i.data)})),this.updateAndEmitDCBufferStatus(Q.RELIABLE)})}waitForBufferStatusLow(e){return new Promise((n,i)=>w(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))n();else{const r=()=>i("Engine closed");for(this.once(L.Closing,r);!this.dcBufferStatus.get(e);)yield Xe(10);this.off(L.Closing,r),n()}}))}ensureDataTransportConnected(e){return w(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return(function*(){var o;if(!i.pcManager)throw new Ue("PC manager is closed");const s=r?i.pcManager.subscriber:i.pcManager.publisher,a=r?"Subscriber":"Publisher";if(!s)throw new me("".concat(a," connection not set"),oe.InternalError);let c=!1;!r&&!i.dataChannelForKind(n,r)&&(i.createDataChannels(),c=!0),!c&&!r&&!i.pcManager.publisher.isICEConnected&&i.pcManager.publisher.getICEConnectionState()!=="checking"&&(c=!0),c&&i.negotiate();const l=i.dataChannelForKind(n,r);if((l==null?void 0:l.readyState)==="open")return;const d=new Date().getTime()+i.peerConnectionTimeout;for(;new Date().getTime()<d;){if(s.isICEConnected&&((o=i.dataChannelForKind(n,r))===null||o===void 0?void 0:o.readyState)==="open")return;yield Xe(50)}throw new me("could not establish ".concat(a," connection, state: ").concat(s.getICEConnectionState()),oe.InternalError)})()})}ensurePublisherConnected(e){return w(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==Pe.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return w(this,void 0,void 0,function*(){return new Promise((e,n)=>w(this,void 0,void 0,function*(){if(!this.pcManager){n(new Ms("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const i=new AbortController,r=()=>{i.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&n("cannot negotiate on closed engine"),this.on(L.Closing,r),this.pcManager.publisher.once(ci.RTPVideoPayloadTypes,o=>{const s=new Map;o.forEach(a=>{const c=a.codec.toLowerCase();bb(c)&&s.set(a.payload,c)}),this.emit(L.RTPVideoMapUpdate,s)});try{yield this.pcManager.negotiate(i),e()}catch(o){o instanceof Ms&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",Zn.RR_UNKNOWN),n(o)}finally{this.off(L.Closing,r)}}))})}dataChannelForKind(e,n){if(n){if(e===Q.LOSSY)return this.lossyDCSub;if(e===Q.RELIABLE)return this.reliableDCSub}else{if(e===Q.LOSSY)return this.lossyDC;if(e===Q.RELIABLE)return this.reliableDC}}sendSyncState(e,n){var i,r;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const o=this.pcManager.subscriber.getLocalDescription(),s=this.pcManager.subscriber.getRemoteDescription(),a=(r=(i=this.signalOpts)===null||i===void 0?void 0:i.autoSubscribe)!==null&&r!==void 0?r:!0,c=new Array,l=new Array;e.forEach(d=>{d.isDesired!==a&&c.push(d.trackSid),d.isEnabled||l.push(d.trackSid)}),this.client.sendSyncState(new Nd({answer:o?Hr({sdp:o.sdp,type:o.type}):void 0,offer:s?Hr({sdp:s.sdp,type:s.type}):void 0,subscription:new Or({trackSids:c,subscribe:!a,participantTracks:[]}),publishTracks:Eb(n),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:l,datachannelReceiveStates:this.reliableReceivedState.map((d,u)=>new Ld({publisherSid:u,lastSeq:d}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],n=(i,r)=>{(i==null?void 0:i.id)!==void 0&&i.id!==null&&e.push(new Ud({label:i.label,id:i.id,target:r}))};return n(this.dataChannelForKind(Q.LOSSY),gt.PUBLISHER),n(this.dataChannelForKind(Q.RELIABLE),gt.PUBLISHER),n(this.dataChannelForKind(Q.LOSSY,!0),gt.SUBSCRIBER),n(this.dataChannelForKind(Q.RELIABLE,!0),gt.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&ze.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){Qe()&&window.addEventListener("online",this.handleBrowserOnLine)}deregisterOnLineListener(){Qe()&&window.removeEventListener("online",this.handleBrowserOnLine)}}class li extends Error{}function v0(t){return t!==void 0&&t>13}function b0(t,e){const n=t.participantIdentity?t.participantIdentity:e.participantIdentity;t.participantIdentity=n,e.participantIdentity=n;const i=t.destinationIdentities.length!==0?t.destinationIdentities:e.destinationIdentities;t.destinationIdentities=i,e.destinationIdentities=i}class ma{constructor(e,n){this.lastUpdateAt=0,this.settingsCacheTime=3e3,this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=n}updateToken(e){this.token=e}isCloud(){return zs(this.serverUrl)}getServerUrl(){return this.serverUrl}getNextBestRegionUrl(e){return w(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");(!this.regionSettings||Date.now()-this.lastUpdateAt>this.settingsCacheTime)&&(this.regionSettings=yield this.fetchRegionSettings(e));const n=this.regionSettings.regions.filter(i=>!this.attemptedRegions.find(r=>r.url===i.url));if(n.length>0){const i=n[0];return this.attemptedRegions.push(i),ie.debug("next region: ".concat(i.region)),i.url}else return null})}resetAttempts(){this.attemptedRegions=[]}fetchRegionSettings(e){return w(this,void 0,void 0,function*(){const n=yield fetch("".concat(y0(this.serverUrl),"/regions"),{headers:{authorization:"Bearer ".concat(this.token)},signal:e});if(n.ok){const i=yield n.json();return this.lastUpdateAt=Date.now(),i}else throw new me("Could not fetch region settings: ".concat(n.statusText),n.status===401?oe.NotAllowed:oe.InternalError,n.status)})}setServerReportedRegions(e){this.regionSettings=e,this.lastUpdateAt=Date.now()}}function y0(t){return"".concat(t.protocol.replace("ws","http"),"//").concat(t.host,"/settings")}class gh{get info(){return this._info}validateBytesReceived(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!(typeof this.totalByteSize!="number"||this.totalByteSize===0)){if(e&&this.bytesReceived<this.totalByteSize)throw new vn("Not enough chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, only received ").concat(this.bytesReceived," bytes"),bt.Incomplete);if(this.bytesReceived>this.totalByteSize)throw new vn("Extra chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, received ").concat(this.bytesReceived," bytes"),bt.LengthExceeded)}}constructor(e,n,i,r){this.reader=n,this.totalByteSize=i,this._info=e,this.bytesReceived=0,this.outOfBandFailureRejectingFuture=r}}class k0 extends gh{handleChunkReceived(e){var n;this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const i=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,i)}[Symbol.asyncIterator](){const e=this.reader.getReader();let n=new Mt,i=null,r=null;if(this.signal){const s=this.signal;r=()=>{var a;(a=n.reject)===null||a===void 0||a.call(n,s.reason)},s.addEventListener("abort",r),i=s}const o=()=>{e.releaseLock(),i&&r&&i.removeEventListener("abort",r),this.signal=void 0};return{next:()=>w(this,void 0,void 0,function*(){var s,a;try{const{done:c,value:l}=yield Promise.race([e.read(),n.promise,(a=(s=this.outOfBandFailureRejectingFuture)===null||s===void 0?void 0:s.promise)!==null&&a!==void 0?a:new Promise(()=>{})]);return c?(this.validateBytesReceived(!0),{done:!0,value:void 0}):(this.handleChunkReceived(l),{done:!1,value:l.content})}catch(c){throw o(),c}}),return(){return w(this,void 0,void 0,function*(){return o(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return w(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(function*(){var i,r,o,s;let a=new Set;const c=n.signal?e.withAbortSignal(n.signal):e;try{for(var l=!0,d=Yt(c),u;u=yield d.next(),i=u.done,!i;l=!0){s=u.value,l=!1;const h=s;a.add(h)}}catch(h){r={error:h}}finally{try{!l&&!i&&(o=d.return)&&(yield o.call(d))}finally{if(r)throw r.error}}return Array.from(a)})()})}}class w0 extends gh{constructor(e,n,i,r){super(e,n,i,r),this.receivedChunks=new Map}handleChunkReceived(e){var n;const i=$r(e.chunkIndex),r=this.receivedChunks.get(i);if(r&&r.version>e.version)return;this.receivedChunks.set(i,e),this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const o=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,o)}[Symbol.asyncIterator](){const e=this.reader.getReader(),n=new TextDecoder("utf-8",{fatal:!0});let i=new Mt,r=null,o=null;if(this.signal){const a=this.signal;o=()=>{var c;(c=i.reject)===null||c===void 0||c.call(i,a.reason)},a.addEventListener("abort",o),r=a}const s=()=>{e.releaseLock(),r&&o&&r.removeEventListener("abort",o),this.signal=void 0};return{next:()=>w(this,void 0,void 0,function*(){var a,c;try{const{done:l,value:d}=yield Promise.race([e.read(),i.promise,(c=(a=this.outOfBandFailureRejectingFuture)===null||a===void 0?void 0:a.promise)!==null&&c!==void 0?c:new Promise(()=>{})]);if(l)return this.validateBytesReceived(!0),{done:!0,value:void 0};{this.handleChunkReceived(d);let u;try{u=n.decode(d.content)}catch(h){throw new vn("Cannot decode datastream chunk ".concat(d.chunkIndex," as text: ").concat(h),bt.DecodeFailed)}return{done:!1,value:u}}}catch(l){throw s(),l}}),return(){return w(this,void 0,void 0,function*(){return s(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return w(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(function*(){var i,r,o,s;let a="";const c=n.signal?e.withAbortSignal(n.signal):e;try{for(var l=!0,d=Yt(c),u;u=yield d.next(),i=u.done,!i;l=!0)s=u.value,l=!1,a+=s}catch(h){r={error:h}}finally{try{!l&&!i&&(o=d.return)&&(yield o.call(d))}finally{if(r)throw r.error}}return a})()})}}class C0{constructor(){this.log=ie,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map}registerTextStreamHandler(e,n){if(this.textStreamHandlers.has(e))throw new vn('A text stream handler for topic "'.concat(e,'" has already been set.'),bt.HandlerAlreadyRegistered);this.textStreamHandlers.set(e,n)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,n){if(this.byteStreamHandlers.has(e))throw new vn('A byte stream handler for topic "'.concat(e,'" has already been set.'),bt.HandlerAlreadyRegistered);this.byteStreamHandlers.set(e,n)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}clearHandlersAndControllers(){this.byteStreamControllers.clear(),this.textStreamControllers.clear(),this.byteStreamHandlers.clear(),this.textStreamHandlers.clear()}validateParticipantHasNoActiveDataStreams(e){var n,i,r,o;const s=Array.from(this.textStreamControllers.entries()).filter(c=>c[1].sendingParticipantIdentity===e),a=Array.from(this.byteStreamControllers.entries()).filter(c=>c[1].sendingParticipantIdentity===e);if(s.length>0||a.length>0){const c=new vn("Participant ".concat(e," unexpectedly disconnected in the middle of sending data"),bt.AbnormalEnd);for(const[l,d]of a)(i=(n=d.outOfBandFailureRejectingFuture).reject)===null||i===void 0||i.call(n,c),this.byteStreamControllers.delete(l);for(const[l,d]of s)(o=(r=d.outOfBandFailureRejectingFuture).reject)===null||o===void 0||o.call(r,c),this.textStreamControllers.delete(l)}}handleDataStreamPacket(e){return w(this,void 0,void 0,function*(){switch(e.value.case){case"streamHeader":return this.handleStreamHeader(e.value.value,e.participantIdentity);case"streamChunk":return this.handleStreamChunk(e.value.value);case"streamTrailer":return this.handleStreamTrailer(e.value.value);default:throw new Error('DataPacket of value "'.concat(e.value.case,'" is not data stream related!'))}})}handleStreamHeader(e,n){return w(this,void 0,void 0,function*(){var i;if(e.contentHeader.case==="byteHeader"){const r=this.byteStreamHandlers.get(e.topic);if(!r){this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);return}let o;const s=new Mt,a={id:e.streamId,name:(i=e.contentHeader.value.name)!==null&&i!==void 0?i:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:$r(e.timestamp),attributes:e.attributes},c=new ReadableStream({start:l=>{if(o=l,this.textStreamControllers.has(e.streamId))throw new vn("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),bt.AlreadyOpened);this.byteStreamControllers.set(e.streamId,{info:a,controller:o,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:s})}});r(new k0(a,c,$r(e.totalLength),s),{identity:n})}else if(e.contentHeader.case==="textHeader"){const r=this.textStreamHandlers.get(e.topic);if(!r){this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);return}let o;const s=new Mt,a={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes},c=new ReadableStream({start:l=>{if(o=l,this.textStreamControllers.has(e.streamId))throw new vn("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),bt.AlreadyOpened);this.textStreamControllers.set(e.streamId,{info:a,controller:o,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:s})}});r(new w0(a,c,$r(e.totalLength),s),{identity:n})}})}handleStreamChunk(e){const n=this.byteStreamControllers.get(e.streamId);n&&e.content.length>0&&n.controller.enqueue(e);const i=this.textStreamControllers.get(e.streamId);i&&e.content.length>0&&i.controller.enqueue(e)}handleStreamTrailer(e){const n=this.textStreamControllers.get(e.streamId);n&&(n.info.attributes=Object.assign(Object.assign({},n.info.attributes),e.attributes),n.controller.close(),this.textStreamControllers.delete(e.streamId));const i=this.byteStreamControllers.get(e.streamId);i&&(i.info.attributes=Object.assign(Object.assign({},i.info.attributes),e.attributes),i.controller.close(),this.byteStreamControllers.delete(e.streamId))}}class vh{constructor(e,n,i){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=i,this.info=n}write(e){return this.defaultWriter.write(e)}close(){return w(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(e=this.onClose)===null||e===void 0||e.call(this)})}}class _0 extends vh{}class S0 extends vh{}const bh=15e3;class T0{constructor(e,n){this.engine=e,this.log=n}setupEngine(e){this.engine=e}sendText(e,n){return w(this,void 0,void 0,function*(){var i;const r=crypto.randomUUID(),s=new TextEncoder().encode(e).byteLength,a=(i=n==null?void 0:n.attachments)===null||i===void 0?void 0:i.map(()=>crypto.randomUUID()),c=new Array(a?a.length+1:1).fill(0),l=(u,h)=>{var f;c[h]=u;const g=c.reduce((p,v)=>p+v,0);(f=n==null?void 0:n.onProgress)===null||f===void 0||f.call(n,g)},d=yield this.streamText({streamId:r,totalSize:s,destinationIdentities:n==null?void 0:n.destinationIdentities,topic:n==null?void 0:n.topic,attachedStreamIds:a,attributes:n==null?void 0:n.attributes});return yield d.write(e),l(1,0),yield d.close(),n!=null&&n.attachments&&a&&(yield Promise.all(n.attachments.map((u,h)=>w(this,void 0,void 0,function*(){return this._sendFile(a[h],u,{topic:n.topic,mimeType:u.type,onProgress:f=>{l(f,h+1)}})})))),d.info})}streamText(e){return w(this,void 0,void 0,function*(){var n,i;const r=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),o={id:r,mimeType:"text/plain",timestamp:Date.now(),topic:(i=e==null?void 0:e.topic)!==null&&i!==void 0?i:"",size:e==null?void 0:e.totalSize,attributes:e==null?void 0:e.attributes},s=new hs({streamId:r,mimeType:o.mimeType,topic:o.topic,timestamp:Fn(o.timestamp),totalLength:Fn(e==null?void 0:e.totalSize),attributes:o.attributes,contentHeader:{case:"textHeader",value:new Td({version:e==null?void 0:e.version,attachedStreamIds:e==null?void 0:e.attachedStreamIds,replyToStreamId:e==null?void 0:e.replyToStreamId,operationType:(e==null?void 0:e.type)==="update"?us.UPDATE:us.CREATE})}}),a=e==null?void 0:e.destinationIdentities,c=new Ye({destinationIdentities:a,value:{case:"streamHeader",value:s}});yield this.engine.sendDataPacket(c,Q.RELIABLE);let l=0;const d=this.engine,u=new WritableStream({write(g){return w(this,void 0,void 0,function*(){for(const p of Sb(g,bh)){yield d.waitForBufferStatusLow(Q.RELIABLE);const v=new fs({content:p,streamId:r,chunkIndex:Fn(l)}),b=new Ye({destinationIdentities:a,value:{case:"streamChunk",value:v}});yield d.sendDataPacket(b,Q.RELIABLE),l+=1}})},close(){return w(this,void 0,void 0,function*(){const g=new ps({streamId:r}),p=new Ye({destinationIdentities:a,value:{case:"streamTrailer",value:g}});yield d.sendDataPacket(p,Q.RELIABLE)})},abort(g){console.log("Sink error:",g)}});let h=()=>w(this,void 0,void 0,function*(){yield f.close()});d.once(L.Closing,h);const f=new _0(u,o,()=>this.engine.off(L.Closing,h));return f})}sendFile(e,n){return w(this,void 0,void 0,function*(){const i=crypto.randomUUID();return yield this._sendFile(i,e,n),{id:i}})}_sendFile(e,n,i){return w(this,void 0,void 0,function*(){var r;const o=yield this.streamBytes({streamId:e,totalSize:n.size,name:n.name,mimeType:(r=i==null?void 0:i.mimeType)!==null&&r!==void 0?r:n.type,topic:i==null?void 0:i.topic,destinationIdentities:i==null?void 0:i.destinationIdentities}),s=n.stream().getReader();for(;;){const{done:a,value:c}=yield s.read();if(a)break;yield o.write(c)}return yield o.close(),o.info})}streamBytes(e){return w(this,void 0,void 0,function*(){var n,i,r,o,s;const a=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),c=e==null?void 0:e.destinationIdentities,l={id:a,mimeType:(i=e==null?void 0:e.mimeType)!==null&&i!==void 0?i:"application/octet-stream",topic:(r=e==null?void 0:e.topic)!==null&&r!==void 0?r:"",timestamp:Date.now(),attributes:e==null?void 0:e.attributes,size:e==null?void 0:e.totalSize,name:(o=e==null?void 0:e.name)!==null&&o!==void 0?o:"unknown"},d=new hs({totalLength:Fn((s=l.size)!==null&&s!==void 0?s:0),mimeType:l.mimeType,streamId:a,topic:l.topic,timestamp:Fn(Date.now()),attributes:l.attributes,contentHeader:{case:"byteHeader",value:new xd({name:l.name})}}),u=new Ye({destinationIdentities:c,value:{case:"streamHeader",value:d}});yield this.engine.sendDataPacket(u,Q.RELIABLE);let h=0;const f=new Ke,g=this.engine,p=this.log,v=new WritableStream({write(k){return w(this,void 0,void 0,function*(){const C=yield f.lock();let y=0;try{for(;y<k.byteLength;){const _=k.slice(y,y+bh);yield g.waitForBufferStatusLow(Q.RELIABLE);const S=new Ye({destinationIdentities:c,value:{case:"streamChunk",value:new fs({content:_,streamId:a,chunkIndex:Fn(h)})}});yield g.sendDataPacket(S,Q.RELIABLE),h+=1,y+=_.byteLength}}finally{C()}})},close(){return w(this,void 0,void 0,function*(){const k=new ps({streamId:a}),C=new Ye({destinationIdentities:c,value:{case:"streamTrailer",value:k}});yield g.sendDataPacket(C,Q.RELIABLE)})},abort(k){p.error("Sink error:",k)}});return new S0(v,l)})}}class yh extends R{constructor(e,n,i,r,o){super(e,i,o),this.sid=n,this.receiver=r}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?N.Muted:N.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const n=i=>{i.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",n),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(N.Ended,this))};e.addEventListener("removetrack",n)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return w(this,void 0,void 0,function*(){var e;return!((e=this.receiver)===null||e===void 0)&&e.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),la)),Pb()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var n;this.timeSyncHandle=requestAnimationFrame(()=>e());const i=(n=this.receiver)===null||n===void 0?void 0:n.getSynchronizationSources()[0];if(i){const{timestamp:r,rtpTimestamp:o}=i;o&&this.rtpTimestamp!==o&&(this.emit(N.TimeSyncUpdate,{timestamp:r,rtpTimestamp:o}),this.rtpTimestamp=o)}};e()}}class x0 extends yh{constructor(e,n,i,r,o,s){super(e,n,R.Kind.Audio,i,s),this.monitorReceiver=()=>w(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const a=yield this.getReceiverStats();a&&this.prevStats&&this.receiver&&(this._currentBitrate=Gr(a,this.prevStats)),this.prevStats=a}),this.audioContext=r,this.webAudioPluginNodes=[],o&&(this.sinkId=o.deviceId)}setVolume(e){var n;for(const i of this.attachedElements)this.audioContext?(n=this.gainNode)===null||n===void 0||n.gain.setTargetAtTime(e,0,.1):i.volume=e;Dt()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(Dt())return 1;let e=0;return this.attachedElements.forEach(n=>{n.volume>e&&(e=n.volume)}),e}setSinkId(e){return w(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(n=>{if(qs(n))return n.setSinkId(e)}))})}attach(e){const n=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.sinkId&&qs(e)&&e.setSinkId(this.sinkId).catch(i=>{this.log.error("Failed to set sink id on remote audio track",i,this.logContext)}),this.audioContext&&n&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let n;return e?(n=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(n=super.detach(),this.disconnectWebAudio()),n}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,n){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(n.srcObject);let i=this.sourceNode;this.webAudioPluginNodes.forEach(r=>{i.connect(r),i=r}),this.gainNode=e.createGain(),i.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit(N.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(r=>{this.emit(N.AudioPlaybackFailed,r)})}disconnectWebAudio(){var e,n;(e=this.gainNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return w(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n;return e.forEach(i=>{i.type==="inbound-rtp"&&(n={type:"audio",streamId:i.id,timestamp:i.timestamp,jitter:i.jitter,bytesReceived:i.bytesReceived,concealedSamples:i.concealedSamples,concealmentEvents:i.concealmentEvents,silentConcealedSamples:i.silentConcealedSamples,silentConcealmentEvents:i.silentConcealmentEvents,totalAudioEnergy:i.totalAudioEnergy,totalSamplesDuration:i.totalSamplesDuration})}),n})}}const ga=100;class E0 extends yh{constructor(e,n,i,r,o){super(e,n,R.Kind.Video,i,o),this.elementInfos=[],this.monitorReceiver=()=>w(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const s=yield this.getReceiverStats();s&&this.prevStats&&this.receiver&&(this._currentBitrate=Gr(s,this.prevStats)),this.prevStats=s}),this.debouncedHandleResize=oa(()=>{this.updateDimensions()},ga),this.adaptiveStreamSettings=r}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(n=>{e?oi(this._mediaStreamTrack,n):ri(this._mediaStreamTrack,n)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(n=>n.element===e)===void 0){const n=new P0(e);this.observeElementInfo(n)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(n=>n===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const n=this.elementInfos.filter(i=>i===e);for(const i of n)i.stopObserving();this.elementInfos=this.elementInfos.filter(i=>i!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let n=[];if(e)return this.stopObservingElement(e),super.detach(e);n=super.detach();for(const i of n)this.stopObservingElement(i);return n}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return w(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n,i="",r=new Map;return e.forEach(o=>{o.type==="inbound-rtp"?(i=o.codecId,n={type:"video",streamId:o.id,framesDecoded:o.framesDecoded,framesDropped:o.framesDropped,framesReceived:o.framesReceived,packetsReceived:o.packetsReceived,packetsLost:o.packetsLost,frameWidth:o.frameWidth,frameHeight:o.frameHeight,pliCount:o.pliCount,firCount:o.firCount,nackCount:o.nackCount,jitter:o.jitter,timestamp:o.timestamp,bytesReceived:o.bytesReceived,decoderImplementation:o.decoderImplementation}):o.type==="codec"&&r.set(o.id,o)}),n&&i!==""&&r.get(i)&&(n.mimeType=r.get(i).mimeType),n})}stopObservingElement(e){const n=this.elementInfos.filter(i=>i.element===e);for(const i of n)this.stopObservingElementInfo(i)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return w(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(){var e,n;const i=this.elementInfos.reduce((a,c)=>Math.max(a,c.visibilityChangedAt||0),0),r=!((n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pauseVideoInBackground)!==null&&n!==void 0)||n?this.isInBackground:!1,o=this.elementInfos.some(a=>a.pictureInPicture),s=this.elementInfos.some(a=>a.visible)&&!r||o;if(this.lastVisible!==s){if(!s&&Date.now()-i<ga){ze.setTimeout(()=>{this.updateVisibility()},ga);return}this.lastVisible=s,this.emit(N.VisibilityChanged,s,this)}}updateDimensions(){var e,n;let i=0,r=0;const o=this.getPixelDensity();for(const s of this.elementInfos){const a=s.width()*o,c=s.height()*o;a+c>i+r&&(i=a,r=c)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===i&&((n=this.lastDimensions)===null||n===void 0?void 0:n.height)===r||(this.lastDimensions={width:i,height:r},this.emit(N.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return n==="screen"?Uu():n||(Uu()>2?2:1)}}class P0{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,n){this.onVisibilityChanged=i=>{var r;const{target:o,isIntersecting:s}=i;o===this.element&&(this.isIntersecting=s,this.isPiP=Ki(this.element),this.visibilityChangedAt=Date.now(),(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this))},this.onEnterPiP=()=>{var i,r,o;(r=(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window)===null||r===void 0||r.addEventListener("pagehide",this.onLeavePiP),this.isPiP=Ki(this.element),(o=this.handleVisibilityChanged)===null||o===void 0||o.call(this)},this.onLeavePiP=()=>{var i;this.isPiP=Ki(this.element),(i=this.handleVisibilityChanged)===null||i===void 0||i.call(this)},this.element=e,this.isIntersecting=n??va(e),this.isPiP=Qe()&&Ki(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,n,i;this.isIntersecting=va(this.element),this.isPiP=Ki(this.element),this.element.handleResize=()=>{var r;(r=this.handleResize)===null||r===void 0||r.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,Bu().observe(this.element),Fu().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(e=window.documentPictureInPicture)===null||e===void 0||e.addEventListener("enter",this.onEnterPiP),(i=(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window)===null||i===void 0||i.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,n,i,r,o;(e=Bu())===null||e===void 0||e.unobserve(this.element),(n=Fu())===null||n===void 0||n.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(i=window.documentPictureInPicture)===null||i===void 0||i.removeEventListener("enter",this.onEnterPiP),(o=(r=window.documentPictureInPicture)===null||r===void 0?void 0:r.window)===null||o===void 0||o.removeEventListener("pagehide",this.onLeavePiP)}}function Ki(t){var e,n;return document.pictureInPictureElement===t?!0:!((e=window.documentPictureInPicture)===null||e===void 0)&&e.window?va(t,(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window):!1}function va(t,e){const n=e||window;let i=t.offsetTop,r=t.offsetLeft;const o=t.offsetWidth,s=t.offsetHeight,{hidden:a}=t,{display:c}=getComputedStyle(t);for(;t.offsetParent;)t=t.offsetParent,i+=t.offsetTop,r+=t.offsetLeft;return i<n.pageYOffset+n.innerHeight&&r<n.pageXOffset+n.innerWidth&&i+s>n.pageYOffset&&r+o>n.pageXOffset&&!a&&c!=="none"}class en extends It.EventEmitter{constructor(e,n,i,r){var o;super(),this.metadataMuted=!1,this.encryption=ot.NONE,this.log=ie,this.handleMuted=()=>{this.emit(N.Muted)},this.handleUnmuted=()=>{this.emit(N.Unmuted)},this.log=Jt((o=r==null?void 0:r.loggerName)!==null&&o!==void 0?o:vt.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=n,this.trackName=i,this.source=R.Source.Unknown}setTrack(e){this.track&&(this.track.off(N.Muted,this.handleMuted),this.track.off(N.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(N.Muted,this.handleMuted),e.on(N.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),te(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==ot.NONE}get audioTrack(){if(Nt(this.track))return this.track}get videoTrack(){if(Bn(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=R.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===R.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}(function(t){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(t.SubscriptionStatus||(t.SubscriptionStatus={})),(function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"})(t.PermissionStatus||(t.PermissionStatus={}))})(en||(en={}));class ba extends en{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.handleTrackEnded=()=>{this.emit(N.Ended)},this.handleCpuConstrained=()=>{this.track&&Bn(this.track)&&this.emit(N.CpuConstrained,this.track)},this.updateInfo(n),this.setTrack(i)}setTrack(e){this.track&&(this.track.off(N.Ended,this.handleTrackEnded),this.track.off(N.CpuConstrained,this.handleCpuConstrained)),super.setTrack(e),e&&(e.on(N.Ended,this.handleTrackEnded),e.on(N.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return w(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){return w(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){return w(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){return w(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(Nt(this.track)){const n=this.track.getSourceTrackSettings(),i=new Set;return n.autoGainControl&&i.add(je.TF_AUTO_GAIN_CONTROL),n.echoCancellation&&i.add(je.TF_ECHO_CANCELLATION),n.noiseSuppression&&i.add(je.TF_NOISE_SUPPRESSION),n.channelCount&&n.channelCount>1&&i.add(je.TF_STEREO),!((e=this.options)===null||e===void 0)&&e.dtx||i.add(je.TF_NO_DTX),this.track.enhancedNoiseCancellation&&i.add(je.TF_ENHANCED_NOISE_CANCELLATION),Array.from(i.values())}else return[]}}function Yr(t,e){return w(this,void 0,void 0,function*(){t??(t={});let n=!1;const{audioProcessor:i,videoProcessor:r,optionsWithoutProcessor:o}=Wu(t);let s=o.audio,a=o.video;if(i&&typeof o.audio=="object"&&(o.audio.processor=i),r&&typeof o.video=="object"&&(o.video.processor=r),t.audio&&typeof o.audio=="object"&&typeof o.audio.deviceId=="string"){const u=o.audio.deviceId;o.audio.deviceId={exact:u},n=!0,s=Object.assign(Object.assign({},o.audio),{deviceId:{ideal:u}})}if(o.video&&typeof o.video=="object"&&typeof o.video.deviceId=="string"){const u=o.video.deviceId;o.video.deviceId={exact:u},n=!0,a=Object.assign(Object.assign({},o.video),{deviceId:{ideal:u}})}(o.audio===!0||typeof o.audio=="object"&&!o.audio.deviceId)&&(o.audio={deviceId:"default"}),o.video===!0?o.video={deviceId:"default"}:typeof o.video=="object"&&!o.video.deviceId&&(o.video.deviceId="default");const c=qu(o,ih,rh),l=Xs(c),d=navigator.mediaDevices.getUserMedia(l);o.audio&&(Ve.userMediaPromiseMap.set("audioinput",d),d.catch(()=>Ve.userMediaPromiseMap.delete("audioinput"))),o.video&&(Ve.userMediaPromiseMap.set("videoinput",d),d.catch(()=>Ve.userMediaPromiseMap.delete("videoinput")));try{const u=yield d;return yield Promise.all(u.getTracks().map(h=>w(this,void 0,void 0,function*(){const f=h.kind==="audio";let g=f?c.audio:c.video;(typeof g=="boolean"||!g)&&(g={});let p;const v=f?l.audio:l.video;typeof v!="boolean"&&(p=v);const b=h.getSettings().deviceId;p!=null&&p.deviceId&&bn(p.deviceId)!==b?p.deviceId=b:p||(p={deviceId:b});const k=n0(h,p,e);return k.kind===R.Kind.Video?k.source=R.Source.Camera:k.kind===R.Kind.Audio&&(k.source=R.Source.Microphone),k.mediaStream=u,Nt(k)&&i?yield k.setProcessor(i):Bn(k)&&r&&(yield k.setProcessor(r)),k})))}catch(u){if(!n)throw u;return Yr(Object.assign(Object.assign({},t),{audio:s,video:a}),e)}})}function R0(t){return w(this,void 0,void 0,function*(){return(yield Yr({audio:!1,video:!0}))[0]})}function kh(t){return w(this,void 0,void 0,function*(){return(yield Yr({audio:t??!0,video:!1}))[0]})}var wn;(function(t){t.Excellent="excellent",t.Good="good",t.Poor="poor",t.Lost="lost",t.Unknown="unknown"})(wn||(wn={}));function I0(t){switch(t){case Fi.EXCELLENT:return wn.Excellent;case Fi.GOOD:return wn.Good;case Fi.POOR:return wn.Poor;case Fi.LOST:return wn.Lost;default:return wn.Unknown}}class wh extends It.EventEmitter{get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return((e=this.permissions)===null||e===void 0?void 0:e.agent)||this.kind===ji.AGENT}get isActive(){var e;return((e=this.participantInfo)===null||e===void 0?void 0:e.state)===ei.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,n,i,r,o,s){let a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:ji.STANDARD;var c;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=wn.Unknown,this.log=ie,this.log=Jt((c=s==null?void 0:s.loggerName)!==null&&c!==void 0?c:vt.Participant),this.loggerOptions=s,this.setMaxListeners(100),this.sid=e,this.identity=n,this.name=i,this.metadata=r,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=a,this._attributes=o??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,n]of this.trackPublications)if(n.source===e)return n}getTrackPublicationByName(e){for(const[,n]of this.trackPublications)if(n.trackName===e)return n}waitUntilActive(){return this.isActive?Promise.resolve():this.activeFuture?this.activeFuture.promise:(this.activeFuture=new Mt,this.once(U.Active,()=>{var e,n;(n=(e=this.activeFuture)===null||e===void 0?void 0:e.resolve)===null||n===void 0||n.call(e),this.activeFuture=void 0}),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const n=this.getTrackPublication(R.Source.Camera);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const n=this.getTrackPublication(R.Source.Microphone);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(R.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){var n;return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.state===ei.ACTIVE&&((n=this.participantInfo)===null||n===void 0?void 0:n.state)!==ei.ACTIVE&&this.emit(U.Active),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,!0)}_setMetadata(e){const n=this.metadata!==e,i=this.metadata;this.metadata=e,n&&this.emit(U.ParticipantMetadataChanged,i)}_setName(e){const n=this.name!==e;this.name=e,n&&this.emit(U.ParticipantNameChanged,e)}_setAttributes(e){const n=Rb(this.attributes,e);this._attributes=e,Object.keys(n).length>0&&this.emit(U.AttributesChanged,n)}setPermissions(e){var n,i,r,o,s,a;const c=this.permissions,l=e.canPublish!==((n=this.permissions)===null||n===void 0?void 0:n.canPublish)||e.canSubscribe!==((i=this.permissions)===null||i===void 0?void 0:i.canSubscribe)||e.canPublishData!==((r=this.permissions)===null||r===void 0?void 0:r.canPublishData)||e.hidden!==((o=this.permissions)===null||o===void 0?void 0:o.hidden)||e.recorder!==((s=this.permissions)===null||s===void 0?void 0:s.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((d,u)=>{var h;return d!==((h=this.permissions)===null||h===void 0?void 0:h.canPublishSources[u])})||e.canSubscribeMetrics!==((a=this.permissions)===null||a===void 0?void 0:a.canSubscribeMetrics);return this.permissions=e,l&&this.emit(U.ParticipantPermissionsChanged,c),l}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(U.IsSpeakingChanged,e))}setConnectionQuality(e){const n=this._connectionQuality;this._connectionQuality=I0(e),n!==this._connectionQuality&&this.emit(U.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var e,n;this.activeFuture&&((n=(e=this.activeFuture).reject)===null||n===void 0||n.call(e,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(n=>Nt(n.track)&&n.track.setAudioContext(e))}addTrackPublication(e){e.on(N.Muted,()=>{this.emit(U.TrackMuted,e)}),e.on(N.Unmuted,()=>{this.emit(U.TrackUnmuted,e)});const n=e;switch(n.track&&(n.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case R.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case R.Kind.Video:this.videoTrackPublications.set(e.trackSid,e);break}}}function O0(t){var e,n,i;if(!t.participantSid&&!t.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new Ad({participantIdentity:(e=t.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(n=t.participantSid)!==null&&n!==void 0?n:"",allTracks:(i=t.allowAll)!==null&&i!==void 0?i:!1,trackSids:t.allowedTrackSids||[]})}class D0 extends wh{constructor(e,n,i,r,o,s){super(e,n,void 0,void 0,void 0,{loggerName:r.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=ot.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new Mt)},this.handleReconnected=()=>{var a,c;(c=(a=this.reconnectFuture)===null||a===void 0?void 0:a.resolve)===null||c===void 0||c.call(a),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleClosing=()=>{var a,c,l,d,u,h;this.reconnectFuture&&(this.reconnectFuture.promise.catch(f=>this.log.warn(f.message,this.logContext)),(c=(a=this.reconnectFuture)===null||a===void 0?void 0:a.reject)===null||c===void 0||c.call(a,"Got disconnected during reconnection attempt"),this.reconnectFuture=void 0),this.signalConnectedFuture&&((d=(l=this.signalConnectedFuture).reject)===null||d===void 0||d.call(l,"Got disconnected without signal connected"),this.signalConnectedFuture=void 0),(h=(u=this.activeAgentFuture)===null||u===void 0?void 0:u.reject)===null||h===void 0||h.call(u,"Got disconnected without active agent present"),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=a=>{var c,l;a.participant&&this.updateInfo(a.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new Mt),(l=(c=this.signalConnectedFuture).resolve)===null||l===void 0||l.call(c)},this.handleSignalRequestResponse=a=>{const{requestId:c,reason:l,message:d}=a,u=this.pendingSignalRequests.get(c);u&&(l!==Cs.OK&&u.reject(new Iu(d,l)),this.pendingSignalRequests.delete(c))},this.handleDataPacket=a=>{switch(a.value.case){case"rpcResponse":let c=a.value.value,l=null,d=null;c.value.case==="payload"?l=c.value.value:c.value.case==="error"&&(d=Re.fromProto(c.value.value)),this.handleIncomingRpcResponse(c.requestId,l,d);break;case"rpcAck":let u=a.value.value;this.handleIncomingRpcAck(u.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(a=>O0(a)))},this.onTrackUnmuted=a=>{this.onTrackMuted(a,a.isUpstreamPaused)},this.onTrackMuted=(a,c)=>{if(c===void 0&&(c=!0),!a.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),te(a)));return}this.engine.updateMuteStatus(a.sid,c)},this.onTrackUpstreamPaused=a=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),te(a))),this.onTrackMuted(a,!0)},this.onTrackUpstreamResumed=a=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),te(a))),this.onTrackMuted(a,a.isMuted)},this.onTrackFeatureUpdate=a=>{const c=this.audioTrackPublications.get(a.sid);if(!c){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(a.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(c.trackSid,c.getTrackFeatures())},this.onTrackCpuConstrained=(a,c)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),te(c))),this.emit(U.LocalTrackCpuConstrained,a,c)},this.handleSubscribedQualityUpdate=a=>w(this,void 0,void 0,function*(){var c,l,d,u,h;if(!(!((h=this.roomOptions)===null||h===void 0)&&h.dynacast))return;const f=this.videoTrackPublications.get(a.trackSid);if(!f){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:a.trackSid}));return}if(!f.videoTrack)return;const g=yield f.videoTrack.setPublishingCodecs(a.subscribedCodecs);try{for(var p=!0,v=Yt(g),b;b=yield v.next(),c=b.done,!c;p=!0){u=b.value,p=!1;const k=u;sb(k)&&(this.log.debug("publish ".concat(k," for ").concat(f.videoTrack.sid),Object.assign(Object.assign({},this.logContext),te(f))),yield this.publishAdditionalCodecForTrack(f.videoTrack,k,f.options))}}catch(k){l={error:k}}finally{try{!p&&!c&&(d=v.return)&&(yield d.call(v))}finally{if(l)throw l.error}}}),this.handleLocalTrackUnpublished=a=>{const c=this.trackPublications.get(a.trackSid);if(!c){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:a.trackSid}));return}this.unpublishTrack(c.track)},this.handleTrackEnded=a=>w(this,void 0,void 0,function*(){if(a.source===R.Source.ScreenShare||a.source===R.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),te(a))),this.unpublishTrack(a);else if(a.isUserProvided)yield a.mute();else if(Zt(a)||yn(a))try{if(Qe())try{const c=yield navigator==null?void 0:navigator.permissions.query({name:a.source===R.Source.Camera?"camera":"microphone"});if(c&&c.state==="denied")throw this.log.warn("user has revoked access to ".concat(a.source),Object.assign(Object.assign({},this.logContext),te(a))),c.onchange=()=>{c.state!=="denied"&&(a.isMuted||a.restartTrack(),c.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}a.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),te(a))),Zt(a)?yield a.restartTrack({deviceId:"default"}):yield a.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),te(a))),yield a.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=i,this.roomOptions=r,this.setupEngine(i),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=o,this.roomOutgoingDataStreamManager=s}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==ot.NONE}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setupEngine(e){var n;this.engine=e,this.engine.on(L.RemoteMute,(i,r)=>{const o=this.trackPublications.get(i);!o||!o.track||(r?o.mute():o.unmute())}),!((n=this.signalConnectedFuture)===null||n===void 0)&&n.isResolved&&(this.signalConnectedFuture=void 0),this.engine.on(L.Connected,this.handleReconnected).on(L.SignalConnected,this.handleSignalConnected).on(L.SignalRestarted,this.handleReconnected).on(L.SignalResumed,this.handleReconnected).on(L.Restarting,this.handleReconnecting).on(L.Resuming,this.handleReconnecting).on(L.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(L.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(L.Closing,this.handleClosing).on(L.SignalRequestResponse,this.handleSignalRequestResponse).on(L.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return w(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return w(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return w(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return w(this,arguments,void 0,function(n){var i=this;let{metadata:r,name:o,attributes:s}=n;return(function*(){return new Promise((a,c)=>w(i,void 0,void 0,function*(){var l,d;try{let u=!1;const h=yield this.engine.client.sendUpdateLocalMetadata((l=r??this.metadata)!==null&&l!==void 0?l:"",(d=o??this.name)!==null&&d!==void 0?d:"",s),f=performance.now();for(this.pendingSignalRequests.set(h,{resolve:a,reject:g=>{c(g),u=!0},values:{name:o,metadata:r,attributes:s}});performance.now()-f<5e3&&!u;){if((!o||this.name===o)&&(!r||this.metadata===r)&&(!s||Object.entries(s).every(g=>{let[p,v]=g;return this.attributes[p]===v||v===""&&!this.attributes[p]}))){this.pendingSignalRequests.delete(h),a();return}yield Xe(50)}c(new Iu("Request to update local metadata timed out","TimeoutError"))}catch(u){u instanceof Error&&c(u)}}))})()})}setCameraEnabled(e,n,i){return this.setTrackEnabled(R.Source.Camera,e,n,i)}setMicrophoneEnabled(e,n,i){return this.setTrackEnabled(R.Source.Microphone,e,n,i)}setScreenShareEnabled(e,n,i){return this.setTrackEnabled(R.Source.ScreenShare,e,n,i)}setPermissions(e){const n=this.permissions,i=super.setPermissions(e);return i&&n&&this.emit(U.ParticipantPermissionsChanged,n),i}setE2EEEnabled(e){return w(this,void 0,void 0,function*(){this.encryptionType=e?ot.GCM:ot.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,n,i,r){return w(this,void 0,void 0,function*(){var o,s;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:n})),this.republishPromise&&(yield this.republishPromise);let a=this.getTrackPublication(e);if(n)if(a)yield a.unmute();else{let c;if(this.pendingPublishing.has(e)){const l=yield this.waitForPendingPublicationOfSource(e);return l||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield l==null?void 0:l.unmute(),l}this.pendingPublishing.add(e);try{switch(e){case R.Source.Camera:c=yield this.createTracks({video:(o=i)!==null&&o!==void 0?o:!0});break;case R.Source.Microphone:c=yield this.createTracks({audio:(s=i)!==null&&s!==void 0?s:!0});break;case R.Source.ScreenShare:c=yield this.createScreenTracks(Object.assign({},i));break;default:throw new Qt(e)}}catch(l){throw c==null||c.forEach(d=>{d.stop()}),l instanceof Error&&this.emit(U.MediaDevicesError,l,Qs(e)),this.pendingPublishing.delete(e),l}for(const l of c){const d=Object.assign(Object.assign({},this.roomOptions.publishDefaults),i);e===R.Source.Microphone&&Nt(l)&&d.preConnectBuffer&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),l.startPreConnectBuffer())}try{const l=[];for(const u of c)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),te(u))),l.push(this.publishTrack(u,r));[a]=yield Promise.all(l)}catch(l){throw c==null||c.forEach(d=>{d.stop()}),l}finally{this.pendingPublishing.delete(e)}}else if(!(a!=null&&a.track)&&this.pendingPublishing.has(e)&&(a=yield this.waitForPendingPublicationOfSource(e),a||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),a&&a.track)if(e===R.Source.ScreenShare){a=yield this.unpublishTrack(a.track);const c=this.getTrackPublication(R.Source.ScreenShareAudio);c&&c.track&&this.unpublishTrack(c.track)}else yield a.mute();return a})}enableCameraAndMicrophone(){return w(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(R.Source.Camera)||this.pendingPublishing.has(R.Source.Microphone))){this.pendingPublishing.add(R.Source.Camera),this.pendingPublishing.add(R.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(n=>this.publishTrack(n)))}finally{this.pendingPublishing.delete(R.Source.Camera),this.pendingPublishing.delete(R.Source.Microphone)}}})}createTracks(e){return w(this,void 0,void 0,function*(){var n,i;e??(e={});const r=qu(e,(n=this.roomOptions)===null||n===void 0?void 0:n.audioCaptureDefaults,(i=this.roomOptions)===null||i===void 0?void 0:i.videoCaptureDefaults);try{return(yield Yr(r,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(a=>(Nt(a)&&(this.microphoneError=void 0,a.setAudioContext(this.audioContext),a.source=R.Source.Microphone,this.emit(U.AudioStreamAcquired)),Bn(a)&&(this.cameraError=void 0,a.source=R.Source.Camera),a))}catch(o){throw o instanceof Error&&(e.audio&&(this.microphoneError=o),e.video&&(this.cameraError=o)),o}})}createScreenTracks(e){return w(this,void 0,void 0,function*(){if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new As("getDisplayMedia not supported");e.resolution===void 0&&!hb()&&(e.resolution=Bs.h1080fps30.resolution);const n=xb(e),i=yield navigator.mediaDevices.getDisplayMedia(n),r=i.getVideoTracks();if(r.length===0)throw new Qt("no video track found");const o=new Jr(r[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});o.source=R.Source.ScreenShare,e.contentHint&&(o.mediaStreamTrack.contentHint=e.contentHint);const s=[o];if(i.getAudioTracks().length>0){this.emit(U.AudioStreamAcquired);const a=new Kr(i.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});a.source=R.Source.ScreenShareAudio,s.push(a)}return s})}publishTrack(e,n){return w(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,n)})}publishOrRepublishTrack(e,n){return w(this,arguments,void 0,function(i,r){var o=this;let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return(function*(){var a,c,l,d;Zt(i)&&i.setAudioContext(o.audioContext),yield(a=o.reconnectFuture)===null||a===void 0?void 0:a.promise,o.republishPromise&&!s&&(yield o.republishPromise),ai(i)&&o.pendingPublishPromises.has(i)&&(yield o.pendingPublishPromises.get(i));let u;if(i instanceof MediaStreamTrack)u=i.getConstraints();else{u=i.constraints;let b;switch(i.source){case R.Source.Microphone:b="audioinput";break;case R.Source.Camera:b="videoinput"}b&&o.activeDeviceMap.has(b)&&(u=Object.assign(Object.assign({},u),{deviceId:o.activeDeviceMap.get(b)}))}if(i instanceof MediaStreamTrack)switch(i.kind){case"audio":i=new Kr(i,u,!0,o.audioContext,{loggerName:o.roomOptions.loggerName,loggerContextCb:()=>o.logContext});break;case"video":i=new Jr(i,u,!0,{loggerName:o.roomOptions.loggerName,loggerContextCb:()=>o.logContext});break;default:throw new Qt("unsupported MediaStreamTrack kind ".concat(i.kind))}else i.updateLoggerOptions({loggerName:o.roomOptions.loggerName,loggerContextCb:()=>o.logContext});let h;if(o.trackPublications.forEach(b=>{b.track&&b.track===i&&(h=b)}),h)return o.log.warn("track has already been published, skipping",Object.assign(Object.assign({},o.logContext),te(h))),h;const f="channelCount"in i.mediaStreamTrack.getSettings()&&i.mediaStreamTrack.getSettings().channelCount===2||i.mediaStreamTrack.getConstraints().channelCount===2,g=(c=r==null?void 0:r.forceStereo)!==null&&c!==void 0?c:f;g&&(r||(r={}),r.dtx===void 0&&o.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},o.logContext),te(i))),r.red===void 0&&o.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(l=r.dtx)!==null&&l!==void 0||(r.dtx=!1),(d=r.red)!==null&&d!==void 0||(r.red=!1));const p=Object.assign(Object.assign({},o.roomOptions.publishDefaults),r);!pb()&&o.roomOptions.e2ee&&(o.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},o.logContext)),p.simulcast=!1),p.source&&(i.source=p.source);const v=new Promise((b,k)=>w(o,void 0,void 0,function*(){try{if(this.engine.client.currentState!==ke.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:te(i)}));const C=setTimeout(()=>{k(new Ru("publishing rejected as engine not connected within timeout",408))},15e3);yield this.waitUntilEngineConnected(),clearTimeout(C);const y=yield this.publish(i,p,g);b(y)}else try{const C=yield this.publish(i,p,g);b(C)}catch(C){k(C)}}catch(C){k(C)}}));o.pendingPublishPromises.set(i,v);try{return yield v}catch(b){throw b}finally{o.pendingPublishPromises.delete(i)}})()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new Mt),this.signalConnectedFuture.promise}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),te(e))),!1;const{canPublish:n,canPublishSources:i}=this.permissions;return n&&(i.length===0||i.map(r=>Ib(r)).includes(e.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),te(e))),!1)}publish(e,n,i){return w(this,void 0,void 0,function*(){var r,o,s,a,c,l,d,u,h,f;if(!this.hasPermissionsToPublish(e))throw new Ru("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(P=>ai(e)&&P.source===e.source)&&e.source!==R.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),te(e))),n.stopMicTrackOnMute&&Nt(e)&&(e.stopOnMute=!0),e.source===R.Source.ScreenShare&&si()&&(n.simulcast=!1),n.videoCodec==="av1"&&!lb()&&(n.videoCodec=void 0),n.videoCodec==="vp9"&&!db()&&(n.videoCodec=void 0),n.videoCodec===void 0&&(n.videoCodec=sa),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(P=>n.videoCodec===Wr(P.mime))||(n.videoCodec=Wr(this.enabledPublishVideoCodecs[0].mime)));const p=n.videoCodec;e.on(N.Muted,this.onTrackMuted),e.on(N.Unmuted,this.onTrackUnmuted),e.on(N.Ended,this.handleTrackEnded),e.on(N.UpstreamPaused,this.onTrackUpstreamPaused),e.on(N.UpstreamResumed,this.onTrackUpstreamResumed),e.on(N.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const v=[],b=!(!((r=n.dtx)!==null&&r!==void 0)||r),k=e.getSourceTrackSettings();k.autoGainControl&&v.push(je.TF_AUTO_GAIN_CONTROL),k.echoCancellation&&v.push(je.TF_ECHO_CANCELLATION),k.noiseSuppression&&v.push(je.TF_NOISE_SUPPRESSION),k.channelCount&&k.channelCount>1&&v.push(je.TF_STEREO),b&&v.push(je.TF_NO_DTX),Zt(e)&&e.hasPreConnectBuffer&&v.push(je.TF_PRECONNECT_BUFFER);const C=new vs({cid:e.mediaStreamTrack.id,name:n.name,type:R.kindToProto(e.kind),muted:e.isMuted,source:R.sourceToProto(e.source),disableDtx:b,encryption:this.encryptionType,stereo:i,disableRed:this.isE2EEEnabled||!(!((o=n.red)!==null&&o!==void 0)||o),stream:n==null?void 0:n.stream,backupCodecPolicy:n==null?void 0:n.backupCodecPolicy,audioFeatures:v});let y;if(e.kind===R.Kind.Video){let P={width:0,height:0};try{P=yield e.waitForDimensions()}catch{const M=(a=(s=this.roomOptions.videoCaptureDefaults)===null||s===void 0?void 0:s.resolution)!==null&&a!==void 0?a:Wi.h720.resolution;P={width:M.width,height:M.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),te(e)),{dims:P}))}C.width=P.width,C.height=P.height,yn(e)&&(Ot(p)&&(e.source===R.Source.ScreenShare&&(n.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),te(e))))),n.scalabilityMode=(c=n.scalabilityMode)!==null&&c!==void 0?c:"L3T3_KEY"),C.simulcastCodecs=[new gs({codec:p,cid:e.mediaStreamTrack.id})],n.backupCodec===!0&&(n.backupCodec={codec:sa}),n.backupCodec&&p!==n.backupCodec.codec&&C.encryption===ot.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),C.simulcastCodecs.push(new gs({codec:n.backupCodec.codec,cid:""})))),y=ha(e.source===R.Source.ScreenShare,C.width,C.height,n),C.layers=fh(C.width,C.height,y,Ot(n.videoCodec))}else e.kind===R.Kind.Audio&&(y=[{maxBitrate:(l=n.audioPreset)===null||l===void 0?void 0:l.maxBitrate,priority:(u=(d=n.audioPreset)===null||d===void 0?void 0:d.priority)!==null&&u!==void 0?u:"high",networkPriority:(f=(h=n.audioPreset)===null||h===void 0?void 0:h.priority)!==null&&f!==void 0?f:"high"}]);if(!this.engine||this.engine.isClosed)throw new Ue("cannot publish track when not connected");const _=()=>w(this,void 0,void 0,function*(){var P,D,M;if(!this.engine.pcManager)throw new Ue("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,n,y),this.emit(U.LocalSenderCreated,e.sender,e),yn(e)&&((P=n.degradationPreference)!==null&&P!==void 0||(n.degradationPreference=h0(e)),e.setDegradationPreference(n.degradationPreference)),y)if(si()&&e.kind===R.Kind.Audio){let F;for(const z of this.engine.pcManager.publisher.getTransceivers())if(z.sender===e.sender){F=z;break}F&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:F,codec:"opus",maxbr:!((D=y[0])===null||D===void 0)&&D.maxBitrate?y[0].maxBitrate/1e3:0})}else e.codec&&Ot(e.codec)&&(!((M=y[0])===null||M===void 0)&&M.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:C.cid,codec:e.codec,maxbr:y[0].maxBitrate/1e3});yield this.engine.negotiate()});let S;const E=new Promise((P,D)=>w(this,void 0,void 0,function*(){var M;try{S=yield this.engine.addTrack(C),P(S)}catch(F){e.sender&&(!((M=this.engine.pcManager)===null||M===void 0)&&M.publisher)&&(this.engine.pcManager.publisher.removeTrack(e.sender),yield this.engine.negotiate().catch(z=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),te(e)),{error:z}))})),D(F)}}));if(this.enabledPublishVideoCodecs.length>0)S=(yield Promise.all([E,_()]))[0];else{S=yield E;let P;if(S.codecs.forEach(D=>{P===void 0&&(P=D.mimeType)}),P&&e.kind===R.Kind.Video){const D=Wr(P);D!==p&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),te(e)),{codec:D})),n.videoCodec=D,y=ha(e.source===R.Source.ScreenShare,C.width,C.height,n))}yield _()}const x=new ba(e.kind,S,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(x.on(N.CpuConstrained,P=>this.onTrackCpuConstrained(P,x)),x.options=n,e.sid=S.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:y,trackInfo:S})),yn(e)?e.startMonitor(this.engine.client):Zt(e)&&e.startMonitor(),this.addTrackPublication(x),this.emit(U.LocalTrackPublished,x),Zt(e)&&S.audioFeatures.includes(je.TF_PRECONNECT_BUFFER)){const P=e.getPreConnectBuffer(),D=e.getPreConnectBufferMimeType();this.on(U.LocalTrackSubscribed,M=>{if(M.trackSid===S.sid){if(!e.hasPreConnectBuffer){this.log.warn("subscribe event came to late, buffer already closed",this.logContext);return}this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),te(e))),e.stopPreConnectBuffer()}}),P&&new Promise((F,z)=>w(this,void 0,void 0,function*(){var W,B,G,Y,A,ee;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),te(e)));const fe=setTimeout(()=>{z(new Error("agent not active within 10 seconds"))},1e4),de=yield this.waitUntilActiveAgentPresent();clearTimeout(fe),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),te(e)));const Ge=yield this.streamBytes({name:"preconnect-buffer",mimeType:D,topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[de.identity],attributes:{trackId:x.trackSid,sampleRate:String((A=k.sampleRate)!==null&&A!==void 0?A:"48000"),channels:String((ee=k.channelCount)!==null&&ee!==void 0?ee:"1")}});try{for(var we=!0,tt=Yt(P),ut;ut=yield tt.next(),W=ut.done,!W;we=!0){Y=ut.value,we=!1;const nt=Y;yield Ge.write(nt)}}catch(nt){B={error:nt}}finally{try{!we&&!W&&(G=tt.return)&&(yield G.call(tt))}finally{if(B)throw B.error}}yield Ge.close(),F()}catch(fe){z(fe)}})).then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),te(e)))}).catch(F=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),te(e)),{error:F}))})}return x})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,n,i){return w(this,void 0,void 0,function*(){var r;if(this.encryptionType!==ot.NONE)return;let o;if(this.trackPublications.forEach(f=>{f.track&&f.track===e&&(o=f)}),!o)throw new Qt("track is not published");if(!yn(e))throw new Qt("track is not a video track");const s=Object.assign(Object.assign({},(r=this.roomOptions)===null||r===void 0?void 0:r.publishDefaults),i),a=l0(e,n,s);if(!a){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),te(e)));return}const c=e.addSimulcastTrack(n,a);if(!c)return;const l=new vs({cid:c.mediaStreamTrack.id,type:R.kindToProto(e.kind),muted:e.isMuted,source:R.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:s.videoCodec,cid:c.mediaStreamTrack.id}]});if(l.layers=fh(l.width,l.height,a),!this.engine||this.engine.isClosed)throw new Ue("cannot publish track when not connected");const d=()=>w(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,c,s,a),yield this.engine.negotiate()}),h=(yield Promise.all([this.engine.addTrack(l),d()]))[0];this.log.debug("published ".concat(n," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:a,trackInfo:h}))})}unpublishTrack(e,n){return w(this,void 0,void 0,function*(){var i,r;if(ai(e)){const l=this.pendingPublishPromises.get(e);l&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),te(e))),yield l)}const o=this.getPublicationForTrack(e),s=o?te(o):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),s)),!o||!o.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),s));return}e=o.track,e.off(N.Muted,this.onTrackMuted),e.off(N.Unmuted,this.onTrackUnmuted),e.off(N.Ended,this.handleTrackEnded),e.off(N.UpstreamPaused,this.onTrackUpstreamPaused),e.off(N.UpstreamResumed,this.onTrackUpstreamResumed),e.off(N.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),n===void 0&&(n=(r=(i=this.roomOptions)===null||i===void 0?void 0:i.stopLocalTrackOnUnpublish)!==null&&r!==void 0?r:!0),n?e.stop():e.stopMonitor();let a=!1;const c=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<Pe.FAILED&&c)try{for(const l of this.engine.pcManager.publisher.getTransceivers())l.sender===c&&(l.direction="inactive",a=!0);if(this.engine.removeTrack(c)&&(a=!0),yn(e)){for(const[,l]of e.simulcastCodecs)l.sender&&(this.engine.removeTrack(l.sender)&&(a=!0),l.sender=void 0);e.simulcastCodecs.clear()}}catch(l){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),s),{error:l}))}switch(this.trackPublications.delete(o.trackSid),o.kind){case R.Kind.Audio:this.audioTrackPublications.delete(o.trackSid);break;case R.Kind.Video:this.videoTrackPublications.delete(o.trackSid);break}return this.emit(U.LocalTrackUnpublished,o),o.setTrack(void 0),a&&(yield this.engine.negotiate()),o})}unpublishTracks(e){return w(this,void 0,void 0,function*(){return(yield Promise.all(e.map(i=>this.unpublishTrack(i)))).filter(i=>!!i)})}republishAllTracks(e){return w(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){i.republishPromise&&(yield i.republishPromise),i.republishPromise=new Promise((o,s)=>w(i,void 0,void 0,function*(){try{const a=[];this.trackPublications.forEach(c=>{c.track&&(n&&(c.options=Object.assign(Object.assign({},c.options),n)),a.push(c))}),yield Promise.all(a.map(c=>w(this,void 0,void 0,function*(){const l=c.track;yield this.unpublishTrack(l,!1),r&&!l.isMuted&&l.source!==R.Source.ScreenShare&&l.source!==R.Source.ScreenShareAudio&&(Zt(l)||yn(l))&&!l.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:c.trackSid})),yield l.restartTrack()),yield this.publishOrRepublishTrack(l,c.options,!0)}))),o()}catch(a){s(a)}finally{this.republishPromise=void 0}})),yield i.republishPromise})()})}publishData(e){return w(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(function*(){const o=r.reliable?Q.RELIABLE:Q.LOSSY,s=r.destinationIdentities,a=r.topic,c=new Ye({kind:o,value:{case:"user",value:new hd({participantIdentity:i.identity,payload:n,destinationIdentities:s,topic:a})}});yield i.engine.sendDataPacket(c,o)})()})}publishDtmf(e,n){return w(this,void 0,void 0,function*(){const i=new Ye({kind:Q.RELIABLE,value:{case:"sipDtmf",value:new fd({code:e,digit:n})}});yield this.engine.sendDataPacket(i,Q.RELIABLE)})}sendChatMessage(e,n){return w(this,void 0,void 0,function*(){const i={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:n==null?void 0:n.attachments},r=new Ye({value:{case:"chatMessage",value:new ds(Object.assign(Object.assign({},i),{timestamp:Se.parse(i.timestamp)}))}});return yield this.engine.sendDataPacket(r,Q.RELIABLE),this.emit(U.ChatMessage,i),i})}editChatMessage(e,n){return w(this,void 0,void 0,function*(){const i=Object.assign(Object.assign({},n),{message:e,editTimestamp:Date.now()}),r=new Ye({value:{case:"chatMessage",value:new ds(Object.assign(Object.assign({},i),{timestamp:Se.parse(i.timestamp),editTimestamp:Se.parse(i.editTimestamp)}))}});return yield this.engine.sendDataPacket(r,Q.RELIABLE),this.emit(U.ChatMessage,i),i})}sendText(e,n){return w(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendText(e,n)})}streamText(e){return w(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamText(e)})}sendFile(e,n){return w(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendFile(e,n)})}streamBytes(e){return w(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamBytes(e)})}performRpc(e){return w(this,arguments,void 0,function(n){var i=this;let{destinationIdentity:r,method:o,payload:s,responseTimeout:a=1e4}=n;return(function*(){return new Promise((l,d)=>w(i,void 0,void 0,function*(){var u,h,f,g;if(ca(s)>oh){d(Re.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((h=(u=this.engine.latestJoinResponse)===null||u===void 0?void 0:u.serverInfo)===null||h===void 0)&&h.version&&At((g=(f=this.engine.latestJoinResponse)===null||f===void 0?void 0:f.serverInfo)===null||g===void 0?void 0:g.version,"1.8.0")<0){d(Re.builtIn("UNSUPPORTED_SERVER"));return}const p=crypto.randomUUID();yield this.publishRpcRequest(r,p,o,s,a-2e3);const v=setTimeout(()=>{this.pendingAcks.delete(p),d(Re.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(p),clearTimeout(b)},2e3);this.pendingAcks.set(p,{resolve:()=>{clearTimeout(v)},participantIdentity:r});const b=setTimeout(()=>{this.pendingResponses.delete(p),d(Re.builtIn("RESPONSE_TIMEOUT"))},a);this.pendingResponses.set(p,{resolve:(k,C)=>{clearTimeout(b),this.pendingAcks.has(p)&&(console.warn("RPC response received before ack",p),this.pendingAcks.delete(p),clearTimeout(v)),C?d(C):l(k??"")},participantIdentity:r})}))})()})}registerRpcMethod(e,n){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=n,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const n=this.pendingAcks.get(e);n?(n.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,n,i){const r=this.pendingResponses.get(e);r?(r.resolve(n,i),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,n,i,r,o){return w(this,void 0,void 0,function*(){const s=new Ye({destinationIdentities:[e],kind:Q.RELIABLE,value:{case:"rpcRequest",value:new pd({id:n,method:i,payload:r,responseTimeoutMs:o,version:1})}});yield this.engine.sendDataPacket(s,Q.RELIABLE)})}handleParticipantDisconnected(e){for(const[n,{participantIdentity:i}]of this.pendingAcks)i===e&&this.pendingAcks.delete(n);for(const[n,{participantIdentity:i,resolve:r}]of this.pendingResponses)i===e&&(r(null,Re.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(n))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(n=>n.mime.split("/")[0].toLowerCase()==="video")}updateInfo(e){return super.updateInfo(e)?(e.tracks.forEach(n=>{var i,r;const o=this.trackPublications.get(n.sid);if(o){const s=o.isMuted||((r=(i=o.track)===null||i===void 0?void 0:i.isUpstreamPaused)!==null&&r!==void 0?r:!1);s!==n.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),te(o)),{mutedOnServer:s})),this.engine.client.sendMuteTrack(n.sid,s))}}),!0):!1}setActiveAgent(e){var n,i,r,o;this.firstActiveAgent=e,e&&!this.firstActiveAgent&&(this.firstActiveAgent=e),e?(i=(n=this.activeAgentFuture)===null||n===void 0?void 0:n.resolve)===null||i===void 0||i.call(n,e):(o=(r=this.activeAgentFuture)===null||r===void 0?void 0:r.reject)===null||o===void 0||o.call(r,"Agent disconnected"),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new Mt),this.activeAgentFuture.promise)}getPublicationForTrack(e){let n;return this.trackPublications.forEach(i=>{const r=i.track;r&&(e instanceof MediaStreamTrack?(Zt(r)||yn(r))&&r.mediaStreamTrack===e&&(n=i):e===r&&(n=i))}),n}waitForPendingPublicationOfSource(e){return w(this,void 0,void 0,function*(){const i=Date.now();for(;Date.now()<i+1e4;){const r=Array.from(this.pendingPublishPromises.entries()).find(o=>{let[s]=o;return s.source===e});if(r)return r[1];yield Xe(20)}})}}class A0 extends en{constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=o=>{this.setTrack(void 0),this.emit(N.Ended,o)},this.handleVisibilityChange=o=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(o),this.logContext),this.visible=o,this.emitTrackUpdate()},this.handleVideoDimensionsChange=o=>{this.log.debug("adaptivestream video dimensions ".concat(o.width,"x").concat(o.height),this.logContext),this.videoDimensionsAdaptiveStream=o,this.emitTrackUpdate()},this.subscribed=i,this.updateInfo(n)}setSubscribed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const r=new Or({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new bd({participantSid:"",trackSids:[this.trackSid]})]});this.emit(N.UpdateSubscription,r),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(i)}get subscriptionStatus(){return this.subscribed===!1?en.SubscriptionStatus.Unsubscribed:super.isSubscribed?en.SubscriptionStatus.Subscribed:en.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?en.PermissionStatus.Allowed:en.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return this.requestedDisabled!==void 0?!this.requestedDisabled:this.isAdaptiveStream?this.visible:!0}get isLocal(){return!1}setEnabled(e){!this.isManualOperationAllowed()||this.requestedDisabled===!e||(this.requestedDisabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.requestedMaxQuality===e||(this.requestedMaxQuality=e,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var n,i;this.isManualOperationAllowed()&&(((n=this.requestedVideoDimensions)===null||n===void 0?void 0:n.width)===e.width&&((i=this.requestedVideoDimensions)===null||i===void 0?void 0:i.height)===e.height||(Js(this.track)&&(this.requestedVideoDimensions=e),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&Js(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){var e;return(e=this.requestedMaxQuality)!==null&&e!==void 0?e:at.HIGH}setTrack(e){const n=this.subscriptionStatus,i=this.permissionStatus,r=this.track;r!==e&&(r&&(r.off(N.VideoDimensionsChanged,this.handleVideoDimensionsChange),r.off(N.VisibilityChanged,this.handleVisibilityChange),r.off(N.Ended,this.handleEnded),r.detach(),r.stopMonitor(),this.emit(N.Unsubscribed,r)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(N.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(N.VisibilityChanged,this.handleVisibilityChange),e.on(N.Ended,this.handleEnded),this.emit(N.Subscribed,e)),this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n))}setAllowed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n)}setSubscriptionError(e){this.emit(N.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const n=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):n!==e.muted&&this.emit(e.muted?N.Muted:N.Unmuted)}emitSubscriptionUpdateIfChanged(e){const n=this.subscriptionStatus;e!==n&&this.emit(N.SubscriptionStatusChanged,n,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(N.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return Js(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new Pd({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===R.Kind.Video){let n=this.requestedVideoDimensions;if(this.videoDimensionsAdaptiveStream!==void 0)if(n)Hu(this.videoDimensionsAdaptiveStream,n)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream);else if(this.requestedMaxQuality!==void 0&&this.trackInfo){const i=Ob(this.trackInfo,this.requestedMaxQuality);i&&Hu(this.videoDimensionsAdaptiveStream,i)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream;n?(e.width=Math.ceil(n.width),e.height=Math.ceil(n.height)):this.requestedMaxQuality!==void 0?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),e.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:at.HIGH})),e.quality=at.HIGH)}this.emit(N.UpdateSettings,e)}}class Xr extends wh{static fromParticipantInfo(e,n,i){return new Xr(e,n.sid,n.identity,n.name,n.metadata,n.attributes,i,n.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,n,i,r,o,s,a){let c=arguments.length>7&&arguments[7]!==void 0?arguments[7]:ji.STANDARD;super(n,i||"",r,o,s,a,c),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(N.UpdateSettings,n=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),te(e)),{settings:n})),this.signalClient.sendUpdateTrackSettings(n)}),e.on(N.UpdateSubscription,n=>{n.participantTracks.forEach(i=>{i.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(n)}),e.on(N.SubscriptionPermissionChanged,n=>{this.emit(U.TrackSubscriptionPermissionChanged,e,n)}),e.on(N.SubscriptionStatusChanged,n=>{this.emit(U.TrackSubscriptionStatusChanged,e,n)}),e.on(N.Subscribed,n=>{this.emit(U.TrackSubscribed,n,e)}),e.on(N.Unsubscribed,n=>{this.emit(U.TrackUnsubscribed,n,e)}),e.on(N.SubscriptionFailed,n=>{this.emit(U.TrackSubscriptionFailed,e.trackSid,n)})}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setVolume(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:R.Source.Microphone;this.volumeMap.set(n,e);const i=this.getTrackPublication(n);i&&i.track&&i.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:R.Source.Microphone;const n=this.getTrackPublication(e);return n&&n.track?n.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,n,i,r,o,s){let a=this.getTrackPublicationBySid(n);if(a||n.startsWith("TR")||this.trackPublications.forEach(d=>{!a&&e.kind===d.kind.toString()&&(a=d)}),!a){if(s===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:n})),this.emit(U.TrackSubscriptionFailed,n);return}s===void 0&&(s=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,n,i,r,o,s-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),te(a))),this.emit(U.TrackSubscriptionFailed,n);return}const c=e.kind==="video";let l;return c?l=new E0(e,n,r,o):l=new x0(e,n,r,this.audioContext,this.audioOutput),l.source=a.source,l.isMuted=a.isMuted,l.setMediaStream(i),l.start(),a.setTrack(l),this.volumeMap.has(a.source)&&Ks(l)&&Nt(l)&&l.setVolume(this.volumeMap.get(a.source)),a}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const n=new Map,i=new Map;return e.tracks.forEach(r=>{var o,s;let a=this.getTrackPublicationBySid(r.sid);if(a)a.updateInfo(r);else{const c=R.kindFromProto(r.type);if(!c)return;a=new A0(c,r,(o=this.signalClient.connectOptions)===null||o===void 0?void 0:o.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(s=this.loggerOptions)===null||s===void 0?void 0:s.loggerName}),a.updateInfo(r),i.set(r.sid,a);const l=Array.from(this.trackPublications.values()).find(d=>d.source===(a==null?void 0:a.source));l&&a.source!==R.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(a.source),Object.assign(Object.assign({},this.logContext),{oldTrack:te(l),newTrack:te(a)})),this.addTrackPublication(a)}n.set(r.sid,a)}),this.trackPublications.forEach(r=>{n.has(r.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),te(r))),this.unpublishTrack(r.trackSid,!0))}),i.forEach(r=>{this.emit(U.TrackPublished,r)}),!0}unpublishTrack(e,n){const i=this.trackPublications.get(e);if(!i)return;const{track:r}=i;switch(r&&(r.stop(),i.setTrack(void 0)),this.trackPublications.delete(e),i.kind){case R.Kind.Audio:this.audioTrackPublications.delete(e);break;case R.Kind.Video:this.videoTrackPublications.delete(e);break}n&&this.emit(U.TrackUnpublished,i)}setAudioOutput(e){return w(this,void 0,void 0,function*(){this.audioOutput=e;const n=[];this.audioTrackPublications.forEach(i=>{var r;Nt(i.track)&&Ks(i.track)&&n.push(i.track.setSinkId((r=e.deviceId)!==null&&r!==void 0?r:"default"))}),yield Promise.all(n)})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:i})),super.emit(e,...i)}}var ae;(function(t){t.Disconnected="disconnected",t.Connecting="connecting",t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting"})(ae||(ae={}));const M0=4*1e3;class di extends It.EventEmitter{constructor(e){var n,i,r,o;if(super(),n=this,this.state=ae.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=ie,this.bufferedEvents=[],this.isResuming=!1,this.rpcHandlers=new Map,this.connect=(s,a,c)=>w(this,void 0,void 0,function*(){var l;if(!ub())throw Dt()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const d=yield this.disconnectLock.lock();if(this.state===ae.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),d(),Promise.resolve();if(this.connectFuture)return d(),this.connectFuture.promise;this.setAndEmitConnectionState(ae.Connecting),((l=this.regionUrlProvider)===null||l===void 0?void 0:l.getServerUrl().toString())!==s&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),zs(new URL(s))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new ma(s,a):this.regionUrlProvider.updateToken(a),this.regionUrlProvider.fetchRegionSettings().then(f=>{var g;(g=this.regionUrlProvider)===null||g===void 0||g.setServerReportedRegions(f)}).catch(f=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:f}))}));const u=(f,g,p)=>w(this,void 0,void 0,function*(){var v,b;this.abortController&&this.abortController.abort();const k=new AbortController;this.abortController=k,d==null||d();try{yield this.attemptConnection(p??s,a,c,k),this.abortController=void 0,f()}catch(C){if(this.regionUrlProvider&&C instanceof me&&C.reason!==oe.Cancelled&&C.reason!==oe.NotAllowed){let y=null;try{y=yield this.regionUrlProvider.getNextBestRegionUrl((v=this.abortController)===null||v===void 0?void 0:v.signal)}catch(_){if(_ instanceof me&&(_.status===401||_.reason===oe.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),g(_);return}}y&&!(!((b=this.abortController)===null||b===void 0)&&b.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(C.message,". Retrying with another region: ").concat(y),this.logContext),this.recreateEngine(),yield u(f,g,y)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Vu(C)),g(C))}else{let y=mt.UNKNOWN_REASON;C instanceof me&&(y=Vu(C)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,y),g(C)}}}),h=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new Mt((f,g)=>{u(f,g,h)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(s,a,c,l,d,u)=>w(this,void 0,void 0,function*(){var h,f,g;const p=yield c.join(s,a,{autoSubscribe:l.autoSubscribe,adaptiveStream:typeof d.adaptiveStream=="object"?!0:d.adaptiveStream,maxRetries:l.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:l.websocketTimeout},u.signal);let v=p.serverInfo;if(v||(v={version:p.serverVersion,region:p.serverRegion}),this.serverInfo=v,this.log.debug("connected to Livekit Server ".concat(Object.entries(v).map(b=>{let[k,C]=b;return"".concat(k,": ").concat(C)}).join(", ")),{room:(h=p.room)===null||h===void 0?void 0:h.name,roomSid:(f=p.room)===null||f===void 0?void 0:f.sid,identity:(g=p.participant)===null||g===void 0?void 0:g.identity}),!v.version)throw new Yv("unknown server version");return v.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),d.dynacast=!1),p}),this.applyJoinResponse=s=>{const a=s.participant;if(this.localParticipant.sid=a.sid,this.localParticipant.identity=a.identity,this.localParticipant.setEnabledPublishCodecs(s.enabledPublishCodecs),this.options.e2ee&&this.e2eeManager)try{this.e2eeManager.setSifTrailer(s.sifTrailer)}catch(c){this.log.error(c instanceof Error?c.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:c}))}this.handleParticipantUpdates([a,...s.otherParticipants]),s.room&&this.handleRoomUpdate(s.room)},this.attemptConnection=(s,a,c,l)=>w(this,void 0,void 0,function*(){var d,u;this.state===ae.Reconnecting||this.isResuming||!((d=this.engine)===null||d===void 0)&&d.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((u=this.regionUrlProvider)===null||u===void 0)&&u.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},aa),c),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const h=yield this.connectSignal(s,a,this.engine,this.connOptions,this.options,l);this.applyJoinResponse(h),this.setupLocalParticipantEvents(),this.emit(O.SignalConnected)}catch(h){yield this.engine.close(),this.recreateEngine();const f=new me("could not establish signal connection",oe.ServerUnreachable);throw h instanceof Error&&(f.message="".concat(f.message,": ").concat(h.message)),h instanceof me&&(f.reason=h.reason,f.status=h.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:h})),f}if(l.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),new me("Connection attempt aborted",oe.Cancelled);try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,l)}catch(h){throw yield this.engine.close(),this.recreateEngine(),h}Qe()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),Qe()&&document.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(ae.Connected),this.emit(O.Connected),this.registerConnectionReconcile()}),this.disconnect=function(){for(var s=arguments.length,a=new Array(s),c=0;c<s;c++)a[c]=arguments[c];return w(n,[...a],void 0,function(){var l=this;let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var u,h,f,g;const p=yield l.disconnectLock.lock();try{if(l.state===ae.Disconnected){l.log.debug("already disconnected",l.logContext);return}l.log.info("disconnect from room",Object.assign({},l.logContext)),(l.state===ae.Connecting||l.state===ae.Reconnecting||l.isResuming)&&(l.log.warn("abort connection attempt",l.logContext),(u=l.abortController)===null||u===void 0||u.abort(),(f=(h=l.connectFuture)===null||h===void 0?void 0:h.reject)===null||f===void 0||f.call(h,new me("Client initiated disconnect",oe.Cancelled)),l.connectFuture=void 0),!((g=l.engine)===null||g===void 0)&&g.client.isDisconnected||(yield l.engine.client.sendLeave()),l.engine&&(yield l.engine.close()),l.handleDisconnect(d,mt.CLIENT_INITIATED),l.engine=void 0}finally{p()}})()})},this.onPageLeave=()=>w(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>w(this,void 0,void 0,function*(){const s=[],a=st();if(a&&a.os==="iOS"){const c="livekit-dummy-audio-el";let l=document.getElementById(c);if(!l){l=document.createElement("audio"),l.id=c,l.autoplay=!0,l.hidden=!0;const d=Hs();d.enabled=!0;const u=new MediaStream([d]);l.srcObject=u,document.addEventListener("visibilitychange",()=>{l&&(l.srcObject=document.hidden?null:u,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(l),this.once(O.Disconnected,()=>{l==null||l.remove(),l=null})}s.push(l)}this.remoteParticipants.forEach(c=>{c.audioTrackPublications.forEach(l=>{l.track&&l.track.attachedElements.forEach(d=>{s.push(d)})})});try{yield Promise.all([this.acquireAudioContext(),...s.map(c=>(c.muted=!1,c.play()))]),this.handleAudioPlaybackStarted()}catch(c){throw this.handleAudioPlaybackFailed(c),c}}),this.startVideo=()=>w(this,void 0,void 0,function*(){const s=[];for(const a of this.remoteParticipants.values())a.videoTrackPublications.forEach(c=>{var l;(l=c.track)===null||l===void 0||l.attachedElements.forEach(d=>{s.includes(d)||s.push(d)})});yield Promise.all(s.map(a=>a.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(a=>{a.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const s of this.remoteParticipants.values())this.handleParticipantDisconnected(s.identity,s);this.setAndEmitConnectionState(ae.Reconnecting)&&this.emit(O.Reconnecting)},this.handleSignalRestarted=s=>w(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(s.serverRegion),Object.assign(Object.assign({},this.logContext),{region:s.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(s);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(a){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:a}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:s.serverRegion}))}catch{return}this.setAndEmitConnectionState(ae.Connected),this.emit(O.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=s=>{s.forEach(a=>{var c;if(a.identity===this.localParticipant.identity){this.localParticipant.updateInfo(a);return}a.identity===""&&(a.identity=(c=this.sidToIdentity.get(a.sid))!==null&&c!==void 0?c:"");let l=this.remoteParticipants.get(a.identity);a.state===ei.DISCONNECTED?this.handleParticipantDisconnected(a.identity,l):l=this.getOrCreateParticipant(a.identity,a)})},this.handleActiveSpeakersUpdate=s=>{const a=[],c={};s.forEach(l=>{if(c[l.sid]=!0,l.sid===this.localParticipant.sid)this.localParticipant.audioLevel=l.level,this.localParticipant.setIsSpeaking(!0),a.push(this.localParticipant);else{const d=this.getRemoteParticipantBySid(l.sid);d&&(d.audioLevel=l.level,d.setIsSpeaking(!0),a.push(d))}}),c[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(l=>{c[l.sid]||(l.audioLevel=0,l.setIsSpeaking(!1))}),this.activeSpeakers=a,this.emitWhenConnected(O.ActiveSpeakersChanged,a)},this.handleSpeakersChanged=s=>{const a=new Map;this.activeSpeakers.forEach(l=>{const d=this.remoteParticipants.get(l.identity);d&&d.sid!==l.sid||a.set(l.sid,l)}),s.forEach(l=>{let d=this.getRemoteParticipantBySid(l.sid);l.sid===this.localParticipant.sid&&(d=this.localParticipant),d&&(d.audioLevel=l.level,d.setIsSpeaking(l.active),l.active?a.set(l.sid,d):a.delete(l.sid))});const c=Array.from(a.values());c.sort((l,d)=>d.audioLevel-l.audioLevel),this.activeSpeakers=c,this.emitWhenConnected(O.ActiveSpeakersChanged,c)},this.handleStreamStateUpdate=s=>{s.streamStates.forEach(a=>{const c=this.getRemoteParticipantBySid(a.participantSid);if(!c)return;const l=c.getTrackPublicationBySid(a.trackSid);if(!l||!l.track)return;const d=R.streamStateFromProto(a.state);d!==l.track.streamState&&(l.track.streamState=d,c.emit(U.TrackStreamStateChanged,l,l.track.streamState),this.emitWhenConnected(O.TrackStreamStateChanged,l,l.track.streamState,c))})},this.handleSubscriptionPermissionUpdate=s=>{const a=this.getRemoteParticipantBySid(s.participantSid);if(!a)return;const c=a.getTrackPublicationBySid(s.trackSid);c&&c.setAllowed(s.allowed)},this.handleSubscriptionError=s=>{const a=Array.from(this.remoteParticipants.values()).find(l=>l.trackPublications.has(s.trackSid));if(!a)return;const c=a.getTrackPublicationBySid(s.trackSid);c&&c.setSubscriptionError(s.err)},this.handleDataPacket=s=>{const a=this.remoteParticipants.get(s.participantIdentity);if(s.value.case==="user")this.handleUserPacket(a,s.value.value,s.kind);else if(s.value.case==="transcription")this.handleTranscription(a,s.value.value);else if(s.value.case==="sipDtmf")this.handleSipDtmf(a,s.value.value);else if(s.value.case==="chatMessage")this.handleChatMessage(a,s.value.value);else if(s.value.case==="metrics")this.handleMetrics(s.value.value,a);else if(s.value.case==="streamHeader"||s.value.case==="streamChunk"||s.value.case==="streamTrailer")this.handleDataStream(s);else if(s.value.case==="rpcRequest"){const c=s.value.value;this.handleIncomingRpcRequest(s.participantIdentity,c.id,c.method,c.payload,c.responseTimeoutMs,c.version)}},this.handleUserPacket=(s,a,c)=>{this.emit(O.DataReceived,a.payload,s,c,a.topic),s==null||s.emit(U.DataReceived,a.payload,c)},this.handleSipDtmf=(s,a)=>{this.emit(O.SipDTMFReceived,a,s),s==null||s.emit(U.SipDTMFReceived,a)},this.handleTranscription=(s,a)=>{const c=a.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(a.transcribedParticipantIdentity),l=c==null?void 0:c.trackPublications.get(a.trackId),d=kb(a,this.transcriptionReceivedTimes);l==null||l.emit(N.TranscriptionReceived,d),c==null||c.emit(U.TranscriptionReceived,d,l),this.emit(O.TranscriptionReceived,d,c,l)},this.handleChatMessage=(s,a)=>{const c=wb(a);this.emit(O.ChatMessage,c,s)},this.handleMetrics=(s,a)=>{this.emit(O.MetricsReceived,s,a)},this.handleDataStream=s=>{this.incomingDataStreamManager.handleDataStreamPacket(s)},this.bufferedSegments=new Map,this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(O.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=s=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:s})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(O.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(O.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(O.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>w(this,void 0,void 0,function*(){var s;((s=st())===null||s===void 0?void 0:s.os)!=="iOS"&&(yield this.selectDefaultDevices()),this.emit(O.MediaDevicesChanged)}),this.handleRoomUpdate=s=>{const a=this.roomInfo;this.roomInfo=s,a&&a.metadata!==s.metadata&&this.emitWhenConnected(O.RoomMetadataChanged,s.metadata),(a==null?void 0:a.activeRecording)!==s.activeRecording&&this.emitWhenConnected(O.RecordingStatusChanged,s.activeRecording)},this.handleConnectionQualityUpdate=s=>{s.updates.forEach(a=>{if(a.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(a.quality);return}const c=this.getRemoteParticipantBySid(a.participantSid);c&&c.setConnectionQuality(a.quality)})},this.onLocalParticipantMetadataChanged=s=>{this.emit(O.ParticipantMetadataChanged,s,this.localParticipant)},this.onLocalParticipantNameChanged=s=>{this.emit(O.ParticipantNameChanged,s,this.localParticipant)},this.onLocalAttributesChanged=s=>{this.emit(O.ParticipantAttributesChanged,s,this.localParticipant)},this.onLocalTrackMuted=s=>{this.emit(O.TrackMuted,s,this.localParticipant)},this.onLocalTrackUnmuted=s=>{this.emit(O.TrackUnmuted,s,this.localParticipant)},this.onTrackProcessorUpdate=s=>{var a;(a=s==null?void 0:s.onPublish)===null||a===void 0||a.call(s,this)},this.onLocalTrackPublished=s=>w(this,void 0,void 0,function*(){var a,c,l,d,u,h;(a=s.track)===null||a===void 0||a.on(N.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=s.track)===null||c===void 0||c.on(N.Restarted,this.onLocalTrackRestarted),(u=(d=(l=s.track)===null||l===void 0?void 0:l.getProcessor())===null||d===void 0?void 0:d.onPublish)===null||u===void 0||u.call(d,this),this.emit(O.LocalTrackPublished,s,this.localParticipant),Zt(s.track)&&(yield s.track.checkForSilence())&&this.emit(O.LocalAudioSilenceDetected,s);const f=yield(h=s.track)===null||h===void 0?void 0:h.getDeviceId(!1),g=Qs(s.source);g&&f&&f!==this.localParticipant.activeDeviceMap.get(g)&&(this.localParticipant.activeDeviceMap.set(g,f),this.emit(O.ActiveDeviceChanged,g,f))}),this.onLocalTrackUnpublished=s=>{var a,c;(a=s.track)===null||a===void 0||a.off(N.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=s.track)===null||c===void 0||c.off(N.Restarted,this.onLocalTrackRestarted),this.emit(O.LocalTrackUnpublished,s,this.localParticipant)},this.onLocalTrackRestarted=s=>w(this,void 0,void 0,function*(){const a=yield s.getDeviceId(!1),c=Qs(s.source);c&&a&&a!==this.localParticipant.activeDeviceMap.get(c)&&(this.log.debug("local track restarted, setting ".concat(c," ").concat(a," active"),this.logContext),this.localParticipant.activeDeviceMap.set(c,a),this.emit(O.ActiveDeviceChanged,c,a))}),this.onLocalConnectionQualityChanged=s=>{this.emit(O.ConnectionQualityChanged,s,this.localParticipant)},this.onMediaDevicesError=(s,a)=>{this.emit(O.MediaDevicesError,s,a)},this.onLocalParticipantPermissionsChanged=s=>{this.emit(O.ParticipantPermissionsChanged,s,this.localParticipant)},this.onLocalChatMessageSent=s=>{this.emit(O.ChatMessage,s,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},Kb),e),this.log=Jt((i=this.options.loggerName)!==null&&i!==void 0?i:vt.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},ih),e==null?void 0:e.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},rh),e==null?void 0:e.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},Gb),e==null?void 0:e.publishDefaults),this.maybeCreateEngine(),this.incomingDataStreamManager=new C0,this.outgoingDataStreamManager=new T0(this.engine,this.log),this.disconnectLock=new Ke,this.localParticipant=new D0("","",this.engine,this.options,this.rpcHandlers,this.outgoingDataStreamManager),this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",bn(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",bn(this.options.audioCaptureDefaults.deviceId)),!((r=this.options.audioOutput)===null||r===void 0)&&r.deviceId&&this.switchActiveDevice("audiooutput",bn(this.options.audioOutput.deviceId)).catch(s=>this.log.warn("Could not set audio output: ".concat(s.message),this.logContext)),this.options.e2ee&&this.setupE2EE(),Qe()){const s=new AbortController;(o=navigator.mediaDevices)===null||o===void 0||o.addEventListener("devicechange",this.handleDeviceChange,{signal:s.signal}),di.cleanupRegistry&&di.cleanupRegistry.register(this,()=>{s.abort()})}}registerTextStreamHandler(e,n){return this.incomingDataStreamManager.registerTextStreamHandler(e,n)}unregisterTextStreamHandler(e){return this.incomingDataStreamManager.unregisterTextStreamHandler(e)}registerByteStreamHandler(e,n){return this.incomingDataStreamManager.registerByteStreamHandler(e,n)}unregisterByteStreamHandler(e){return this.incomingDataStreamManager.unregisterByteStreamHandler(e)}registerRpcMethod(e,n){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setE2EEEnabled(e){return w(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;this.options.e2ee&&("e2eeManager"in this.options.e2ee?this.e2eeManager=this.options.e2ee.e2eeManager:this.e2eeManager=new Db(this.options.e2ee),this.e2eeManager.on(gn.ParticipantEncryptionStatusChanged,(n,i)=>{_b(i)&&(this.isE2EEEnabled=n),this.emit(O.ParticipantEncryptionStatusChanged,n,i)}),this.e2eeManager.on(gn.EncryptionError,n=>this.emit(O.EncryptionError,n)),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:(e=this.roomInfo)===null||e===void 0?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&n!==void 0?n:!1}getSid(){return w(this,void 0,void 0,function*(){return this.state===ae.Disconnected?"":this.roomInfo&&this.roomInfo.sid!==""?this.roomInfo.sid:new Promise((e,n)=>{const i=r=>{r.sid!==""&&(this.engine.off(L.RoomUpdate,i),e(r.sid))};this.engine.on(L.RoomUpdate,i),this.once(O.Disconnected,()=>{this.engine.off(L.RoomUpdate,i),n("Room disconnected before room server id was available")})})})}get name(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&n!==void 0?n:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&n!==void 0?n:0}get numPublishers(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&n!==void 0?n:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new g0(this.options),this.engine.on(L.ParticipantUpdate,this.handleParticipantUpdates).on(L.RoomUpdate,this.handleRoomUpdate).on(L.SpeakersChanged,this.handleSpeakersChanged).on(L.StreamStateChanged,this.handleStreamStateUpdate).on(L.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(L.SubscriptionError,this.handleSubscriptionError).on(L.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(L.MediaTrackAdded,(e,n,i)=>{this.onTrackAdded(e,n,i)}).on(L.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(L.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(L.DataPacketReceived,this.handleDataPacket).on(L.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(ae.SignalReconnecting)&&this.emit(O.SignalReconnecting)}).on(L.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(ae.Connected)&&this.emit(O.Reconnected)}).on(L.SignalResumed,()=>{this.bufferedEvents=[],(this.state===ae.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(L.Restarting,this.handleRestarting).on(L.SignalRestarted,this.handleSignalRestarted).on(L.Offline,()=>{this.setAndEmitConnectionState(ae.Reconnecting)&&this.emit(O.Reconnecting)}).on(L.DCBufferStatusChanged,(e,n)=>{this.emit(O.DCBufferStatusChanged,e,n)}).on(L.LocalTrackSubscribed,e=>{const n=this.localParticipant.getTrackPublications().find(i=>{let{trackSid:r}=i;return r===e});if(!n){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(U.LocalTrackSubscribed,n),this.emitWhenConnected(O.LocalTrackSubscribed,n,this.localParticipant)}).on(L.RoomMoved,e=>{this.log.debug("room moved",e),e.room&&this.handleRoomUpdate(e.room),this.remoteParticipants.forEach((n,i)=>{this.handleParticipantDisconnected(i,n)}),this.emit(O.Moved,e.room.name),e.participant?this.handleParticipantUpdates([e.participant,...e.otherParticipants]):this.handleParticipantUpdates(e.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine),this.outgoingDataStreamManager&&this.outgoingDataStreamManager.setupEngine(this.engine))}static getLocalDevices(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return Ve.getInstance().getDevices(e,n)}prepareConnection(e,n){return w(this,void 0,void 0,function*(){if(this.state===ae.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(zs(new URL(e))&&n){this.regionUrlProvider=new ma(e,n);const i=yield this.regionUrlProvider.getNextBestRegionUrl();i&&this.state===ae.Disconnected&&(this.regionUrl=i,yield fetch(Gs(i),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(i),this.logContext))}else yield fetch(Gs(e),{method:"HEAD"})}catch(i){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:i}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,n){return w(this,void 0,void 0,function*(){let i=()=>{},r;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":r=new Rt({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":r=new Rt({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":r=new Rt({scenario:{case:"serverLeave",value:!0}});break;case"migration":r=new Rt({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":i=()=>w(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new Rt({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":i=()=>w(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new Rt({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":r=new Rt({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),i=()=>w(this,void 0,void 0,function*(){const o=this.engine.client.onLeave;o&&o(new Dr({reason:mt.CLIENT_INITIATED,action:ni.RECONNECT}))});break;case"subscriber-bandwidth":if(n===void 0||typeof n!="number")throw new Error("subscriber-bandwidth requires a number as argument");r=new Rt({scenario:{case:"subscriberBandwidth",value:Fn(n)}});break;case"leave-full-reconnect":r=new Rt({scenario:{case:"leaveRequestFullReconnect",value:!0}})}r&&(yield this.engine.client.sendSimulateScenario(r),yield i())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,n){return w(this,arguments,void 0,function(i,r){var o=this;let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return(function*(){var a,c,l,d,u,h,f;let g=!0,p=!1;const v=s?{exact:r}:r;if(i==="audioinput"){p=o.localParticipant.audioTrackPublications.size===0;const b=(a=o.getActiveDevice(i))!==null&&a!==void 0?a:o.options.audioCaptureDefaults.deviceId;o.options.audioCaptureDefaults.deviceId=v;const k=Array.from(o.localParticipant.audioTrackPublications.values()).filter(y=>y.source===R.Source.Microphone);try{g=(yield Promise.all(k.map(y=>{var _;return(_=y.audioTrack)===null||_===void 0?void 0:_.setDeviceId(v)}))).every(y=>y===!0)}catch(y){throw o.options.audioCaptureDefaults.deviceId=b,y}const C=k.some(y=>{var _,S;return(S=(_=y.track)===null||_===void 0?void 0:_.isMuted)!==null&&S!==void 0?S:!1});g&&C&&(p=!0)}else if(i==="videoinput"){p=o.localParticipant.videoTrackPublications.size===0;const b=(c=o.getActiveDevice(i))!==null&&c!==void 0?c:o.options.videoCaptureDefaults.deviceId;o.options.videoCaptureDefaults.deviceId=v;const k=Array.from(o.localParticipant.videoTrackPublications.values()).filter(y=>y.source===R.Source.Camera);try{g=(yield Promise.all(k.map(y=>{var _;return(_=y.videoTrack)===null||_===void 0?void 0:_.setDeviceId(v)}))).every(y=>y===!0)}catch(y){throw o.options.videoCaptureDefaults.deviceId=b,y}const C=k.some(y=>{var _,S;return(S=(_=y.track)===null||_===void 0?void 0:_.isMuted)!==null&&S!==void 0?S:!1});g&&C&&(p=!0)}else if(i==="audiooutput"){if(p=!0,!qs()&&!o.options.webAudioMix||o.options.webAudioMix&&o.audioContext&&!("setSinkId"in o.audioContext))throw new Error("cannot switch audio output, the current browser does not support it");o.options.webAudioMix&&(r=(l=yield Ve.getInstance().normalizeDeviceId("audiooutput",r))!==null&&l!==void 0?l:""),(d=(f=o.options).audioOutput)!==null&&d!==void 0||(f.audioOutput={});const b=(u=o.getActiveDevice(i))!==null&&u!==void 0?u:o.options.audioOutput.deviceId;o.options.audioOutput.deviceId=r;try{o.options.webAudioMix&&((h=o.audioContext)===null||h===void 0||h.setSinkId(r)),yield Promise.all(Array.from(o.remoteParticipants.values()).map(k=>k.setAudioOutput({deviceId:r})))}catch(k){throw o.options.audioOutput.deviceId=b,k}}return p&&(o.localParticipant.activeDeviceMap.set(i,r),o.emit(O.ActiveDeviceChanged,i,r)),g})()})}setupLocalParticipantEvents(){this.localParticipant.on(U.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(U.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(U.AttributesChanged,this.onLocalAttributesChanged).on(U.TrackMuted,this.onLocalTrackMuted).on(U.TrackUnmuted,this.onLocalTrackUnmuted).on(U.LocalTrackPublished,this.onLocalTrackPublished).on(U.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(U.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(U.MediaDevicesError,this.onMediaDevicesError).on(U.AudioStreamAcquired,this.startAudio).on(U.ChatMessage,this.onLocalChatMessageSent).on(U.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,n,i){if(this.state===ae.Connecting||this.state===ae.Reconnecting){const d=()=>{this.onTrackAdded(e,n,i),u()},u=()=>{this.off(O.Reconnected,d),this.off(O.Connected,d),this.off(O.Disconnected,u)};this.once(O.Reconnected,d),this.once(O.Connected,d),this.once(O.Disconnected,u);return}if(this.state===ae.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(e.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const r=cb(n.id),o=r[0];let s=r[1],a=e.id;if(s&&s.startsWith("TR")&&(a=s),o===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const c=Array.from(this.remoteParticipants.values()).find(d=>d.sid===o);if(!c){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(o),this.logContext);return}let l;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?l=this.options.adaptiveStream:l={}),c.addSubscribedMediaTrack(e,a,n,i,l)}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,n=arguments.length>1?arguments[1]:void 0;var i;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.incomingDataStreamManager.clearHandlersAndControllers(),this.state!==ae.Disconnected){this.regionUrl=void 0;try{this.remoteParticipants.forEach(r=>{r.trackPublications.forEach(o=>{r.unpublishTrack(o.trackSid)})}),this.localParticipant.trackPublications.forEach(r=>{var o,s,a;r.track&&this.localParticipant.unpublishTrack(r.track,e),e?((o=r.track)===null||o===void 0||o.detach(),(s=r.track)===null||s===void 0||s.stop()):(a=r.track)===null||a===void 0||a.stopMonitor()}),this.localParticipant.off(U.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(U.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(U.AttributesChanged,this.onLocalAttributesChanged).off(U.TrackMuted,this.onLocalTrackMuted).off(U.TrackUnmuted,this.onLocalTrackUnmuted).off(U.LocalTrackPublished,this.onLocalTrackPublished).off(U.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(U.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(U.MediaDevicesError,this.onMediaDevicesError).off(U.AudioStreamAcquired,this.startAudio).off(U.ChatMessage,this.onLocalChatMessageSent).off(U.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),Qe()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(i=navigator.mediaDevices)===null||i===void 0||i.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(ae.Disconnected),this.emit(O.Disconnected,n)}}}handleParticipantDisconnected(e,n){var i;this.remoteParticipants.delete(e),n&&(this.incomingDataStreamManager.validateParticipantHasNoActiveDataStreams(e),n.trackPublications.forEach(r=>{n.unpublishTrack(r.trackSid,!0)}),this.emit(O.ParticipantDisconnected,n),n.setDisconnected(),(i=this.localParticipant)===null||i===void 0||i.handleParticipantDisconnected(n.identity))}handleIncomingRpcRequest(e,n,i,r,o,s){return w(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,n),s!==1){yield this.engine.publishRpcResponse(e,n,null,Re.builtIn("UNSUPPORTED_VERSION"));return}const a=this.rpcHandlers.get(i);if(!a){yield this.engine.publishRpcResponse(e,n,null,Re.builtIn("UNSUPPORTED_METHOD"));return}let c=null,l=null;try{const d=yield a({requestId:n,callerIdentity:e,payload:r,responseTimeout:o});ca(d)>oh?(c=Re.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),console.warn("RPC Response payload too large for ".concat(i))):l=d}catch(d){d instanceof Re?c=d:(console.warn("Uncaught error returned by RPC handler for ".concat(i,". Returning APPLICATION_ERROR instead."),d),c=Re.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,n,l,c)})}selectDefaultDevices(){return w(this,void 0,void 0,function*(){var e,n,i;const r=Ve.getInstance().previousDevices,o=yield Ve.getInstance().getDevices(void 0,!1),s=st();if((s==null?void 0:s.name)==="Chrome"&&s.os!=="iOS")for(let c of o){const l=r.find(d=>d.deviceId===c.deviceId);l&&l.label!==""&&l.kind===c.kind&&l.label!==c.label&&this.getActiveDevice(c.kind)==="default"&&this.emit(O.ActiveDeviceChanged,c.kind,c.deviceId)}const a=["audiooutput","audioinput","videoinput"];for(let c of a){const l=Tb(c),d=this.localParticipant.getTrackPublication(l);if(d&&(!((e=d.track)===null||e===void 0)&&e.isUserProvided))continue;const u=o.filter(f=>f.kind===c),h=this.getActiveDevice(c);if(h===((n=r.filter(f=>f.kind===c)[0])===null||n===void 0?void 0:n.deviceId)&&u.length>0&&((i=u[0])===null||i===void 0?void 0:i.deviceId)!==h){yield this.switchActiveDevice(c,u[0].deviceId);continue}c==="audioinput"&&!zr()||c==="videoinput"||u.length>0&&!u.find(f=>f.deviceId===this.getActiveDevice(c))&&(c!=="audiooutput"||!zr())&&(yield this.switchActiveDevice(c,u[0].deviceId))}})}acquireAudioContext(){return w(this,void 0,void 0,function*(){var e,n;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=$u())!==null&&e!==void 0?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(r=>r.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),Xe(200)])}catch(r){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:r}))}const i=((n=this.audioContext)===null||n===void 0?void 0:n.state)==="running";i!==this.canPlaybackAudio&&(this.audioEnabled=i,this.emit(O.AudioPlaybackStatusChanged,i))})}createParticipant(e,n){var i;let r;return n?r=Xr.fromParticipantInfo(this.engine.client,n,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):r=new Xr(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&r.setAudioContext(this.audioContext),!((i=this.options.audioOutput)===null||i===void 0)&&i.deviceId&&r.setAudioOutput(this.options.audioOutput).catch(o=>this.log.warn("Could not set audio output: ".concat(o.message),this.logContext)),r}getOrCreateParticipant(e,n){if(this.remoteParticipants.has(e)){const r=this.remoteParticipants.get(e);return n&&r.updateInfo(n)&&this.sidToIdentity.set(n.sid,n.identity),r}const i=this.createParticipant(e,n);return this.remoteParticipants.set(e,i),this.sidToIdentity.set(n.sid,n.identity),this.emitWhenConnected(O.ParticipantConnected,i),i.on(U.TrackPublished,r=>{this.emitWhenConnected(O.TrackPublished,r,i)}).on(U.TrackSubscribed,(r,o)=>{r.kind===R.Kind.Audio?(r.on(N.AudioPlaybackStarted,this.handleAudioPlaybackStarted),r.on(N.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):r.kind===R.Kind.Video&&(r.on(N.VideoPlaybackFailed,this.handleVideoPlaybackFailed),r.on(N.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(O.TrackSubscribed,r,o,i)}).on(U.TrackUnpublished,r=>{this.emit(O.TrackUnpublished,r,i)}).on(U.TrackUnsubscribed,(r,o)=>{this.emit(O.TrackUnsubscribed,r,o,i)}).on(U.TrackMuted,r=>{this.emitWhenConnected(O.TrackMuted,r,i)}).on(U.TrackUnmuted,r=>{this.emitWhenConnected(O.TrackUnmuted,r,i)}).on(U.ParticipantMetadataChanged,r=>{this.emitWhenConnected(O.ParticipantMetadataChanged,r,i)}).on(U.ParticipantNameChanged,r=>{this.emitWhenConnected(O.ParticipantNameChanged,r,i)}).on(U.AttributesChanged,r=>{this.emitWhenConnected(O.ParticipantAttributesChanged,r,i)}).on(U.ConnectionQualityChanged,r=>{this.emitWhenConnected(O.ConnectionQualityChanged,r,i)}).on(U.ParticipantPermissionsChanged,r=>{this.emitWhenConnected(O.ParticipantPermissionsChanged,r,i)}).on(U.TrackSubscriptionStatusChanged,(r,o)=>{this.emitWhenConnected(O.TrackSubscriptionStatusChanged,r,o,i)}).on(U.TrackSubscriptionFailed,(r,o)=>{this.emit(O.TrackSubscriptionFailed,r,i,o)}).on(U.TrackSubscriptionPermissionChanged,(r,o)=>{this.emitWhenConnected(O.TrackSubscriptionPermissionChanged,r,o,i)}).on(U.Active,()=>{this.emitWhenConnected(O.ParticipantActive,i),i.kind===ji.AGENT&&this.localParticipant.setActiveAgent(i)}),n&&i.updateInfo(n),i}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((i,r)=>(i.push(...r.getTrackPublications()),i),[]),n=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,n)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const n of e.videoTrackPublications.values())n.isSubscribed&&Cb(n)&&n.emitTrackUpdate()}getRemoteParticipantBySid(e){const n=this.sidToIdentity.get(e);if(n)return this.remoteParticipants.get(n)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=ze.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,mt.STATE_MISMATCH))):e=0},M0)}clearConnectionReconcile(){this.connectionReconcileInterval&&ze.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit(O.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[n,i]=e;this.emit(n,...i)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(this.state===ae.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,i]);else if(this.state===ae.Connected)return this.emit(e,...i);return!1}simulateParticipants(e){return w(this,void 0,void 0,function*(){var n,i;const r=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),o=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new Rr({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:Se.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new An({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(O.SignalConnected),this.emit(O.Connected),this.setAndEmitConnectionState(ae.Connected),r.video){const s=new ba(R.Kind.Video,new ti({source:De.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:pt.AUDIO,name:"video-dummy"}),new Jr(r.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:ju(160*((n=o.aspectRatios[0])!==null&&n!==void 0?n:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(s),this.localParticipant.emit(U.LocalTrackPublished,s)}if(r.audio){const s=new ba(R.Kind.Audio,new ti({source:De.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:pt.AUDIO}),new Kr(r.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:Hs(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(s),this.localParticipant.emit(U.LocalTrackPublished,s)}for(let s=0;s<o.count-1;s+=1){let a=new An({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(s),state:ei.ACTIVE,tracks:[],joinedAt:Se.parse(Date.now())});const c=this.getOrCreateParticipant(a.identity,a);if(o.video){const l=ju(160*((i=o.aspectRatios[s%o.aspectRatios.length])!==null&&i!==void 0?i:1),160,!1,!0),d=new ti({source:De.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:pt.AUDIO});c.addSubscribedMediaTrack(l,d.sid,new MediaStream([l]),new RTCRtpReceiver),a.tracks=[...a.tracks,d]}if(o.audio){const l=Hs(),d=new ti({source:De.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:pt.AUDIO});c.addSubscribedMediaTrack(l,d.sid,new MediaStream([l]),new RTCRtpReceiver),a.tracks=[...a.tracks,d]}c.updateInfo(a)}})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(e!==O.ActiveSpeakersChanged&&e!==O.TranscriptionReceived){const o=Ch(i).filter(s=>s!==void 0);this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:o}))}return super.emit(e,...i)}}di.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(t=>{t()});function Ch(t){return t.map(e=>{if(e)return Array.isArray(e)?Ch(e):typeof e=="object"?"logContext"in e?e.logContext:void 0:e})}var wt;(function(t){t[t.IDLE=0]="IDLE",t[t.RUNNING=1]="RUNNING",t[t.SKIPPED=2]="SKIPPED",t[t.SUCCESS=3]="SUCCESS",t[t.FAILED=4]="FAILED"})(wt||(wt={}));class Cn extends It.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=wt.IDLE,this.logs=[],this.options={},this.url=e,this.token=n,this.name=this.constructor.name,this.room=new di(i.roomOptions),this.connectOptions=i.connectOptions,this.options=i}run(e){return w(this,void 0,void 0,function*(){if(this.status!==wt.IDLE)throw Error("check is running already");this.setStatus(wt.RUNNING);try{yield this.perform()}catch(n){n instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(n.message):this.appendError(n.message))}return yield this.disconnect(),yield new Promise(n=>setTimeout(n,500)),this.status!==wt.SKIPPED&&this.setStatus(this.isSuccess()?wt.SUCCESS:wt.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(e){return w(this,void 0,void 0,function*(){return this.room.state===ae.Connected?this.room:(e||(e=this.url),yield this.room.connect(e,this.token,this.connectOptions),this.room)})}disconnect(){return w(this,void 0,void 0,function*(){this.room&&this.room.state!==ae.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(wt.SKIPPED)}switchProtocol(e){return w(this,void 0,void 0,function*(){let n=!1,i=!1;if(this.room.on(O.Reconnecting,()=>{n=!0}),this.room.once(O.Reconnected,()=>{i=!0}),this.room.simulateScenario("force-".concat(e)),yield new Promise(o=>setTimeout(o,1e3)),!n)return;const r=Date.now()+1e4;for(;Date.now()<r;){if(i)return;yield Xe(100)}throw new Error("Could not reconnect using ".concat(e," protocol after 10 seconds"))})}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class N0 extends Cn{get description(){return"Cloud regions"}perform(){return w(this,void 0,void 0,function*(){const e=new ma(this.url,this.token);if(!e.isCloud()){this.skip();return}const n=[],i=new Set;for(let o=0;o<3;o++){const s=yield e.getNextBestRegionUrl();if(!s)break;if(i.has(s))continue;i.add(s);const a=yield this.checkCloudRegion(s);this.appendMessage("".concat(a.region," RTT: ").concat(a.rtt,"ms, duration: ").concat(a.duration,"ms")),n.push(a)}n.sort((o,s)=>(o.duration-s.duration)*.5+(o.rtt-s.rtt)*.5);const r=n[0];this.bestStats=r,this.appendMessage("best Cloud region: ".concat(r.region))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkCloudRegion(e){return w(this,void 0,void 0,function*(){var n,i;yield this.connect(e),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const r=(n=this.room.serverInfo)===null||n===void 0?void 0:n.region;if(!r)throw new Error("Region not found");const o=yield this.room.localParticipant.streamText({topic:"test"}),s=1e3,c=1e6/s,l="A".repeat(s),d=Date.now();for(let g=0;g<c;g++)yield o.write(l);yield o.close();const u=Date.now(),h=yield(i=this.room.engine.pcManager)===null||i===void 0?void 0:i.publisher.getStats(),f={region:r,rtt:1e4,duration:u-d};return h==null||h.forEach(g=>{g.type==="candidate-pair"&&g.nominated&&(f.rtt=g.currentRoundTripTime*1e3)}),yield this.disconnect(),f})}}const ya=1e4;class L0 extends Cn{get description(){return"Connection via UDP vs TCP"}perform(){return w(this,void 0,void 0,function*(){const e=yield this.checkConnectionProtocol("udp"),n=yield this.checkConnectionProtocol("tcp");this.bestStats=e,e.qualityLimitationDurations.bandwidth-n.qualityLimitationDurations.bandwidth>.5||(e.packetsLost-n.packetsLost)/e.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=n):this.appendMessage("best connection quality via udp");const i=this.bestStats;this.appendMessage("upstream bitrate: ".concat((i.bitrateTotal/i.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((i.rttTotal/i.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((i.jitterTotal/i.count*1e3).toFixed(2)," ms")),i.packetsLost>0&&this.appendWarning("packets lost: ".concat((i.packetsLost/i.packetsSent*100).toFixed(2),"%")),i.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((i.qualityLimitationDurations.bandwidth/(ya/1e3)*100).toFixed(2),"%")),i.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((i.qualityLimitationDurations.cpu/(ya/1e3)*100).toFixed(2),"%"))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkConnectionProtocol(e){return w(this,void 0,void 0,function*(){yield this.connect(),e==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const n=document.createElement("canvas");n.width=1280,n.height=720;const i=n.getContext("2d");if(!i)throw new Error("Could not get canvas context");let r=0;const o=()=>{r=(r+1)%360,i.fillStyle="hsl(".concat(r,", 100%, 50%)"),i.fillRect(0,0,n.width,n.height),requestAnimationFrame(o)};o();const a=n.captureStream(30).getVideoTracks()[0],l=(yield this.room.localParticipant.publishTrack(a,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,d={protocol:e,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},u=setInterval(()=>w(this,void 0,void 0,function*(){const h=yield l.getRTCStatsReport();h==null||h.forEach(f=>{f.type==="outbound-rtp"?(d.packetsSent=f.packetsSent,d.qualityLimitationDurations=f.qualityLimitationDurations,d.bitrateTotal+=f.targetBitrate,d.count++):f.type==="remote-inbound-rtp"&&(d.packetsLost=f.packetsLost,d.rttTotal+=f.roundTripTime,d.jitterTotal+=f.jitter)})}),1e3);return yield new Promise(h=>setTimeout(h,ya)),clearInterval(u),a.stop(),n.remove(),yield this.disconnect(),d})}}class U0 extends Cn{get description(){return"Can publish audio"}perform(){return w(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield kh();if(yield zu(i,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),n.localParticipant.publishTrack(i),yield new Promise(a=>setTimeout(a,3e3));const o=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!o)throw new Error("Could not get RTCStats");let s=0;if(o.forEach(a=>{a.type==="outbound-rtp"&&(a.kind==="audio"||!a.kind&&a.mediaType==="audio")&&(s=a.packetsSent)}),s===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(s," audio packets"))})}}class F0 extends Cn{get description(){return"Can publish video"}perform(){return w(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield R0();yield this.checkForVideo(i.mediaStreamTrack),n.localParticipant.publishTrack(i),yield new Promise(s=>setTimeout(s,5e3));const r=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!r)throw new Error("Could not get RTCStats");let o=0;if(r.forEach(s=>{s.type==="outbound-rtp"&&(s.kind==="video"||!s.kind&&s.mediaType==="video")&&(o+=s.packetsSent)}),o===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(o," video packets"))})}checkForVideo(e){return w(this,void 0,void 0,function*(){const n=new MediaStream;n.addTrack(e.clone());const i=document.createElement("video");i.srcObject=n,i.muted=!0,yield new Promise(r=>{i.onplay=()=>{setTimeout(()=>{var o,s,a,c;const l=document.createElement("canvas"),d=e.getSettings(),u=(s=(o=d.width)!==null&&o!==void 0?o:i.videoWidth)!==null&&s!==void 0?s:1280,h=(c=(a=d.height)!==null&&a!==void 0?a:i.videoHeight)!==null&&c!==void 0?c:720;l.width=u,l.height=h;const f=l.getContext("2d");f.drawImage(i,0,0);const p=f.getImageData(0,0,l.width,l.height).data;let v=!0;for(let b=0;b<p.length;b+=4)if(p[b]!==0||p[b+1]!==0||p[b+2]!==0){v=!1;break}v?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),r()},1e3)},i.play()}),n.getTracks().forEach(r=>r.stop()),i.remove()})}}class B0 extends Cn{get description(){return"Resuming connection after interruption"}perform(){return w(this,void 0,void 0,function*(){var e;const n=yield this.connect();let i=!1,r=!1,o;const s=new Promise(l=>{setTimeout(l,5e3),o=l}),a=()=>{i=!0};n.on(O.SignalReconnecting,a).on(O.Reconnecting,a).on(O.Reconnected,()=>{r=!0,o(!0)}),(e=n.engine.client.ws)===null||e===void 0||e.close();const c=n.engine.client.onClose;if(c&&c(""),yield s,i){if(!r||n.state!==ae.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class j0 extends Cn{get description(){return"Can connect via TURN"}perform(){return w(this,void 0,void 0,function*(){var e,n;const i=new ea,r=yield i.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});let o=!1,s=!1,a=!1;for(let c of r.iceServers)for(let l of c.urls)l.startsWith("turn:")?(s=!0,a=!0):l.startsWith("turns:")&&(s=!0,a=!0,o=!0),l.startsWith("stun:")&&(a=!0);a?s&&!o&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield i.close(),!((n=(e=this.connectOptions)===null||e===void 0?void 0:e.rtcConfig)===null||n===void 0)&&n.iceServers||s?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(c=>setTimeout(c,0)))})}}class V0 extends Cn{get description(){return"Establishing WebRTC connection"}perform(){return w(this,void 0,void 0,function*(){let e=!1,n=!1;this.room.on(O.SignalConnected,()=>{const i=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(r,o)=>{if(r.candidate){const s=new RTCIceCandidate(r);let a="".concat(s.protocol," ").concat(s.address,":").concat(s.port," ").concat(s.type);s.address&&(q0(s.address)?a+=" (private)":s.protocol==="tcp"&&s.tcpType==="passive"?(e=!0,a+=" (passive)"):s.protocol==="udp"&&(n=!0)),this.appendMessage(a)}i&&i(r,o)},this.room.engine.pcManager&&(this.room.engine.pcManager.subscriber.onIceCandidateError=r=>{r instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(r.errorCode," ").concat(r.errorText," ").concat(r.url))})});try{yield this.connect(),ie.info("now the room is connected")}catch(i){throw this.appendWarning("ports need to be open on firewall in order to connect."),i}e||this.appendWarning("Server is not configured for ICE/TCP"),n||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function q0(t){const e=t.split(".");if(e.length===4){if(e[0]==="10")return!0;if(e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const n=parseInt(e[1],10);if(n>=16&&n<=31)return!0}}return!1}class z0 extends Cn{get description(){return"Connecting to signal connection via WebSocket"}perform(){return w(this,void 0,void 0,function*(){var e,n,i;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let r=new ea;const o=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});this.appendMessage("Connected to server, version ".concat(o.serverVersion,".")),((e=o.serverInfo)===null||e===void 0?void 0:e.edition)===kd.Cloud&&(!((n=o.serverInfo)===null||n===void 0)&&n.region)&&this.appendMessage("LiveKit Cloud: ".concat((i=o.serverInfo)===null||i===void 0?void 0:i.region)),yield r.close()})}}class XS extends It.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=n,this.options=i}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:wt.IDLE,name:"",description:""}),e}updateCheck(e,n){this.checkResults.set(e,n),this.emit("checkUpdate",e,n)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==wt.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return w(this,void 0,void 0,function*(){const n=this.getNextCheckId(),i=new e(this.url,this.token,this.options),r=s=>{this.updateCheck(n,s)};i.on("update",r);const o=yield i.run();return i.off("update",r),o})}checkWebsocket(){return w(this,void 0,void 0,function*(){return this.createAndRunCheck(z0)})}checkWebRTC(){return w(this,void 0,void 0,function*(){return this.createAndRunCheck(V0)})}checkTURN(){return w(this,void 0,void 0,function*(){return this.createAndRunCheck(j0)})}checkReconnect(){return w(this,void 0,void 0,function*(){return this.createAndRunCheck(B0)})}checkPublishAudio(){return w(this,void 0,void 0,function*(){return this.createAndRunCheck(U0)})}checkPublishVideo(){return w(this,void 0,void 0,function*(){return this.createAndRunCheck(F0)})}checkConnectionProtocol(){return w(this,void 0,void 0,function*(){const e=yield this.createAndRunCheck(L0);if(e.data&&"protocol"in e.data){const n=e.data;this.options.protocol=n.protocol}return e})}checkCloudRegion(){return w(this,void 0,void 0,function*(){return this.createAndRunCheck(N0)})}}function tn(){return tn=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)({}).hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},tn.apply(null,arguments)}const _h=new Uint8Array(0);class Ji{static getFullOptions(e){return tn({clientTools:{},onConnect:()=>{},onDebug:()=>{},onDisconnect:()=>{},onError:()=>{},onMessage:()=>{},onAudio:()=>{},onModeChange:()=>{},onStatusChange:()=>{},onCanSendFeedbackChange:()=>{},onInterruption:()=>{}},e)}constructor(e,n){var i=this;this.options=void 0,this.connection=void 0,this.lastInterruptTimestamp=0,this.mode="listening",this.status="connecting",this.volume=1,this.currentEventId=1,this.lastFeedbackEventId=0,this.canSendFeedback=!1,this.endSessionWithDetails=async function(r){i.status!=="connected"&&i.status!=="connecting"||(i.updateStatus("disconnecting"),await i.handleEndSession(),i.updateStatus("disconnected"),i.options.onDisconnect&&i.options.onDisconnect(r))},this.onMessage=async function(r){switch(r.type){case"interruption":return void i.handleInterruption(r);case"agent_response":return void i.handleAgentResponse(r);case"user_transcript":return void i.handleUserTranscript(r);case"internal_tentative_agent_response":return void i.handleTentativeAgentResponse(r);case"client_tool_call":try{await i.handleClientToolCall(r)}catch(o){i.onError(`Unexpected error in client tool call handling: ${o instanceof Error?o.message:String(o)}`,{clientToolName:r.client_tool_call.tool_name,toolCallId:r.client_tool_call.tool_call_id})}return;case"audio":return void i.handleAudio(r);case"vad_score":return void i.handleVadScore(r);case"ping":return void i.connection.sendMessage({type:"pong",event_id:r.ping_event.event_id});case"mcp_tool_call":return void i.handleMCPToolCall(r);case"mcp_connection_status":return void i.handleMCPConnectionStatus(r);case"agent_tool_request":return void i.handleAgentToolRequest(r);case"agent_tool_response":return void i.handleAgentToolResponse(r);case"conversation_initiation_metadata":return void i.handleConversationMetadata(r);case"asr_initiation_metadata":return void i.handleAsrInitiationMetadata(r);case"agent_chat_response_part":return void i.handleAgentChatResponsePart(r);case"error":return void i.handleErrorEvent(r);default:return void(i.options.onDebug&&i.options.onDebug(r))}},this.setVolume=({volume:r})=>{this.volume=r},this.options=e,this.connection=n,this.options.onConnect&&this.options.onConnect({conversationId:n.conversationId}),this.connection.onMessage(this.onMessage),this.connection.onDisconnect(this.endSessionWithDetails),this.connection.onModeChange(r=>this.updateMode(r)),this.updateStatus("connected")}endSession(){return this.endSessionWithDetails({reason:"user"})}async handleEndSession(){this.connection.close()}updateMode(e){e!==this.mode&&(this.mode=e,this.options.onModeChange&&this.options.onModeChange({mode:e}))}updateStatus(e){e!==this.status&&(this.status=e,this.options.onStatusChange&&this.options.onStatusChange({status:e}))}updateCanSendFeedback(){const e=this.currentEventId!==this.lastFeedbackEventId;this.canSendFeedback!==e&&(this.canSendFeedback=e,this.options.onCanSendFeedbackChange&&this.options.onCanSendFeedbackChange({canSendFeedback:e}))}handleInterruption(e){e.interruption_event&&(this.lastInterruptTimestamp=e.interruption_event.event_id,this.options.onInterruption&&this.options.onInterruption({event_id:e.interruption_event.event_id}))}handleAgentResponse(e){this.options.onMessage&&this.options.onMessage({source:"ai",role:"agent",message:e.agent_response_event.agent_response})}handleUserTranscript(e){this.options.onMessage&&this.options.onMessage({source:"user",role:"user",message:e.user_transcription_event.user_transcript})}handleTentativeAgentResponse(e){this.options.onDebug&&this.options.onDebug({type:"tentative_agent_response",response:e.tentative_agent_response_internal_event.tentative_agent_response})}handleVadScore(e){this.options.onVadScore&&this.options.onVadScore({vadScore:e.vad_score_event.vad_score})}async handleClientToolCall(e){if(Object.prototype.hasOwnProperty.call(this.options.clientTools,e.client_tool_call.tool_name))try{var n;const i=(n=await this.options.clientTools[e.client_tool_call.tool_name](e.client_tool_call.parameters))!=null?n:"Client tool execution successful.",r=typeof i=="object"?JSON.stringify(i):String(i);this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:r,is_error:!1})}catch(i){this.onError(`Client tool execution failed with following error: ${i==null?void 0:i.message}`,{clientToolName:e.client_tool_call.tool_name}),this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:`Client tool execution failed: ${i==null?void 0:i.message}`,is_error:!0})}else{if(this.options.onUnhandledClientToolCall)return void this.options.onUnhandledClientToolCall(e.client_tool_call);this.onError(`Client tool with name ${e.client_tool_call.tool_name} is not defined on client`,{clientToolName:e.client_tool_call.tool_name}),this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:`Client tool with name ${e.client_tool_call.tool_name} is not defined on client`,is_error:!0})}}handleAudio(e){}handleMCPToolCall(e){this.options.onMCPToolCall&&this.options.onMCPToolCall(e.mcp_tool_call)}handleMCPConnectionStatus(e){this.options.onMCPConnectionStatus&&this.options.onMCPConnectionStatus(e.mcp_connection_status)}handleAgentToolRequest(e){this.options.onAgentToolRequest&&this.options.onAgentToolRequest(e.agent_tool_request)}handleAgentToolResponse(e){e.agent_tool_response.tool_name==="end_call"&&this.endSessionWithDetails({reason:"agent",context:new CloseEvent("end_call",{reason:"Agent ended the call"})}),this.options.onAgentToolResponse&&this.options.onAgentToolResponse(e.agent_tool_response)}handleConversationMetadata(e){this.options.onConversationMetadata&&this.options.onConversationMetadata(e.conversation_initiation_metadata_event)}handleAsrInitiationMetadata(e){this.options.onAsrInitiationMetadata&&this.options.onAsrInitiationMetadata(e.asr_initiation_metadata_event)}handleAgentChatResponsePart(e){this.options.onAgentChatResponsePart&&this.options.onAgentChatResponsePart(e.text_response_part)}handleErrorEvent(e){const n=e.error_event.error_type,i=e.error_event.message||e.error_event.reason||"Unknown error";n!=="max_duration_exceeded"?this.onError(`Server error: ${i}`,{errorType:n,code:e.error_event.code,debugMessage:e.error_event.debug_message,details:e.error_event.details}):this.endSessionWithDetails({reason:"error",message:i,context:new Event("max_duration_exceeded")})}onError(e,n){console.error(e,n),this.options.onError&&this.options.onError(e,n)}getId(){return this.connection.conversationId}isOpen(){return this.status==="connected"}setMicMuted(e){this.connection.setMicMuted(e)}getInputByteFrequencyData(){return _h}getOutputByteFrequencyData(){return _h}getInputVolume(){return 0}getOutputVolume(){return 0}sendFeedback(e){this.canSendFeedback?(this.connection.sendMessage({type:"feedback",score:e?"like":"dislike",event_id:this.currentEventId}),this.lastFeedbackEventId=this.currentEventId,this.updateCanSendFeedback()):console.warn(this.lastFeedbackEventId===0?"Cannot send feedback: the conversation has not started yet.":"Cannot send feedback: feedback has already been sent for the current response.")}sendContextualUpdate(e){this.connection.sendMessage({type:"contextual_update",text:e})}sendUserMessage(e){this.connection.sendMessage({type:"user_message",text:e})}sendUserActivity(){this.connection.sendMessage({type:"user_activity"})}sendMCPToolApprovalResult(e,n){this.connection.sendMessage({type:"mcp_tool_approval_result",tool_call_id:e,is_approved:n})}}class Sh{constructor(e={}){this.queue=[],this.disconnectionDetails=null,this.onDisconnectCallback=null,this.onMessageCallback=null,this.onModeChangeCallback=null,this.onDebug=void 0,this.onDebug=e.onDebug}debug(e){this.onDebug&&this.onDebug(e)}onMessage(e){this.onMessageCallback=e;const n=this.queue;this.queue=[],n.length>0&&queueMicrotask(()=>{n.forEach(e)})}onDisconnect(e){this.onDisconnectCallback=e;const n=this.disconnectionDetails;n&&queueMicrotask(()=>{e(n)})}onModeChange(e){this.onModeChangeCallback=e}updateMode(e){var n;(n=this.onModeChangeCallback)==null||n.call(this,e)}disconnect(e){var n;this.disconnectionDetails||(this.disconnectionDetails=e,(n=this.onDisconnectCallback)==null||n.call(this,e))}handleMessage(e){this.onMessageCallback?this.onMessageCallback(e):this.queue.push(e)}}function Qr(t){const[e,n]=t.split("_");if(!["pcm","ulaw"].includes(e))throw new Error(`Invalid format: ${t}`);const i=Number.parseInt(n);if(Number.isNaN(i))throw new Error(`Invalid sample rate: ${n}`);return{format:e,sampleRate:i}}const Th="0.12.0";function ka(t){return!!t.type}const xh="conversation_initiation_client_data";function Eh(t){var e;const n={type:xh};var i,r,o,s,a;return t.overrides&&(n.conversation_config_override={agent:{prompt:(i=t.overrides.agent)==null?void 0:i.prompt,first_message:(r=t.overrides.agent)==null?void 0:r.firstMessage,language:(o=t.overrides.agent)==null?void 0:o.language},tts:{voice_id:(s=t.overrides.tts)==null?void 0:s.voiceId},conversation:{text_only:(a=t.overrides.conversation)==null?void 0:a.textOnly}}),t.customLlmExtraBody&&(n.custom_llm_extra_body=t.customLlmExtraBody),t.dynamicVariables&&(n.dynamic_variables=t.dynamicVariables),t.userId&&(n.user_id=t.userId),(e=t.overrides)!=null&&e.client&&(n.source_info={source:t.overrides.client.source,version:t.overrides.client.version}),n}class Yi extends Sh{constructor(e,n,i,r){super(),this.socket=void 0,this.conversationId=void 0,this.inputFormat=void 0,this.outputFormat=void 0,this.socket=e,this.conversationId=n,this.inputFormat=i,this.outputFormat=r,this.socket.addEventListener("error",o=>{setTimeout(()=>this.disconnect({reason:"error",message:"The connection was closed due to a socket error.",context:o}),0)}),this.socket.addEventListener("close",o=>{this.disconnect(o.code===1e3?{reason:"agent",context:o}:{reason:"error",message:o.reason||"The connection was closed by the server.",context:o})}),this.socket.addEventListener("message",o=>{try{const s=JSON.parse(o.data);if(!ka(s))return void this.debug({type:"invalid_event",message:"Received invalid socket event",data:o.data});this.handleMessage(s)}catch(s){this.debug({type:"parsing_error",message:"Failed to parse socket message",error:s instanceof Error?s.message:String(s),data:o.data})}})}static async create(e){let n=null;try{var i,r,o;const a=(i=e.origin)!=null?i:"wss://api.elevenlabs.io";let c;const l=((r=e.overrides)==null||(r=r.client)==null?void 0:r.version)||Th,d=((o=e.overrides)==null||(o=o.client)==null?void 0:o.source)||"js_sdk";if(e.signedUrl){const k=e.signedUrl.includes("?")?"&":"?";c=`${e.signedUrl}${k}source=${d}&version=${l}`}else c=`${a}/v1/convai/conversation?agent_id=${e.agentId}&source=${d}&version=${l}`;const u=["convai"];e.authorization&&u.push(`bearer.${e.authorization}`),n=new WebSocket(c,u);const h=await new Promise((k,C)=>{n.addEventListener("open",()=>{var y;const _=Eh(e);(y=n)==null||y.send(JSON.stringify(_))},{once:!0}),n.addEventListener("error",y=>{setTimeout(()=>C(y),0)}),n.addEventListener("close",C),n.addEventListener("message",y=>{const _=JSON.parse(y.data);ka(_)&&(_.type==="conversation_initiation_metadata"?k(_.conversation_initiation_metadata_event):console.warn("First received message is not conversation metadata."))},{once:!0})}),{conversation_id:f,agent_output_audio_format:g,user_input_audio_format:p}=h,v=Qr(p??"pcm_16000"),b=Qr(g);return new Yi(n,f,v,b)}catch(a){var s;throw(s=n)==null||s.close(),a}}close(){this.socket.close()}sendMessage(e){this.socket.send(JSON.stringify(e))}async setMicMuted(e){console.warn(`WebSocket connection setMicMuted called with ${e}, but this is handled by VoiceConversation`)}}function Ph(t){const e=new Uint8Array(t);return window.btoa(String.fromCharCode(...e))}function $0(t){const e=window.atob(t),n=e.length,i=new Uint8Array(n);for(let r=0;r<n;r++)i[r]=e.charCodeAt(r);return i.buffer}const Zr=new Map;function Rh(t,e){return async(n,i)=>{const r=Zr.get(t);if(r)return n.addModule(r);if(i)try{return await n.addModule(i),void Zr.set(t,i)}catch(a){throw new Error(`Failed to load the ${t} worklet module from path: ${i}. Error: ${a}`)}const o=new Blob([e],{type:"application/javascript"}),s=URL.createObjectURL(o);try{return await n.addModule(s),void Zr.set(t,s)}catch{URL.revokeObjectURL(s)}try{const a=`data:application/javascript;base64,${btoa(e)}`;await n.addModule(a),Zr.set(t,a)}catch{throw new Error(`Failed to load the ${t} worklet module. Make sure the browser supports AudioWorklets. If you are using a strict CSP, you may need to self-host the worklet files.`)}}}const Ih=Rh("rawAudioProcessor",`/*
 * ulaw encoding logic taken from the wavefile library
 * https://github.com/rochars/wavefile/blob/master/lib/codecs/mulaw.js
 * USED BY @elevenlabs/client
 */

const BIAS = 0x84;
const CLIP = 32635;
const encodeTable = [
  0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,
  4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,
  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,
  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7
];

function encodeSample(sample) {
  let sign;
  let exponent;
  let mantissa;
  let muLawSample;
  sign = (sample >> 8) & 0x80;
  if (sign !== 0) sample = -sample;
  sample = sample + BIAS;
  if (sample > CLIP) sample = CLIP;
  exponent = encodeTable[(sample>>7) & 0xFF];
  mantissa = (sample >> (exponent+3)) & 0x0F;
  muLawSample = ~(sign | (exponent << 4) | mantissa);
  
  return muLawSample;
}

class RawAudioProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
              
    this.port.onmessage = ({ data }) => {
      switch (data.type) {
        case "setFormat":
          this.isMuted = false;
          this.buffer = []; // Initialize an empty buffer
          this.bufferSize = data.sampleRate / 4;
          this.format = data.format;

          if (globalThis.LibSampleRate && sampleRate !== data.sampleRate) {
            globalThis.LibSampleRate.create(1, sampleRate, data.sampleRate).then(resampler => {
              this.resampler = resampler;
            });
          }
          break;
        case "setMuted":
          this.isMuted = data.isMuted;
          break;
      }
    };
  }
  process(inputs) {
    if (!this.buffer) {
      return true;
    }
    
    const input = inputs[0]; // Get the first input node
    if (input.length > 0) {
      let channelData = input[0]; // Get the first channel's data

      // Resample the audio if necessary
      if (this.resampler) {
        channelData = this.resampler.full(channelData);
      }

      // Add channel data to the buffer
      this.buffer.push(...channelData);
      // Get max volume 
      let sum = 0.0;
      for (let i = 0; i < channelData.length; i++) {
        sum += channelData[i] * channelData[i];
      }
      const maxVolume = Math.sqrt(sum / channelData.length);
      // Check if buffer size has reached or exceeded the threshold
      if (this.buffer.length >= this.bufferSize) {
        const float32Array = this.isMuted 
          ? new Float32Array(this.buffer.length)
          : new Float32Array(this.buffer);

        let encodedArray = this.format === "ulaw"
          ? new Uint8Array(float32Array.length)
          : new Int16Array(float32Array.length);

        // Iterate through the Float32Array and convert each sample to PCM16
        for (let i = 0; i < float32Array.length; i++) {
          // Clamp the value to the range [-1, 1]
          let sample = Math.max(-1, Math.min(1, float32Array[i]));

          // Scale the sample to the range [-32768, 32767]
          let value = sample < 0 ? sample * 32768 : sample * 32767;
          if (this.format === "ulaw") {
            value = encodeSample(Math.round(value));
          }

          encodedArray[i] = value;
        }

        // Send the buffered data to the main script
        this.port.postMessage([encodedArray, maxVolume]);

        // Clear the buffer after sending
        this.buffer = [];
      }
    }
    return true; // Continue processing
  }
}
registerProcessor("rawAudioProcessor", RawAudioProcessor);
`);class nn extends Sh{constructor(e,n,i,r,o={}){super(o),this.conversationId=void 0,this.inputFormat=void 0,this.outputFormat=void 0,this.room=void 0,this.isConnected=!1,this.audioEventId=1,this.audioCaptureContext=null,this.audioElements=[],this.outputDeviceId=null,this.outputAnalyser=null,this.outputFrequencyData=null,this.room=e,this.conversationId=n,this.inputFormat=i,this.outputFormat=r,this.setupRoomEventListeners()}static async create(e){let n;if("conversationToken"in e&&e.conversationToken)n=e.conversationToken;else{if(!("agentId"in e)||!e.agentId)throw new Error("Either conversationToken or agentId is required for WebRTC connection");try{var i,r,o;const l=((i=e.overrides)==null||(i=i.client)==null?void 0:i.version)||Th,d=((r=e.overrides)==null||(r=r.client)==null?void 0:r.source)||"js_sdk",u=`${s=(o=e.origin)!=null?o:"https://api.elevenlabs.io",s.replace(/^wss:\/\//,"https://")}/v1/convai/conversation/token?agent_id=${e.agentId}&source=${d}&version=${l}`,h=await fetch(u);if(!h.ok)throw new Error(`ElevenLabs API returned ${h.status} ${h.statusText}`);if(n=(await h.json()).token,!n)throw new Error("No conversation token received from API")}catch(l){let d=l instanceof Error?l.message:String(l);throw l instanceof Error&&l.message.includes("401")&&(d="Your agent has authentication enabled, but no signed URL or conversation token was provided."),new Error(`Failed to fetch conversation token for agent ${e.agentId}: ${d}`)}}var s;const a=new di;try{const l=`room_${Date.now()}`,d=Qr("pcm_48000"),u=Qr("pcm_48000"),h=new nn(a,l,d,u,e),f=e.livekitUrl||"wss://livekit.rtc.elevenlabs.io";var c;await a.connect(f,n),await new Promise(p=>{if(h.isConnected)p();else{const v=()=>{a.off(O.Connected,v),p()};a.on(O.Connected,v)}}),a.name&&(h.conversationId=((c=a.name.match(/(conv_[a-zA-Z0-9]+)/))==null?void 0:c[0])||a.name),await a.localParticipant.setMicrophoneEnabled(!0);const g=Eh(e);return h.debug({type:xh,message:g}),await h.sendMessage(g),h}catch(l){throw await a.disconnect(),l}}setupRoomEventListeners(){var e=this;this.room.on(O.Connected,async function(){e.isConnected=!0,console.info("WebRTC room connected")}),this.room.on(O.Disconnected,n=>{this.isConnected=!1,this.disconnect({reason:"agent",context:new CloseEvent("close",{reason:n==null?void 0:n.toString()})})}),this.room.on(O.ConnectionStateChanged,n=>{n===ae.Disconnected&&(this.isConnected=!1,this.disconnect({reason:"error",message:`LiveKit connection state changed to ${n}`,context:new Event("connection_state_changed")}))}),this.room.on(O.DataReceived,(n,i)=>{try{const r=JSON.parse(new TextDecoder().decode(n));if(r.type==="audio")return;ka(r)?this.handleMessage(r):console.warn("Invalid socket event received:",r)}catch(r){console.warn("Failed to parse incoming data message:",r),console.warn("Raw payload:",new TextDecoder().decode(n))}}),this.room.on(O.TrackSubscribed,async function(n,i,r){if(n.kind===R.Kind.Audio&&r.identity.includes("agent")){const o=n,s=o.attach();if(s.autoplay=!0,s.controls=!1,e.outputDeviceId&&s.setSinkId)try{await s.setSinkId(e.outputDeviceId)}catch(a){console.warn("Failed to set output device for new audio element:",a)}s.style.display="none",document.body.appendChild(s),e.audioElements.push(s),e.audioElements.length===1&&(e.onDebug==null||e.onDebug({type:"audio_element_ready"})),await e.setupAudioCapture(o)}}),this.room.on(O.ActiveSpeakersChanged,async function(n){e.updateMode(n.length>0&&n[0].identity.startsWith("agent")?"speaking":"listening")}),this.room.on(O.ParticipantDisconnected,n=>{var i;(i=n.identity)!=null&&i.startsWith("agent")&&this.disconnect({reason:"agent",context:new CloseEvent("close",{reason:"agent disconnected"})})})}close(){if(this.isConnected){try{this.room.localParticipant.audioTrackPublications.forEach(e=>{e.track&&e.track.stop()})}catch(e){console.warn("Error stopping local tracks:",e)}this.audioCaptureContext&&(this.audioCaptureContext.close().catch(e=>{console.warn("Error closing audio capture context:",e)}),this.audioCaptureContext=null),this.audioElements.forEach(e=>{e.parentNode&&e.parentNode.removeChild(e)}),this.audioElements=[],this.room.disconnect()}}async sendMessage(e){if(this.isConnected&&this.room.localParticipant){if(!("user_audio_chunk"in e))try{const n=new TextEncoder().encode(JSON.stringify(e));await this.room.localParticipant.publishData(n,{reliable:!0})}catch(n){this.debug({type:"send_message_error",message:{message:e,error:n}}),console.error("Failed to send message via WebRTC:",n)}}else console.warn("Cannot send message: room not connected or no local participant")}getRoom(){return this.room}async setMicMuted(e){if(!this.isConnected||!this.room.localParticipant)return void console.warn("Cannot set microphone muted: room not connected or no local participant");const n=this.room.localParticipant.getTrackPublication(R.Source.Microphone);if(n!=null&&n.track)try{e?await n.track.mute():await n.track.unmute()}catch{await this.room.localParticipant.setMicrophoneEnabled(!e)}else await this.room.localParticipant.setMicrophoneEnabled(!e)}async setupAudioCapture(e){try{const n=new AudioContext;this.audioCaptureContext=n,this.outputAnalyser=n.createAnalyser(),this.outputAnalyser.fftSize=2048,this.outputAnalyser.smoothingTimeConstant=.8;const i=new MediaStream([e.mediaStreamTrack]),r=n.createMediaStreamSource(i);r.connect(this.outputAnalyser),await Ih(n.audioWorklet);const o=new AudioWorkletNode(n,"rawAudioProcessor");this.outputAnalyser.connect(o),o.port.postMessage({type:"setFormat",format:this.outputFormat.format,sampleRate:this.outputFormat.sampleRate}),o.port.onmessage=s=>{const[a,c]=s.data;if(c>.01){const l=Ph(a.buffer),d=this.audioEventId++;this.handleMessage({type:"audio",audio_event:{audio_base_64:l,event_id:d}})}},r.connect(o)}catch(n){console.warn("Failed to set up audio capture:",n)}}setAudioVolume(e){this.audioElements.forEach(n=>{n.volume=e})}async setAudioOutputDevice(e){if(!("setSinkId"in HTMLAudioElement.prototype))throw new Error("setSinkId is not supported in this browser");const n=this.audioElements.map(async function(i){try{await i.setSinkId(e)}catch(r){throw console.error("Failed to set sink ID for audio element:",r),r}});await Promise.all(n),this.outputDeviceId=e}async setAudioInputDevice(e){if(!this.isConnected||!this.room.localParticipant)throw new Error("Cannot change input device: room not connected or no local participant");try{const n=this.room.localParticipant.getTrackPublication(R.Source.Microphone);n!=null&&n.track&&(await n.track.stop(),await this.room.localParticipant.unpublishTrack(n.track));const i={deviceId:{exact:e},echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,channelCount:{ideal:1}},r=await kh(i);await this.room.localParticipant.publishTrack(r,{name:"microphone",source:R.Source.Microphone})}catch(n){console.error("Failed to change input device:",n);try{await this.room.localParticipant.setMicrophoneEnabled(!0)}catch(i){console.error("Failed to recover microphone after device switch error:",i)}throw n}}getOutputByteFrequencyData(){return this.outputAnalyser?(this.outputFrequencyData!=null||(this.outputFrequencyData=new Uint8Array(this.outputAnalyser.frequencyBinCount)),this.outputAnalyser.getByteFrequencyData(this.outputFrequencyData),this.outputFrequencyData):null}}async function Oh(t){const e=(function(n){return n.connectionType?n.connectionType:"conversationToken"in n&&n.conversationToken?"webrtc":"websocket"})(t);switch(e){case"websocket":return Yi.create(t);case"webrtc":return nn.create(t);default:throw new Error(`Unknown connection type: ${e}`)}}function wa(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}async function Dh(t={default:0,android:3e3}){let e=t.default;var n;if(/android/i.test(navigator.userAgent))e=(n=t.android)!=null?n:e;else if(wa()){var i;e=(i=t.ios)!=null?i:e}e>0&&await new Promise(r=>setTimeout(r,e))}class Ca extends Ji{static async startSession(e){const n=Ji.getFullOptions(e);n.onStatusChange&&n.onStatusChange({status:"connecting"}),n.onCanSendFeedbackChange&&n.onCanSendFeedbackChange({canSendFeedback:!1}),n.onModeChange&&n.onModeChange({mode:"listening"}),n.onCanSendFeedbackChange&&n.onCanSendFeedbackChange({canSendFeedback:!1});let i=null;try{return await Dh(n.connectionDelay),i=await Oh(e),new Ca(n,i)}catch(o){var r;throw n.onStatusChange&&n.onStatusChange({status:"disconnected"}),(r=i)==null||r.close(),o}}}const Ah={echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,channelCount:{ideal:1}};class ui{static async create({sampleRate:e,format:n,preferHeadphonesForIosDevices:i,inputDeviceId:r,workletPaths:o,libsampleratePath:s}){let a=null,c=null;try{const u=tn({sampleRate:{ideal:e}},Ah);if(wa()&&i){const b=(await window.navigator.mediaDevices.enumerateDevices()).find(k=>k.kind==="audioinput"&&["airpod","headphone","earphone"].find(C=>k.label.toLowerCase().includes(C)));b&&(u.deviceId={ideal:b.deviceId})}r&&(u.deviceId=ui.getDeviceIdConstraint(r));const h=navigator.mediaDevices.getSupportedConstraints().sampleRate;a=new window.AudioContext(h?{sampleRate:e}:{});const f=a.createAnalyser();if(!h){const b=s||"https://cdn.jsdelivr.net/npm/@alexanderolsen/libsamplerate-js@2.1.2/dist/libsamplerate.worklet.js";await a.audioWorklet.addModule(b)}await Ih(a.audioWorklet,o==null?void 0:o.rawAudioProcessor);const g=tn({voiceIsolation:!0},u);c=await navigator.mediaDevices.getUserMedia({audio:g});const p=a.createMediaStreamSource(c),v=new AudioWorkletNode(a,"rawAudioProcessor");return v.port.postMessage({type:"setFormat",format:n,sampleRate:e}),p.connect(f),f.connect(v),await a.resume(),new ui(a,f,v,c,p)}catch(u){var l,d;throw(l=c)==null||l.getTracks().forEach(h=>{h.stop()}),(d=a)==null||d.close(),u}}static getDeviceIdConstraint(e){if(e)return wa()?{ideal:e}:{exact:e}}constructor(e,n,i,r,o){this.context=void 0,this.analyser=void 0,this.worklet=void 0,this.inputStream=void 0,this.mediaStreamSource=void 0,this.context=e,this.analyser=n,this.worklet=i,this.inputStream=r,this.mediaStreamSource=o}async close(){this.inputStream.getTracks().forEach(e=>{e.stop()}),this.mediaStreamSource.disconnect(),await this.context.close()}setMuted(e){this.worklet.port.postMessage({type:"setMuted",isMuted:e})}async setInputDevice(e){try{const n=tn({},Ah);e&&(n.deviceId=ui.getDeviceIdConstraint(e));const i=tn({voiceIsolation:!0},n),r=await navigator.mediaDevices.getUserMedia({audio:i});this.inputStream.getTracks().forEach(o=>{o.stop()}),this.mediaStreamSource.disconnect(),this.inputStream=r,this.mediaStreamSource=this.context.createMediaStreamSource(r),this.mediaStreamSource.connect(this.analyser)}catch(n){throw console.error("Failed to switch input device:",n),n}}}const W0=Rh("audioConcatProcessor",`/*
 * ulaw decoding logic taken from the wavefile library
 * https://github.com/rochars/wavefile/blob/master/lib/codecs/mulaw.js
 * USED BY @elevenlabs/client
 */

const decodeTable = [0,132,396,924,1980,4092,8316,16764];

function decodeSample(muLawSample) {
  let sign;
  let exponent;
  let mantissa;
  let sample;
  muLawSample = ~muLawSample;
  sign = (muLawSample & 0x80);
  exponent = (muLawSample >> 4) & 0x07;
  mantissa = muLawSample & 0x0F;
  sample = decodeTable[exponent] + (mantissa << (exponent+3));
  if (sign !== 0) sample = -sample;

  return sample;
}

class AudioConcatProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
    this.buffers = []; // Initialize an empty buffer
    this.cursor = 0;
    this.currentBuffer = null;
    this.wasInterrupted = false;
    this.finished = false;
    
    this.port.onmessage = ({ data }) => {
      switch (data.type) {
        case "setFormat":
          this.format = data.format;
          break;
        case "buffer":
          this.wasInterrupted = false;
          this.buffers.push(
            this.format === "ulaw"
              ? new Uint8Array(data.buffer)
              : new Int16Array(data.buffer)
          );
          break;
        case "interrupt":
          this.wasInterrupted = true;
          break;
        case "clearInterrupted":
          if (this.wasInterrupted) {
            this.wasInterrupted = false;
            this.buffers = [];
            this.currentBuffer = null;
          }
      }
    };
  }
  process(_, outputs) {
    let finished = false;
    const output = outputs[0][0];
    for (let i = 0; i < output.length; i++) {
      if (!this.currentBuffer) {
        if (this.buffers.length === 0) {
          finished = true;
          break;
        }
        this.currentBuffer = this.buffers.shift();
        this.cursor = 0;
      }

      let value = this.currentBuffer[this.cursor];
      if (this.format === "ulaw") {
        value = decodeSample(value);
      }
      output[i] = value / 32768;
      this.cursor++;

      if (this.cursor >= this.currentBuffer.length) {
        this.currentBuffer = null;
      }
    }

    if (this.finished !== finished) {
      this.finished = finished;
      this.port.postMessage({ type: "process", finished });
    }

    return true; // Continue processing
  }
}

registerProcessor("audioConcatProcessor", AudioConcatProcessor);
`);let Mh=class bm{static async create({sampleRate:e,format:n,outputDeviceId:i,workletPaths:r}){let o=null,s=null;try{o=new AudioContext({sampleRate:e});const l=o.createAnalyser(),d=o.createGain();s=new Audio,s.src="",s.load(),s.autoplay=!0,s.style.display="none",document.body.appendChild(s);const u=o.createMediaStreamDestination();s.srcObject=u.stream,d.connect(l),l.connect(u),await W0(o.audioWorklet,r==null?void 0:r.audioConcatProcessor);const h=new AudioWorkletNode(o,"audioConcatProcessor");return h.port.postMessage({type:"setFormat",format:n}),h.connect(d),await o.resume(),i&&s.setSinkId&&await s.setSinkId(i),new bm(o,l,d,h,s)}catch(l){var a,c;throw(a=s)!=null&&a.parentNode&&s.parentNode.removeChild(s),(c=s)==null||c.pause(),o&&o.state!=="closed"&&await o.close(),l}}constructor(e,n,i,r,o){this.context=void 0,this.analyser=void 0,this.gain=void 0,this.worklet=void 0,this.audioElement=void 0,this.context=e,this.analyser=n,this.gain=i,this.worklet=r,this.audioElement=o}async setOutputDevice(e){if(!("setSinkId"in HTMLAudioElement.prototype))throw new Error("setSinkId is not supported in this browser");await this.audioElement.setSinkId(e||"")}async close(){this.audioElement.parentNode&&this.audioElement.parentNode.removeChild(this.audioElement),this.audioElement.pause(),await this.context.close()}};class _a extends Ji{static async startSession(e){var n;const i=Ji.getFullOptions(e);i.onStatusChange&&i.onStatusChange({status:"connecting"}),i.onCanSendFeedbackChange&&i.onCanSendFeedbackChange({canSendFeedback:!1});let r=null,o=null,s=null,a=null,c=null;if((n=e.useWakeLock)==null||n)try{c=await navigator.wakeLock.request("screen")}catch{}try{var l;return a=await navigator.mediaDevices.getUserMedia({audio:!0}),await Dh(i.connectionDelay),o=await Oh(e),[r,s]=await Promise.all([ui.create(tn({},o.inputFormat,{preferHeadphonesForIosDevices:e.preferHeadphonesForIosDevices,inputDeviceId:e.inputDeviceId,workletPaths:e.workletPaths,libsampleratePath:e.libsampleratePath})),Mh.create(tn({},o.outputFormat,{outputDeviceId:e.outputDeviceId,workletPaths:e.workletPaths}))]),(l=a)==null||l.getTracks().forEach(p=>{p.stop()}),a=null,new _a(i,o,r,s,c)}catch(p){var d,u,h,f;i.onStatusChange&&i.onStatusChange({status:"disconnected"}),(d=a)==null||d.getTracks().forEach(v=>{v.stop()}),(u=o)==null||u.close(),await((h=r)==null?void 0:h.close()),await((f=s)==null?void 0:f.close());try{var g;await((g=c)==null?void 0:g.release()),c=null}catch{}throw p}}constructor(e,n,i,r,o){super(e,n),this.input=void 0,this.output=void 0,this.wakeLock=void 0,this.inputFrequencyData=void 0,this.outputFrequencyData=void 0,this.onInputWorkletMessage=s=>{this.status==="connected"&&this.connection.sendMessage({user_audio_chunk:Ph(s.data[0].buffer)})},this.onOutputWorkletMessage=({data:s})=>{s.type==="process"&&this.updateMode(s.finished?"listening":"speaking")},this.addAudioBase64Chunk=s=>{this.output.gain.gain.cancelScheduledValues(this.output.context.currentTime),this.output.gain.gain.value=this.volume,this.output.worklet.port.postMessage({type:"clearInterrupted"}),this.output.worklet.port.postMessage({type:"buffer",buffer:$0(s)})},this.fadeOutAudio=()=>{this.updateMode("listening"),this.output.worklet.port.postMessage({type:"interrupt"}),this.output.gain.gain.exponentialRampToValueAtTime(1e-4,this.output.context.currentTime+2),setTimeout(()=>{this.output.gain.gain.value=this.volume,this.output.worklet.port.postMessage({type:"clearInterrupted"})},2e3)},this.calculateVolume=s=>{if(s.length===0)return 0;let a=0;for(let c=0;c<s.length;c++)a+=s[c]/255;return a/=s.length,a<0?0:a>1?1:a},this.setVolume=({volume:s})=>{const a=Number.isFinite(s)?Math.min(1,Math.max(0,s)):1;this.volume=a,this.connection instanceof nn?this.connection.setAudioVolume(a):this.output.gain.gain.value=a},this.input=i,this.output=r,this.wakeLock=o,this.input.worklet.port.onmessage=this.onInputWorkletMessage,this.output.worklet.port.onmessage=this.onOutputWorkletMessage}async handleEndSession(){await super.handleEndSession();try{var e;await((e=this.wakeLock)==null?void 0:e.release()),this.wakeLock=null}catch{}await this.input.close(),await this.output.close()}handleInterruption(e){super.handleInterruption(e),this.fadeOutAudio()}handleAudio(e){var n,i;this.lastInterruptTimestamp<=e.audio_event.event_id&&((n=(i=this.options).onAudio)==null||n.call(i,e.audio_event.audio_base_64),this.connection instanceof nn||this.addAudioBase64Chunk(e.audio_event.audio_base_64),this.currentEventId=e.audio_event.event_id,this.updateCanSendFeedback(),this.updateMode("speaking"))}setMicMuted(e){this.connection instanceof nn?this.connection.setMicMuted(e):this.input.setMuted(e)}getInputByteFrequencyData(){return this.inputFrequencyData!=null||(this.inputFrequencyData=new Uint8Array(this.input.analyser.frequencyBinCount)),this.input.analyser.getByteFrequencyData(this.inputFrequencyData),this.inputFrequencyData}getOutputByteFrequencyData(){return this.connection instanceof nn?this.connection.getOutputByteFrequencyData()||new Uint8Array(1024):(this.outputFrequencyData!=null||(this.outputFrequencyData=new Uint8Array(this.output.analyser.frequencyBinCount)),this.output.analyser.getByteFrequencyData(this.outputFrequencyData),this.outputFrequencyData)}getInputVolume(){return this.calculateVolume(this.getInputByteFrequencyData())}getOutputVolume(){return this.calculateVolume(this.getOutputByteFrequencyData())}async changeInputDevice({sampleRate:e,format:n,preferHeadphonesForIosDevices:i,inputDeviceId:r}){try{if(this.connection instanceof Yi)try{return await this.input.setInputDevice(r),this.input}catch(s){console.warn("Failed to change device on existing input, recreating:",s)}this.connection instanceof nn&&await this.connection.setAudioInputDevice(r||""),await this.input.close();const o=await ui.create({sampleRate:e??this.connection.inputFormat.sampleRate,format:n??this.connection.inputFormat.format,preferHeadphonesForIosDevices:i,inputDeviceId:r,workletPaths:this.options.workletPaths,libsampleratePath:this.options.libsampleratePath});return this.input=o,this.input.worklet.port.onmessage=this.onInputWorkletMessage,this.input}catch(o){throw console.error("Error changing input device",o),o}}async changeOutputDevice({sampleRate:e,format:n,outputDeviceId:i}){try{if(this.connection instanceof Yi)try{return await this.output.setOutputDevice(i),this.output}catch(o){console.warn("Failed to change device on existing output, recreating:",o)}this.connection instanceof nn&&await this.connection.setAudioOutputDevice(i||""),await this.output.close();const r=await Mh.create({sampleRate:e??this.connection.outputFormat.sampleRate,format:n??this.connection.outputFormat.format,outputDeviceId:i,workletPaths:this.options.workletPaths});return this.output=r,this.output}catch(r){throw console.error("Error changing output device",r),r}}}function Nh(t,e,n="https://api.elevenlabs.io"){const i={};return typeof e=="boolean"?i.feedback=e?"like":"dislike":(i.rating=e.rating,i.comment=e.comment),fetch(`${n}/v1/convai/conversations/${t}/feedback`,{method:"POST",body:JSON.stringify(i),headers:{"Content-Type":"application/json"}})}var Lh;(function(t){t.SESSION_STARTED="session_started",t.PARTIAL_TRANSCRIPT="partial_transcript",t.COMMITTED_TRANSCRIPT="committed_transcript",t.COMMITTED_TRANSCRIPT_WITH_TIMESTAMPS="committed_transcript_with_timestamps",t.AUTH_ERROR="auth_error",t.ERROR="error",t.OPEN="open",t.CLOSE="close",t.QUOTA_EXCEEDED="quota_exceeded",t.COMMIT_THROTTLED="commit_throttled",t.TRANSCRIBER_ERROR="transcriber_error",t.UNACCEPTED_TERMS="unaccepted_terms",t.RATE_LIMITED="rate_limited",t.INPUT_ERROR="input_error",t.QUEUE_OVERFLOW="queue_overflow",t.RESOURCE_EXHAUSTED="resource_exhausted",t.SESSION_TIME_LIMIT_EXCEEDED="session_time_limit_exceeded",t.CHUNK_SIZE_EXCEEDED="chunk_size_exceeded",t.INSUFFICIENT_AUDIO_ACTIVITY="insufficient_audio_activity"})(Lh||(Lh={}));var Uh,Fh;(function(t){t.PCM_8000="pcm_8000",t.PCM_16000="pcm_16000",t.PCM_22050="pcm_22050",t.PCM_24000="pcm_24000",t.PCM_44100="pcm_44100",t.PCM_48000="pcm_48000",t.ULAW_8000="ulaw_8000"})(Uh||(Uh={})),(function(t){t.MANUAL="manual",t.VAD="vad"})(Fh||(Fh={}));class H0 extends Ji{static startSession(e){return e.textOnly?Ca.startSession(e):_a.startSession(e)}}var G0=Object.defineProperty,K0=(t,e,n)=>e in t?G0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Ze=(t,e,n)=>K0(t,typeof e!="symbol"?e+"":e,n);function rn(t){return t?t==="true"?!0:t==="false"?!1:null:null}const Sa=["variant","placement","override-config","avatar-image-url","avatar-orb-color-1","avatar-orb-color-2","agent-id","signed-url","terms-key","server-location","language","dynamic-variables","show-avatar-when-collapsed","override-prompt","override-first-message","override-language","override-voice-id","override-text-only","mic-muting","transcript","text-input","text-contents","default-expanded","always-expanded","user-id","use-rtc","collect-feedback","worklet-path-raw-audio-processor","worklet-path-audio-concat-processor","worklet-path-libsamplerate"],J0='@import"https://fonts.googleapis.com/css2?family=Inter:wght@400,500&display=swap";*,:before,:after{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }*,:before,:after{box-sizing:border-box;border-width:0;border-style:solid;border-color:currentColor}:before,:after{--tw-content: ""}html,:host{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;-o-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,samp,pre{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dl,dd,h1,h2,h3,h4,h5,h6,hr,figure,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}ol,ul,menu{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{opacity:1;color:#9ca3af}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}button,[role=button]{cursor:pointer}:disabled{cursor:default}img,svg,video,canvas,audio,iframe,embed,object{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.\\!container{width:100%!important}.container{width:100%}@media (min-width: 640px){.\\!container{max-width:640px!important}.container{max-width:640px}}@media (min-width: 768px){.\\!container{max-width:768px!important}.container{max-width:768px}}@media (min-width: 1024px){.\\!container{max-width:1024px!important}.container{max-width:1024px}}@media (min-width: 1280px){.\\!container{max-width:1280px!important}.container{max-width:1280px}}@media (min-width: 1536px){.\\!container{max-width:1536px!important}.container{max-width:1536px}}.pointer-events-none{pointer-events:none}.pointer-events-auto{pointer-events:auto}.\\!visible{visibility:visible!important}.visible{visibility:visible}.collapse{visibility:collapse}.static{position:static}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.inset-0{top:0;right:0;bottom:0;left:0}.-bottom-3{bottom:-12px}.bottom-0{bottom:0}.bottom-1{bottom:4px}.bottom-20{bottom:80px}.left-0{left:0}.left-1\\/2{left:50%}.left-4{left:16px}.right-0{right:0}.right-1{right:4px}.top-0{top:0}.top-1{top:4px}.top-1\\/2{top:50%}.top-20{top:80px}.top-4{top:16px}.top-\\[88px\\]{top:88px}.z-1{z-index:1}.z-10{z-index:10}.m-0{margin:0}.m-1{margin:4px}.-mx-0\\.5{margin-left:-2px;margin-right:-2px}.mx-1{margin-left:4px;margin-right:4px}.my-4{margin-top:16px;margin-bottom:16px}.my-6{margin-top:24px;margin-bottom:24px}.-mr-1\\.5{margin-right:-6px}.mb-0\\.5{margin-bottom:2px}.mb-1{margin-bottom:4px}.mb-2{margin-bottom:8px}.mb-4{margin-bottom:16px}.ml-4{margin-left:16px}.ml-auto{margin-left:auto}.mt-2{margin-top:8px}.mt-3{margin-top:12px}.mt-6{margin-top:24px}.block{display:block}.inline-block{display:inline-block}.inline{display:inline}.\\!flex{display:flex!important}.flex{display:flex}.inline-flex{display:inline-flex}.table{display:table}.table-cell{display:table-cell}.table-row{display:table-row}.grid{display:grid}.contents{display:contents}.list-item{display:list-item}.hidden{display:none}.\\!h-8{height:32px!important}.h-11{height:44px}.h-4{height:16px}.h-48{height:192px}.h-5{height:20px}.h-6{height:24px}.h-7{height:28px}.h-8{height:32px}.h-9{height:36px}.h-\\[550px\\]{height:550px}.h-\\[calc\\(100\\%-80px\\)\\]{height:calc(100% - 80px)}.h-full{height:100%}.h-screen{height:100vh}.max-h-\\[550px\\]{max-height:550px}.max-h-\\[8lh\\]{max-height:8lh}.max-h-\\[min\\(384px\\,var\\(--radix-select-content-available-height\\)\\)\\]{max-height:min(384px,var(--radix-select-content-available-height))}.min-h-0{min-height:0px}.min-h-\\[6lh\\]{min-height:6lh}.min-h-full{min-height:100%}.min-h-min{min-height:-moz-min-content;min-height:min-content}.\\!w-8{width:32px!important}.w-1\\/2{width:50%}.w-20{width:80px}.w-4{width:16px}.w-48{width:192px}.w-5{width:20px}.w-6{width:24px}.w-64{width:256px}.w-7{width:28px}.w-8{width:32px}.w-9{width:36px}.w-\\[400px\\]{width:400px}.w-full{width:100%}.w-screen{width:100vw}.\\!min-w-60{min-width:240px!important}.min-w-0{min-width:0px}.min-w-60{min-width:240px}.min-w-9{min-width:36px}.min-w-\\[var\\(--radix-select-trigger-width\\)\\]{min-width:var(--radix-select-trigger-width)}.min-w-max{min-width:-moz-max-content;min-width:max-content}.min-w-min{min-width:-moz-min-content;min-width:min-content}.max-w-64{max-width:256px}.max-w-\\[400px\\]{max-width:400px}.max-w-full{max-width:100%}.flex-1{flex:1 1 0%}.shrink-0{flex-shrink:0}.grow{flex-grow:1}.border-collapse{border-collapse:collapse}.origin-bottom{transform-origin:bottom}.origin-bottom-left{transform-origin:bottom left}.origin-bottom-right{transform-origin:bottom right}.origin-top{transform-origin:top}.origin-top-left{transform-origin:top left}.origin-top-right{transform-origin:top right}.-translate-x-1\\/2{--tw-translate-x: -50%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.-translate-y-1\\/2{--tw-translate-y: -50%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.-translate-y-\\[calc\\(var\\(--el-overlay-padding\\)\\)\\]{--tw-translate-y: calc(calc(var(--el-overlay-padding)) * -1);transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.translate-y-1\\/2{--tw-translate-y: 50%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.translate-y-\\[calc\\(var\\(--el-overlay-padding\\)\\)\\]{--tw-translate-y: calc(var(--el-overlay-padding));transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.translate-y-full{--tw-translate-y: 100%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.-rotate-180{--tw-rotate: -180deg;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.-rotate-90{--tw-rotate: -90deg;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.scale-100{--tw-scale-x: 1;--tw-scale-y: 1;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.scale-150{--tw-scale-x: 1.5;--tw-scale-y: 1.5;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.scale-75{--tw-scale-x: .75;--tw-scale-y: .75;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.scale-90{--tw-scale-x: .9;--tw-scale-y: .9;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.scale-\\[0\\.1667\\]{--tw-scale-x: .1667;--tw-scale-y: .1667;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.transform{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.cursor-default{cursor:default}.cursor-pointer{cursor:pointer}.select-none{-webkit-user-select:none;-moz-user-select:none;user-select:none}.resize-none{resize:none}.list-outside{list-style-position:outside}.list-decimal{list-style-type:decimal}.list-disc{list-style-type:disc}.flex-row{flex-direction:row}.flex-col{flex-direction:column}.flex-col-reverse{flex-direction:column-reverse}.place-content-center{place-content:center}.items-start{align-items:flex-start}.items-end{align-items:flex-end}.items-center{align-items:center}.justify-end{justify-content:flex-end}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-1{gap:4px}.gap-2{gap:8px}.gap-2\\.5{gap:10px}.gap-3{gap:12px}.gap-8{gap:32px}.divide-y>:not([hidden])~:not([hidden]){--tw-divide-y-reverse: 0;border-top-width:calc(1px * calc(1 - var(--tw-divide-y-reverse)));border-bottom-width:calc(1px * var(--tw-divide-y-reverse))}.divide-base-border>:not([hidden])~:not([hidden]){border-color:var(--el-base-border)}.self-auto{align-self:auto}.self-stretch{align-self:stretch}.overflow-auto{overflow:auto}.overflow-hidden{overflow:hidden}.overflow-x-auto{overflow-x:auto}.overflow-y-auto{overflow-y:auto}.overflow-x-hidden{overflow-x:hidden}.truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.whitespace-normal{white-space:normal}.whitespace-nowrap{white-space:nowrap}.whitespace-pre{white-space:pre}.whitespace-pre-wrap{white-space:pre-wrap}.break-all{word-break:break-all}.rounded-\\[calc\\(var\\(--el-button-radius\\)\\+4px\\)\\]{border-radius:calc(var(--el-button-radius) + 4px)}.rounded-bubble{border-radius:var(--el-bubble-radius)}.rounded-button{border-radius:var(--el-button-radius)}.rounded-compact-sheet{border-radius:var(--el-compact-sheet-radius)}.rounded-dropdown-sheet{border-radius:var(--el-dropdown-sheet-radius)}.rounded-full{border-radius:9999px}.rounded-input{border-radius:var(--el-input-radius)}.rounded-sheet{border-radius:var(--el-sheet-radius)}.border{border-width:1px}.border-b{border-bottom-width:1px}.border-l-4{border-left-width:4px}.border-r{border-right-width:1px}.border-accent{border-color:var(--el-accent)}.border-base{border-color:var(--el-base)}.border-base-border{border-color:var(--el-base-border)}.bg-accent{background-color:var(--el-accent)}.bg-base{background-color:var(--el-base)}.bg-base-active{background-color:var(--el-base-active)}.bg-base-border{background-color:var(--el-base-border)}.bg-base-hover{background-color:var(--el-base-hover)}.bg-cover{background-size:cover}.object-cover{-o-object-fit:cover;object-fit:cover}.p-1{padding:4px}.p-1\\.5{padding:6px}.p-2{padding:8px}.p-3{padding:12px}.p-4{padding:16px}.px-1{padding-left:4px;padding-right:4px}.px-1\\.5{padding-left:6px;padding-right:6px}.px-2{padding-left:8px;padding-right:8px}.px-2\\.5{padding-left:10px;padding-right:10px}.px-3{padding-left:12px;padding-right:12px}.px-4{padding-left:16px;padding-right:16px}.px-8{padding-left:32px;padding-right:32px}.py-0\\.5{padding-top:2px;padding-bottom:2px}.py-1{padding-top:4px;padding-bottom:4px}.py-1\\.5{padding-top:6px;padding-bottom:6px}.py-2{padding-top:8px;padding-bottom:8px}.py-2\\.5{padding-top:10px;padding-bottom:10px}.py-4{padding-top:16px;padding-bottom:16px}.py-\\[calc\\(theme\\(spacing\\.2\\)-1px\\)\\]{padding-top:7px;padding-bottom:7px}.pb-1{padding-bottom:4px}.pb-2{padding-bottom:8px}.pb-3{padding-bottom:12px}.pl-1\\.5{padding-left:6px}.pl-16{padding-left:64px}.pl-4{padding-left:16px}.pr-16{padding-right:64px}.pr-3{padding-right:12px}.pr-9{padding-right:36px}.pt-1{padding-top:4px}.pt-1\\.5{padding-top:6px}.pt-3{padding-top:12px}.pt-4{padding-top:16px}.text-left{text-align:left}.text-center{text-align:center}.font-mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}.text-\\[10px\\]{font-size:10px}.text-\\[13px\\]{font-size:13px}.text-lg{font-size:18px;line-height:26px}.text-md{font-size:16px;line-height:24px}.text-sm{font-size:14px;line-height:20px}.text-xl{font-size:20px;line-height:28px}.text-xs{font-size:12px;line-height:16px}.font-medium{font-weight:500}.font-semibold{font-weight:600}.italic{font-style:italic}.text-accent-primary{color:var(--el-accent-primary)}.text-base-border{color:var(--el-base-border)}.text-base-error{color:var(--el-base-error)}.text-base-primary{color:var(--el-base-primary)}.text-base-subtle{color:var(--el-base-subtle)}.underline{text-decoration-line:underline}.opacity-0{opacity:0}.opacity-30{opacity:.3}.shadow-header{--tw-shadow: 0 0 1px 0 rgba(0, 0, 0, .4), 0 2px 2px 0 rgba(0, 0, 0, .04);--tw-shadow-colored: 0 0 1px 0 var(--tw-shadow-color), 0 2px 2px 0 var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-lg{--tw-shadow: 0 2px 40px 1px rgba(0, 0, 0, .12);--tw-shadow-colored: 0 2px 40px 1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-md{--tw-shadow: 0 2px 24px 1px rgba(0, 0, 0, .16);--tw-shadow-colored: 0 2px 24px 1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.transition{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-\\[border-radius\\]{transition-property:border-radius;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-\\[margin\\]{transition-property:margin;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-\\[opacity\\,transform\\]{transition-property:opacity,transform;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-\\[opacity\\,width\\,height\\,transform\\,flex-grow\\]{transition-property:opacity,width,height,transform,flex-grow;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-\\[transform\\,left\\,top\\,opacity\\,scale\\]{transition-property:transform,left,top,opacity,scale;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-\\[transform\\,opacity\\]{transition-property:transform,opacity;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-colors{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-opacity{transition-property:opacity;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-transform{transition-property:transform;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.duration-200{transition-duration:.2s}.duration-300{transition-duration:.3s}.ease-out{transition-timing-function:cubic-bezier(0,0,.2,1)}.overlay{position:absolute;inset:var(--el-overlay-padding);right:calc(var(--el-overlay-padding) + var(--removed-body-scroll-bar-size, 0px))}.focus-ring{--tw-ring-color: var(--el-accent);--tw-ring-offset-width: 2px;--tw-ring-offset-color: var(--el-base)}.focus-ring:focus-visible{outline:2px solid transparent;outline-offset:2px;--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.animate-text{background-image:linear-gradient(75deg,var(--el-base-primary),var(--el-base-subtle),var(--el-base-primary),var(--el-base-subtle));background-size:300% 100%;-webkit-background-clip:text;background-clip:text;color:transparent;animation:TextAnimation 2s linear infinite}@keyframes TextAnimation{0%{background-position:0 0}to{background-position:100% 0}}.\\!terms h6,.terms h6{font-size:12px;line-height:16px;font-weight:500;color:var(--el-base-primary)}.\\!terms h5,.terms h5{font-size:14px;line-height:20px;font-weight:500;color:var(--el-base-primary)}.\\!terms h4,.terms h4{font-size:16px;line-height:24px;font-weight:500;color:var(--el-base-primary)}.\\!terms h3,.terms h3{font-size:18px;line-height:26px;font-weight:500;color:var(--el-base-primary)}.\\!terms h2,.terms h2{font-size:20px;line-height:28px;font-weight:500;color:var(--el-base-primary)}.\\!terms h2,.terms h2{font-size:24px;line-height:30px;font-weight:500;color:var(--el-base-primary)}.\\[field-sizing\\:content\\]{field-sizing:content}.\\[line-height\\:var\\(--el-overlay-padding\\)\\]{line-height:var(--el-overlay-padding)}.\\[overflow-wrap\\:break-word\\]{overflow-wrap:break-word}.dev-host,:host{pointer-events:none;position:fixed;top:0;right:0;bottom:0;left:0;z-index:1000;font-size:16px;line-height:24px;color:var(--el-base-primary);font-family:Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;scrollbar-color:#e5e7eb transparent}.markdown{text-autospace:normal;text-spacing-trim:trim-start}.markdown h1,.markdown h2,.markdown h3,.markdown h4,.markdown h5,.markdown h6{word-break:auto-phrase}.tok-comment{color:#6a737d}.tok-keyword{color:#d73a49}.tok-atom,.tok-bool,.tok-literal{color:#005cc5}.tok-string,.tok-string2{color:#032f62}.tok-variableName{color:#24292e}.tok-variableName.tok-definition{color:#6f42c1}.tok-variableName.tok-local{color:#24292e}.tok-variableName2,.tok-macroName,.tok-typeName,.tok-namespace,.tok-className{color:#6f42c1}.tok-propertyName{color:#24292e}.tok-propertyName.tok-definition{color:#005cc5}.tok-labelName{color:#22863a}.tok-url,.tok-link{text-decoration:underline;color:#032f62}.tok-meta{color:#6a737d}.tok-invalid{color:#b31d28}.tok-deleted{color:#b31d28;background-color:#ffeef0}.tok-inserted{color:#22863a;background-color:#f0fff4}.tok-heading{font-weight:700;color:#005cc5}.tok-emphasis{font-style:italic;color:#24292e}.tok-strong{font-weight:700;color:#24292e}.tok-strikethrough{text-decoration:line-through}.placeholder\\:text-base-subtle::-moz-placeholder{color:var(--el-base-subtle)}.placeholder\\:text-base-subtle::placeholder{color:var(--el-base-subtle)}.hover\\:border-accent-hover:hover{border-color:var(--el-accent-hover)}.hover\\:border-base-hover:hover{border-color:var(--el-base-hover)}.hover\\:bg-accent-hover:hover{background-color:var(--el-accent-hover)}.hover\\:bg-base-hover:hover{background-color:var(--el-base-hover)}.hover\\:opacity-50:hover{opacity:.5}.focus\\:outline-none:focus{outline:2px solid transparent;outline-offset:2px}.focus\\:ring-2:focus{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.focus-visible\\:underline-offset-2:focus-visible{text-underline-offset:2px}.focus-visible\\:opacity-100:focus-visible{opacity:1}.focus-visible\\:outline-none:focus-visible{outline:2px solid transparent;outline-offset:2px}.active\\:border-accent-active:active{border-color:var(--el-accent-active)}.active\\:border-base-active:active{border-color:var(--el-base-active)}.active\\:bg-accent-active:active{background-color:var(--el-accent-active)}.active\\:bg-base-active:active{background-color:var(--el-base-active)}.disabled\\:cursor-not-allowed:disabled{cursor:not-allowed}.group:focus-within .group-focus-within\\:pointer-events-auto{pointer-events:auto}.group:focus-within .group-focus-within\\:opacity-100{opacity:1}.group:hover .group-hover\\:pointer-events-auto{pointer-events:auto}.group:hover .group-hover\\:opacity-100{opacity:1}.data-hidden\\:-translate-y-4[data-shown=false]{--tw-translate-y: -16px;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.data-hidden\\:translate-x-full[data-shown=false]{--tw-translate-x: 100%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.data-hidden\\:translate-y-2[data-shown=false]{--tw-translate-y: 8px;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.data-hidden\\:scale-100[data-shown=false]{--tw-scale-x: 1;--tw-scale-y: 1;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.data-hidden\\:scale-75[data-shown=false]{--tw-scale-x: .75;--tw-scale-y: .75;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.data-hidden\\:scale-90[data-shown=false]{--tw-scale-x: .9;--tw-scale-y: .9;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.data-hidden\\:opacity-0[data-shown=false]{opacity:0}.data-\\[highlighted\\]\\:bg-base-active[data-highlighted]{background-color:var(--el-base-active)}',Bh=["tiny","compact","full"];function Y0(t){return Bh.includes(t)?t:Bh[0]}const X0=["top-left","top","top-right","bottom-left","bottom","bottom-right"];function Q0(t){return X0.includes(t)?t:"bottom-right"}const jh={main_label:"Need help?",start_call:"Start a call",start_chat:"Start a chat",send_message:"Send",new_call:"New call",end_call:"End",mute_microphone:"Mute microphone",change_language:"Change language",collapse:"Collapse",expand:"Expand",copied:"Copied!",accept_terms:"Accept",dismiss_terms:"Cancel",listening_status:"Listening",speaking_status:"Talk to interrupt",connecting_status:"Connecting",chatting_status:"Chatting with AI Agent",input_label:"Text message input",input_placeholder:"Send a message",input_placeholder_text_only:"Send a message",input_placeholder_new_conversation:"Start a new conversation",user_ended_conversation:"You ended the conversation",agent_ended_conversation:"The agent ended the conversation",conversation_id:"ID",error_occurred:"An error occurred",copy_id:"Copy ID",initiate_feedback:"How was this conversation?",request_follow_up_feedback:"Tell us more",thanks_for_feedback:"Thank you for your feedback!",thanks_for_feedback_details:"Your feedback helps us improve our service and better support you in the future.",follow_up_feedback_placeholder:"Tell us more about your experience...",submit:"Submit",go_back:"Go back",copy:"Copy",download:"Download",wrap:"Wrap"},Z0=Object.keys(jh),Vh={base:"#ffffff",base_hover:"#f9fafb",base_active:"#f3f4f6",base_border:"#e5e7eb",base_subtle:"#6b7280",base_primary:"#000000",base_error:"#ef4444",accent:"#000000",accent_hover:"#1f2937",accent_active:"#374151",accent_border:"#4b5563",accent_subtle:"#6b7280",accent_primary:"#ffffff",overlay_padding:32,button_radius:18,input_radius:10,bubble_radius:15,sheet_radius:"calc(var(--el-button-radius) + 6px)",compact_sheet_radius:"calc(var(--el-button-radius) + 12px)",dropdown_sheet_radius:"calc(var(--el-input-radius) + 6px)"},ey=Object.keys(Vh);function ty(t="us"){switch(t){case"eu-residency":case"in-residency":case"us":case"global":return t;default:return console.warn(`[ConversationalAI] Invalid server-location: ${t}. Defaulting to "us"`),"us"}}function ct(t){const e=dn(t);if(e==null)throw new Error(`${t.displayName} cannot be used outside of provider`);return e}const qh=Ne(null);function ny({value:t,children:e}){const n=le(()=>Object.fromEntries(Sa.map(i=>[i,it(t[i])])),[]);return Sa.forEach(i=>{n[i].value=t[i]}),m(qh.Provider,{value:n,children:e})}function iy(){return ct(qh)}function se(t){return iy()[t]}const zh=Ne(null);function ry({children:t}){const e=se("server-location"),n=le(()=>{const i=rt(()=>ty(e.value)),r={us:"https://api.us.elevenlabs.io","eu-residency":"https://api.eu.residency.elevenlabs.io","in-residency":"https://api.in.residency.elevenlabs.io",global:"https://api.elevenlabs.io"},o={us:"wss://api.us.elevenlabs.io","eu-residency":"wss://api.eu.residency.elevenlabs.io","in-residency":"wss://api.in.residency.elevenlabs.io",global:"wss://api.elevenlabs.io"};return{location:i,serverUrl:rt(()=>r[i.value]),webSocketUrl:rt(()=>o[i.value])}},[]);return m(zh.Provider,{value:n,children:t})}function Ta(){return ct(zh)}const Xi={en:{name:"English",flagCode:"us",languageCode:"en"},zh:{name:"",flagCode:"cn",languageCode:"zh"},es:{name:"Espaol",flagCode:"es",languageCode:"es"},hi:{name:"",flagCode:"in",languageCode:"hi"},pt:{name:"Portugus (Portugal)",flagCode:"pt",languageCode:"pt"},"pt-br":{name:"Portugus (Brasil)",flagCode:"br",languageCode:"pt-br"},fr:{name:"Franais",flagCode:"fr",languageCode:"fr"},de:{name:"Deutsch",flagCode:"de",languageCode:"de"},ja:{name:"",flagCode:"jp",languageCode:"ja"},ar:{name:"",flagCode:"ae",languageCode:"ar"},ru:{name:"",flagCode:"ru",languageCode:"ru"},ko:{name:"",flagCode:"kr",languageCode:"ko"},id:{name:"Bahasa Indonesia",flagCode:"id",languageCode:"id"},it:{name:"Italiano",flagCode:"it",languageCode:"it"},nl:{name:"Nederlands",flagCode:"nl",languageCode:"nl"},tr:{name:"Trke",flagCode:"tr",languageCode:"tr"},pl:{name:"Polski",flagCode:"pl",languageCode:"pl"},sv:{name:"Svenska",flagCode:"se",languageCode:"sv"},ms:{name:"Bahasa Melayu",flagCode:"my",languageCode:"ms"},ro:{name:"Romn",flagCode:"ro",languageCode:"ro"},uk:{name:"",flagCode:"ua",languageCode:"uk"},el:{name:"",flagCode:"gr",languageCode:"el"},cs:{name:"etina",flagCode:"cz",languageCode:"cs"},da:{name:"Dansk",flagCode:"dk",languageCode:"da"},fi:{name:"Suomi",flagCode:"fi",languageCode:"fi"},bg:{name:"",flagCode:"bg",languageCode:"bg"},hr:{name:"Hrvatski",flagCode:"hr",languageCode:"hr"},sk:{name:"Slovenina",flagCode:"sk",languageCode:"sk"},ta:{name:"",flagCode:"in",languageCode:"ta"},hu:{name:"Magyar",flagCode:"hu",languageCode:"hu"},no:{name:"Norsk",flagCode:"no",languageCode:"no"},vi:{name:"Ting Vit",flagCode:"vn",languageCode:"vi"},tl:{name:"Filipino",flagCode:"ph",languageCode:"tl"}};function xa(t){return Object.keys(Xi).includes(t??"")}const $h=Ne(null);function oy({children:t}){const e=Fe(),n=se("language"),i=se("override-language"),r=Le(n.peek()??e.peek().language),o=be(()=>(e.value.supported_language_overrides??[]).filter(xa)),s=be(()=>o.value.map(c=>Xi[c]).sort((c,l)=>c.name.localeCompare(l.name))),a=le(()=>({language:rt(()=>xa(i.value)?Xi[i.value]:xa(r.value)&&o.value.includes(r.value)?Xi[r.value]:Xi[e.value.language]),setLanguage:c=>{r.value=c},options:s,showPicker:rt(()=>s.value.length>0)}),[]);return m($h.Provider,{value:a,children:t})}function hi(){return ct($h)}const sy="0.5.4",Wh=Ne(null);function ay({children:t}){const e=Fe(),n=be(()=>e.value.mic_muting_enabled??!1),i=Le(!1),r=le(()=>({isMuted:rt(()=>n.value?i.value:!1),setIsMuted:o=>{i.value=o},isMutingEnabled:n}),[]);return m(Wh.Provider,{value:r,children:t})}function Hh(){return ct(Wh)}const Gh=Ne(null);function cy({children:t}){const{language:e}=hi(),n=se("override-prompt"),i=se("override-first-message"),r=se("override-voice-id"),o=se("override-text-only"),s=se("user-id"),a=be(()=>({agent:{prompt:{prompt:n.value},firstMessage:i.value,language:e.value.languageCode},tts:{voiceId:r.value},conversation:{textOnly:rn(o.value)??void 0}})),c=se("dynamic-variables"),l=be(()=>{if(c.value)try{return JSON.parse(c.value)}catch(C){console.error(`[ConversationalAI] Cannot parse dynamic-variables: ${C==null?void 0:C.message}`)}}),d=se("worklet-path-raw-audio-processor"),u=se("worklet-path-audio-concat-processor"),h=se("worklet-path-libsamplerate"),{webSocketUrl:f}=Ta(),g=se("agent-id"),p=se("signed-url"),v=Ea(),b=my(),k=be(()=>{const C=b.value,y={dynamicVariables:l.value,overrides:a.value,connectionDelay:{default:300},textOnly:v.value,userId:s.value||void 0,libsampleratePath:h.value,workletPaths:{rawAudioProcessor:d.value,audioConcatProcessor:u.value}};return g.value?C?{agentId:g.value,origin:f.value,connectionType:"webrtc",...y}:{agentId:g.value,origin:f.value,connectionType:"websocket",...y}:p.value?{signedUrl:p.value,connectionType:"websocket",...y}:(console.error("[ConversationalAI] Either agent-id or signed-url is required"),null)});return k.value?m(Gh.Provider,{value:k,children:t}):null}function ly(){return ct(Gh)}const Kh=Ne(null);function dy({children:t}){const e=Fe(),n=le(()=>{const i=e.peek().terms_key,r=i?!!localStorage.getItem(i):!1,o=it(!1),s=it(r),a=rt(()=>!e.value.terms_html||s.value);let c=[];return{termsShown:o,termsAccepted:a,dismissTerms:()=>{o.value=!1,c.forEach(l=>l.reject()),c=[]},acceptTerms:()=>{s.value=!0,o.value=!1;const l=e.peek().terms_key;l&&localStorage.setItem(l,"true"),c.forEach(d=>d.resolve()),c=[]},requestTerms:async()=>{a.peek()||(o.value=!0,await new Promise((l,d)=>{c.push({resolve:l,reject:d})}))}}},[]);return m(Kh.Provider,{value:n,children:t})}function eo(){return ct(Kh)}const Jh=Ne(null);function uy({children:t}){const e=hy();return Et(()=>{if(e.conversationTextOnly.value===!0){e.transcript.value;const n=setTimeout(()=>{e.endSession()},600*1e3);return()=>{clearTimeout(n)}}}),m(Jh.Provider,{value:e,children:t})}function We(){return ct(Jh)}function hy(){const t=$(null),e=$(null),n=$(!1),i=$(null),r=$(!1),o=Fe(),s=Xh(),a=eo(),c=ly(),{isMuted:l}=Hh();return Et(()=>{var d;const u=l.value;(d=t==null?void 0:t.current)==null||d.setMicMuted(u)}),X(()=>()=>{var d;(d=t.current)==null||d.endSession()},[]),le(()=>{const d=it("disconnected"),u=rt(()=>d.value==="disconnected"),h=it("listening"),f=rt(()=>h.value==="speaking"),g=it(null),p=it(null),v=it(!1),b=it([]),k=it(0),C=it(null);return{status:d,isSpeaking:f,mode:h,isDisconnected:u,lastId:p,error:g,canSendFeedback:v,conversationIndex:k,conversationTextOnly:C,transcript:b,startSession:async(y,_)=>{var S,E,x,P,D,M,F;if(await a.requestTerms(),(S=t.current)!=null&&S.isOpen())return t.current.getId();if(e.current)return(await e.current).getId();let z=structuredClone(c.peek());_&&o.value.supports_text_only&&(z.textOnly=!0,o.value.text_only||(z.overrides??(z.overrides={}),(E=z.overrides).conversation??(E.conversation={}),z.overrides.conversation.textOnly=!0));try{z=fy(y,z)}catch(W){console.error("[ConversationalAI] Error triggering call event:",W)}C.value=z.textOnly??!1,b.value=_?[{type:"message",role:"user",message:_,isText:!0,conversationIndex:k.peek()}]:[];try{if(e.current=H0.startSession({...z,overrides:{...z.overrides,client:{...(x=z.overrides)==null?void 0:x.client,source:((D=(P=z.overrides)==null?void 0:P.client)==null?void 0:D.source)||"widget",version:((F=(M=z.overrides)==null?void 0:M.client)==null?void 0:F.version)||sy}},onModeChange:B=>{h.value=B.mode},onStatusChange:B=>{d.value=B.status},onCanSendFeedbackChange:B=>{v.value=B.canSendFeedback},onMessage:({role:B,message:G})=>{if(s.peek()&&C.peek()===!0&&B==="agent"&&!n.current){n.current=!0;return}else B==="agent"&&(n.current=!0);if(B==="agent"&&r.current){r.current=!1;return}b.value=[...b.value,{type:"message",role:B,message:G,isText:!1,conversationIndex:k.peek()}]},onAgentChatResponsePart:({text:B,type:G})=>{if(s.peek()&&C.peek()===!0&&!n.current)return;const Y=b.peek();if(G==="start")r.current=!0,i.current=Y.length;else if(G==="delta"){const A=i.current;if(A!==null&&B){const ee=[...Y],we=ee[A]??(ee[A]={type:"message",role:"agent",message:"",isText:!0,conversationIndex:k.peek()});we.type==="message"&&(ee[A]={...we,message:we.message+B},b.value=ee)}}else G==="stop"&&(i.current=null)},onDisconnect:B=>{n.current=!1,C.value=null,i.current=null,r.current=!1,b.value=[...b.value,B.reason==="error"?{type:"error",message:B.message,conversationIndex:k.peek()}:{type:"disconnection",role:B.reason==="user"?"user":"agent",conversationIndex:k.peek()}],k.value++,B.reason==="error"&&(g.value=B.message,console.error("[ConversationalAI] Disconnected due to an error:",B.message))}}),t.current=await e.current,t.current.setMicMuted(l.peek()),_){const B=t.current;setTimeout(()=>B.sendUserMessage(_),100)}const W=t.current.getId();return p.value=W,g.value=null,W}catch(W){let B="Could not start a conversation.";W instanceof CloseEvent?B=W.reason||B:W instanceof Error&&(B=W.message||B),g.value=B,b.value=[...b.value,{type:"error",message:B,conversationIndex:k.peek()}]}finally{e.current=null}},endSession:async()=>{const y=t.current;t.current=null,await(y==null?void 0:y.endSession())},getInputVolume:()=>{var y;return((y=t.current)==null?void 0:y.getInputVolume())??0},getOutputVolume:()=>{var y;return((y=t.current)==null?void 0:y.getOutputVolume())??0},sendFeedback:y=>{var _;(_=t.current)==null||_.sendFeedback(y)},sendUserMessage:y=>{var _;(_=t.current)==null||_.sendUserMessage(y),b.value=[...b.value,{type:"message",role:"user",message:y,isText:!0,conversationIndex:k.peek()}]},sendUserActivity:()=>{var y;(y=t.current)==null||y.sendUserActivity()}}},[c,l])}function fy(t,e){try{const n=new CustomEvent("elevenlabs-convai:call",{bubbles:!0,composed:!0,detail:{config:e}});return t.dispatchEvent(n),n.detail.config}catch(n){return console.error("[ConversationalAI] Could not trigger call event:",n),e}}const Yh=Ne(null);function py({children:t}){const{serverUrl:e}=Ta(),n=se("agent-id"),i=se("override-config"),r=se("signed-url"),o=Le(null);Et(()=>{if(i.value)try{const y=JSON.parse(i.value);if(y){o.value=y;return}}catch(y){console.error(`[ConversationalAI] Cannot parse override-config: ${y==null?void 0:y.message}`)}let b=n.value,k;if(r.value){const y=new URL(r.value).searchParams;b=y.get("agent_id")??n.value,k=y.get("conversation_signature")??void 0}if(!b){o.value=null;return}const C=new AbortController;return vy(b,e.value,C.signal,k).then(y=>{C.signal.aborted||(o.value=y)}).catch(y=>{console.error(`[ConversationalAI] Cannot fetch config for agent ${n.value}: ${y==null?void 0:y.message}`),C.signal.aborted||(o.value=null)}),()=>{C.abort()}});const s=se("variant"),a=se("placement"),c=se("terms-key"),l=se("mic-muting"),d=se("transcript"),u=se("text-input"),h=se("default-expanded"),f=se("always-expanded"),g=se("override-text-only"),p=se("use-rtc"),v=be(()=>{if(!o.value)return null;const b=s.value??o.value.variant,k=a.value??o.value.placement,C=c.value??o.value.terms_key,y=rn(g.value)??o.value.text_only??!1,_=rn(l.value)??o.value.mic_muting_enabled,S=rn(d.value)??o.value.transcript_enabled,E=rn(u.value)??o.value.text_input_enabled,x=rn(f.value)??o.value.always_expanded??!1,P=rn(h.value)??o.value.default_expanded??!1,D=rn(p.value)??o.value.use_rtc??!1;return{...o.value,variant:Y0(b),placement:Q0(k),terms_key:C,mic_muting_enabled:!y&&_,transcript_enabled:y||S,text_input_enabled:y||E,always_expanded:x,default_expanded:P,use_rtc:D}});return v.value?m(Yh.Provider,{value:v,children:t}):null}function Fe(){return ct(Yh)}function Ea(){const t=se("override-text-only"),e=Fe();return be(()=>rn(t.value)??e.value.text_only??!1)}function to(){const t=Ea(),{conversationTextOnly:e}=We();return be(()=>e.value??t.value)}function Xh(){const t=se("override-first-message"),e=Fe(),{language:n}=hi();return be(()=>{var i,r;return t.value??((r=(i=e.value.language_presets)==null?void 0:i[n.value.languageCode])==null?void 0:r.first_message)??e.value.first_message??null})}function my(){const t=Fe();return be(()=>t.value.use_rtc??!1)}function gy(){const t=Fe();return be(()=>{var e;return((e=t.value.end_feedback)==null?void 0:e.type)??null})}async function vy(t,e,n,i){const r=await(await fetch(`${e}/v1/convai/agents/${t}/widget${i?`?conversation_signature=${encodeURIComponent(i)}`:""}`,{signal:n})).json();if(!r.widget_config)throw new Error("Response does not contain widget_config");return r.widget_config}const by=fr(function(){const t=Fe(),e=be(()=>{const n=t.value.styles;return`:host, :root {
${ey.map(i=>`${yy(i)}: ${ky((n==null?void 0:n[i])??Vh[i])};`).join(`
`)}
}`});return m("style",{children:[e,J0]})});function yy(t){return`--el-${t.replace(/_/g,"-")}`}function ky(t){return typeof t=="number"?`${t}px`:t}const Qh=Ne(null);function wy({children:t}){const e=Fe(),{language:n}=hi(),i=se("text-contents"),r=be(()=>{try{if(i.value){const s=JSON.parse(i.value);if(typeof s=="object")return s}}catch(s){console.error("[ConversationalAI] Cannot parse text-contents:",s)}return{}}),o=le(()=>Object.fromEntries(Z0.map(s=>[s,rt(()=>{var a,c,l,d;return r.value[s]??((l=(c=(a=e.value.language_presets)==null?void 0:a[n.value.languageCode])==null?void 0:c.text_contents)==null?void 0:l[s])??((d=e.value.text_contents)==null?void 0:d[s])??jh[s]})])),[]);return m(Qh.Provider,{value:o,children:t})}function Ae(){return ct(Qh)}const Zh=Ne(null);function Cy({children:t}){const e=Fe(),n=se("avatar-image-url"),i=se("avatar-orb-color-1"),r=se("avatar-orb-color-2"),o=Le(""),s=be(()=>n.value?{type:"image",url:n.value}:i.value&&r.value?{type:"orb",color_1:i.value,color_2:r.value}:e.value.avatar),a=be(()=>{switch(s.value.type){case"url":return s.value.custom_url;case"orb":return o.value;case"image":return s.value.url}}),c=le(()=>({config:s,previewUrl:a,canvasUrl:o}),[]);return m(Zh.Provider,{value:c,children:t})}function Pa(){return ct(Zh)}function ef(t){var e,n,i="";if(typeof t=="string"||typeof t=="number")i+=t;else if(typeof t=="object")if(Array.isArray(t)){var r=t.length;for(e=0;e<r;e++)t[e]&&(n=ef(t[e]))&&(i&&(i+=" "),i+=n)}else for(n in t)t[n]&&(i&&(i+=" "),i+=n);return i}function he(){for(var t,e,n=0,i="",r=arguments.length;n<r;n++)(t=arguments[n])&&(e=ef(t))&&(i&&(i+=" "),i+=e);return i}const tf=Ne(null);function no({children:t,...e}){const[n,i]=K(null);return m("div",{ref:i,...e,children:n&&m(tf.Provider,{value:n,children:t})})}function _y(){return ct(tf)}function Ra(t){return t&&typeof t=="object"&&"peek"in t}function Sy(t){const e=Ra(t),n=Le(e?t.peek():t);return e?t:(n.value=t,n)}function nf(t){return Ra(t)?t.value:t}function Ty(t){return Ra(t)?t.peek():t}function rf(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function of(...t){return e=>{let n=!1;const i=t.map(r=>{const o=rf(r,e);return!n&&typeof o=="function"&&(n=!0),o});if(n)return()=>{for(let r=0;r<i.length;r++){const o=i[r];typeof o=="function"?o():rf(t[r],null)}}}}function $e(...t){return H(of(...t),t)}function Qi(t){const e=xy(t),n=ne((i,r)=>{const{children:o,...s}=i,a=un.toArray(o),c=a.find(Py);if(c){const l=c.props.children,d=a.map(u=>u===c?un.count(l)>1?un.only(null):Wt(l)?l.props.children:null:u);return m(e,{...s,ref:r,children:Wt(l)?Ai(l,void 0,d):null})}return m(e,{...s,ref:r,children:o})});return n.displayName=`${t}.Slot`,n}var sf=Qi("Slot");function xy(t){const e=ne((n,i)=>{const{children:r,...o}=n;if(Wt(r)){const s=Iy(r),a=Ry(o,r.props);return r.type!==Te&&(a.ref=i?of(i,s):s),Ai(r,a)}return un.count(r)>1?un.only(null):null});return e.displayName=`${t}.SlotClone`,e}var Ey=Symbol("radix.slottable");function Py(t){return Wt(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===Ey}function Ry(t,e){const n={...e};for(const i in e){const r=t[i],o=e[i];/^on[A-Z]/.test(i)?r&&o?n[i]=(...s)=>{const a=o(...s);return r(...s),a}:r&&(n[i]=r):i==="style"?n[i]={...r,...o}:i==="className"&&(n[i]=[r,o].filter(Boolean).join(" "))}return{...t,...n}}function Iy(t){var e,n;let i=(e=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:e.get,r=i&&"isReactWarning"in i&&i.isReactWarning;return r?t.ref:(i=(n=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:n.get,r=i&&"isReactWarning"in i&&i.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}const Ia=window.matchMedia("(prefers-reduced-motion: reduce)");function af(){const t=Le(Ia.matches);return X(()=>{const e=n=>{t.value=n.matches};return Ia.addEventListener("change",e),()=>Ia.removeEventListener("change",e)},[]),t}function cf({onStart:t,onEnd:e}){const n=$();n.current??(n.current=new Set);const i=$(t);i.current=t;const r=$(e);r.current=e;const o=Le(!1),s=H(c=>{var l,d;c.target===c.currentTarget&&((l=n.current)==null||l.add(c.propertyName),o.peek()||(o.value=!0,(d=i.current)==null||d.call(i)))},[]),a=H(c=>{var l,d,u;c.target===c.currentTarget&&((l=n.current)==null||l.delete(c.propertyName),(d=n.current)!=null&&d.size||(o.value=!1,(u=r.current)==null||u.call(r)))},[]);return{transitioning:o,handlers:{onTransitionStart:s,onTransitionEnd:a}}}function He(t){const e=af().value?Oy:Dy;return m(e,{...t})}function Oy({active:t,...e}){return nf(t)?m(sf,{"data-shown":!0,...e}):null}function Dy({active:t,initial:e=t,...n}){const i=Sy(t),r=Le(Ty(e));Et(()=>{i.value&&(r.value=i.value)});const{handlers:o}=cf({onEnd:()=>{r.value=i.value}});return!i.value&&!r.value?null:m(sf,{"data-shown":i.value&&r.value,...o,...n})}const Ay=`#version 300 es
precision highp float;

uniform float uTime;
uniform float uOffsets[7];
uniform vec3 uColor1;
uniform vec3 uColor2;
uniform sampler2D uPerlinTexture;

in vec2 vUv;

out vec4 outColor;

const float PI = 3.14159265358979323846;

// Draw a single oval with soft edges and calculate its gradient color
bool drawOval(vec2 polarUv, vec2 polarCenter, float a, float b, bool reverseGradient, float softness, out vec4 color) {
    vec2 p = polarUv - polarCenter;
    float oval = (p.x * p.x) / (a * a) + (p.y * p.y) / (b * b);
    
    float edge = smoothstep(1.0, 1.0 - softness, oval);
    
    if (edge > 0.0) {
        float gradient = reverseGradient ? (1.0 - (p.x / a + 1.0) / 2.0) : ((p.x / a + 1.0) / 2.0);
        color = vec4(vec3(gradient), 0.8 * edge);
        return true;
    }
    return false;
}

// Map grayscale value to a 4-color ramp (color1, color2, color3, color4)
vec3 colorRamp(float grayscale, vec3 color1, vec3 color2, vec3 color3, vec3 color4) {
    if (grayscale < 0.33) {
        return mix(color1, color2, grayscale * 3.0);
    } else if (grayscale < 0.66) {
        return mix(color2, color3, (grayscale - 0.33) * 3.0);
    } else {
        return mix(color3, color4, (grayscale - 0.66) * 3.0);
    }
}

vec2 hash2(vec2 p) {
    return fract(sin(vec2(dot(p, vec2(127.1, 311.7)), dot(p, vec2(269.5, 183.3)))) * 43758.5453);
}

// 2D noise for the ring
float noise2D(vec2 p) {
    vec2 i = floor(p);
    vec2 f = fract(p);
    
    vec2 u = f * f * (3.0 - 2.0 * f);
    float n = mix(
        mix(dot(hash2(i + vec2(0.0, 0.0)), f - vec2(0.0, 0.0)),
            dot(hash2(i + vec2(1.0, 0.0)), f - vec2(1.0, 0.0)), u.x),
        mix(dot(hash2(i + vec2(0.0, 1.0)), f - vec2(0.0, 1.0)),
            dot(hash2(i + vec2(1.0, 1.0)), f - vec2(1.0, 1.0)), u.x),
        u.y
    );

    return 0.5 + 0.5 * n;
}

float sharpRing(vec2 uv, float theta, float time) {
    float ringStart = 1.0;
    float ringWidth = 0.5;
    float noiseScale = 5.0;
    
    vec2 noiseCoord = vec2(theta / (2.0 * PI), time * 0.1);
    noiseCoord *= noiseScale;
    
    float noise = noise2D(noiseCoord);
    noise = (noise - 0.5) * 4.0;
    
    return ringStart + noise * ringWidth * 1.5;
}

float smoothRing(vec2 uv, float time) {
    float angle = atan(uv.y, uv.x);
    if (angle < 0.0) angle += 2.0 * PI;
    
    vec2 noiseCoord = vec2(angle / (2.0 * PI), time * 0.1);
    noiseCoord *= 6.0;
    
    float noise = noise2D(noiseCoord);
    noise = (noise - 0.5) * 8.0;
    
    float ringStart = 0.9;
    float ringWidth = 0.3;
    
    return ringStart + noise * ringWidth;
}

void main() {
    // Normalize vUv to be centered around (0.0, 0.0)
    vec2 uv = vUv * 2.0 - 1.0;

    // Convert uv to polar coordinates
    float radius = length(uv);
    float theta = atan(uv.y, uv.x);
    if (theta < 0.0) theta += 2.0 * PI; // Normalize theta to [0, 2*PI]

    // Initialize the base color to white
    vec4 color = vec4(1.0, 1.0, 1.0, 1.0);

    // Original parameters for the ovals in polar coordinates
    float originalCenters[7] = float[7](0.0, 0.5 * PI, 1.0 * PI, 1.5 * PI, 2.0 * PI, 2.5 * PI, 3.0 * PI);

    // Parameters for the animated centers in polar coordinates
    float centers[7];
    for (int i = 0; i < 7; i++) {
        centers[i] = originalCenters[i] + 0.5 * sin(uTime / 20.0 + uOffsets[i]);
    }

    float a, b;
    vec4 ovalColor;

    // Check if the pixel is inside any of the ovals
    for (int i = 0; i < 7; i++) {
        float noise = texture(uPerlinTexture, vec2(mod(centers[i] + uTime * 0.05, 1.0), 0.5)).r;
        a = noise * 1.5; // Increased variance: goes from 0.0 to 1.0
        b = noise * 4.5; // Tall semi-minor axis
        bool reverseGradient = (i % 2 == 1); // Reverse gradient for every second oval

        // Calculate the distance in polar coordinates
        float distTheta = abs(theta - centers[i]);
        if (distTheta > PI) distTheta = 2.0 * PI - distTheta; // Shortest distance on circle
        float distRadius = radius;

        float softness = 0.4; // Controls edge softness (e.g. how much blur is applied to the ovals)

        // Check if the pixel is inside the oval in polar coordinates
        if (drawOval(vec2(distTheta, distRadius), vec2(0.0, 0.0), a, b, reverseGradient, softness, ovalColor)) {
            // Blend the oval color with the existing color
            color.rgb = mix(color.rgb, ovalColor.rgb, ovalColor.a);
            color.a = max(color.a, ovalColor.a); // Max alpha
        }
    }
    
    // Calculate both noisy rings
    float ringRadius1 = sharpRing(uv, theta, uTime);
    float ringRadius2 = smoothRing(uv, uTime);
    
    // Blend both rings
    float ringAlpha1 = (radius >= ringRadius1) ? 0.3 : 0.0;
    float ringAlpha2 = smoothstep(ringRadius2 - 0.05, ringRadius2 + 0.05, radius) * 0.25;
    
    float totalRingAlpha = max(ringAlpha1, ringAlpha2);
    
    // Apply screen blend mode for combined rings
    vec3 ringColor = vec3(1.0); // White ring color
    color.rgb = 1.0 - (1.0 - color.rgb) * (1.0 - ringColor * totalRingAlpha);

    // Define colours to ramp against greyscale (could increase the amount of colours in the ramp)
    vec3 color1 = vec3(0.0, 0.0, 0.0); // Black
    vec3 color2 = uColor1; // Darker Color
    vec3 color3 = uColor2; // Lighter Color
    vec3 color4 = vec3(1.0, 1.0, 1.0); // White

    // Convert grayscale color to the color ramp
    float luminance = color.r; 
    color.rgb = colorRamp(luminance, color1, color2, color3, color4); // Apply the color ramp

    outColor = color;
}
`,My=`#version 300 es
precision highp float;

in vec2 position;

out vec2 vUv;

void main() {
  vUv = position * 0.5 + 0.5;
  gl_Position = vec4(position, 0, 1);
}
`,lf=0,Ny=new Float32Array([-1,1,-1,-1,1,1,1,-1]),Ly="https://storage.googleapis.com/eleven-public-cdn/images/perlin-noise.png",df=class Rn{constructor(e){Ze(this,"gl"),Ze(this,"program"),Ze(this,"startTime"),Ze(this,"targetSpeed",0),Ze(this,"speed",.5),Ze(this,"rafId",null),Ze(this,"resizeObserver"),Ze(this,"colorA",[0,0,0]),Ze(this,"colorB",[0,0,0]),Ze(this,"offsets",new Float32Array(7).map(()=>Math.random()*Math.PI*2)),Ze(this,"copyNoiseImage",()=>{this.gl&&(this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,Rn.noiseImage),this.gl.generateMipmap(this.gl.TEXTURE_2D))}),Ze(this,"toDataURL",()=>this.gl.canvas.toDataURL("image/png")),Ze(this,"render",()=>{if(!this.gl){this.rafId=null;return}const s=(performance.now()-this.startTime)/1e3;this.gl.uniform1f(this.gl.getUniformLocation(this.program,"uTime"),s),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4),this.rafId=requestAnimationFrame(this.render)});const n=e.getContext("webgl2",{depth:!1,stencil:!1});this.gl=n,this.program=this.setupProgram(Ay,My);const i=n.createTexture();n.bindTexture(n.TEXTURE_2D,i),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,new Uint8Array([128,128,128,255])),Rn.noiseImage||(Rn.noiseImage=new Image,Rn.noiseImage.crossOrigin="anonymous",Rn.noiseImage.src=Ly),Rn.noiseImage.complete?this.copyNoiseImage():Rn.noiseImage.addEventListener("load",this.copyNoiseImage);const r=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,r),n.bufferData(n.ARRAY_BUFFER,Ny,n.STATIC_DRAW),n.vertexAttribPointer(lf,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(lf),this.updateColors("#2792DC","#9CE6E6"),this.resizeObserver=new ResizeObserver(s=>{const a=s[0],c=a.devicePixelContentBoxSize?a.devicePixelContentBoxSize[0]:a.contentBoxSize[0];e.width=Math.min(512,c.inlineSize),e.height=Math.min(512,c.blockSize),this.updateViewport()});const o=e.parentElement;if(o)try{this.resizeObserver.observe(o,{box:"device-pixel-content-box"})}catch{this.resizeObserver.observe(o)}this.startTime=performance.now(),this.rafId=requestAnimationFrame(this.render)}dispose(){var e;this.rafId!==null&&cancelAnimationFrame(this.rafId),(e=this.resizeObserver)==null||e.disconnect(),this.gl=null,this.program=null}updateViewport(){this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}updateColors(e,n){this.gl&&(this.colorA=this.updateColor("uColor1",e)??this.colorA,this.colorB=this.updateColor("uColor2",n)??this.colorB)}updateVolume(e,n){this.targetSpeed=.2+(1-Math.pow(n-1,2))*1.8,this.targetSpeed>this.speed&&(this.speed=this.targetSpeed),this.gl.uniform1f(this.gl.getUniformLocation(this.program,"uInputVolume"),e),this.gl.uniform1f(this.gl.getUniformLocation(this.program,"uOutputVolume"),n)}updateColor(e,n){try{const i=parseInt(n.slice(1,3),16)/255,r=parseInt(n.slice(3,5),16)/255,o=parseInt(n.slice(5,7),16)/255,s=[Math.pow(i,2.2),Math.pow(r,2.2),Math.pow(o,2.2)];return this.gl.uniform3fv(this.gl.getUniformLocation(this.program,e),s),s}catch(i){console.error(`[ConversationalAI] Failed to parse ${n} as color:`,i)}}setupProgram(e,n){const i=this.getShader(this.gl.FRAGMENT_SHADER,e),r=this.getShader(this.gl.VERTEX_SHADER,n);if(!i||!r)throw new Error("Failed to compile shaders");if(this.program=this.gl.createProgram(),this.gl.attachShader(this.program,i),this.gl.attachShader(this.program,r),this.gl.linkProgram(this.program),!this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS))throw new Error("Failed to link program");return this.gl.useProgram(this.program),this.gl.uniform1i(this.gl.getUniformLocation(this.program,"uPerlinTexture"),0),this.gl.uniform1fv(this.gl.getUniformLocation(this.program,"uOffsets"),this.offsets),this.gl.uniform3fv(this.gl.getUniformLocation(this.program,"uColor1"),this.colorA),this.gl.uniform3fv(this.gl.getUniformLocation(this.program,"uColor2"),this.colorB),this.program}getShader(e,n){const i=this.gl.createShader(e);return this.gl.shaderSource(i,n),this.gl.compileShader(i),this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS)?i:(this.gl.deleteShader(i),null)}};Ze(df,"noiseImage");let Uy=df;const Fy={sm:"w-9 h-9",lg:"w-48 h-48"};function fi({size:t="sm",className:e}){const{getInputVolume:n,getOutputVolume:i,isSpeaking:r,isDisconnected:o}=We(),{config:s}=Pa(),a=$(null),c=$(null);Et(()=>{if(o.value){a.current.style.transform="",c.current.style.transform="";return}let d;function u(){const h=n(),f=i(),g=r.peek()?1:1-h*.4,p=r.peek()?1+f*.4:1;a.current.style.transform=`scale(${p})`,c.current.style.transform=`scale(${g})`,d=requestAnimationFrame(u)}return u(),()=>{cancelAnimationFrame(d)}});const l=be(()=>({backgroundImage:s.value.type==="image"?`url(${s.value.url})`:s.value.type==="url"?`url(${s.value.custom_url})`:void 0}));return m("div",{className:he("relative shrink-0",Fy[t],e),children:[m("div",{ref:a,className:"absolute inset-0 rounded-full bg-base-border"}),m("div",{ref:c,style:l,className:"absolute inset-0 rounded-full overflow-hidden bg-base bg-cover",children:s.value.type==="orb"&&m(By,{color1:s.value.color_1,color2:s.value.color_2})})]})}function By({color1:t,color2:e}){const{canvasUrl:n}=Pa(),[i,r]=K(null);X(()=>{i&&(i.updateColors(t,e),i.render(),n.value=i.toDataURL())},[i,t,e]);const o=H(s=>{if(s){const a=new Uy(s);return r(a),()=>a.dispose()}else r(null)},[r]);return m("canvas",{className:"w-full h-full",ref:o})}const jy=(t,e)=>{const n=new Array(t.length+e.length);for(let i=0;i<t.length;i++)n[i]=t[i];for(let i=0;i<e.length;i++)n[t.length+i]=e[i];return n},Vy=(t,e)=>({classGroupId:t,validator:e}),uf=(t=new Map,e=null,n)=>({nextPart:t,validators:e,classGroupId:n}),io="-",hf=[],qy="arbitrary..",zy=t=>{const e=Wy(t),{conflictingClassGroups:n,conflictingClassGroupModifiers:i}=t;return{getClassGroupId:r=>{if(r.startsWith("[")&&r.endsWith("]"))return $y(r);const o=r.split(io),s=o[0]===""&&o.length>1?1:0;return ff(o,s,e)},getConflictingClassGroupIds:(r,o)=>{if(o){const s=i[r],a=n[r];return s?a?jy(a,s):s:a||hf}return n[r]||hf}}},ff=(t,e,n)=>{if(t.length-e===0)return n.classGroupId;const i=t[e],r=n.nextPart.get(i);if(r){const c=ff(t,e+1,r);if(c)return c}const o=n.validators;if(o===null)return;const s=e===0?t.join(io):t.slice(e).join(io),a=o.length;for(let c=0;c<a;c++){const l=o[c];if(l.validator(s))return l.classGroupId}},$y=t=>t.slice(1,-1).indexOf(":")===-1?void 0:(()=>{const e=t.slice(1,-1),n=e.indexOf(":"),i=e.slice(0,n);return i?qy+i:void 0})(),Wy=t=>{const{theme:e,classGroups:n}=t;return Hy(n,e)},Hy=(t,e)=>{const n=uf();for(const i in t){const r=t[i];Oa(r,n,i,e)}return n},Oa=(t,e,n,i)=>{const r=t.length;for(let o=0;o<r;o++){const s=t[o];Gy(s,e,n,i)}},Gy=(t,e,n,i)=>{if(typeof t=="string"){Ky(t,e,n);return}if(typeof t=="function"){Jy(t,e,n,i);return}Yy(t,e,n,i)},Ky=(t,e,n)=>{const i=t===""?e:pf(e,t);i.classGroupId=n},Jy=(t,e,n,i)=>{if(Xy(t)){Oa(t(i),e,n,i);return}e.validators===null&&(e.validators=[]),e.validators.push(Vy(n,t))},Yy=(t,e,n,i)=>{const r=Object.entries(t),o=r.length;for(let s=0;s<o;s++){const[a,c]=r[s];Oa(c,pf(e,a),n,i)}},pf=(t,e)=>{let n=t;const i=e.split(io),r=i.length;for(let o=0;o<r;o++){const s=i[o];let a=n.nextPart.get(s);a||(a=uf(),n.nextPart.set(s,a)),n=a}return n},Xy=t=>"isThemeGetter"in t&&t.isThemeGetter===!0,Qy=t=>{if(t<1)return{get:()=>{},set:()=>{}};let e=0,n=Object.create(null),i=Object.create(null);const r=(o,s)=>{n[o]=s,e++,e>t&&(e=0,i=n,n=Object.create(null))};return{get(o){let s=n[o];if(s!==void 0)return s;if((s=i[o])!==void 0)return r(o,s),s},set(o,s){o in n?n[o]=s:r(o,s)}}},Da="!",mf=":",Zy=[],gf=(t,e,n,i,r)=>({modifiers:t,hasImportantModifier:e,baseClassName:n,maybePostfixModifierPosition:i,isExternal:r}),ek=t=>{const{prefix:e,experimentalParseClassName:n}=t;let i=r=>{const o=[];let s=0,a=0,c=0,l;const d=r.length;for(let p=0;p<d;p++){const v=r[p];if(s===0&&a===0){if(v===mf){o.push(r.slice(c,p)),c=p+1;continue}if(v==="/"){l=p;continue}}v==="["?s++:v==="]"?s--:v==="("?a++:v===")"&&a--}const u=o.length===0?r:r.slice(c);let h=u,f=!1;u.endsWith(Da)?(h=u.slice(0,-1),f=!0):u.startsWith(Da)&&(h=u.slice(1),f=!0);const g=l&&l>c?l-c:void 0;return gf(o,f,h,g)};if(e){const r=e+mf,o=i;i=s=>s.startsWith(r)?o(s.slice(r.length)):gf(Zy,!1,s,void 0,!0)}if(n){const r=i;i=o=>n({className:o,parseClassName:r})}return i},tk=t=>{const e=new Map;return t.orderSensitiveModifiers.forEach((n,i)=>{e.set(n,1e6+i)}),n=>{const i=[];let r=[];for(let o=0;o<n.length;o++){const s=n[o],a=s[0]==="[",c=e.has(s);a||c?(r.length>0&&(r.sort(),i.push(...r),r=[]),i.push(s)):r.push(s)}return r.length>0&&(r.sort(),i.push(...r)),i}},nk=t=>({cache:Qy(t.cacheSize),parseClassName:ek(t),sortModifiers:tk(t),...zy(t)}),ik=/\s+/,rk=(t,e)=>{const{parseClassName:n,getClassGroupId:i,getConflictingClassGroupIds:r,sortModifiers:o}=e,s=[],a=t.trim().split(ik);let c="";for(let l=a.length-1;l>=0;l-=1){const d=a[l],{isExternal:u,modifiers:h,hasImportantModifier:f,baseClassName:g,maybePostfixModifierPosition:p}=n(d);if(u){c=d+(c.length>0?" "+c:c);continue}let v=!!p,b=i(v?g.substring(0,p):g);if(!b){if(!v){c=d+(c.length>0?" "+c:c);continue}if(b=i(g),!b){c=d+(c.length>0?" "+c:c);continue}v=!1}const k=h.length===0?"":h.length===1?h[0]:o(h).join(":"),C=f?k+Da:k,y=C+b;if(s.indexOf(y)>-1)continue;s.push(y);const _=r(b,v);for(let S=0;S<_.length;++S){const E=_[S];s.push(C+E)}c=d+(c.length>0?" "+c:c)}return c},ok=(...t)=>{let e=0,n,i,r="";for(;e<t.length;)(n=t[e++])&&(i=vf(n))&&(r&&(r+=" "),r+=i);return r},vf=t=>{if(typeof t=="string")return t;let e,n="";for(let i=0;i<t.length;i++)t[i]&&(e=vf(t[i]))&&(n&&(n+=" "),n+=e);return n},sk=(t,...e)=>{let n,i,r,o;const s=c=>{const l=e.reduce((d,u)=>u(d),t());return n=nk(l),i=n.cache.get,r=n.cache.set,o=a,a(c)},a=c=>{const l=i(c);if(l)return l;const d=rk(c,n);return r(c,d),d};return o=s,(...c)=>o(ok(...c))},ak=[],Be=t=>{const e=n=>n[t]||ak;return e.isThemeGetter=!0,e},bf=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,yf=/^\((?:(\w[\w-]*):)?(.+)\)$/i,ck=/^\d+\/\d+$/,lk=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,dk=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,uk=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,hk=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,fk=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,pi=t=>ck.test(t),Z=t=>!!t&&!Number.isNaN(Number(t)),_n=t=>!!t&&Number.isInteger(Number(t)),Aa=t=>t.endsWith("%")&&Z(t.slice(0,-1)),on=t=>lk.test(t),pk=()=>!0,mk=t=>dk.test(t)&&!uk.test(t),kf=()=>!1,gk=t=>hk.test(t),vk=t=>fk.test(t),bk=t=>!j(t)&&!V(t),yk=t=>mi(t,Tf,kf),j=t=>bf.test(t),jn=t=>mi(t,xf,mk),Ma=t=>mi(t,Sk,Z),wf=t=>mi(t,_f,kf),kk=t=>mi(t,Sf,vk),ro=t=>mi(t,Ef,gk),V=t=>yf.test(t),Zi=t=>gi(t,xf),wk=t=>gi(t,Tk),Cf=t=>gi(t,_f),Ck=t=>gi(t,Tf),_k=t=>gi(t,Sf),oo=t=>gi(t,Ef,!0),mi=(t,e,n)=>{const i=bf.exec(t);return i?i[1]?e(i[1]):n(i[2]):!1},gi=(t,e,n=!1)=>{const i=yf.exec(t);return i?i[1]?e(i[1]):n:!1},_f=t=>t==="position"||t==="percentage",Sf=t=>t==="image"||t==="url",Tf=t=>t==="length"||t==="size"||t==="bg-size",xf=t=>t==="length",Sk=t=>t==="number",Tk=t=>t==="family-name",Ef=t=>t==="shadow",xk=()=>{const t=Be("color"),e=Be("font"),n=Be("text"),i=Be("font-weight"),r=Be("tracking"),o=Be("leading"),s=Be("breakpoint"),a=Be("container"),c=Be("spacing"),l=Be("radius"),d=Be("shadow"),u=Be("inset-shadow"),h=Be("text-shadow"),f=Be("drop-shadow"),g=Be("blur"),p=Be("perspective"),v=Be("aspect"),b=Be("ease"),k=Be("animate"),C=()=>["auto","avoid","all","avoid-page","page","left","right","column"],y=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],_=()=>[...y(),V,j],S=()=>["auto","hidden","clip","visible","scroll"],E=()=>["auto","contain","none"],x=()=>[V,j,c],P=()=>[pi,"full","auto",...x()],D=()=>[_n,"none","subgrid",V,j],M=()=>["auto",{span:["full",_n,V,j]},_n,V,j],F=()=>[_n,"auto",V,j],z=()=>["auto","min","max","fr",V,j],W=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],B=()=>["start","end","center","stretch","center-safe","end-safe"],G=()=>["auto",...x()],Y=()=>[pi,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...x()],A=()=>[t,V,j],ee=()=>[...y(),Cf,wf,{position:[V,j]}],we=()=>["no-repeat",{repeat:["","x","y","space","round"]}],tt=()=>["auto","cover","contain",Ck,yk,{size:[V,j]}],ut=()=>[Aa,Zi,jn],fe=()=>["","none","full",l,V,j],de=()=>["",Z,Zi,jn],Ge=()=>["solid","dashed","dotted","double"],nt=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],q=()=>[Z,Aa,Cf,wf],ge=()=>["","none",g,V,j],ye=()=>["none",Z,V,j],re=()=>["none",Z,V,j],ve=()=>[Z,V,j],Ce=()=>[pi,"full",...x()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[on],breakpoint:[on],color:[pk],container:[on],"drop-shadow":[on],ease:["in","out","in-out"],font:[bk],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[on],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[on],shadow:[on],spacing:["px",Z],text:[on],"text-shadow":[on],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",pi,j,V,v]}],container:["container"],columns:[{columns:[Z,j,V,a]}],"break-after":[{"break-after":C()}],"break-before":[{"break-before":C()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:_()}],overflow:[{overflow:S()}],"overflow-x":[{"overflow-x":S()}],"overflow-y":[{"overflow-y":S()}],overscroll:[{overscroll:E()}],"overscroll-x":[{"overscroll-x":E()}],"overscroll-y":[{"overscroll-y":E()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:P()}],"inset-x":[{"inset-x":P()}],"inset-y":[{"inset-y":P()}],start:[{start:P()}],end:[{end:P()}],top:[{top:P()}],right:[{right:P()}],bottom:[{bottom:P()}],left:[{left:P()}],visibility:["visible","invisible","collapse"],z:[{z:[_n,"auto",V,j]}],basis:[{basis:[pi,"full","auto",a,...x()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[Z,pi,"auto","initial","none",j]}],grow:[{grow:["",Z,V,j]}],shrink:[{shrink:["",Z,V,j]}],order:[{order:[_n,"first","last","none",V,j]}],"grid-cols":[{"grid-cols":D()}],"col-start-end":[{col:M()}],"col-start":[{"col-start":F()}],"col-end":[{"col-end":F()}],"grid-rows":[{"grid-rows":D()}],"row-start-end":[{row:M()}],"row-start":[{"row-start":F()}],"row-end":[{"row-end":F()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":z()}],"auto-rows":[{"auto-rows":z()}],gap:[{gap:x()}],"gap-x":[{"gap-x":x()}],"gap-y":[{"gap-y":x()}],"justify-content":[{justify:[...W(),"normal"]}],"justify-items":[{"justify-items":[...B(),"normal"]}],"justify-self":[{"justify-self":["auto",...B()]}],"align-content":[{content:["normal",...W()]}],"align-items":[{items:[...B(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...B(),{baseline:["","last"]}]}],"place-content":[{"place-content":W()}],"place-items":[{"place-items":[...B(),"baseline"]}],"place-self":[{"place-self":["auto",...B()]}],p:[{p:x()}],px:[{px:x()}],py:[{py:x()}],ps:[{ps:x()}],pe:[{pe:x()}],pt:[{pt:x()}],pr:[{pr:x()}],pb:[{pb:x()}],pl:[{pl:x()}],m:[{m:G()}],mx:[{mx:G()}],my:[{my:G()}],ms:[{ms:G()}],me:[{me:G()}],mt:[{mt:G()}],mr:[{mr:G()}],mb:[{mb:G()}],ml:[{ml:G()}],"space-x":[{"space-x":x()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":x()}],"space-y-reverse":["space-y-reverse"],size:[{size:Y()}],w:[{w:[a,"screen",...Y()]}],"min-w":[{"min-w":[a,"screen","none",...Y()]}],"max-w":[{"max-w":[a,"screen","none","prose",{screen:[s]},...Y()]}],h:[{h:["screen","lh",...Y()]}],"min-h":[{"min-h":["screen","lh","none",...Y()]}],"max-h":[{"max-h":["screen","lh",...Y()]}],"font-size":[{text:["base",n,Zi,jn]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[i,V,Ma]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",Aa,j]}],"font-family":[{font:[wk,j,e]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[r,V,j]}],"line-clamp":[{"line-clamp":[Z,"none",V,Ma]}],leading:[{leading:[o,...x()]}],"list-image":[{"list-image":["none",V,j]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",V,j]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:A()}],"text-color":[{text:A()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Ge(),"wavy"]}],"text-decoration-thickness":[{decoration:[Z,"from-font","auto",V,jn]}],"text-decoration-color":[{decoration:A()}],"underline-offset":[{"underline-offset":[Z,"auto",V,j]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:x()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",V,j]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",V,j]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:ee()}],"bg-repeat":[{bg:we()}],"bg-size":[{bg:tt()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},_n,V,j],radial:["",V,j],conic:[_n,V,j]},_k,kk]}],"bg-color":[{bg:A()}],"gradient-from-pos":[{from:ut()}],"gradient-via-pos":[{via:ut()}],"gradient-to-pos":[{to:ut()}],"gradient-from":[{from:A()}],"gradient-via":[{via:A()}],"gradient-to":[{to:A()}],rounded:[{rounded:fe()}],"rounded-s":[{"rounded-s":fe()}],"rounded-e":[{"rounded-e":fe()}],"rounded-t":[{"rounded-t":fe()}],"rounded-r":[{"rounded-r":fe()}],"rounded-b":[{"rounded-b":fe()}],"rounded-l":[{"rounded-l":fe()}],"rounded-ss":[{"rounded-ss":fe()}],"rounded-se":[{"rounded-se":fe()}],"rounded-ee":[{"rounded-ee":fe()}],"rounded-es":[{"rounded-es":fe()}],"rounded-tl":[{"rounded-tl":fe()}],"rounded-tr":[{"rounded-tr":fe()}],"rounded-br":[{"rounded-br":fe()}],"rounded-bl":[{"rounded-bl":fe()}],"border-w":[{border:de()}],"border-w-x":[{"border-x":de()}],"border-w-y":[{"border-y":de()}],"border-w-s":[{"border-s":de()}],"border-w-e":[{"border-e":de()}],"border-w-t":[{"border-t":de()}],"border-w-r":[{"border-r":de()}],"border-w-b":[{"border-b":de()}],"border-w-l":[{"border-l":de()}],"divide-x":[{"divide-x":de()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":de()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...Ge(),"hidden","none"]}],"divide-style":[{divide:[...Ge(),"hidden","none"]}],"border-color":[{border:A()}],"border-color-x":[{"border-x":A()}],"border-color-y":[{"border-y":A()}],"border-color-s":[{"border-s":A()}],"border-color-e":[{"border-e":A()}],"border-color-t":[{"border-t":A()}],"border-color-r":[{"border-r":A()}],"border-color-b":[{"border-b":A()}],"border-color-l":[{"border-l":A()}],"divide-color":[{divide:A()}],"outline-style":[{outline:[...Ge(),"none","hidden"]}],"outline-offset":[{"outline-offset":[Z,V,j]}],"outline-w":[{outline:["",Z,Zi,jn]}],"outline-color":[{outline:A()}],shadow:[{shadow:["","none",d,oo,ro]}],"shadow-color":[{shadow:A()}],"inset-shadow":[{"inset-shadow":["none",u,oo,ro]}],"inset-shadow-color":[{"inset-shadow":A()}],"ring-w":[{ring:de()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:A()}],"ring-offset-w":[{"ring-offset":[Z,jn]}],"ring-offset-color":[{"ring-offset":A()}],"inset-ring-w":[{"inset-ring":de()}],"inset-ring-color":[{"inset-ring":A()}],"text-shadow":[{"text-shadow":["none",h,oo,ro]}],"text-shadow-color":[{"text-shadow":A()}],opacity:[{opacity:[Z,V,j]}],"mix-blend":[{"mix-blend":[...nt(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":nt()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[Z]}],"mask-image-linear-from-pos":[{"mask-linear-from":q()}],"mask-image-linear-to-pos":[{"mask-linear-to":q()}],"mask-image-linear-from-color":[{"mask-linear-from":A()}],"mask-image-linear-to-color":[{"mask-linear-to":A()}],"mask-image-t-from-pos":[{"mask-t-from":q()}],"mask-image-t-to-pos":[{"mask-t-to":q()}],"mask-image-t-from-color":[{"mask-t-from":A()}],"mask-image-t-to-color":[{"mask-t-to":A()}],"mask-image-r-from-pos":[{"mask-r-from":q()}],"mask-image-r-to-pos":[{"mask-r-to":q()}],"mask-image-r-from-color":[{"mask-r-from":A()}],"mask-image-r-to-color":[{"mask-r-to":A()}],"mask-image-b-from-pos":[{"mask-b-from":q()}],"mask-image-b-to-pos":[{"mask-b-to":q()}],"mask-image-b-from-color":[{"mask-b-from":A()}],"mask-image-b-to-color":[{"mask-b-to":A()}],"mask-image-l-from-pos":[{"mask-l-from":q()}],"mask-image-l-to-pos":[{"mask-l-to":q()}],"mask-image-l-from-color":[{"mask-l-from":A()}],"mask-image-l-to-color":[{"mask-l-to":A()}],"mask-image-x-from-pos":[{"mask-x-from":q()}],"mask-image-x-to-pos":[{"mask-x-to":q()}],"mask-image-x-from-color":[{"mask-x-from":A()}],"mask-image-x-to-color":[{"mask-x-to":A()}],"mask-image-y-from-pos":[{"mask-y-from":q()}],"mask-image-y-to-pos":[{"mask-y-to":q()}],"mask-image-y-from-color":[{"mask-y-from":A()}],"mask-image-y-to-color":[{"mask-y-to":A()}],"mask-image-radial":[{"mask-radial":[V,j]}],"mask-image-radial-from-pos":[{"mask-radial-from":q()}],"mask-image-radial-to-pos":[{"mask-radial-to":q()}],"mask-image-radial-from-color":[{"mask-radial-from":A()}],"mask-image-radial-to-color":[{"mask-radial-to":A()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":y()}],"mask-image-conic-pos":[{"mask-conic":[Z]}],"mask-image-conic-from-pos":[{"mask-conic-from":q()}],"mask-image-conic-to-pos":[{"mask-conic-to":q()}],"mask-image-conic-from-color":[{"mask-conic-from":A()}],"mask-image-conic-to-color":[{"mask-conic-to":A()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:ee()}],"mask-repeat":[{mask:we()}],"mask-size":[{mask:tt()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",V,j]}],filter:[{filter:["","none",V,j]}],blur:[{blur:ge()}],brightness:[{brightness:[Z,V,j]}],contrast:[{contrast:[Z,V,j]}],"drop-shadow":[{"drop-shadow":["","none",f,oo,ro]}],"drop-shadow-color":[{"drop-shadow":A()}],grayscale:[{grayscale:["",Z,V,j]}],"hue-rotate":[{"hue-rotate":[Z,V,j]}],invert:[{invert:["",Z,V,j]}],saturate:[{saturate:[Z,V,j]}],sepia:[{sepia:["",Z,V,j]}],"backdrop-filter":[{"backdrop-filter":["","none",V,j]}],"backdrop-blur":[{"backdrop-blur":ge()}],"backdrop-brightness":[{"backdrop-brightness":[Z,V,j]}],"backdrop-contrast":[{"backdrop-contrast":[Z,V,j]}],"backdrop-grayscale":[{"backdrop-grayscale":["",Z,V,j]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[Z,V,j]}],"backdrop-invert":[{"backdrop-invert":["",Z,V,j]}],"backdrop-opacity":[{"backdrop-opacity":[Z,V,j]}],"backdrop-saturate":[{"backdrop-saturate":[Z,V,j]}],"backdrop-sepia":[{"backdrop-sepia":["",Z,V,j]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":x()}],"border-spacing-x":[{"border-spacing-x":x()}],"border-spacing-y":[{"border-spacing-y":x()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",V,j]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[Z,"initial",V,j]}],ease:[{ease:["linear","initial",b,V,j]}],delay:[{delay:[Z,V,j]}],animate:[{animate:["none",k,V,j]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[p,V,j]}],"perspective-origin":[{"perspective-origin":_()}],rotate:[{rotate:ye()}],"rotate-x":[{"rotate-x":ye()}],"rotate-y":[{"rotate-y":ye()}],"rotate-z":[{"rotate-z":ye()}],scale:[{scale:re()}],"scale-x":[{"scale-x":re()}],"scale-y":[{"scale-y":re()}],"scale-z":[{"scale-z":re()}],"scale-3d":["scale-3d"],skew:[{skew:ve()}],"skew-x":[{"skew-x":ve()}],"skew-y":[{"skew-y":ve()}],transform:[{transform:[V,j,"","none","gpu","cpu"]}],"transform-origin":[{origin:_()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:Ce()}],"translate-x":[{"translate-x":Ce()}],"translate-y":[{"translate-y":Ce()}],"translate-z":[{"translate-z":Ce()}],"translate-none":["translate-none"],accent:[{accent:A()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:A()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",V,j]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":x()}],"scroll-mx":[{"scroll-mx":x()}],"scroll-my":[{"scroll-my":x()}],"scroll-ms":[{"scroll-ms":x()}],"scroll-me":[{"scroll-me":x()}],"scroll-mt":[{"scroll-mt":x()}],"scroll-mr":[{"scroll-mr":x()}],"scroll-mb":[{"scroll-mb":x()}],"scroll-ml":[{"scroll-ml":x()}],"scroll-p":[{"scroll-p":x()}],"scroll-px":[{"scroll-px":x()}],"scroll-py":[{"scroll-py":x()}],"scroll-ps":[{"scroll-ps":x()}],"scroll-pe":[{"scroll-pe":x()}],"scroll-pt":[{"scroll-pt":x()}],"scroll-pr":[{"scroll-pr":x()}],"scroll-pb":[{"scroll-pb":x()}],"scroll-pl":[{"scroll-pl":x()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",V,j]}],fill:[{fill:["none",...A()]}],"stroke-w":[{stroke:[Z,Zi,jn,Ma]}],stroke:[{stroke:["none",...A()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},Ek=sk(xk),Na=(...t)=>Ek(he(t)),Pk={phone:Ik,"phone-off":Ok,chat:Dk,mic:Ak,"mic-off":Mk,check:Uk,"chevron-down":Nk,"chevron-up":Lk,send:Fk,star:Bk,copy:jk,download:Vk,wrap:qk},Rk={sm:"text-xs",md:"text-lg",lg:"text-xl"};function Lt({name:t,size:e="md",className:n}){const i=Pk[t];return m("slot",{name:`icon-${t}`,className:he("flex",Rk[e],n),"aria-hidden":!0,children:m(i,{})})}function Ik(t){return m("svg",{height:"1em",width:"1em",viewBox:"0 0 18 18",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...t,children:m("path",{d:"M3.7489 2.25C2.93286 2.25 2.21942 2.92142 2.27338 3.7963C2.6686 10.2041 7.79483 15.3303 14.2026 15.7255C15.0775 15.7795 15.7489 15.066 15.7489 14.25V11.958C15.7489 11.2956 15.3144 10.7116 14.6799 10.5213L12.6435 9.91035C12.1149 9.75179 11.542 9.89623 11.1518 10.2864L10.5901 10.8482C9.15291 10.0389 7.95998 8.84599 7.15074 7.40881L7.71246 6.84709C8.10266 6.45689 8.24711 5.88396 8.08854 5.35541L7.47761 3.31898C7.28727 2.6845 6.70329 2.25 6.04087 2.25H3.7489Z"})})}function Ok(t){return m("svg",{height:"1em",width:"1em",viewBox:"0 0 19 18",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...t,children:[m("path",{d:"M16.0303 3.53033C16.3232 3.23744 16.3232 2.76256 16.0303 2.46967C15.7374 2.17678 15.2626 2.17678 14.9697 2.46967L8.6271 8.81224C8.25925 8.3778 7.93185 7.90804 7.65074 7.40881L8.21246 6.84709C8.60266 6.45689 8.74711 5.88396 8.58854 5.35541L7.97761 3.31898C7.78727 2.6845 7.20329 2.25 6.54087 2.25H4.2489C3.43286 2.25 2.71942 2.92142 2.77338 3.7963C2.95462 6.73468 4.13069 9.40357 5.96899 11.4703L2.96967 14.4697C2.67678 14.7626 2.67678 15.2374 2.96967 15.5303C3.26256 15.8232 3.73744 15.8232 4.03033 15.5303L16.0303 3.53033Z"}),m("path",{d:"M14.7026 15.7255C12.2994 15.5773 10.0765 14.7636 8.21584 13.4665L10.9278 10.7545C10.9815 10.7863 11.0356 10.8175 11.0901 10.8482L11.6518 10.2864C12.042 9.89623 12.6149 9.75179 13.1435 9.91035L15.1799 10.5213C15.8144 10.7116 16.2489 11.2956 16.2489 11.958V14.25C16.2489 15.066 15.5775 15.7795 14.7026 15.7255Z"})]})}function Dk(t){return m("svg",{height:"1em",width:"1em",viewBox:"0 0 19 18",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...t,children:m("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M1.5 6.75C1.5 4.26472 3.51472 2.25 6 2.25H12C14.4853 2.25 16.5 4.26472 16.5 6.75V11.25C16.5 13.7353 14.4853 15.75 12 15.75H2.25C1.83579 15.75 1.5 15.4142 1.5 15V6.75ZM6 9.9375C5.48223 9.9375 5.0625 9.51777 5.0625 9C5.0625 8.48223 5.48223 8.0625 6 8.0625C6.51777 8.0625 6.9375 8.48223 6.9375 9C6.9375 9.51777 6.51777 9.9375 6 9.9375ZM9 9.9375C8.48223 9.9375 8.0625 9.51777 8.0625 9C8.0625 8.48223 8.48223 8.0625 9 8.0625C9.51777 8.0625 9.9375 8.48223 9.9375 9C9.9375 9.51777 9.51777 9.9375 9 9.9375ZM11.0625 9C11.0625 9.51777 11.4822 9.9375 12 9.9375C12.5178 9.9375 12.9375 9.51777 12.9375 9C12.9375 8.48223 12.5178 8.0625 12 8.0625C11.4822 8.0625 11.0625 8.48223 11.0625 9Z"})})}function Ak(t){return m("svg",{height:"1em",width:"1em",viewBox:"0 0 19 18",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...t,children:[m("path",{d:"M9.50008 1.5C7.42901 1.5 5.75008 3.17893 5.75008 5.25V8.25C5.75008 10.3211 7.42901 12 9.50008 12C11.5712 12 13.2501 10.3211 13.2501 8.25V5.25C13.2501 3.17893 11.5712 1.5 9.50008 1.5Z"}),m("path",{d:"M4.88997 10.8417C4.66448 10.4943 4.20002 10.3954 3.85256 10.6209C3.50509 10.8463 3.40621 11.3108 3.63169 11.6583C4.47442 12.9569 6.08493 14.6838 8.75008 14.9616V15.75C8.75008 16.1642 9.08587 16.5 9.50008 16.5C9.9143 16.5 10.2501 16.1642 10.2501 15.75V14.9616C12.9152 14.6838 14.5257 12.9569 15.3685 11.6583C15.594 11.3108 15.4951 10.8463 15.1476 10.6209C14.8001 10.3954 14.3357 10.4943 14.1102 10.8417C13.3305 12.0432 11.9002 13.5 9.50008 13.5C7.1 13.5 5.66968 12.0432 4.88997 10.8417Z"})]})}function Mk(t){return m("svg",{height:"1em",width:"1em",viewBox:"0 0 19 18",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...t,children:[m("path",{d:"M13.25 8.25C13.25 8.64791 13.188 9.03135 13.0732 9.39119L6.57947 2.8975C7.26687 2.04521 8.31974 1.5 9.49995 1.5C11.571 1.5 13.25 3.17893 13.25 5.25V8.25Z"}),m("path",{d:"M2.21967 1.71967C2.51256 1.42678 2.98744 1.42678 3.28033 1.71967L16.7803 15.2197C17.0732 15.5126 17.0732 15.9874 16.7803 16.2803C16.4874 16.5732 16.0126 16.5732 15.7197 16.2803L13.2828 13.8435C12.4719 14.4022 11.4678 14.8338 10.25 14.9614V15.75C10.25 16.1642 9.91422 16.5 9.50001 16.5C9.08579 16.5 8.75001 16.1642 8.75001 15.75V14.9616C6.08485 14.6838 4.47434 12.9569 3.63162 11.6583C3.40614 11.3108 3.50502 10.8463 3.85248 10.6209C4.19995 10.3954 4.66441 10.4943 4.88989 10.8417C5.6696 12.0432 7.09993 13.5 9.50001 13.5C10.5978 13.5 11.4845 13.1981 12.1992 12.7598L11.0875 11.6482C10.605 11.8739 10.0667 12 9.50001 12C7.42894 12 5.75001 10.3211 5.75001 8.25V6.31067L2.21967 2.78033C1.92678 2.48744 1.92678 2.01256 2.21967 1.71967Z"})]})}function Nk(t){return m("svg",{xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",...t,children:m("path",{d:"m6 9 6 6 6-6"})})}function Lk(t){return m("svg",{xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",...t,children:m("path",{d:"m18 15-6-6-6 6"})})}function Uk(t){return m("svg",{xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",...t,children:m("path",{d:"M20 6 9 17l-5-5"})})}function Fk(t){return m("svg",{xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em",viewBox:"0 0 20 20",fill:"currentColor",...t,children:m("path",{d:"M2.59413 5.1485C2.04 3.39377 3.86657 1.83482 5.51245 2.65776L16.47 8.13653C18.0055 8.90429 18.0055 11.0955 16.47 11.8633L5.51245 17.3421C3.86656 18.165 2.04 16.6061 2.59413 14.8513L3.86297 10.8333H7.50006C7.9603 10.8333 8.33339 10.4602 8.33339 10C8.33339 9.53976 7.9603 9.16667 7.50006 9.16667H3.86302L2.59413 5.1485Z"})})}function Bk(t){return m("svg",{height:"1em",width:"1em",viewBox:"0 0 21 20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...t,children:m("path",{d:"M11.8621 0.854898C11.3145 -0.284967 9.68804 -0.284965 9.1404 0.854899L6.77181 5.78487C6.77181 5.78487 6.76902 5.78867 6.7646 5.78925L1.31499 6.50272C0.0591912 6.66713 -0.452868 8.21568 0.474832 9.09033L4.45896 12.8466C4.46075 12.8483 4.46059 12.8502 4.46059 12.8502L3.46003 18.2169C3.22657 19.4691 4.55184 20.4152 5.66108 19.8172L10.4957 17.2111C10.4991 17.2093 10.5035 17.2093 10.5068 17.2111L15.3415 19.8172C16.4507 20.4152 17.776 19.4691 17.5425 18.2169L16.542 12.8502C16.542 12.8502 16.5418 12.8483 16.5436 12.8466L20.5277 9.09033C21.4554 8.21568 20.9434 6.66713 19.6876 6.50272L14.2379 5.78925C14.2335 5.78867 14.2307 5.78487 14.2307 5.78487L11.8621 0.854898Z"})})}function jk(t){return m("svg",{xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",...t,children:[m("rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2"}),m("path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"})]})}function Vk(t){return m("svg",{xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",...t,children:[m("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),m("polyline",{points:"7 10 12 15 17 10"}),m("line",{x1:"12",x2:"12",y1:"15",y2:"3"})]})}function qk(t){return m("svg",{xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",...t,children:[m("line",{x1:"3",x2:"21",y1:"6",y2:"6"}),m("path",{d:"M3 12h15a3 3 0 1 1 0 6h-4"}),m("polyline",{points:"16 16 14 18 16 20"}),m("line",{x1:"3",x2:"10",y1:"18",y2:"18"})]})}function zk({orbColor:t,circleBackgroundColor:e,starColor:n,className:i}){return m("slot",{name:"icon-feedback",className:he("flex",i),"aria-hidden":!0,children:m("svg",{width:"100%",height:"100%",viewBox:"0 0 82 88",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M9 42C9 59.6731 23.3269 74 41 74C58.6731 74 73 59.6731 73 42C73 24.3269 58.6731 10 41 10C23.3269 10 9 24.3269 9 42ZM29.4529 18.5973C31.1347 18.0574 32.8641 17.5023 34.9844 16.6005C42.2533 13.5091 48.3526 11.9217 51.7782 14.094C53.5063 15.1899 54.4051 16.7749 55.6117 18.9024C56.7969 20.9922 58.279 23.6057 61.1358 26.7937C62.2737 28.0636 63.3886 29.2195 64.4371 30.3064C68.7007 34.7263 71.8645 38.0061 70.9949 43.1697C70.2965 47.316 67.9794 49.4559 65.6038 51.65C63.4317 53.656 61.2107 55.7073 60.1332 59.3786C57.8774 67.0653 53.5327 71.9113 48.3526 72.7468C43.1725 73.5823 36.6555 75.1698 29.8043 70.1567C26.1949 67.5157 25.229 64.3182 24.1947 60.894C23.2657 57.8184 22.2814 54.56 19.2768 51.3577C14.1619 45.9062 10.2533 29.6345 19.2768 23.0339C23.736 20.4327 26.5223 19.5382 29.4529 18.5973Z",fill:t,"fill-opacity":"0.15",stroke:t,"stroke-opacity":"0.35"}),m("path",{d:"M43.5 73.4212C40.4387 73.4212 35.0039 71.1025 37.556 56.4696C40.143 41.6365 42.6582 40.577 44.6991 25.744C46.3318 13.8775 41.1635 8.87964 33 10.9988",stroke:t,"stroke-opacity":"0.35"}),m("path",{d:"M43.5 73.4212C40.4387 73.4212 35.0039 71.1025 37.556 56.4696C40.143 41.6365 42.6582 40.577 44.6991 25.744C46.3318 13.8775 41.1635 8.87964 33 10.9988",stroke:t,"stroke-opacity":"0.35"}),m("path",{d:"M21.9366 68.1987C21.3549 66.5119 21.0386 60.9231 28.1376 53.3448C37.0114 43.8719 40.5 43.9579 51.4911 31.7482C59.5691 22.7747 59.1723 17.0524 58.0993 15.4626",stroke:t,"stroke-opacity":"0.35"}),m("path",{d:"M9.26819 42.161C10.4003 43.5337 15.6951 46.3853 25.7661 44.3926C38.3548 41.9018 52.434 40.307 57.694 41.0287C70.352 42.7655 71.4138 51.3035 71.4138 51.3035",stroke:t,"stroke-opacity":"0.35"}),m("path",{d:"M22 16.4916C18.815 21.85 19.6451 26.0591 27.9943 32.0828C38.4307 39.6124 50.2985 48.8304 53.5024 53.1027C58.6684 59.9914 59.5 67.928 59.5 67.928",stroke:t,"stroke-opacity":"0.35"}),m("rect",{x:"9.26099",y:"10",width:"63.7129",height:"63.7129",rx:"31.8565",stroke:t,"stroke-opacity":"0.43","stroke-width":"1.5"}),m("g",{"clip-path":"url(#clip0_7006_42127)",children:[m("circle",{cx:"62.4996",cy:"18.2032",r:"15.0195",transform:"rotate(6.27205 62.4996 18.2032)",fill:e}),m("path",{d:"M60.7142 12.1753C62.057 10.0714 65.2294 10.4202 66.0833 12.7654L66.6158 14.2308L68.1251 14.6217C70.5415 15.2484 71.1908 18.3742 69.2237 19.911L67.9944 20.8704L68.0896 22.4262C68.2403 24.9178 65.4681 26.5011 63.3987 25.1056L62.1065 24.2326L60.6555 24.8041C58.3322 25.7172 55.9702 23.5694 56.6585 21.1698L57.0884 19.6717L56.0977 18.4684C54.5112 16.541 55.8231 13.6307 58.318 13.5438L59.8751 13.4899L60.7142 12.1753Z",fill:n,stroke:e,"stroke-width":"3.27381"}),m("path",{d:"M63.925 5.23719C71.0867 6.02431 76.2545 12.4676 75.4676 19.6293C74.6805 26.7911 68.2364 31.959 61.0746 31.1718C53.9129 30.3845 48.7459 23.9406 49.533 16.7789C50.3203 9.61739 56.7634 4.45029 63.925 5.23719ZM63.6957 7.32326C57.6866 6.66302 52.2797 10.9991 51.6191 17.0082C50.9586 23.0174 55.2946 28.4251 61.3038 29.0858C67.3132 29.7462 72.7211 25.4094 73.3816 19.4C74.0418 13.3908 69.705 7.98372 63.6957 7.32326Z",fill:n,stroke:e,"stroke-width":"0.3","stroke-linecap":"round","stroke-linejoin":"round"})]}),m("ellipse",{cx:"41",cy:"85",rx:"15",ry:"3",fill:t,"fill-opacity":"0.35"}),m("defs",{children:m("clipPath",{id:"clip0_7006_42127",children:m("rect",{width:"33",height:"33",fill:"white",transform:"translate(47.9012) rotate(6.27205)"})})})]})})}function sn(t){const e=af().value?$k:Wk;return m(e,{...t})}function $k({visible:t,className:e,grow:n,dep:i,...r}){return t?m("div",{className:he(n&&"grow",e),...r}):null}function Wk({visible:t,children:e,className:n,grow:i,dep:r,...o}){const[s,a]=K(t),[c,l]=K(null),[d,u]=K(null),h=$(e);t&&(h.current=e);const f=H(v=>{l(v),v&&!t&&(v.style.width="0px",v.style.height="0px")},[]);X(()=>{d&&(d.style.transition="none",d.style.opacity="0",d.offsetWidth,d.style.transition="",d.style.opacity="")},[r]),le(()=>{c&&(c.style.width=`${c.offsetWidth}px`,c.style.height=`${c.offsetHeight}px`)},[c,t,r]),X(()=>{if(!c||!d)return;t&&a(!0);const v=t?d.offsetWidth:0,b=t?d.offsetHeight:0;c.style.width=!t||c.offsetWidth!==v?`${v}px`:"",c.style.height=!t||c.offsetHeight!==b?`${b}px`:""},[c,d,t,r]);const{transitioning:g,handlers:p}=cf({onEnd:()=>{t?(c.style.width="",c.style.height=""):a(!1)}});return m("div",{ref:f,className:he("relative inline-flex shrink-0 justify-center items-center transition-[opacity,width,height,transform,flex-grow] duration-200 min-w-0",!t&&"opacity-0 scale-75",t&&i&&"grow",t&&s&&!g.value&&"z-1"),...p,children:m("div",{ref:u,className:he("shrink-0 min-h-min min-w-min transition-opacity duration-200",i&&"grow",n),...o,children:(t||s)&&h.current})})}const Hk={primary:"text-accent-primary border border-accent bg-accent hover:border-accent-hover hover:bg-accent-hover active:border-accent-active active:bg-accent-active",secondary:"text-base-primary border border-base-border bg-base hover:bg-base-hover active:bg-base-active",ghost:"text-base-primary border border-base bg-base hover:bg-base-hover hover:border-base-hover active:bg-base-active active:border-base-active","md-button":"text-base-primary border border-base-border bg-base hover:bg-base-hover active:bg-base-active text-sm h-6"},Ct=ne(function({variant:t="secondary",children:e,icon:n,className:i,iconClassName:r,truncate:o=!0,...s},a){const c=!!n&&!e;return m("button",{ref:a,className:Na("h-9 flex px-2.5 text-sm items-center transition-colors justify-center rounded-button duration-200 focus-ring overflow-hidden select-none",Hk[t],c&&"min-w-9",i),type:"button",...s,children:[n&&m(Lt,{className:Na("transition-[margin] duration-200",c&&"-mx-0.5",t==="md-button"&&"text-sm",r),name:n}),m(sn,{visible:!!e,dep:e,children:m("span",{className:Na("block whitespace-nowrap max-w-64 truncate",t==="md-button"?"pl-1.5":"px-1.5"),children:e})})]})});function La({className:t,...e}){const{status:n,isSpeaking:i}=We(),r=to(),o=Ae(),s=be(()=>n.value!=="connected"?o.connecting_status.value:r.value?o.chatting_status.value:i.value?o.speaking_status.value:o.listening_status.value),[a,c]=K(s.peek());return Et(()=>{const l=s.value;if(n.value==="connected"&&i.value)c(l);else{const d=setTimeout(()=>{c(l)},500);return()=>clearTimeout(d)}}),m("div",{className:he("py-1.5 px-3 bg-base-active overflow-hidden rounded-bubble text-sm",t),...e,children:m(He,{initial:!1,active:!0,children:m("div",{className:"animate-text whitespace-nowrap transition-[opacity,transform] ease-out duration-200 data-hidden:opacity-0 transform data-hidden:translate-y-2",children:a})},a)})}const Pf=Ne(null);function Gk({children:t}){const e=Le(null),n=Le(""),i=Le("initial"),{lastId:r}=We(),o=se("agent-id"),{serverUrl:s}=Ta(),a=H(async u=>{const h=r.value,f=o.value;if(!h||!f){console.warn("[ConversationalAI] Cannot submit rating: missing agent_id or conversation_id");return}try{e.value=u,i.value="submitted-rating",await Nh(h,{rating:u},s.value)}catch(g){console.error("[ConversationalAI] Failed to submit rating:",g)}},[]),c=H(async()=>{const u=r.value,h=o.value;if(!u||!h){console.warn("[ConversationalAI] Cannot submit feedback: missing agent_id or conversation_id");return}if(e.value===null){console.warn("[ConversationalAI] Cannot submit feedback: rating not set");return}if(n.value)try{i.value="submitted-follow-up",await Nh(u,{rating:e.value,comment:n.value||void 0},s.value)}catch(f){console.error("[ConversationalAI] Failed to submit feedback:",f)}},[]),l=H(()=>{e.value=null,n.value="",i.value="initial"},[]);Et(()=>{r.value!==null&&l()});const d=le(()=>({rating:e,feedbackText:n,feedbackProgress:i,submitRating:a,submitFeedback:c,reset:l}),[a,c,l]);return m(Pf.Provider,{value:d,children:t})}function Ua(){return ct(Pf)}const Rf=Ne(null);function Kk({defaultContent:t="transcript",children:e}){const n=Le(t),i=le(()=>{const r=n.value==="feedback"?{showHeaderBack:!0,onHeaderBack:()=>{n.value="transcript"}}:{showHeaderBack:!1};return{currentContent:n,currentConfig:r}},[n.value]);return m(Rf.Provider,{value:i,children:e})}function Fa(){return ct(Rf)}const If=(t,e)=>Array.from({length:e-t+1},(n,i)=>i+t),Jk=({isFilled:t,iconName:e})=>m("span",{className:he("w-8 h-8 grid place-content-center",t?"text-base-primary":"text-base-border"),children:m(Lt,{name:e,size:"lg"})}),Yk=({value:t,rating:e,hoverRating:n,onClick:i,onHover:r,onKeyDown:o,iconName:s})=>{const a=e.value!==null&&t<=e.value,c=n.value!==null&&t<=n.value,l=H(u=>{u.stopPropagation(),i(t)},[i,t]),d=H(u=>{o(u,t)},[o,t]);return m("button",{type:"button",role:"radio","aria-checked":a,"aria-label":t.toString(),onMouseEnter:()=>r(t),onClick:l,onKeyDown:d,className:he("w-8 h-8 grid place-content-center rounded-full focus-ring transition-colors cursor-pointer",a||c?"text-base-primary":"text-base-border"),children:m(Lt,{name:s,size:"lg"})})},Xk=({onRate:t,min:e=1,max:n=5,ariaLabel:i,icon:r="star"})=>{const o=Le(null),s=Le(null),a=If(e,n),c=H(h=>{s.value=h},[s]),l=H(()=>{s.value=null},[s]),d=H(h=>{o.value=h,t(h)},[o,t]),u=H((h,f)=>{if(h.key==="Enter"||h.key===" ")h.preventDefault(),o.value=f,t(f);else if(h.key==="ArrowLeft"||h.key==="ArrowDown"){if(h.preventDefault(),f-1>=e){const g=h.currentTarget,p=g==null?void 0:g.previousElementSibling;p==null||p.focus()}}else if((h.key==="ArrowRight"||h.key==="ArrowUp")&&(h.preventDefault(),f+1<=n)){const g=h.currentTarget,p=g==null?void 0:g.nextElementSibling;p==null||p.focus()}},[o,t,e,n]);return m("div",{role:"radiogroup","aria-label":i,className:"flex no-wrap cursor-pointer",onMouseLeave:l,children:a.map(h=>m(Yk,{value:h,rating:o,hoverRating:s,onClick:d,onHover:c,onKeyDown:u,iconName:r},h))})};function Of({rating:t,min:e=1,max:n=5,icon:i="star"}){const r=If(e,n);return m("div",{className:"flex no-wrap",role:"img","aria-label":`Rating: ${t} out of ${n}`,children:r.map(o=>m(Jk,{isFilled:t>=o,iconName:i},o))})}function Qk({icon:t,onRate:e}){const n=Ae();return m("div",{className:"flex flex-col items-center",children:[m("div",{className:"text-sm text-base-primary font-medium",children:n.initiate_feedback}),m("div",{className:"py-4",children:m(Xk,{onRate:e,ariaLabel:n.initiate_feedback,icon:t})})]})}function Zk({icon:t,rating:e,showFollowUpButton:n,onFollowUpClick:i}){const r=Ae();return m("div",{className:"flex flex-col items-center gap-3 mb-4",children:[m("div",{className:"text-sm text-base-primary font-medium",children:r.thanks_for_feedback}),m(Of,{rating:e,min:1,max:5,icon:t}),n&&m(Ct,{variant:"secondary",onClick:i,children:r.request_follow_up_feedback})]})}function ew({icon:t="star"}){const{currentContent:e}=Fa(),{rating:n,feedbackProgress:i,submitRating:r}=Ua(),o=i.value!=="initial"&&n.value!==null,s=H(c=>{r(c),e.value="feedback"},[r]),a=H(()=>{e.value="feedback"},[]);return o?m(Zk,{icon:t,rating:n.value??0,showFollowUpButton:i.value!=="submitted-follow-up",onFollowUpClick:a}):m(Qk,{icon:t,onRate:s})}function tw({entry:t}){const{previewUrl:e}=Pa();return m("div",{className:he("flex gap-2.5 transition-[opacity,transform] duration-200 data-hidden:opacity-0 data-hidden:scale-75",t.role==="user"?"justify-end pl-16 origin-top-right":"pr-16 origin-top-left"),children:[t.role==="agent"&&m("img",{src:e,alt:"AI agent avatar",className:"bg-base-border shrink-0 w-5 h-5 rounded-full"}),m("div",{dir:"auto",className:he("px-3 py-2.5 rounded-bubble text-sm min-w-0 [overflow-wrap:break-word]",t.role==="user"?"bg-accent text-accent-primary":"bg-base-active text-base-primary"),children:t.message})]})}function nw({entry:t}){const e=Ae(),{lastId:n}=We(),i=gy();return m("div",{className:"mt-3 px-8 flex flex-col",children:[i.value==="rating"&&m(ew,{}),m("div",{className:"text-xs text-base-subtle text-center transition-opacity duration-200 data-hidden:opacity-0",children:[t.role==="user"?e.user_ended_conversation:e.agent_ended_conversation,m("br",{}),n.value&&m("span",{className:"break-all",children:[e.conversation_id,": ",n.value]})]})]})}function iw({entry:t}){const e=Ae(),{lastId:n}=We();return m("div",{className:"mt-2 px-8 text-xs text-base-error text-center transition-opacity duration-200 data-hidden:opacity-0",children:[e.error_occurred,m("br",{}),t.message,n.value&&m(Te,{children:[m("br",{}),m("span",{className:"text-base-subtle break-all",children:[e.conversation_id,": ",n.value]})]})]})}function rw({entry:t,animateIn:e}){return m(He,{initial:!e,active:!0,children:t.type==="message"?m(tw,{entry:t}):t.type==="disconnection"?m(nw,{entry:t}):m(iw,{entry:t})})}const ow=16;function sw({scrollPinned:t,transcript:e}){const n=$(null),i=$(0),r=$(null),o=$(!1),s=$(!1),a=u=>{var h;(h=n.current)==null||h.scrollTo({top:n.current.scrollHeight,behavior:u?"smooth":"instant"})},c=()=>{const u=n.current;if(!u||!o.current||s.current)return;const h=u.scrollTop,f=u.scrollHeight-u.clientHeight,g=f-h;if(Math.abs(g)<1){u.scrollTop=f,r.current=requestAnimationFrame(c);return}const p=g*.2,v=2;u.scrollTop=h+Math.max(p,v),r.current=requestAnimationFrame(c)},l=()=>{!n.current||s.current||o.current||(o.current=!0,r.current=requestAnimationFrame(c))},d=$(!0);return X(()=>(d.current=!1,a(!1),()=>{r.current&&cancelAnimationFrame(r.current)}),[]),Et(()=>{var u;const h=e.value;if(!t.peek())return;const f=h[h.length-1];if((f==null?void 0:f.type)==="message"&&(f==null?void 0:f.role)==="agent"&&(f==null?void 0:f.isText)===!0){const g=((u=f.message)==null?void 0:u.length)||0;i.current===0&&g>0?(i.current=g,s.current=!1,requestAnimationFrame(()=>{requestAnimationFrame(()=>{!s.current&&t.peek()&&(a(!1),l())})})):g>i.current&&(i.current=g,l())}else i.current=0,o.current=!1,s.current=!1,r.current&&(cancelAnimationFrame(r.current),r.current=null),a(!0)}),m("div",{ref:n,onWheel:u=>{const h=u.currentTarget.scrollTop>=u.currentTarget.scrollHeight-u.currentTarget.clientHeight-ow;t.value=h,!h&&o.current&&(s.current=!0,o.current=!1,r.current&&(cancelAnimationFrame(r.current),r.current=null))},className:"px-4 pt-3 pb-3 grow flex flex-col gap-3 overflow-x-hidden overflow-y-auto",children:e.value.map((u,h)=>m(rw,{entry:u,animateIn:!d.current},`${h}-${u.conversationIndex}`))})}function Df({className:t,...e}){return m("textarea",{className:he("px-3 py-[calc(theme(spacing.2)-1px)] border text-sm text-base-primary bg-base border-base-border rounded-input focus-ring resize-none [field-sizing:content] placeholder:text-base-subtle",t),...e})}function Ba({visible:t,...e}){const n=Ae(),{isMuted:i,isMutingEnabled:r,setIsMuted:o}=Hh(),s=H(()=>{o(!i.peek())},[o]);return r.value?m(sn,{visible:t,className:"p-1",children:m(Ct,{"aria-label":n.mute_microphone,"aria-pressed":i,icon:i.value?"mic-off":"mic",onClick:s,...e})}):null}function ja({iconOnly:t,isDisconnected:e,children:n,...i}){const{endSession:r,startSession:o}=We(),s=Ae();return m(Ct,{variant:e?"primary":"secondary",icon:e?"phone":"phone-off",onClick:e?a=>o(a.currentTarget):r,"aria-label":e?s.start_call:s.end_call,...i,children:t?void 0:n??(e?s.start_call:s.end_call)})}function aw({showTranscript:t,scrollPinned:e}){const n=Le(""),i=to(),{text_input_enabled:r}=Fe().value,o=Ae(),{isDisconnected:s,status:a,startSession:c,sendUserMessage:l,sendUserActivity:d,conversationIndex:u}=We(),h=H(async v=>{v.preventDefault();const b=n.value.trim();b&&(e.value=!0,n.value="",s.value?await c(v.currentTarget,b):l(b))},[n,e,s,c,l]),f=H(async v=>{v.key==="Enter"&&!v.shiftKey&&await h(v)},[h]),g=H(v=>{n.value=v.currentTarget.value},[n]),p=be(()=>!!n.value.trim());return m("div",{className:"shrink-0 overflow-hidden flex p-3 items-end justify-end",children:[r&&m("div",{className:"relative grow min-w-0 flex z-1 m-1",children:[m(Df,{rows:1,"aria-label":o.input_label,value:n,onInput:d,onChange:g,onKeyDown:f,className:"min-w-0 w-full max-h-[8lh] pr-9",placeholder:i.value?s.value&&u.value>0?o.input_placeholder_new_conversation:o.input_placeholder_text_only:o.input_placeholder}),m(He,{active:p,children:m("button",{"aria-label":o.send_message,className:"absolute right-1 bottom-1 w-7 h-7 flex items-center justify-center hover:bg-base-hover active:bg-base-active rounded-button focus-ring transition-[transform,opacity] duration-200 data-hidden:opacity-0 data-hidden:scale-90",onClick:h,children:m(Lt,{name:"send"})})})]}),m("div",{className:"flex h-11 items-center",children:[m(Ba,{visible:!i.value&&!s.value}),m(sn,{visible:!s.value||t,className:"p-1",children:m(ja,{iconOnly:!s.value,isDisconnected:s.value,disabled:a.value==="disconnecting"||a.value==="connecting",children:o.new_call})})]})]})}function cw(){const t=Ae(),{rating:e,feedbackText:n}=Ua(),i=H(r=>{n.value=r.currentTarget.value},[]);return m("div",{className:"grow flex flex-col overflow-y-auto overflow-x-hidden px-4",children:m("div",{className:"flex flex-col gap-8 min-h-full pt-4 pb-2",children:[m("div",{className:"flex flex-col items-center justify-center gap-3",children:[m(zk,{orbColor:"var(--el-base-subtle)",circleBackgroundColor:"var(--el-base)",starColor:"var(--el-base-primary)",className:"w-20 h-22"}),e.value!==null&&m(Of,{rating:e.value,min:1,max:5}),m("div",{className:"text-center",children:[m("p",{className:"text-sm text-base-primary font-medium",children:t.thanks_for_feedback}),m("p",{className:"text-sm text-base-subtle",children:t.thanks_for_feedback_details})]})]}),m(Df,{className:"w-full min-h-[6lh]",placeholder:t.follow_up_feedback_placeholder,rows:6,value:n,onInput:i})]})})}function lw(){const t=Ae(),{currentContent:e}=Fa(),{submitFeedback:n}=Ua(),i=H(()=>{n(),e.value="transcript"},[n]);return m("div",{className:"shrink-0 overflow-hidden flex p-3 items-end justify-end",children:m(Ct,{variant:"primary",onClick:i,children:t.submit})})}function Af(t,[e,n]){return Math.min(n,Math.max(e,t))}function Me(t,e,{checkForDefaultPrevented:n=!0}={}){return function(i){if(t==null||t(i),n===!1||!i.defaultPrevented)return e==null?void 0:e(i)}}function Va(t,e=[]){let n=[];function i(o,s){const a=Ne(s),c=n.length;n=[...n,s];const l=u=>{var h;const{scope:f,children:g,...p}=u,v=((h=f==null?void 0:f[t])==null?void 0:h[c])||a,b=le(()=>p,Object.values(p));return m(v.Provider,{value:b,children:g})};l.displayName=o+"Provider";function d(u,h){var f;const g=((f=h==null?void 0:h[t])==null?void 0:f[c])||a,p=dn(g);if(p)return p;if(s!==void 0)return s;throw new Error(`\`${u}\` must be used within \`${o}\``)}return[l,d]}const r=()=>{const o=n.map(s=>Ne(s));return function(s){const a=(s==null?void 0:s[t])||o;return le(()=>({[`__scope${t}`]:{...s,[t]:a}}),[s,a])}};return r.scopeName=t,[i,dw(r,...e)]}function dw(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const i=t.map(r=>({useScope:r(),scopeName:r.scopeName}));return function(r){const o=i.reduce((s,{useScope:a,scopeName:c})=>{const l=a(r)[`__scope${c}`];return{...s,...l}},{});return le(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return n.scopeName=e.scopeName,n}function uw(t){const e=t+"CollectionProvider",[n,i]=Va(e),[r,o]=n(e,{collectionRef:{current:null},itemMap:new Map}),s=p=>{const{scope:v,children:b}=p,k=Ht.useRef(null),C=Ht.useRef(new Map).current;return m(r,{scope:v,itemMap:C,collectionRef:k,children:b})};s.displayName=e;const a=t+"CollectionSlot",c=Qi(a),l=Ht.forwardRef((p,v)=>{const{scope:b,children:k}=p,C=o(a,b),y=$e(v,C.collectionRef);return m(c,{ref:y,children:k})});l.displayName=a;const d=t+"CollectionItemSlot",u="data-radix-collection-item",h=Qi(d),f=Ht.forwardRef((p,v)=>{const{scope:b,children:k,...C}=p,y=Ht.useRef(null),_=$e(v,y),S=o(d,b);return Ht.useEffect(()=>(S.itemMap.set(y,{ref:y,...C}),()=>void S.itemMap.delete(y))),m(h,{[u]:"",ref:_,children:k})});f.displayName=d;function g(p){const v=o(t+"CollectionConsumer",p);return Ht.useCallback(()=>{const b=v.collectionRef.current;if(!b)return[];const k=Array.from(b.querySelectorAll(`[${u}]`));return Array.from(v.itemMap.values()).sort((C,y)=>k.indexOf(C.ref.current)-k.indexOf(y.ref.current))},[v.collectionRef,v.itemMap])}return[{Provider:s,Slot:l,ItemSlot:f},g,i]}var hw=Ne(void 0);function fw(t){const e=dn(hw);return t||e||"ltr"}var pw=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Oe=pw.reduce((t,e)=>{const n=Qi(`Primitive.${e}`),i=ne((r,o)=>{const{asChild:s,...a}=r,c=s?n:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),m(c,{...a,ref:o})});return i.displayName=`Primitive.${e}`,{...t,[e]:i}},{});function mw(t,e){t&&mr(()=>t.dispatchEvent(e))}function Vn(t){const e=$(t);return X(()=>{e.current=t}),le(()=>(...n)=>{var i;return(i=e.current)==null?void 0:i.call(e,...n)},[])}function gw(t,e=globalThis==null?void 0:globalThis.document){const n=Vn(t);X(()=>{const i=r=>{r.key==="Escape"&&n(r)};return e.addEventListener("keydown",i,{capture:!0}),()=>e.removeEventListener("keydown",i,{capture:!0})},[n,e])}var vw="DismissableLayer",qa="dismissableLayer.update",bw="dismissableLayer.pointerDownOutside",yw="dismissableLayer.focusOutside",Mf,Nf=Ne({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Lf=ne((t,e)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:i,onPointerDownOutside:r,onFocusOutside:o,onInteractOutside:s,onDismiss:a,...c}=t,l=dn(Nf),[d,u]=K(null),h=(d==null?void 0:d.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,f]=K({}),g=$e(e,E=>u(E)),p=Array.from(l.layers),[v]=[...l.layersWithOutsidePointerEventsDisabled].slice(-1),b=p.indexOf(v),k=d?p.indexOf(d):-1,C=l.layersWithOutsidePointerEventsDisabled.size>0,y=k>=b,_=Cw(E=>{const x=E.target,P=[...l.branches].some(D=>D.contains(x));!y||P||(r==null||r(E),s==null||s(E),E.defaultPrevented||a==null||a())},h),S=_w(E=>{const x=E.target;[...l.branches].some(P=>P.contains(x))||(o==null||o(E),s==null||s(E),E.defaultPrevented||a==null||a())},h);return gw(E=>{k===l.layers.size-1&&(i==null||i(E),!E.defaultPrevented&&a&&(E.preventDefault(),a()))},h),X(()=>{if(d)return n&&(l.layersWithOutsidePointerEventsDisabled.size===0&&(Mf=h.body.style.pointerEvents,h.body.style.pointerEvents="none"),l.layersWithOutsidePointerEventsDisabled.add(d)),l.layers.add(d),Uf(),()=>{n&&l.layersWithOutsidePointerEventsDisabled.size===1&&(h.body.style.pointerEvents=Mf)}},[d,h,n,l]),X(()=>()=>{d&&(l.layers.delete(d),l.layersWithOutsidePointerEventsDisabled.delete(d),Uf())},[d,l]),X(()=>{const E=()=>f({});return document.addEventListener(qa,E),()=>document.removeEventListener(qa,E)},[]),m(Oe.div,{...c,ref:g,style:{pointerEvents:C?y?"auto":"none":void 0,...t.style},onFocusCapture:Me(t.onFocusCapture,S.onFocusCapture),onBlurCapture:Me(t.onBlurCapture,S.onBlurCapture),onPointerDownCapture:Me(t.onPointerDownCapture,_.onPointerDownCapture)})});Lf.displayName=vw;var kw="DismissableLayerBranch",ww=ne((t,e)=>{const n=dn(Nf),i=$(null),r=$e(e,i);return X(()=>{const o=i.current;if(o)return n.branches.add(o),()=>{n.branches.delete(o)}},[n.branches]),m(Oe.div,{...t,ref:r})});ww.displayName=kw;function Cw(t,e=globalThis==null?void 0:globalThis.document){const n=Vn(t),i=$(!1),r=$(()=>{});return X(()=>{const o=a=>{if(a.target&&!i.current){let c=function(){Ff(bw,n,l,{discrete:!0})};const l={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",r.current),r.current=c,e.addEventListener("click",r.current,{once:!0})):c()}else e.removeEventListener("click",r.current);i.current=!1},s=window.setTimeout(()=>{e.addEventListener("pointerdown",o)},0);return()=>{window.clearTimeout(s),e.removeEventListener("pointerdown",o),e.removeEventListener("click",r.current)}},[e,n]),{onPointerDownCapture:()=>i.current=!0}}function _w(t,e=globalThis==null?void 0:globalThis.document){const n=Vn(t),i=$(!1);return X(()=>{const r=o=>{o.target&&!i.current&&Ff(yw,n,{originalEvent:o},{discrete:!1})};return e.addEventListener("focusin",r),()=>e.removeEventListener("focusin",r)},[e,n]),{onFocusCapture:()=>i.current=!0,onBlurCapture:()=>i.current=!1}}function Uf(){const t=new CustomEvent(qa);document.dispatchEvent(t)}function Ff(t,e,n,{discrete:i}){const r=n.originalEvent.target,o=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:n});e&&r.addEventListener(t,e,{once:!0}),i?mw(r,o):r.dispatchEvent(o)}var za=0;function Sw(){X(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??Bf()),document.body.insertAdjacentElement("beforeend",t[1]??Bf()),za++,()=>{za===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),za--}},[])}function Bf(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var $a="focusScope.autoFocusOnMount",Wa="focusScope.autoFocusOnUnmount",jf={bubbles:!1,cancelable:!0},Tw="FocusScope",Vf=ne((t,e)=>{const{loop:n=!1,trapped:i=!1,onMountAutoFocus:r,onUnmountAutoFocus:o,...s}=t,[a,c]=K(null),l=Vn(r),d=Vn(o),u=$(null),h=$e(e,p=>c(p)),f=$({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;X(()=>{if(i){let p=function(C){if(f.paused||!a)return;const y=C.target;a.contains(y)?u.current=y:Sn(u.current,{select:!0})},v=function(C){if(f.paused||!a)return;const y=C.relatedTarget;y!==null&&(a.contains(y)||Sn(u.current,{select:!0}))},b=function(C){if(document.activeElement===document.body)for(const y of C)y.removedNodes.length>0&&Sn(a)};document.addEventListener("focusin",p),document.addEventListener("focusout",v);const k=new MutationObserver(b);return a&&k.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",p),document.removeEventListener("focusout",v),k.disconnect()}}},[i,a,f.paused]),X(()=>{if(a){$f.add(f);const p=document.activeElement;if(!a.contains(p)){const v=new CustomEvent($a,jf);a.addEventListener($a,l),a.dispatchEvent(v),v.defaultPrevented||(xw(Ow(qf(a)),{select:!0}),document.activeElement===p&&Sn(a))}return()=>{a.removeEventListener($a,l),setTimeout(()=>{const v=new CustomEvent(Wa,jf);a.addEventListener(Wa,d),a.dispatchEvent(v),v.defaultPrevented||Sn(p??document.body,{select:!0}),a.removeEventListener(Wa,d),$f.remove(f)},0)}}},[a,l,d,f]);const g=H(p=>{if(!n&&!i||f.paused)return;const v=p.key==="Tab"&&!p.altKey&&!p.ctrlKey&&!p.metaKey,b=document.activeElement;if(v&&b){const k=p.currentTarget,[C,y]=Ew(k);C&&y?!p.shiftKey&&b===y?(p.preventDefault(),n&&Sn(C,{select:!0})):p.shiftKey&&b===C&&(p.preventDefault(),n&&Sn(y,{select:!0})):b===k&&p.preventDefault()}},[n,i,f.paused]);return m(Oe.div,{tabIndex:-1,...s,ref:h,onKeyDown:g})});Vf.displayName=Tw;function xw(t,{select:e=!1}={}){const n=document.activeElement;for(const i of t)if(Sn(i,{select:e}),document.activeElement!==n)return}function Ew(t){const e=qf(t),n=zf(e,t),i=zf(e.reverse(),t);return[n,i]}function qf(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:i=>{const r=i.tagName==="INPUT"&&i.type==="hidden";return i.disabled||i.hidden||r?NodeFilter.FILTER_SKIP:i.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)e.push(n.currentNode);return e}function zf(t,e){for(const n of t)if(!Pw(n,{upTo:e}))return n}function Pw(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function Rw(t){return t instanceof HTMLInputElement&&"select"in t}function Sn(t,{select:e=!1}={}){if(t&&t.focus){const n=document.activeElement;t.focus({preventScroll:!0}),t!==n&&Rw(t)&&e&&t.select()}}var $f=Iw();function Iw(){let t=[];return{add(e){const n=t[0];e!==n&&(n==null||n.pause()),t=Wf(t,e),t.unshift(e)},remove(e){var n;t=Wf(t,e),(n=t[0])==null||n.resume()}}}function Wf(t,e){const n=[...t],i=n.indexOf(e);return i!==-1&&n.splice(i,1),n}function Ow(t){return t.filter(e=>e.tagName!=="A")}var et=globalThis!=null&&globalThis.document?$t:()=>{},Dw=kl[" useId ".trim().toString()]||(()=>{}),Aw=0;function Ha(t){const[e,n]=K(Dw());return et(()=>{n(i=>i??String(Aw++))},[t]),e?`radix-${e}`:""}const Mw=["top","right","bottom","left"],Tn=Math.min,lt=Math.max,so=Math.round,ao=Math.floor,Ut=t=>({x:t,y:t}),Nw={left:"right",right:"left",bottom:"top",top:"bottom"},Lw={start:"end",end:"start"};function Ga(t,e,n){return lt(t,Tn(e,n))}function an(t,e){return typeof t=="function"?t(e):t}function cn(t){return t.split("-")[0]}function vi(t){return t.split("-")[1]}function Ka(t){return t==="x"?"y":"x"}function Ja(t){return t==="y"?"height":"width"}const Uw=new Set(["top","bottom"]);function Ft(t){return Uw.has(cn(t))?"y":"x"}function Ya(t){return Ka(Ft(t))}function Fw(t,e,n){n===void 0&&(n=!1);const i=vi(t),r=Ya(t),o=Ja(r);let s=r==="x"?i===(n?"end":"start")?"right":"left":i==="start"?"bottom":"top";return e.reference[o]>e.floating[o]&&(s=co(s)),[s,co(s)]}function Bw(t){const e=co(t);return[Xa(t),e,Xa(e)]}function Xa(t){return t.replace(/start|end/g,e=>Lw[e])}const Hf=["left","right"],Gf=["right","left"],jw=["top","bottom"],Vw=["bottom","top"];function qw(t,e,n){switch(t){case"top":case"bottom":return n?e?Gf:Hf:e?Hf:Gf;case"left":case"right":return e?jw:Vw;default:return[]}}function zw(t,e,n,i){const r=vi(t);let o=qw(cn(t),n==="start",i);return r&&(o=o.map(s=>s+"-"+r),e&&(o=o.concat(o.map(Xa)))),o}function co(t){return t.replace(/left|right|bottom|top/g,e=>Nw[e])}function $w(t){return{top:0,right:0,bottom:0,left:0,...t}}function Kf(t){return typeof t!="number"?$w(t):{top:t,right:t,bottom:t,left:t}}function lo(t){const{x:e,y:n,width:i,height:r}=t;return{width:i,height:r,top:n,left:e,right:e+i,bottom:n+r,x:e,y:n}}function Jf(t,e,n){let{reference:i,floating:r}=t;const o=Ft(e),s=Ya(e),a=Ja(s),c=cn(e),l=o==="y",d=i.x+i.width/2-r.width/2,u=i.y+i.height/2-r.height/2,h=i[a]/2-r[a]/2;let f;switch(c){case"top":f={x:d,y:i.y-r.height};break;case"bottom":f={x:d,y:i.y+i.height};break;case"right":f={x:i.x+i.width,y:u};break;case"left":f={x:i.x-r.width,y:u};break;default:f={x:i.x,y:i.y}}switch(vi(e)){case"start":f[s]-=h*(n&&l?-1:1);break;case"end":f[s]+=h*(n&&l?-1:1);break}return f}const Ww=async(t,e,n)=>{const{placement:i="bottom",strategy:r="absolute",middleware:o=[],platform:s}=n,a=o.filter(Boolean),c=await(s.isRTL==null?void 0:s.isRTL(e));let l=await s.getElementRects({reference:t,floating:e,strategy:r}),{x:d,y:u}=Jf(l,i,c),h=i,f={},g=0;for(let p=0;p<a.length;p++){const{name:v,fn:b}=a[p],{x:k,y:C,data:y,reset:_}=await b({x:d,y:u,initialPlacement:i,placement:h,strategy:r,middlewareData:f,rects:l,platform:s,elements:{reference:t,floating:e}});d=k??d,u=C??u,f={...f,[v]:{...f[v],...y}},_&&g<=50&&(g++,typeof _=="object"&&(_.placement&&(h=_.placement),_.rects&&(l=_.rects===!0?await s.getElementRects({reference:t,floating:e,strategy:r}):_.rects),{x:d,y:u}=Jf(l,h,c)),p=-1)}return{x:d,y:u,placement:h,strategy:r,middlewareData:f}};async function er(t,e){var n;e===void 0&&(e={});const{x:i,y:r,platform:o,rects:s,elements:a,strategy:c}=t,{boundary:l="clippingAncestors",rootBoundary:d="viewport",elementContext:u="floating",altBoundary:h=!1,padding:f=0}=an(e,t),g=Kf(f),p=a[h?u==="floating"?"reference":"floating":u],v=lo(await o.getClippingRect({element:(n=await(o.isElement==null?void 0:o.isElement(p)))==null||n?p:p.contextElement||await(o.getDocumentElement==null?void 0:o.getDocumentElement(a.floating)),boundary:l,rootBoundary:d,strategy:c})),b=u==="floating"?{x:i,y:r,width:s.floating.width,height:s.floating.height}:s.reference,k=await(o.getOffsetParent==null?void 0:o.getOffsetParent(a.floating)),C=await(o.isElement==null?void 0:o.isElement(k))?await(o.getScale==null?void 0:o.getScale(k))||{x:1,y:1}:{x:1,y:1},y=lo(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:b,offsetParent:k,strategy:c}):b);return{top:(v.top-y.top+g.top)/C.y,bottom:(y.bottom-v.bottom+g.bottom)/C.y,left:(v.left-y.left+g.left)/C.x,right:(y.right-v.right+g.right)/C.x}}const Hw=t=>({name:"arrow",options:t,async fn(e){const{x:n,y:i,placement:r,rects:o,platform:s,elements:a,middlewareData:c}=e,{element:l,padding:d=0}=an(t,e)||{};if(l==null)return{};const u=Kf(d),h={x:n,y:i},f=Ya(r),g=Ja(f),p=await s.getDimensions(l),v=f==="y",b=v?"top":"left",k=v?"bottom":"right",C=v?"clientHeight":"clientWidth",y=o.reference[g]+o.reference[f]-h[f]-o.floating[g],_=h[f]-o.reference[f],S=await(s.getOffsetParent==null?void 0:s.getOffsetParent(l));let E=S?S[C]:0;(!E||!await(s.isElement==null?void 0:s.isElement(S)))&&(E=a.floating[C]||o.floating[g]);const x=y/2-_/2,P=E/2-p[g]/2-1,D=Tn(u[b],P),M=Tn(u[k],P),F=D,z=E-p[g]-M,W=E/2-p[g]/2+x,B=Ga(F,W,z),G=!c.arrow&&vi(r)!=null&&W!==B&&o.reference[g]/2-(W<F?D:M)-p[g]/2<0,Y=G?W<F?W-F:W-z:0;return{[f]:h[f]+Y,data:{[f]:B,centerOffset:W-B-Y,...G&&{alignmentOffset:Y}},reset:G}}}),Gw=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var n,i;const{placement:r,middlewareData:o,rects:s,initialPlacement:a,platform:c,elements:l}=e,{mainAxis:d=!0,crossAxis:u=!0,fallbackPlacements:h,fallbackStrategy:f="bestFit",fallbackAxisSideDirection:g="none",flipAlignment:p=!0,...v}=an(t,e);if((n=o.arrow)!=null&&n.alignmentOffset)return{};const b=cn(r),k=Ft(a),C=cn(a)===a,y=await(c.isRTL==null?void 0:c.isRTL(l.floating)),_=h||(C||!p?[co(a)]:Bw(a)),S=g!=="none";!h&&S&&_.push(...zw(a,p,g,y));const E=[a,..._],x=await er(e,v),P=[];let D=((i=o.flip)==null?void 0:i.overflows)||[];if(d&&P.push(x[b]),u){const W=Fw(r,s,y);P.push(x[W[0]],x[W[1]])}if(D=[...D,{placement:r,overflows:P}],!P.every(W=>W<=0)){var M,F;const W=(((M=o.flip)==null?void 0:M.index)||0)+1,B=E[W];if(B&&(!(u==="alignment"&&k!==Ft(B))||D.every(Y=>Ft(Y.placement)===k?Y.overflows[0]>0:!0)))return{data:{index:W,overflows:D},reset:{placement:B}};let G=(F=D.filter(Y=>Y.overflows[0]<=0).sort((Y,A)=>Y.overflows[1]-A.overflows[1])[0])==null?void 0:F.placement;if(!G)switch(f){case"bestFit":{var z;const Y=(z=D.filter(A=>{if(S){const ee=Ft(A.placement);return ee===k||ee==="y"}return!0}).map(A=>[A.placement,A.overflows.filter(ee=>ee>0).reduce((ee,we)=>ee+we,0)]).sort((A,ee)=>A[1]-ee[1])[0])==null?void 0:z[0];Y&&(G=Y);break}case"initialPlacement":G=a;break}if(r!==G)return{reset:{placement:G}}}return{}}}};function Yf(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function Xf(t){return Mw.some(e=>t[e]>=0)}const Kw=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:n}=e,{strategy:i="referenceHidden",...r}=an(t,e);switch(i){case"referenceHidden":{const o=await er(e,{...r,elementContext:"reference"}),s=Yf(o,n.reference);return{data:{referenceHiddenOffsets:s,referenceHidden:Xf(s)}}}case"escaped":{const o=await er(e,{...r,altBoundary:!0}),s=Yf(o,n.floating);return{data:{escapedOffsets:s,escaped:Xf(s)}}}default:return{}}}}},Qf=new Set(["left","top"]);async function Jw(t,e){const{placement:n,platform:i,elements:r}=t,o=await(i.isRTL==null?void 0:i.isRTL(r.floating)),s=cn(n),a=vi(n),c=Ft(n)==="y",l=Qf.has(s)?-1:1,d=o&&c?-1:1,u=an(e,t);let{mainAxis:h,crossAxis:f,alignmentAxis:g}=typeof u=="number"?{mainAxis:u,crossAxis:0,alignmentAxis:null}:{mainAxis:u.mainAxis||0,crossAxis:u.crossAxis||0,alignmentAxis:u.alignmentAxis};return a&&typeof g=="number"&&(f=a==="end"?g*-1:g),c?{x:f*d,y:h*l}:{x:h*l,y:f*d}}const Yw=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var n,i;const{x:r,y:o,placement:s,middlewareData:a}=e,c=await Jw(e,t);return s===((n=a.offset)==null?void 0:n.placement)&&(i=a.arrow)!=null&&i.alignmentOffset?{}:{x:r+c.x,y:o+c.y,data:{...c,placement:s}}}}},Xw=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:n,y:i,placement:r}=e,{mainAxis:o=!0,crossAxis:s=!1,limiter:a={fn:v=>{let{x:b,y:k}=v;return{x:b,y:k}}},...c}=an(t,e),l={x:n,y:i},d=await er(e,c),u=Ft(cn(r)),h=Ka(u);let f=l[h],g=l[u];if(o){const v=h==="y"?"top":"left",b=h==="y"?"bottom":"right",k=f+d[v],C=f-d[b];f=Ga(k,f,C)}if(s){const v=u==="y"?"top":"left",b=u==="y"?"bottom":"right",k=g+d[v],C=g-d[b];g=Ga(k,g,C)}const p=a.fn({...e,[h]:f,[u]:g});return{...p,data:{x:p.x-n,y:p.y-i,enabled:{[h]:o,[u]:s}}}}}},Qw=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:n,y:i,placement:r,rects:o,middlewareData:s}=e,{offset:a=0,mainAxis:c=!0,crossAxis:l=!0}=an(t,e),d={x:n,y:i},u=Ft(r),h=Ka(u);let f=d[h],g=d[u];const p=an(a,e),v=typeof p=="number"?{mainAxis:p,crossAxis:0}:{mainAxis:0,crossAxis:0,...p};if(c){const C=h==="y"?"height":"width",y=o.reference[h]-o.floating[C]+v.mainAxis,_=o.reference[h]+o.reference[C]-v.mainAxis;f<y?f=y:f>_&&(f=_)}if(l){var b,k;const C=h==="y"?"width":"height",y=Qf.has(cn(r)),_=o.reference[u]-o.floating[C]+(y&&((b=s.offset)==null?void 0:b[u])||0)+(y?0:v.crossAxis),S=o.reference[u]+o.reference[C]+(y?0:((k=s.offset)==null?void 0:k[u])||0)-(y?v.crossAxis:0);g<_?g=_:g>S&&(g=S)}return{[h]:f,[u]:g}}}},Zw=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){var n,i;const{placement:r,rects:o,platform:s,elements:a}=e,{apply:c=()=>{},...l}=an(t,e),d=await er(e,l),u=cn(r),h=vi(r),f=Ft(r)==="y",{width:g,height:p}=o.floating;let v,b;u==="top"||u==="bottom"?(v=u,b=h===(await(s.isRTL==null?void 0:s.isRTL(a.floating))?"start":"end")?"left":"right"):(b=u,v=h==="end"?"top":"bottom");const k=p-d.top-d.bottom,C=g-d.left-d.right,y=Tn(p-d[v],k),_=Tn(g-d[b],C),S=!e.middlewareData.shift;let E=y,x=_;if((n=e.middlewareData.shift)!=null&&n.enabled.x&&(x=C),(i=e.middlewareData.shift)!=null&&i.enabled.y&&(E=k),S&&!h){const D=lt(d.left,0),M=lt(d.right,0),F=lt(d.top,0),z=lt(d.bottom,0);f?x=g-2*(D!==0||M!==0?D+M:lt(d.left,d.right)):E=p-2*(F!==0||z!==0?F+z:lt(d.top,d.bottom))}await c({...e,availableWidth:x,availableHeight:E});const P=await s.getDimensions(a.floating);return g!==P.width||p!==P.height?{reset:{rects:!0}}:{}}}};function uo(){return typeof window<"u"}function bi(t){return Zf(t)?(t.nodeName||"").toLowerCase():"#document"}function dt(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function Bt(t){var e;return(e=(Zf(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function Zf(t){return uo()?t instanceof Node||t instanceof dt(t).Node:!1}function _t(t){return uo()?t instanceof Element||t instanceof dt(t).Element:!1}function jt(t){return uo()?t instanceof HTMLElement||t instanceof dt(t).HTMLElement:!1}function ep(t){return!uo()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof dt(t).ShadowRoot}const eC=new Set(["inline","contents"]);function tr(t){const{overflow:e,overflowX:n,overflowY:i,display:r}=St(t);return/auto|scroll|overlay|hidden|clip/.test(e+i+n)&&!eC.has(r)}const tC=new Set(["table","td","th"]);function nC(t){return tC.has(bi(t))}const iC=[":popover-open",":modal"];function ho(t){return iC.some(e=>{try{return t.matches(e)}catch{return!1}})}const rC=["transform","translate","scale","rotate","perspective"],oC=["transform","translate","scale","rotate","perspective","filter"],sC=["paint","layout","strict","content"];function Qa(t){const e=Za(),n=_t(t)?St(t):t;return rC.some(i=>n[i]?n[i]!=="none":!1)||(n.containerType?n.containerType!=="normal":!1)||!e&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!e&&(n.filter?n.filter!=="none":!1)||oC.some(i=>(n.willChange||"").includes(i))||sC.some(i=>(n.contain||"").includes(i))}function aC(t){let e=xn(t);for(;jt(e)&&!yi(e);){if(Qa(e))return e;if(ho(e))return null;e=xn(e)}return null}function Za(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const cC=new Set(["html","body","#document"]);function yi(t){return cC.has(bi(t))}function St(t){return dt(t).getComputedStyle(t)}function fo(t){return _t(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function xn(t){if(bi(t)==="html")return t;const e=t.assignedSlot||t.parentNode||ep(t)&&t.host||Bt(t);return ep(e)?e.host:e}function tp(t){const e=xn(t);return yi(e)?t.ownerDocument?t.ownerDocument.body:t.body:jt(e)&&tr(e)?e:tp(e)}function nr(t,e,n){var i;e===void 0&&(e=[]),n===void 0&&(n=!0);const r=tp(t),o=r===((i=t.ownerDocument)==null?void 0:i.body),s=dt(r);if(o){const a=ec(s);return e.concat(s,s.visualViewport||[],tr(r)?r:[],a&&n?nr(a):[])}return e.concat(r,nr(r,[],n))}function ec(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function np(t){const e=St(t);let n=parseFloat(e.width)||0,i=parseFloat(e.height)||0;const r=jt(t),o=r?t.offsetWidth:n,s=r?t.offsetHeight:i,a=so(n)!==o||so(i)!==s;return a&&(n=o,i=s),{width:n,height:i,$:a}}function tc(t){return _t(t)?t:t.contextElement}function ki(t){const e=tc(t);if(!jt(e))return Ut(1);const n=e.getBoundingClientRect(),{width:i,height:r,$:o}=np(e);let s=(o?so(n.width):n.width)/i,a=(o?so(n.height):n.height)/r;return(!s||!Number.isFinite(s))&&(s=1),(!a||!Number.isFinite(a))&&(a=1),{x:s,y:a}}const lC=Ut(0);function ip(t){const e=dt(t);return!Za()||!e.visualViewport?lC:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function dC(t,e,n){return e===void 0&&(e=!1),!n||e&&n!==dt(t)?!1:e}function qn(t,e,n,i){e===void 0&&(e=!1),n===void 0&&(n=!1);const r=t.getBoundingClientRect(),o=tc(t);let s=Ut(1);e&&(i?_t(i)&&(s=ki(i)):s=ki(t));const a=dC(o,n,i)?ip(o):Ut(0);let c=(r.left+a.x)/s.x,l=(r.top+a.y)/s.y,d=r.width/s.x,u=r.height/s.y;if(o){const h=dt(o),f=i&&_t(i)?dt(i):i;let g=h,p=ec(g);for(;p&&i&&f!==g;){const v=ki(p),b=p.getBoundingClientRect(),k=St(p),C=b.left+(p.clientLeft+parseFloat(k.paddingLeft))*v.x,y=b.top+(p.clientTop+parseFloat(k.paddingTop))*v.y;c*=v.x,l*=v.y,d*=v.x,u*=v.y,c+=C,l+=y,g=dt(p),p=ec(g)}}return lo({width:d,height:u,x:c,y:l})}function nc(t,e){const n=fo(t).scrollLeft;return e?e.left+n:qn(Bt(t)).left+n}function rp(t,e,n){n===void 0&&(n=!1);const i=t.getBoundingClientRect(),r=i.left+e.scrollLeft-(n?0:nc(t,i)),o=i.top+e.scrollTop;return{x:r,y:o}}function uC(t){let{elements:e,rect:n,offsetParent:i,strategy:r}=t;const o=r==="fixed",s=Bt(i),a=e?ho(e.floating):!1;if(i===s||a&&o)return n;let c={scrollLeft:0,scrollTop:0},l=Ut(1);const d=Ut(0),u=jt(i);if((u||!u&&!o)&&((bi(i)!=="body"||tr(s))&&(c=fo(i)),jt(i))){const f=qn(i);l=ki(i),d.x=f.x+i.clientLeft,d.y=f.y+i.clientTop}const h=s&&!u&&!o?rp(s,c,!0):Ut(0);return{width:n.width*l.x,height:n.height*l.y,x:n.x*l.x-c.scrollLeft*l.x+d.x+h.x,y:n.y*l.y-c.scrollTop*l.y+d.y+h.y}}function hC(t){return Array.from(t.getClientRects())}function fC(t){const e=Bt(t),n=fo(t),i=t.ownerDocument.body,r=lt(e.scrollWidth,e.clientWidth,i.scrollWidth,i.clientWidth),o=lt(e.scrollHeight,e.clientHeight,i.scrollHeight,i.clientHeight);let s=-n.scrollLeft+nc(t);const a=-n.scrollTop;return St(i).direction==="rtl"&&(s+=lt(e.clientWidth,i.clientWidth)-r),{width:r,height:o,x:s,y:a}}function pC(t,e){const n=dt(t),i=Bt(t),r=n.visualViewport;let o=i.clientWidth,s=i.clientHeight,a=0,c=0;if(r){o=r.width,s=r.height;const l=Za();(!l||l&&e==="fixed")&&(a=r.offsetLeft,c=r.offsetTop)}return{width:o,height:s,x:a,y:c}}const mC=new Set(["absolute","fixed"]);function gC(t,e){const n=qn(t,!0,e==="fixed"),i=n.top+t.clientTop,r=n.left+t.clientLeft,o=jt(t)?ki(t):Ut(1),s=t.clientWidth*o.x,a=t.clientHeight*o.y,c=r*o.x,l=i*o.y;return{width:s,height:a,x:c,y:l}}function op(t,e,n){let i;if(e==="viewport")i=pC(t,n);else if(e==="document")i=fC(Bt(t));else if(_t(e))i=gC(e,n);else{const r=ip(t);i={x:e.x-r.x,y:e.y-r.y,width:e.width,height:e.height}}return lo(i)}function sp(t,e){const n=xn(t);return n===e||!_t(n)||yi(n)?!1:St(n).position==="fixed"||sp(n,e)}function vC(t,e){const n=e.get(t);if(n)return n;let i=nr(t,[],!1).filter(a=>_t(a)&&bi(a)!=="body"),r=null;const o=St(t).position==="fixed";let s=o?xn(t):t;for(;_t(s)&&!yi(s);){const a=St(s),c=Qa(s);!c&&a.position==="fixed"&&(r=null),(o?!c&&!r:!c&&a.position==="static"&&r&&mC.has(r.position)||tr(s)&&!c&&sp(t,s))?i=i.filter(l=>l!==s):r=a,s=xn(s)}return e.set(t,i),i}function bC(t){let{element:e,boundary:n,rootBoundary:i,strategy:r}=t;const o=[...n==="clippingAncestors"?ho(e)?[]:vC(e,this._c):[].concat(n),i],s=o[0],a=o.reduce((c,l)=>{const d=op(e,l,r);return c.top=lt(d.top,c.top),c.right=Tn(d.right,c.right),c.bottom=Tn(d.bottom,c.bottom),c.left=lt(d.left,c.left),c},op(e,s,r));return{width:a.right-a.left,height:a.bottom-a.top,x:a.left,y:a.top}}function yC(t){const{width:e,height:n}=np(t);return{width:e,height:n}}function kC(t,e,n){const i=jt(e),r=Bt(e),o=n==="fixed",s=qn(t,!0,o,e);let a={scrollLeft:0,scrollTop:0};const c=Ut(0);function l(){c.x=nc(r)}if(i||!i&&!o)if((bi(e)!=="body"||tr(r))&&(a=fo(e)),i){const f=qn(e,!0,o,e);c.x=f.x+e.clientLeft,c.y=f.y+e.clientTop}else r&&l();o&&!i&&r&&l();const d=r&&!i&&!o?rp(r,a):Ut(0),u=s.left+a.scrollLeft-c.x-d.x,h=s.top+a.scrollTop-c.y-d.y;return{x:u,y:h,width:s.width,height:s.height}}function ic(t){return St(t).position==="static"}function ap(t,e){if(!jt(t)||St(t).position==="fixed")return null;if(e)return e(t);let n=t.offsetParent;return Bt(t)===n&&(n=n.ownerDocument.body),n}function cp(t,e){const n=dt(t);if(ho(t))return n;if(!jt(t)){let r=xn(t);for(;r&&!yi(r);){if(_t(r)&&!ic(r))return r;r=xn(r)}return n}let i=ap(t,e);for(;i&&nC(i)&&ic(i);)i=ap(i,e);return i&&yi(i)&&ic(i)&&!Qa(i)?n:i||aC(t)||n}const wC=async function(t){const e=this.getOffsetParent||cp,n=this.getDimensions,i=await n(t.floating);return{reference:kC(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:i.width,height:i.height}}};function CC(t){return St(t).direction==="rtl"}const _C={convertOffsetParentRelativeRectToViewportRelativeRect:uC,getDocumentElement:Bt,getClippingRect:bC,getOffsetParent:cp,getElementRects:wC,getClientRects:hC,getDimensions:yC,getScale:ki,isElement:_t,isRTL:CC};function lp(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}function SC(t,e){let n=null,i;const r=Bt(t);function o(){var a;clearTimeout(i),(a=n)==null||a.disconnect(),n=null}function s(a,c){a===void 0&&(a=!1),c===void 0&&(c=1),o();const l=t.getBoundingClientRect(),{left:d,top:u,width:h,height:f}=l;if(a||e(),!h||!f)return;const g=ao(u),p=ao(r.clientWidth-(d+h)),v=ao(r.clientHeight-(u+f)),b=ao(d),k={rootMargin:-g+"px "+-p+"px "+-v+"px "+-b+"px",threshold:lt(0,Tn(1,c))||1};let C=!0;function y(_){const S=_[0].intersectionRatio;if(S!==c){if(!C)return s();S?s(!1,S):i=setTimeout(()=>{s(!1,1e-7)},1e3)}S===1&&!lp(l,t.getBoundingClientRect())&&s(),C=!1}try{n=new IntersectionObserver(y,{...k,root:r.ownerDocument})}catch{n=new IntersectionObserver(y,k)}n.observe(t)}return s(!0),o}function TC(t,e,n,i){i===void 0&&(i={});const{ancestorScroll:r=!0,ancestorResize:o=!0,elementResize:s=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:c=!1}=i,l=tc(t),d=r||o?[...l?nr(l):[],...nr(e)]:[];d.forEach(b=>{r&&b.addEventListener("scroll",n,{passive:!0}),o&&b.addEventListener("resize",n)});const u=l&&a?SC(l,n):null;let h=-1,f=null;s&&(f=new ResizeObserver(b=>{let[k]=b;k&&k.target===l&&f&&(f.unobserve(e),cancelAnimationFrame(h),h=requestAnimationFrame(()=>{var C;(C=f)==null||C.observe(e)})),n()}),l&&!c&&f.observe(l),f.observe(e));let g,p=c?qn(t):null;c&&v();function v(){const b=qn(t);p&&!lp(p,b)&&n(),p=b,g=requestAnimationFrame(v)}return n(),()=>{var b;d.forEach(k=>{r&&k.removeEventListener("scroll",n),o&&k.removeEventListener("resize",n)}),u==null||u(),(b=f)==null||b.disconnect(),f=null,c&&cancelAnimationFrame(g)}}const xC=Yw,EC=Xw,PC=Gw,RC=Zw,IC=Kw,dp=Hw,OC=Qw,DC=(t,e,n)=>{const i=new Map,r={platform:_C,...n},o={...r.platform,_c:i};return Ww(t,e,{...r,platform:o})};var AC=typeof document<"u",MC=function(){},po=AC?$t:MC;function mo(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let n,i,r;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(n=t.length,n!==e.length)return!1;for(i=n;i--!==0;)if(!mo(t[i],e[i]))return!1;return!0}if(r=Object.keys(t),n=r.length,n!==Object.keys(e).length)return!1;for(i=n;i--!==0;)if(!{}.hasOwnProperty.call(e,r[i]))return!1;for(i=n;i--!==0;){const o=r[i];if(!(o==="_owner"&&t.$$typeof)&&!mo(t[o],e[o]))return!1}return!0}return t!==t&&e!==e}function up(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function hp(t,e){const n=up(t);return Math.round(e*n)/n}function rc(t){const e=$(t);return po(()=>{e.current=t}),e}function NC(t){t===void 0&&(t={});const{placement:e="bottom",strategy:n="absolute",middleware:i=[],platform:r,elements:{reference:o,floating:s}={},transform:a=!0,whileElementsMounted:c,open:l}=t,[d,u]=K({x:0,y:0,strategy:n,placement:e,middlewareData:{},isPositioned:!1}),[h,f]=K(i);mo(h,i)||f(i);const[g,p]=K(null),[v,b]=K(null),k=H(A=>{A!==S.current&&(S.current=A,p(A))},[]),C=H(A=>{A!==E.current&&(E.current=A,b(A))},[]),y=o||g,_=s||v,S=$(null),E=$(null),x=$(d),P=c!=null,D=rc(c),M=rc(r),F=rc(l),z=H(()=>{if(!S.current||!E.current)return;const A={placement:e,strategy:n,middleware:h};M.current&&(A.platform=M.current),DC(S.current,E.current,A).then(ee=>{const we={...ee,isPositioned:F.current!==!1};W.current&&!mo(x.current,we)&&(x.current=we,mr(()=>{u(we)}))})},[h,e,n,M,F]);po(()=>{l===!1&&x.current.isPositioned&&(x.current.isPositioned=!1,u(A=>({...A,isPositioned:!1})))},[l]);const W=$(!1);po(()=>(W.current=!0,()=>{W.current=!1}),[]),po(()=>{if(y&&(S.current=y),_&&(E.current=_),y&&_){if(D.current)return D.current(y,_,z);z()}},[y,_,z,D,P]);const B=le(()=>({reference:S,floating:E,setReference:k,setFloating:C}),[k,C]),G=le(()=>({reference:y,floating:_}),[y,_]),Y=le(()=>{const A={position:n,left:0,top:0};if(!G.floating)return A;const ee=hp(G.floating,d.x),we=hp(G.floating,d.y);return a?{...A,transform:"translate("+ee+"px, "+we+"px)",...up(G.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:ee,top:we}},[n,a,G.floating,d.x,d.y]);return le(()=>({...d,update:z,refs:B,elements:G,floatingStyles:Y}),[d,z,B,G,Y])}const LC=t=>{function e(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:t,fn(n){const{element:i,padding:r}=typeof t=="function"?t(n):t;return i&&e(i)?i.current!=null?dp({element:i.current,padding:r}).fn(n):{}:i?dp({element:i,padding:r}).fn(n):{}}}},UC=(t,e)=>({...xC(t),options:[t,e]}),FC=(t,e)=>({...EC(t),options:[t,e]}),BC=(t,e)=>({...OC(t),options:[t,e]}),jC=(t,e)=>({...PC(t),options:[t,e]}),VC=(t,e)=>({...RC(t),options:[t,e]}),qC=(t,e)=>({...IC(t),options:[t,e]}),zC=(t,e)=>({...LC(t),options:[t,e]});var $C="Arrow",fp=ne((t,e)=>{const{children:n,width:i=10,height:r=5,...o}=t;return m(Oe.svg,{...o,ref:e,width:i,height:r,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?n:m("polygon",{points:"0,0 30,0 15,10"})})});fp.displayName=$C;var WC=fp;function HC(t){const[e,n]=K(void 0);return et(()=>{if(t){n({width:t.offsetWidth,height:t.offsetHeight});const i=new ResizeObserver(r=>{if(!Array.isArray(r)||!r.length)return;const o=r[0];let s,a;if("borderBoxSize"in o){const c=o.borderBoxSize,l=Array.isArray(c)?c[0]:c;s=l.inlineSize,a=l.blockSize}else s=t.offsetWidth,a=t.offsetHeight;n({width:s,height:a})});return i.observe(t,{box:"border-box"}),()=>i.unobserve(t)}else n(void 0)},[t]),e}var oc="Popper",[pp,mp]=Va(oc),[GC,gp]=pp(oc),vp=t=>{const{__scopePopper:e,children:n}=t,[i,r]=K(null);return m(GC,{scope:e,anchor:i,onAnchorChange:r,children:n})};vp.displayName=oc;var bp="PopperAnchor",yp=ne((t,e)=>{const{__scopePopper:n,virtualRef:i,...r}=t,o=gp(bp,n),s=$(null),a=$e(e,s),c=$(null);return X(()=>{const l=c.current;c.current=(i==null?void 0:i.current)||s.current,l!==c.current&&o.onAnchorChange(c.current)}),i?null:m(Oe.div,{...r,ref:a})});yp.displayName=bp;var sc="PopperContent",[KC,JC]=pp(sc),kp=ne((t,e)=>{var n,i,r,o,s,a;const{__scopePopper:c,side:l="bottom",sideOffset:d=0,align:u="center",alignOffset:h=0,arrowPadding:f=0,avoidCollisions:g=!0,collisionBoundary:p=[],collisionPadding:v=0,sticky:b="partial",hideWhenDetached:k=!1,updatePositionStrategy:C="optimized",onPlaced:y,..._}=t,S=gp(sc,c),[E,x]=K(null),P=$e(e,ht=>x(ht)),[D,M]=K(null),F=HC(D),z=(F==null?void 0:F.width)??0,W=(F==null?void 0:F.height)??0,B=l+(u!=="center"?"-"+u:""),G=typeof v=="number"?v:{top:0,right:0,bottom:0,left:0,...v},Y=Array.isArray(p)?p:[p],A=Y.length>0,ee={padding:G,boundary:Y.filter(XC),altBoundary:A},{refs:we,floatingStyles:tt,placement:ut,isPositioned:fe,middlewareData:de}=NC({strategy:"fixed",placement:B,whileElementsMounted:(...ht)=>TC(...ht,{animationFrame:C==="always"}),elements:{reference:S.anchor},middleware:[UC({mainAxis:d+W,alignmentAxis:h}),g&&FC({mainAxis:!0,crossAxis:!1,limiter:b==="partial"?BC():void 0,...ee}),g&&jC({...ee}),VC({...ee,apply:({elements:ht,rects:rr,availableWidth:or,availableHeight:sr})=>{const{width:GS,height:KS}=rr.reference,Po=ht.floating.style;Po.setProperty("--radix-popper-available-width",`${or}px`),Po.setProperty("--radix-popper-available-height",`${sr}px`),Po.setProperty("--radix-popper-anchor-width",`${GS}px`),Po.setProperty("--radix-popper-anchor-height",`${KS}px`)}}),D&&zC({element:D,padding:f}),QC({arrowWidth:z,arrowHeight:W}),k&&qC({strategy:"referenceHidden",...ee})]}),[Ge,nt]=_p(ut),q=Vn(y);et(()=>{fe&&(q==null||q())},[fe,q]);const ge=(n=de.arrow)==null?void 0:n.x,ye=(i=de.arrow)==null?void 0:i.y,re=((r=de.arrow)==null?void 0:r.centerOffset)!==0,[ve,Ce]=K();return et(()=>{E&&Ce(window.getComputedStyle(E).zIndex)},[E]),m("div",{ref:we.setFloating,"data-radix-popper-content-wrapper":"",style:{...tt,transform:fe?tt.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:ve,"--radix-popper-transform-origin":[(o=de.transformOrigin)==null?void 0:o.x,(s=de.transformOrigin)==null?void 0:s.y].join(" "),...((a=de.hide)==null?void 0:a.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:m(KC,{scope:c,placedSide:Ge,onArrowChange:M,arrowX:ge,arrowY:ye,shouldHideArrow:re,children:m(Oe.div,{"data-side":Ge,"data-align":nt,..._,ref:P,style:{..._.style,animation:fe?void 0:"none"}})})})});kp.displayName=sc;var wp="PopperArrow",YC={top:"bottom",right:"left",bottom:"top",left:"right"},Cp=ne(function(t,e){const{__scopePopper:n,...i}=t,r=JC(wp,n),o=YC[r.placedSide];return m("span",{ref:r.onArrowChange,style:{position:"absolute",left:r.arrowX,top:r.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[r.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[r.placedSide],visibility:r.shouldHideArrow?"hidden":void 0},children:m(WC,{...i,ref:e,style:{...i.style,display:"block"}})})});Cp.displayName=wp;function XC(t){return t!==null}var QC=t=>({name:"transformOrigin",options:t,fn(e){var n,i,r;const{placement:o,rects:s,middlewareData:a}=e,c=((n=a.arrow)==null?void 0:n.centerOffset)!==0,l=c?0:t.arrowWidth,d=c?0:t.arrowHeight,[u,h]=_p(o),f={start:"0%",center:"50%",end:"100%"}[h],g=(((i=a.arrow)==null?void 0:i.x)??0)+l/2,p=(((r=a.arrow)==null?void 0:r.y)??0)+d/2;let v="",b="";return u==="bottom"?(v=c?f:`${g}px`,b=`${-d}px`):u==="top"?(v=c?f:`${g}px`,b=`${s.floating.height+d}px`):u==="right"?(v=`${-d}px`,b=c?f:`${p}px`):u==="left"&&(v=`${s.floating.width+d}px`,b=c?f:`${p}px`),{data:{x:v,y:b}}}});function _p(t){const[e,n="center"]=t.split("-");return[e,n]}var ZC=vp,e_=yp,t_=kp,n_=Cp,i_="Portal",Sp=ne((t,e)=>{var n;const{container:i,...r}=t,[o,s]=K(!1);et(()=>s(!0),[]);const a=i||o&&((n=globalThis==null?void 0:globalThis.document)==null?void 0:n.body);return a?Ht.createPortal(m(Oe.div,{...r,ref:e}),a):null});Sp.displayName=i_;var r_=kl[" useInsertionEffect ".trim().toString()]||et;function Tp({prop:t,defaultProp:e,onChange:n=()=>{},caller:i}){const[r,o,s]=o_({defaultProp:e,onChange:n}),a=t!==void 0,c=a?t:r;{const d=$(t!==void 0);X(()=>{const u=d.current;u!==a&&console.warn(`${i} is changing from ${u?"controlled":"uncontrolled"} to ${a?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),d.current=a},[a,i])}const l=H(d=>{var u;if(a){const h=s_(d)?d(t):d;h!==t&&((u=s.current)==null||u.call(s,h))}else o(d)},[a,t,o,s]);return[c,l]}function o_({defaultProp:t,onChange:e}){const[n,i]=K(t),r=$(n),o=$(e);return r_(()=>{o.current=e},[e]),X(()=>{var s;r.current!==n&&((s=o.current)==null||s.call(o,n),r.current=n)},[n,r]),[n,i,o]}function s_(t){return typeof t=="function"}function a_(t){const e=$({value:t,previous:t});return le(()=>(e.current.value!==t&&(e.current.previous=e.current.value,e.current.value=t),e.current.previous),[t])}var xp=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),c_="VisuallyHidden",l_=ne((t,e)=>m(Oe.span,{...t,ref:e,style:{...xp,...t.style}}));l_.displayName=c_;var d_=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},wi=new WeakMap,go=new WeakMap,vo={},ac=0,Ep=function(t){return t&&(t.host||Ep(t.parentNode))},u_=function(t,e){return e.map(function(n){if(t.contains(n))return n;var i=Ep(n);return i&&t.contains(i)?i:(console.error("aria-hidden",n,"in not contained inside",t,". Doing nothing"),null)}).filter(function(n){return!!n})},h_=function(t,e,n,i){var r=u_(e,Array.isArray(t)?t:[t]);vo[n]||(vo[n]=new WeakMap);var o=vo[n],s=[],a=new Set,c=new Set(r),l=function(u){!u||a.has(u)||(a.add(u),l(u.parentNode))};r.forEach(l);var d=function(u){!u||c.has(u)||Array.prototype.forEach.call(u.children,function(h){if(a.has(h))d(h);else try{var f=h.getAttribute(i),g=f!==null&&f!=="false",p=(wi.get(h)||0)+1,v=(o.get(h)||0)+1;wi.set(h,p),o.set(h,v),s.push(h),p===1&&g&&go.set(h,!0),v===1&&h.setAttribute(n,"true"),g||h.setAttribute(i,"true")}catch(b){console.error("aria-hidden: cannot operate on ",h,b)}})};return d(e),a.clear(),ac++,function(){s.forEach(function(u){var h=wi.get(u)-1,f=o.get(u)-1;wi.set(u,h),o.set(u,f),h||(go.has(u)||u.removeAttribute(i),go.delete(u)),f||u.removeAttribute(n)}),ac--,ac||(wi=new WeakMap,wi=new WeakMap,go=new WeakMap,vo={})}},f_=function(t,e,n){n===void 0&&(n="data-aria-hidden");var i=Array.from(Array.isArray(t)?t:[t]),r=d_(t);return r?(i.push.apply(i,Array.from(r.querySelectorAll("[aria-live], script"))),h_(i,r,n,"aria-hidden")):function(){return null}},Vt=function(){return Vt=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++){e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},Vt.apply(this,arguments)};function Pp(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n}function p_(t,e,n){for(var i=0,r=e.length,o;i<r;i++)(o||!(i in e))&&(o||(o=Array.prototype.slice.call(e,0,i)),o[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))}var bo="right-scroll-bar-position",yo="width-before-scroll-bar",m_="with-scroll-bars-hidden",g_="--removed-body-scroll-bar-size";function cc(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function v_(t,e){var n=K(function(){return{value:t,callback:e,facade:{get current(){return n.value},set current(i){var r=n.value;r!==i&&(n.value=i,n.callback(i,r))}}}})[0];return n.callback=e,n.facade}var b_=typeof window<"u"?$t:X,Rp=new WeakMap;function y_(t,e){var n=v_(null,function(i){return t.forEach(function(r){return cc(r,i)})});return b_(function(){var i=Rp.get(n);if(i){var r=new Set(i),o=new Set(t),s=n.current;r.forEach(function(a){o.has(a)||cc(a,null)}),o.forEach(function(a){r.has(a)||cc(a,s)})}Rp.set(n,t)},[t]),n}function k_(t){return t}function w_(t,e){e===void 0&&(e=k_);var n=[],i=!1,r={read:function(){if(i)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:t},useMedium:function(o){var s=e(o,i);return n.push(s),function(){n=n.filter(function(a){return a!==s})}},assignSyncMedium:function(o){for(i=!0;n.length;){var s=n;n=[],s.forEach(o)}n={push:function(a){return o(a)},filter:function(){return n}}},assignMedium:function(o){i=!0;var s=[];if(n.length){var a=n;n=[],a.forEach(o),s=n}var c=function(){var d=s;s=[],d.forEach(o)},l=function(){return Promise.resolve().then(c)};l(),n={push:function(d){s.push(d),l()},filter:function(d){return s=s.filter(d),n}}}};return r}function C_(t){t===void 0&&(t={});var e=w_(null);return e.options=Vt({async:!0,ssr:!1},t),e}var Ip=function(t){var e=t.sideCar,n=Pp(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var i=e.read();if(!i)throw new Error("Sidecar medium not found");return _e(i,Vt({},n))};Ip.isSideCarExport=!0;function __(t,e){return t.useMedium(e),Ip}var Op=C_(),lc=function(){},ko=ne(function(t,e){var n=$(null),i=K({onScrollCapture:lc,onWheelCapture:lc,onTouchMoveCapture:lc}),r=i[0],o=i[1],s=t.forwardProps,a=t.children,c=t.className,l=t.removeScrollBar,d=t.enabled,u=t.shards,h=t.sideCar,f=t.noRelative,g=t.noIsolation,p=t.inert,v=t.allowPinchZoom,b=t.as,k=b===void 0?"div":b,C=t.gapMode,y=Pp(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),_=h,S=y_([n,e]),E=Vt(Vt({},y),r);return _e(Te,null,d&&_e(_,{sideCar:Op,removeScrollBar:l,shards:u,noRelative:f,noIsolation:g,inert:p,setCallbacks:o,allowPinchZoom:!!v,lockRef:n,gapMode:C}),s?Ai(un.only(a),Vt(Vt({},E),{ref:S})):_e(k,Vt({},E,{className:c,ref:S}),a))});ko.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},ko.classNames={fullWidth:yo,zeroRight:bo};var S_=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function T_(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=S_();return e&&t.setAttribute("nonce",e),t}function x_(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function E_(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}var P_=function(){var t=0,e=null;return{add:function(n){t==0&&(e=T_())&&(x_(e,n),E_(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},R_=function(){var t=P_();return function(e,n){X(function(){return t.add(e),function(){t.remove()}},[e&&n])}},Dp=function(){var t=R_(),e=function(n){var i=n.styles,r=n.dynamic;return t(i,r),null};return e},I_={left:0,top:0,right:0,gap:0},dc=function(t){return parseInt(t||"",10)||0},O_=function(t){var e=window.getComputedStyle(document.body),n=e[t==="padding"?"paddingLeft":"marginLeft"],i=e[t==="padding"?"paddingTop":"marginTop"],r=e[t==="padding"?"paddingRight":"marginRight"];return[dc(n),dc(i),dc(r)]},D_=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return I_;var e=O_(t),n=document.documentElement.clientWidth,i=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,i-n+e[2]-e[0])}},A_=Dp(),Ci="data-scroll-locked",M_=function(t,e,n,i){var r=t.left,o=t.top,s=t.right,a=t.gap;return n===void 0&&(n="margin"),`
  .`.concat(m_,` {
   overflow: hidden `).concat(i,`;
   padding-right: `).concat(a,"px ").concat(i,`;
  }
  body[`).concat(Ci,`] {
    overflow: hidden `).concat(i,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(i,";"),n==="margin"&&`
    padding-left: `.concat(r,`px;
    padding-top: `).concat(o,`px;
    padding-right: `).concat(s,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(i,`;
    `),n==="padding"&&"padding-right: ".concat(a,"px ").concat(i,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(bo,` {
    right: `).concat(a,"px ").concat(i,`;
  }
  
  .`).concat(yo,` {
    margin-right: `).concat(a,"px ").concat(i,`;
  }
  
  .`).concat(bo," .").concat(bo,` {
    right: 0 `).concat(i,`;
  }
  
  .`).concat(yo," .").concat(yo,` {
    margin-right: 0 `).concat(i,`;
  }
  
  body[`).concat(Ci,`] {
    `).concat(g_,": ").concat(a,`px;
  }
`)},Ap=function(){var t=parseInt(document.body.getAttribute(Ci)||"0",10);return isFinite(t)?t:0},N_=function(){X(function(){return document.body.setAttribute(Ci,(Ap()+1).toString()),function(){var t=Ap()-1;t<=0?document.body.removeAttribute(Ci):document.body.setAttribute(Ci,t.toString())}},[])},L_=function(t){var e=t.noRelative,n=t.noImportant,i=t.gapMode,r=i===void 0?"margin":i;N_();var o=le(function(){return D_(r)},[r]);return _e(A_,{styles:M_(o,!e,r,n?"":"!important")})},uc=!1;if(typeof window<"u")try{var wo=Object.defineProperty({},"passive",{get:function(){return uc=!0,!0}});window.addEventListener("test",wo,wo),window.removeEventListener("test",wo,wo)}catch{uc=!1}var _i=uc?{passive:!1}:!1,U_=function(t){return t.tagName==="TEXTAREA"},Mp=function(t,e){if(!(t instanceof Element))return!1;var n=window.getComputedStyle(t);return n[e]!=="hidden"&&!(n.overflowY===n.overflowX&&!U_(t)&&n[e]==="visible")},F_=function(t){return Mp(t,"overflowY")},B_=function(t){return Mp(t,"overflowX")},Np=function(t,e){var n=e.ownerDocument,i=e;do{typeof ShadowRoot<"u"&&i instanceof ShadowRoot&&(i=i.host);var r=Lp(t,i);if(r){var o=Up(t,i),s=o[1],a=o[2];if(s>a)return!0}i=i.parentNode}while(i&&i!==n.body);return!1},j_=function(t){var e=t.scrollTop,n=t.scrollHeight,i=t.clientHeight;return[e,n,i]},V_=function(t){var e=t.scrollLeft,n=t.scrollWidth,i=t.clientWidth;return[e,n,i]},Lp=function(t,e){return t==="v"?F_(e):B_(e)},Up=function(t,e){return t==="v"?j_(e):V_(e)},q_=function(t,e){return t==="h"&&e==="rtl"?-1:1},z_=function(t,e,n,i,r){var o=q_(t,window.getComputedStyle(e).direction),s=o*i,a=n.target,c=e.contains(a),l=!1,d=s>0,u=0,h=0;do{if(!a)break;var f=Up(t,a),g=f[0],p=f[1],v=f[2],b=p-v-o*g;(g||b)&&Lp(t,a)&&(u+=b,h+=g);var k=a.parentNode;a=k&&k.nodeType===Node.DOCUMENT_FRAGMENT_NODE?k.host:k}while(!c&&a!==document.body||c&&(e.contains(a)||e===a));return(d&&Math.abs(u)<1||!d&&Math.abs(h)<1)&&(l=!0),l},Co=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},Fp=function(t){return[t.deltaX,t.deltaY]},Bp=function(t){return t&&"current"in t?t.current:t},$_=function(t,e){return t[0]===e[0]&&t[1]===e[1]},W_=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},H_=0,Si=[];function G_(t){var e=$([]),n=$([0,0]),i=$(),r=K(H_++)[0],o=K(Dp)[0],s=$(t);X(function(){s.current=t},[t]),X(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(r));var p=p_([t.lockRef.current],(t.shards||[]).map(Bp)).filter(Boolean);return p.forEach(function(v){return v.classList.add("allow-interactivity-".concat(r))}),function(){document.body.classList.remove("block-interactivity-".concat(r)),p.forEach(function(v){return v.classList.remove("allow-interactivity-".concat(r))})}}},[t.inert,t.lockRef.current,t.shards]);var a=H(function(p,v){if("touches"in p&&p.touches.length===2||p.type==="wheel"&&p.ctrlKey)return!s.current.allowPinchZoom;var b=Co(p),k=n.current,C="deltaX"in p?p.deltaX:k[0]-b[0],y="deltaY"in p?p.deltaY:k[1]-b[1],_,S=p.target,E=Math.abs(C)>Math.abs(y)?"h":"v";if("touches"in p&&E==="h"&&S.type==="range")return!1;var x=Np(E,S);if(!x)return!0;if(x?_=E:(_=E==="v"?"h":"v",x=Np(E,S)),!x)return!1;if(!i.current&&"changedTouches"in p&&(C||y)&&(i.current=_),!_)return!0;var P=i.current||_;return z_(P,v,p,P==="h"?C:y)},[]),c=H(function(p){var v=p;if(!(!Si.length||Si[Si.length-1]!==o)){var b="deltaY"in v?Fp(v):Co(v),k=e.current.filter(function(_){return _.name===v.type&&(_.target===v.target||v.target===_.shadowParent)&&$_(_.delta,b)})[0];if(k&&k.should){v.cancelable&&v.preventDefault();return}if(!k){var C=(s.current.shards||[]).map(Bp).filter(Boolean).filter(function(_){return _.contains(v.target)}),y=C.length>0?a(v,C[0]):!s.current.noIsolation;y&&v.cancelable&&v.preventDefault()}}},[]),l=H(function(p,v,b,k){var C={name:p,delta:v,target:b,should:k,shadowParent:K_(b)};e.current.push(C),setTimeout(function(){e.current=e.current.filter(function(y){return y!==C})},1)},[]),d=H(function(p){n.current=Co(p),i.current=void 0},[]),u=H(function(p){l(p.type,Fp(p),p.target,a(p,t.lockRef.current))},[]),h=H(function(p){l(p.type,Co(p),p.target,a(p,t.lockRef.current))},[]);X(function(){return Si.push(o),t.setCallbacks({onScrollCapture:u,onWheelCapture:u,onTouchMoveCapture:h}),document.addEventListener("wheel",c,_i),document.addEventListener("touchmove",c,_i),document.addEventListener("touchstart",d,_i),function(){Si=Si.filter(function(p){return p!==o}),document.removeEventListener("wheel",c,_i),document.removeEventListener("touchmove",c,_i),document.removeEventListener("touchstart",d,_i)}},[]);var f=t.removeScrollBar,g=t.inert;return _e(Te,null,g?_e(o,{styles:W_(r)}):null,f?_e(L_,{noRelative:t.noRelative,gapMode:t.gapMode}):null)}function K_(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const J_=__(Op,G_);var jp=ne(function(t,e){return _e(ko,Vt({},t,{ref:e,sideCar:J_}))});jp.classNames=ko.classNames;var Y_=[" ","Enter","ArrowUp","ArrowDown"],X_=[" ","Enter"],zn="Select",[_o,So,Q_]=uw(zn),[Ti,QS]=Va(zn,[Q_,mp]),To=mp(),[Z_,En]=Ti(zn),[eS,tS]=Ti(zn),Vp=t=>{const{__scopeSelect:e,children:n,open:i,defaultOpen:r,onOpenChange:o,value:s,defaultValue:a,onValueChange:c,dir:l,name:d,autoComplete:u,disabled:h,required:f,form:g}=t,p=To(e),[v,b]=K(null),[k,C]=K(null),[y,_]=K(!1),S=fw(l),[E,x]=Tp({prop:i,defaultProp:r??!1,onChange:o,caller:zn}),[P,D]=Tp({prop:s,defaultProp:a,onChange:c,caller:zn}),M=$(null),F=v?g||!!v.closest("form"):!0,[z,W]=K(new Set),B=Array.from(z).map(G=>G.props.value).join(";");return m(ZC,{...p,children:m(Z_,{required:f,scope:e,trigger:v,onTriggerChange:b,valueNode:k,onValueNodeChange:C,valueNodeHasChildren:y,onValueNodeHasChildrenChange:_,contentId:Ha(),value:P,onValueChange:D,open:E,onOpenChange:x,dir:S,triggerPointerDownPosRef:M,disabled:h,children:[m(_o.Provider,{scope:e,children:m(eS,{scope:t.__scopeSelect,onNativeOptionAdd:H(G=>{W(Y=>new Set(Y).add(G))},[]),onNativeOptionRemove:H(G=>{W(Y=>{const A=new Set(Y);return A.delete(G),A})},[]),children:n})}),F?m(cm,{"aria-hidden":!0,required:f,tabIndex:-1,name:d,autoComplete:u,value:P,onChange:G=>D(G.target.value),disabled:h,form:g,children:[P===void 0?m("option",{value:""}):null,Array.from(z)]},B):null]})})};Vp.displayName=zn;var qp="SelectTrigger",zp=ne((t,e)=>{const{__scopeSelect:n,disabled:i=!1,...r}=t,o=To(n),s=En(qp,n),a=s.disabled||i,c=$e(e,s.onTriggerChange),l=So(n),d=$("touch"),[u,h,f]=dm(p=>{const v=l().filter(C=>!C.disabled),b=v.find(C=>C.value===s.value),k=um(v,p,b);k!==void 0&&s.onValueChange(k.value)}),g=p=>{a||(s.onOpenChange(!0),f()),p&&(s.triggerPointerDownPosRef.current={x:Math.round(p.pageX),y:Math.round(p.pageY)})};return m(e_,{asChild:!0,...o,children:m(Oe.button,{type:"button",role:"combobox","aria-controls":s.contentId,"aria-expanded":s.open,"aria-required":s.required,"aria-autocomplete":"none",dir:s.dir,"data-state":s.open?"open":"closed",disabled:a,"data-disabled":a?"":void 0,"data-placeholder":lm(s.value)?"":void 0,...r,ref:c,onClick:Me(r.onClick,p=>{p.currentTarget.focus(),d.current!=="mouse"&&g(p)}),onPointerDown:Me(r.onPointerDown,p=>{d.current=p.pointerType;const v=p.target;v.hasPointerCapture(p.pointerId)&&v.releasePointerCapture(p.pointerId),p.button===0&&p.ctrlKey===!1&&p.pointerType==="mouse"&&(g(p),p.preventDefault())}),onKeyDown:Me(r.onKeyDown,p=>{const v=u.current!=="";!(p.ctrlKey||p.altKey||p.metaKey)&&p.key.length===1&&h(p.key),!(v&&p.key===" ")&&Y_.includes(p.key)&&(g(),p.preventDefault())})})})});zp.displayName=qp;var $p="SelectValue",nS=ne((t,e)=>{const{__scopeSelect:n,className:i,style:r,children:o,placeholder:s="",...a}=t,c=En($p,n),{onValueNodeHasChildrenChange:l}=c,d=o!==void 0,u=$e(e,c.onValueNodeChange);return et(()=>{l(d)},[l,d]),m(Oe.span,{...a,ref:u,style:{pointerEvents:"none"},children:lm(c.value)?m(Te,{children:s}):o})});nS.displayName=$p;var iS="SelectIcon",Wp=ne((t,e)=>{const{__scopeSelect:n,children:i,...r}=t;return m(Oe.span,{"aria-hidden":!0,...r,ref:e,children:i||""})});Wp.displayName=iS;var rS="SelectPortal",Hp=t=>m(Sp,{asChild:!0,...t});Hp.displayName=rS;var $n="SelectContent",Gp=ne((t,e)=>{const n=En($n,t.__scopeSelect),[i,r]=K();if(et(()=>{r(new DocumentFragment)},[]),!n.open){const o=i;return o?pr(m(Kp,{scope:t.__scopeSelect,children:m(_o.Slot,{scope:t.__scopeSelect,children:m("div",{children:t.children})})}),o):null}return m(Jp,{...t,ref:e})});Gp.displayName=$n;var Tt=10,[Kp,Pn]=Ti($n),oS="SelectContentImpl",sS=Qi("SelectContent.RemoveScroll"),Jp=ne((t,e)=>{const{__scopeSelect:n,position:i="item-aligned",onCloseAutoFocus:r,onEscapeKeyDown:o,onPointerDownOutside:s,side:a,sideOffset:c,align:l,alignOffset:d,arrowPadding:u,collisionBoundary:h,collisionPadding:f,sticky:g,hideWhenDetached:p,avoidCollisions:v,...b}=t,k=En($n,n),[C,y]=K(null),[_,S]=K(null),E=$e(e,q=>y(q)),[x,P]=K(null),[D,M]=K(null),F=So(n),[z,W]=K(!1),B=$(!1);X(()=>{if(C)return f_(C)},[C]),Sw();const G=H(q=>{const[ge,...ye]=F().map(Ce=>Ce.ref.current),[re]=ye.slice(-1),ve=document.activeElement;for(const Ce of q)if(Ce===ve||(Ce==null||Ce.scrollIntoView({block:"nearest"}),Ce===ge&&_&&(_.scrollTop=0),Ce===re&&_&&(_.scrollTop=_.scrollHeight),Ce==null||Ce.focus(),document.activeElement!==ve))return},[F,_]),Y=H(()=>G([x,C]),[G,x,C]);X(()=>{z&&Y()},[z,Y]);const{onOpenChange:A,triggerPointerDownPosRef:ee}=k;X(()=>{if(C){let q={x:0,y:0};const ge=re=>{var ve,Ce;q={x:Math.abs(Math.round(re.pageX)-(((ve=ee.current)==null?void 0:ve.x)??0)),y:Math.abs(Math.round(re.pageY)-(((Ce=ee.current)==null?void 0:Ce.y)??0))}},ye=re=>{q.x<=10&&q.y<=10?re.preventDefault():C.contains(re.target)||A(!1),document.removeEventListener("pointermove",ge),ee.current=null};return ee.current!==null&&(document.addEventListener("pointermove",ge),document.addEventListener("pointerup",ye,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",ge),document.removeEventListener("pointerup",ye,{capture:!0})}}},[C,A,ee]),X(()=>{const q=()=>A(!1);return window.addEventListener("blur",q),window.addEventListener("resize",q),()=>{window.removeEventListener("blur",q),window.removeEventListener("resize",q)}},[A]);const[we,tt]=dm(q=>{const ge=F().filter(ve=>!ve.disabled),ye=ge.find(ve=>ve.ref.current===document.activeElement),re=um(ge,q,ye);re&&setTimeout(()=>re.ref.current.focus())}),ut=H((q,ge,ye)=>{const re=!B.current&&!ye;(k.value!==void 0&&k.value===ge||re)&&(P(q),re&&(B.current=!0))},[k.value]),fe=H(()=>C==null?void 0:C.focus(),[C]),de=H((q,ge,ye)=>{const re=!B.current&&!ye;(k.value!==void 0&&k.value===ge||re)&&M(q)},[k.value]),Ge=i==="popper"?hc:Yp,nt=Ge===hc?{side:a,sideOffset:c,align:l,alignOffset:d,arrowPadding:u,collisionBoundary:h,collisionPadding:f,sticky:g,hideWhenDetached:p,avoidCollisions:v}:{};return m(Kp,{scope:n,content:C,viewport:_,onViewportChange:S,itemRefCallback:ut,selectedItem:x,onItemLeave:fe,itemTextRefCallback:de,focusSelectedItem:Y,selectedItemText:D,position:i,isPositioned:z,searchRef:we,children:m(jp,{as:sS,allowPinchZoom:!0,children:m(Vf,{asChild:!0,trapped:k.open,onMountAutoFocus:q=>{q.preventDefault()},onUnmountAutoFocus:Me(r,q=>{var ge;(ge=k.trigger)==null||ge.focus({preventScroll:!0}),q.preventDefault()}),children:m(Lf,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:o,onPointerDownOutside:s,onFocusOutside:q=>q.preventDefault(),onDismiss:()=>k.onOpenChange(!1),children:m(Ge,{role:"listbox",id:k.contentId,"data-state":k.open?"open":"closed",dir:k.dir,onContextMenu:q=>q.preventDefault(),...b,...nt,onPlaced:()=>W(!0),ref:E,style:{display:"flex",flexDirection:"column",outline:"none",...b.style},onKeyDown:Me(b.onKeyDown,q=>{const ge=q.ctrlKey||q.altKey||q.metaKey;if(q.key==="Tab"&&q.preventDefault(),!ge&&q.key.length===1&&tt(q.key),["ArrowUp","ArrowDown","Home","End"].includes(q.key)){let ye=F().filter(re=>!re.disabled).map(re=>re.ref.current);if(["ArrowUp","End"].includes(q.key)&&(ye=ye.slice().reverse()),["ArrowUp","ArrowDown"].includes(q.key)){const re=q.target,ve=ye.indexOf(re);ye=ye.slice(ve+1)}setTimeout(()=>G(ye)),q.preventDefault()}})})})})})})});Jp.displayName=oS;var aS="SelectItemAlignedPosition",Yp=ne((t,e)=>{const{__scopeSelect:n,onPlaced:i,...r}=t,o=En($n,n),s=Pn($n,n),[a,c]=K(null),[l,d]=K(null),u=$e(e,E=>d(E)),h=So(n),f=$(!1),g=$(!0),{viewport:p,selectedItem:v,selectedItemText:b,focusSelectedItem:k}=s,C=H(()=>{if(o.trigger&&o.valueNode&&a&&l&&p&&v&&b){const E=o.trigger.getBoundingClientRect(),x=l.getBoundingClientRect(),P=o.valueNode.getBoundingClientRect(),D=b.getBoundingClientRect();if(o.dir!=="rtl"){const re=D.left-x.left,ve=P.left-re,Ce=E.left-ve,ht=E.width+Ce,rr=Math.max(ht,x.width),or=window.innerWidth-Tt,sr=Af(ve,[Tt,Math.max(Tt,or-rr)]);a.style.minWidth=ht+"px",a.style.left=sr+"px"}else{const re=x.right-D.right,ve=window.innerWidth-P.right-re,Ce=window.innerWidth-E.right-ve,ht=E.width+Ce,rr=Math.max(ht,x.width),or=window.innerWidth-Tt,sr=Af(ve,[Tt,Math.max(Tt,or-rr)]);a.style.minWidth=ht+"px",a.style.right=sr+"px"}const M=h(),F=window.innerHeight-Tt*2,z=p.scrollHeight,W=window.getComputedStyle(l),B=parseInt(W.borderTopWidth,10),G=parseInt(W.paddingTop,10),Y=parseInt(W.borderBottomWidth,10),A=parseInt(W.paddingBottom,10),ee=B+G+z+A+Y,we=Math.min(v.offsetHeight*5,ee),tt=window.getComputedStyle(p),ut=parseInt(tt.paddingTop,10),fe=parseInt(tt.paddingBottom,10),de=E.top+E.height/2-Tt,Ge=F-de,nt=v.offsetHeight/2,q=v.offsetTop+nt,ge=B+G+q,ye=ee-ge;if(ge<=de){const re=M.length>0&&v===M[M.length-1].ref.current;a.style.bottom="0px";const ve=l.clientHeight-p.offsetTop-p.offsetHeight,Ce=Math.max(Ge,nt+(re?fe:0)+ve+Y),ht=ge+Ce;a.style.height=ht+"px"}else{const re=M.length>0&&v===M[0].ref.current;a.style.top="0px";const ve=Math.max(de,B+p.offsetTop+(re?ut:0)+nt)+ye;a.style.height=ve+"px",p.scrollTop=ge-de+p.offsetTop}a.style.margin=`${Tt}px 0`,a.style.minHeight=we+"px",a.style.maxHeight=F+"px",i==null||i(),requestAnimationFrame(()=>f.current=!0)}},[h,o.trigger,o.valueNode,a,l,p,v,b,o.dir,i]);et(()=>C(),[C]);const[y,_]=K();et(()=>{l&&_(window.getComputedStyle(l).zIndex)},[l]);const S=H(E=>{E&&g.current===!0&&(C(),k==null||k(),g.current=!1)},[C,k]);return m(lS,{scope:n,contentWrapper:a,shouldExpandOnScrollRef:f,onScrollButtonChange:S,children:m("div",{ref:c,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:y},children:m(Oe.div,{...r,ref:u,style:{boxSizing:"border-box",maxHeight:"100%",...r.style}})})})});Yp.displayName=aS;var cS="SelectPopperPosition",hc=ne((t,e)=>{const{__scopeSelect:n,align:i="start",collisionPadding:r=Tt,...o}=t,s=To(n);return m(t_,{...s,...o,ref:e,align:i,collisionPadding:r,style:{boxSizing:"border-box",...o.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});hc.displayName=cS;var[lS,fc]=Ti($n,{}),pc="SelectViewport",Xp=ne((t,e)=>{const{__scopeSelect:n,nonce:i,...r}=t,o=Pn(pc,n),s=fc(pc,n),a=$e(e,o.onViewportChange),c=$(0);return m(Te,{children:[m("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:i}),m(_o.Slot,{scope:n,children:m(Oe.div,{"data-radix-select-viewport":"",role:"presentation",...r,ref:a,style:{position:"relative",flex:1,overflow:"hidden auto",...r.style},onScroll:Me(r.onScroll,l=>{const d=l.currentTarget,{contentWrapper:u,shouldExpandOnScrollRef:h}=s;if(h!=null&&h.current&&u){const f=Math.abs(c.current-d.scrollTop);if(f>0){const g=window.innerHeight-Tt*2,p=parseFloat(u.style.minHeight),v=parseFloat(u.style.height),b=Math.max(p,v);if(b<g){const k=b+f,C=Math.min(g,k),y=k-C;u.style.height=C+"px",u.style.bottom==="0px"&&(d.scrollTop=y>0?y:0,u.style.justifyContent="flex-end")}}}c.current=d.scrollTop})})})]})});Xp.displayName=pc;var Qp="SelectGroup",[dS,uS]=Ti(Qp),hS=ne((t,e)=>{const{__scopeSelect:n,...i}=t,r=Ha();return m(dS,{scope:n,id:r,children:m(Oe.div,{role:"group","aria-labelledby":r,...i,ref:e})})});hS.displayName=Qp;var Zp="SelectLabel",fS=ne((t,e)=>{const{__scopeSelect:n,...i}=t,r=uS(Zp,n);return m(Oe.div,{id:r.id,...i,ref:e})});fS.displayName=Zp;var xo="SelectItem",[pS,em]=Ti(xo),tm=ne((t,e)=>{const{__scopeSelect:n,value:i,disabled:r=!1,textValue:o,...s}=t,a=En(xo,n),c=Pn(xo,n),l=a.value===i,[d,u]=K(o??""),[h,f]=K(!1),g=$e(e,k=>{var C;return(C=c.itemRefCallback)==null?void 0:C.call(c,k,i,r)}),p=Ha(),v=$("touch"),b=()=>{r||(a.onValueChange(i),a.onOpenChange(!1))};if(i==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return m(pS,{scope:n,value:i,disabled:r,textId:p,isSelected:l,onItemTextChange:H(k=>{u(C=>C||((k==null?void 0:k.textContent)??"").trim())},[]),children:m(_o.ItemSlot,{scope:n,value:i,disabled:r,textValue:d,children:m(Oe.div,{role:"option","aria-labelledby":p,"data-highlighted":h?"":void 0,"aria-selected":l&&h,"data-state":l?"checked":"unchecked","aria-disabled":r||void 0,"data-disabled":r?"":void 0,tabIndex:r?void 0:-1,...s,ref:g,onFocus:Me(s.onFocus,()=>f(!0)),onBlur:Me(s.onBlur,()=>f(!1)),onClick:Me(s.onClick,()=>{v.current!=="mouse"&&b()}),onPointerUp:Me(s.onPointerUp,()=>{v.current==="mouse"&&b()}),onPointerDown:Me(s.onPointerDown,k=>{v.current=k.pointerType}),onPointerMove:Me(s.onPointerMove,k=>{var C;v.current=k.pointerType,r?(C=c.onItemLeave)==null||C.call(c):v.current==="mouse"&&k.currentTarget.focus({preventScroll:!0})}),onPointerLeave:Me(s.onPointerLeave,k=>{var C;k.currentTarget===document.activeElement&&((C=c.onItemLeave)==null||C.call(c))}),onKeyDown:Me(s.onKeyDown,k=>{var C;((C=c.searchRef)==null?void 0:C.current)!==""&&k.key===" "||(X_.includes(k.key)&&b(),k.key===" "&&k.preventDefault())})})})})});tm.displayName=xo;var ir="SelectItemText",nm=ne((t,e)=>{const{__scopeSelect:n,className:i,style:r,...o}=t,s=En(ir,n),a=Pn(ir,n),c=em(ir,n),l=tS(ir,n),[d,u]=K(null),h=$e(e,b=>u(b),c.onItemTextChange,b=>{var k;return(k=a.itemTextRefCallback)==null?void 0:k.call(a,b,c.value,c.disabled)}),f=d==null?void 0:d.textContent,g=le(()=>m("option",{value:c.value,disabled:c.disabled,children:f},c.value),[c.disabled,c.value,f]),{onNativeOptionAdd:p,onNativeOptionRemove:v}=l;return et(()=>(p(g),()=>v(g)),[p,v,g]),m(Te,{children:[m(Oe.span,{id:c.textId,...o,ref:h}),c.isSelected&&s.valueNode&&!s.valueNodeHasChildren?pr(o.children,s.valueNode):null]})});nm.displayName=ir;var im="SelectItemIndicator",rm=ne((t,e)=>{const{__scopeSelect:n,...i}=t;return em(im,n).isSelected?m(Oe.span,{"aria-hidden":!0,...i,ref:e}):null});rm.displayName=im;var mc="SelectScrollUpButton",om=ne((t,e)=>{const n=Pn(mc,t.__scopeSelect),i=fc(mc,t.__scopeSelect),[r,o]=K(!1),s=$e(e,i.onScrollButtonChange);return et(()=>{if(n.viewport&&n.isPositioned){let a=function(){const l=c.scrollTop>0;o(l)};const c=n.viewport;return a(),c.addEventListener("scroll",a),()=>c.removeEventListener("scroll",a)}},[n.viewport,n.isPositioned]),r?m(am,{...t,ref:s,onAutoScroll:()=>{const{viewport:a,selectedItem:c}=n;a&&c&&(a.scrollTop=a.scrollTop-c.offsetHeight)}}):null});om.displayName=mc;var gc="SelectScrollDownButton",sm=ne((t,e)=>{const n=Pn(gc,t.__scopeSelect),i=fc(gc,t.__scopeSelect),[r,o]=K(!1),s=$e(e,i.onScrollButtonChange);return et(()=>{if(n.viewport&&n.isPositioned){let a=function(){const l=c.scrollHeight-c.clientHeight,d=Math.ceil(c.scrollTop)<l;o(d)};const c=n.viewport;return a(),c.addEventListener("scroll",a),()=>c.removeEventListener("scroll",a)}},[n.viewport,n.isPositioned]),r?m(am,{...t,ref:s,onAutoScroll:()=>{const{viewport:a,selectedItem:c}=n;a&&c&&(a.scrollTop=a.scrollTop+c.offsetHeight)}}):null});sm.displayName=gc;var am=ne((t,e)=>{const{__scopeSelect:n,onAutoScroll:i,...r}=t,o=Pn("SelectScrollButton",n),s=$(null),a=So(n),c=H(()=>{s.current!==null&&(window.clearInterval(s.current),s.current=null)},[]);return X(()=>()=>c(),[c]),et(()=>{var l;const d=a().find(u=>u.ref.current===document.activeElement);(l=d==null?void 0:d.ref.current)==null||l.scrollIntoView({block:"nearest"})},[a]),m(Oe.div,{"aria-hidden":!0,...r,ref:e,style:{flexShrink:0,...r.style},onPointerDown:Me(r.onPointerDown,()=>{s.current===null&&(s.current=window.setInterval(i,50))}),onPointerMove:Me(r.onPointerMove,()=>{var l;(l=o.onItemLeave)==null||l.call(o),s.current===null&&(s.current=window.setInterval(i,50))}),onPointerLeave:Me(r.onPointerLeave,()=>{c()})})}),mS="SelectSeparator",gS=ne((t,e)=>{const{__scopeSelect:n,...i}=t;return m(Oe.div,{"aria-hidden":!0,...i,ref:e})});gS.displayName=mS;var vc="SelectArrow",vS=ne((t,e)=>{const{__scopeSelect:n,...i}=t,r=To(n),o=En(vc,n),s=Pn(vc,n);return o.open&&s.position==="popper"?m(n_,{...r,...i,ref:e}):null});vS.displayName=vc;var bS="SelectBubbleInput",cm=ne(({__scopeSelect:t,value:e,...n},i)=>{const r=$(null),o=$e(i,r),s=a_(e);return X(()=>{const a=r.current;if(!a)return;const c=window.HTMLSelectElement.prototype,l=Object.getOwnPropertyDescriptor(c,"value").set;if(s!==e&&l){const d=new Event("change",{bubbles:!0});l.call(a,e),a.dispatchEvent(d)}},[s,e]),m(Oe.select,{...n,style:{...xp,...n.style},ref:o,defaultValue:e})});cm.displayName=bS;function lm(t){return t===""||t===void 0}function dm(t){const e=Vn(t),n=$(""),i=$(0),r=H(s=>{const a=n.current+s;e(a),(function c(l){n.current=l,window.clearTimeout(i.current),l!==""&&(i.current=window.setTimeout(()=>c(""),1e3))})(a)},[e]),o=H(()=>{n.current="",window.clearTimeout(i.current)},[]);return X(()=>()=>window.clearTimeout(i.current),[]),[n,r,o]}function um(t,e,n){const i=e.length>1&&Array.from(e).every(a=>a===e[0])?e[0]:e,r=n?t.indexOf(n):-1;let o=yS(t,Math.max(r,0));i.length===1&&(o=o.filter(a=>a!==n));const s=o.find(a=>a.textValue.toLowerCase().startsWith(i.toLowerCase()));return s!==n?s:void 0}function yS(t,e){return t.map((n,i)=>t[(e+i)%t.length])}var kS=Vp,hm=zp,fm=Wp,wS=Hp,CS=Gp,_S=Xp,SS=tm,TS=nm,xS=rm,ES=om,PS=sm;const RS={sm:"w-4 h-4",md:"w-6 h-6"};function bc({size:t="md",flagCode:e,className:n,...i}){return m("img",{className:he("rounded-full object-cover",RS[t],n),src:`https://storage.googleapis.com/eleven-public-cdn/images/flags/circle-flags/${e}.svg`,alt:`${e.toUpperCase()} flag`,...i})}function pm({children:t,...e}){const[n,i]=K(!1),{language:r,setLanguage:o,options:s}=hi(),a=_y();return m(kS,{open:n,value:r.value.languageCode,onValueChange:c=>{o(c),i(!1)},onOpenChange:c=>{c&&i(!0)},children:[t,m(wS,{container:a,children:m(CS,{className:"overflow-hidden bg-base border border-base-border rounded-dropdown-sheet max-h-[min(384px,var(--radix-select-content-available-height))] min-w-[var(--radix-select-trigger-width)] z-10",position:"popper",sideOffset:8,align:"end",side:"top",onPointerDownOutside:()=>i(!1),onCloseAutoFocus:()=>i(!1),onEscapeKeyDown:()=>i(!1),...e,children:[m(ES,{className:"flex items-center justify-center h-6 bg-base text-base-subtle cursor-default",children:m(Lt,{size:"sm",name:"chevron-up"})}),m(_S,{className:"p-1.5",children:s.value.map(c=>m(SS,{value:c.languageCode,className:"flex select-none items-center p-1.5 pr-3 gap-2 cursor-pointer rounded-input relative focus-visible:outline-none data-[highlighted]:bg-base-active text-sm",children:[m(bc,{flagCode:c.flagCode}),m(TS,{children:c.name}),m(xS,{className:"text-base-primary p-1.5 -mr-1.5 ml-auto",children:m(Lt,{size:"sm",name:"check"})})]},c.languageCode))}),m(PS,{className:"flex items-center justify-center h-6 bg-base text-base-subtle cursor-default",children:m(Lt,{size:"sm",name:"chevron-down"})})]})})]})}function IS({className:t,...e}){const n=Ae(),{language:i,showPicker:r}=hi();return r.value?m(pm,{align:"center",children:m(hm,{className:he("h-9 min-w-max rounded-button focus-ring px-2 flex gap-2 items-center text-base-primary bg-base hover:bg-base-hover active:bg-base-active font-medium",t),"aria-label":n.change_language,...e,children:[m(bc,{size:"sm",flagCode:i.value.flagCode}),i.value.name,m(fm,{className:"text-base-subtle",asChild:!0,children:m(Lt,{size:"sm",name:"chevron-down"})})]})}):null}function OS({showBackButton:t,onBackClick:e,showStatusLabel:n,showShadow:i,showLanguageSelector:r}){const o=Ae();return m("div",{className:he("bg-base shrink-0 relative",i&&"shadow-header"),children:[m("div",{className:"flex gap-2 p-4 items-start",children:[t?m(Ct,{variant:"ghost",onClick:e,"aria-label":o.go_back,className:"!h-8 !w-8",children:m(Lt,{name:"chevron-up",className:"-rotate-90",size:"sm"})}):m("div",{className:"relative w-8 h-8"}),m(He,{active:n,children:m(La,{className:"transition-opacity data-hidden:opacity-0"})})]}),m(He,{active:r,children:m("div",{className:"absolute top-0 left-0 right-0 p-4 flex justify-center transition-[opacity,transform] duration-200 data-hidden:opacity-0 data-hidden:-translate-y-4",children:m(IS,{})})})]})}const DS={"top-left":"origin-top-left",top:"origin-top","top-right":"origin-top-right","bottom-left":"origin-bottom-left","bottom-right":"origin-bottom-right",bottom:"origin-bottom"};function mm({open:t}){const e=Ae(),n=Ea(),i=to(),r=Fe(),o=r.value.placement,{isDisconnected:s,startSession:a,transcript:c,conversationIndex:l}=We(),d=Xh(),{currentContent:u,currentConfig:h}=Fa(),f=be(()=>{var b;return n.value||i.value?!d.value||!n.value?c.value:[{type:"message",role:"agent",message:d.value,isText:!0,conversationIndex:((b=c.value[0])==null?void 0:b.conversationIndex)??l.peek()},...c.value]:r.value.transcript_enabled?c.value:c.value.filter(k=>k.type!=="message"||k.isText)}),g=f.value.length>0||!s.value&&r.value.transcript_enabled,p=Le(!0),v=u.value!=="feedback";return m(He,{initial:!1,active:t,children:m("div",{className:he("flex flex-col overflow-hidden absolute bg-base shadow-lg pointer-events-auto rounded-sheet w-full max-w-[400px] h-[calc(100%-80px)] max-h-[550px]","transition-[transform,opacity] duration-200 data-hidden:scale-90 data-hidden:opacity-0",DS[o],o.startsWith("top")?r.value.always_expanded?"top-0":"top-20":r.value.always_expanded?"bottom-0":"bottom-20"),children:[m(OS,{showBackButton:h.showHeaderBack,onBackClick:h.onHeaderBack,showStatusLabel:g&&!s.value,showShadow:g,showLanguageSelector:u.value!=="feedback"&&(!g||s.value)}),m(He,{active:u.value==="transcript",children:m("div",{className:"grow flex flex-col min-h-0 transition-opacity duration-300 ease-out data-hidden:opacity-0",children:[m(sw,{transcript:f,scrollPinned:p}),m(aw,{scrollPinned:p,showTranscript:g})]})}),m(He,{active:u.value==="feedback",children:m("div",{className:"absolute inset-0 top-[88px] flex flex-col bg-base transition-transform duration-300 ease-out data-hidden:translate-x-full",children:[m(cw,{}),m(lw,{})]})}),m(He,{active:v,children:m("div",{className:he("absolute origin-top-left transition-[transform,left,top,opacity,scale] duration-200 z-1","data-hidden:opacity-0",g?"top-4 left-4 scale-[0.1667]":"top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 scale-100"),children:[m(fi,{size:"lg"}),m(He,{active:!g&&s.value&&!n.value,children:m("div",{className:"absolute bottom-0 p-1 rounded-[calc(var(--el-button-radius)+4px)] bg-base left-1/2 -translate-x-1/2 translate-y-1/2 transition-[opacity,transform] data-hidden:opacity-0 data-hidden:scale-100 scale-150",children:m(Ct,{"aria-label":e.start_call,variant:"primary",icon:"phone",onClick:b=>a(b.currentTarget)})})}),m(He,{active:!g&&!s.value,children:m("div",{className:"absolute -bottom-3 left-1/2 -translate-x-1/2 translate-y-full transition-[opacity,transform] data-hidden:opacity-0 data-hidden:scale-75",children:m(La,{})})})]})})]})})}function gm({expanded:t}){const e=to(),n=Fe().value.variant,{isDisconnected:i}=We(),r=Ae(),o=H(()=>{t.value=!t.value},[t]);return m(Te,{children:[n==="full"&&m(sn,{visible:!t.value&&!i.value,className:"p-1",children:m(fi,{})}),m(sn,{grow:n!=="tiny",visible:!e.value&&!t.value&&!i.value,className:"p-1",children:m(ja,{iconOnly:!0,isDisconnected:!1})}),m(Ba,{visible:!e.value&&!t.value&&!i.value}),m(sn,{grow:i.value,visible:!0,className:"p-1",children:m(Ct,{className:"w-full",variant:"primary",iconClassName:he((t.value||!i.value)&&"transition-transform duration-200",t.value&&"-rotate-180"),icon:t.value?"chevron-up":i.value?e.value?"chat":"phone":"chevron-up","aria-label":t.value?r.collapse:i.value?e.value?r.start_chat:r.start_call:r.expand,onClick:!t.value&&!i.value?o:void 0,children:!t.value&&i.value&&n!=="tiny"?e.value?r.start_chat:r.start_call:void 0})})]})}function AS({expanded:t,className:e,...n}){const{isDisconnected:i}=We(),r=Ae();return m("div",{className:he("transition-[border-radius] flex flex-col p-2",!t.value&&i.value?"rounded-sheet":"rounded-compact-sheet",e),...n,children:[m(sn,{visible:!t.value&&i.value,className:"p-1 !min-w-60",children:m("div",{className:"flex items-center gap-2",children:[m(fi,{}),m("div",{className:"text-sm max-w-64",children:r.main_label})]})}),m("div",{className:"flex items-center",children:m(gm,{expanded:t})})]})}function MS({expanded:t,className:e,...n}){return m("div",{className:he("rounded-compact-sheet flex items-center p-2",e),...n,children:[m(sn,{visible:!t.value,className:"p-1",children:m(fi,{})}),m(gm,{expanded:t})]})}function NS({visible:t,className:e,...n}){const i=Ae(),{language:r,showPicker:o}=hi();return o.value?m(sn,{visible:t,className:"p-1",children:m(pm,{children:m(hm,{className:he("h-9 min-w-max border border-base-border rounded-button focus-ring px-1.5 flex gap-1 items-center transition-colors duration-200 hover:bg-base-hover active:bg-base-active",e),"aria-label":i.change_language,...n,children:[m(bc,{flagCode:r.value.flagCode}),m(fm,{className:"px-1 text-base-subtle",asChild:!0,children:m(Lt,{size:"sm",name:"chevron-down"})})]})})}):null}function vm(){const t=Fe().value.variant,{isDisconnected:e,status:n}=We();return m(Te,{children:[m(ja,{isDisconnected:e.value,iconOnly:t==="tiny",className:"w-full m-1 z-1",disabled:n.value==="disconnecting"||n.value==="connecting"}),m(NS,{visible:e.value}),m(Ba,{visible:!e.value})]})}function LS({className:t,...e}){const{isDisconnected:n}=We(),i=Ae();return m("div",{className:he("flex flex-col p-2 rounded-sheet",t),...e,children:[m("div",{className:"flex items-center p-1 gap-2 min-w-60",children:[m(fi,{}),m("div",{className:"relative text-sm max-w-64",children:[m("span",{className:he("block transition-[transform,opacity] duration-200",!n.value&&"opacity-0 scale-90"),children:i.main_label}),m(He,{active:!n.value,children:m(La,{className:"absolute top-1/2 -translate-y-1/2 transition-[transform,opacity] duration-200 data-hidden:opacity-0 data-hidden:scale-90"})})]})]}),m("div",{className:"flex items-center",children:m(vm,{})})]})}function US({className:t,...e}){return m("div",{className:he("rounded-compact-sheet flex items-center p-2",t),...e,children:[m(fi,{className:"mx-1"}),m(vm,{})]})}function FS({expandable:t,expanded:e}){const n=Fe().value.variant,i=eo(),{isDisconnected:r}=We(),o=H(async()=>{await i.requestTerms(),e.value=!e.peek()},[e]),s=n==="full";return t?m(s?AS:MS,{expanded:e,className:he("bg-base shadow-md pointer-events-auto overflow-hidden",(r.value||e.value)&&"cursor-pointer"),onClick:r.value||e.value?o:void 0}):m(s?LS:US,{className:"bg-base shadow-md pointer-events-auto overflow-hidden"})}function BS(){const t=Ae(),e=Fe(),{dismissTerms:n,acceptTerms:i}=eo();return m("div",{className:"max-w-[400px] flex flex-col gap-2 bg-base shadow-md pointer-events-auto rounded-sheet p-3 text-sm",children:[m("div",{className:"flex flex-col gap-1 terms p-2 pt-1",dangerouslySetInnerHTML:{__html:e.value.terms_html??""}}),m("div",{className:"flex justify-end gap-2",children:[m(Ct,{onClick:n,children:t.dismiss_terms}),m(Ct,{onClick:i,variant:"primary",children:t.accept_terms})]})]})}function jS({copyText:t,children:e}){const n=Ae(),[i,r]=K(!1);X(()=>{if(i){const s=setTimeout(()=>{r(!1)},2e3);return()=>{clearTimeout(s)}}},[i]);const o=H(()=>{const s=nf(t);s&&(navigator.clipboard.writeText(s),r(!0))},[]);return m(Ct,{onClick:o,children:i?n.copied:e})}function VS({sawError:t}){const e=Ae(),{error:n,lastId:i}=We(),r=H(()=>{t.value=!0},[]);return m("div",{className:"max-w-[400px] flex flex-col gap-2 bg-base shadow-md pointer-events-auto rounded-sheet p-3 text-sm",children:[m("div",{className:"p-2 pt-1",children:[m("h1",{className:"text-md font-medium pb-1",children:e.error_occurred}),n.value,i.value&&m(Te,{children:[m("br",{}),m("span",{className:"text-base-subtle",children:[e.conversation_id,": ",i.value]})]})]}),m("div",{className:"flex justify-end gap-2",children:[m(jS,{copyText:i,children:e.copy_id}),m(Ct,{variant:"primary",onClick:r,children:"Close"})]})]})}function qS(){const t=Fe();return t.value.disable_banner?null:m("p",{className:he("whitespace-nowrap [line-height:var(--el-overlay-padding)] text-[10px] px-3",t.value.placement.startsWith("top")?"-translate-y-[calc(var(--el-overlay-padding))]":"translate-y-[calc(var(--el-overlay-padding))]"),children:[m("span",{className:"opacity-30",children:"Powered by ElevenLabs"})," ",m("a",{href:t.value.override_link||"https://elevenlabs.io/conversational-ai",className:"underline cursor-pointer pointer-events-auto focus-visible:outline-none opacity-30 hover:opacity-50 focus-visible:opacity-100 focus-visible:underline-offset-2",target:"_blank",children:"Agents"})]})}const xi={left:"items-start",center:"items-center",right:"items-end"},Ei={top:"flex-col-reverse justify-end",bottom:"flex-col justify-end"},zS={"top-left":`${Ei.top} ${xi.left}`,top:`${Ei.top} ${xi.center}`,"top-right":`${Ei.top} ${xi.right}`,"bottom-left":`${Ei.bottom} ${xi.left}`,bottom:`${Ei.bottom} ${xi.center}`,"bottom-right":`${Ei.bottom} ${xi.right}`},Eo={display:"none"},$S=fr(function(){const t=Fe(),e=Le(t.peek().default_expanded),n=Le(!1),{error:i}=We(),r=eo(),o=be(()=>t.value.transcript_enabled||t.value.text_input_enabled),s=be(()=>he("overlay !flex transition-opacity duration-200 data-hidden:opacity-0",zS[t.value.placement]));Et(()=>{i.value&&(o.value?(n.value=!0,e.value=!0):n.value=!1)}),Et(()=>{const u=h=>{var f,g,p;((f=h.detail)==null?void 0:f.action)==="expand"?e.value=!0:((g=h.detail)==null?void 0:g.action)==="collapse"?e.value=!1:((p=h.detail)==null?void 0:p.action)==="toggle"&&(e.value=!e.value)};return document.addEventListener("elevenlabs-agent:expand",u),()=>{document.removeEventListener("elevenlabs-agent:expand",u)}});const a=be(()=>!o.value&&i.value&&!n.value?"error":!r.termsAccepted.value&&r.termsShown.value?"terms":"conversation"),c=be(()=>a.value==="error"),l=be(()=>a.value==="terms"),d=be(()=>a.value==="conversation");return m(Te,{children:[m(He,{initial:!1,active:d,children:m(no,{className:s,style:Eo,children:t.value.always_expanded?m(mm,{open:!0}):m(Te,{children:[o.value&&m(mm,{open:e}),m(FS,{expandable:o.value,expanded:e})]})})}),m(He,{initial:!1,active:l,children:m(no,{className:s,style:Eo,children:m(BS,{})})}),m(He,{initial:!1,active:c,children:m(no,{className:s,style:Eo,children:m(VS,{sawError:n})})}),m(no,{className:s,style:Eo,children:m(qS,{})})]})});function WS(t){return m(ny,{value:t,children:m(ry,{children:m(py,{children:m(dy,{children:m(oy,{children:m(ay,{children:m(cy,{children:m(uy,{children:m(wy,{children:m(Cy,{children:m(Kk,{children:m(Gk,{children:[m(by,{}),m($S,{})]})})})})})})})})})})})})}function HS(t="elevenlabs-convai"){Tm(WS,t,[...Sa],{shadow:!0,mode:"open"})}HS()})();
